(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.PlayerTemplate = {
  name: "human (you)",
  character: "@",
  foreground: "white",
  maxHp: 40,
  attackValue: 10,
  sightRadius: 6,
  inventorySlots: 22,
  mixins: [Game.EntityMixins.PlayerActor, Game.EntityMixins.Attacker, Game.EntityMixins.Destructible, Game.EntityMixins.InventoryHolder, Game.EntityMixins.FoodConsumer, Game.EntityMixins.Sight, Game.EntityMixins.MessageRecipient, Game.EntityMixins.Equipper, Game.EntityMixins.ExperienceGainer, Game.EntityMixins.PlayerStatGainer]
};

},{"./../../game":33}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.EntityRepository == null) {
  Game.EntityRepository = new Game.Repository("entities", Game.Entity);
}

Game.EntityRepository.define("bat", {
  name: "bat",
  character: "B",
  foreground: "white",
  maxHp: 5,
  attackValue: 4,
  speed: 2000,
  mixins: [Game.EntityMixins.TaskActor, Game.EntityMixins.Attacker, Game.EntityMixins.Destructible, Game.EntityMixins.CorpseDropper, Game.EntityMixins.ExperienceGainer, Game.EntityMixins.RandomStatGainer]
});

},{"./../../game":33}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.EntityRepository == null) {
  Game.EntityRepository = new Game.Repository("entities", Game.Entity);
}

Game.EntityRepository.define("fungus", {
  name: "fungus",
  character: "F",
  foreground: "green",
  maxHp: 10,
  speed: 250,
  mixins: [Game.EntityMixins.FungusActor, Game.EntityMixins.Destructible, Game.EntityMixins.ExperienceGainer, Game.EntityMixins.RandomStatGainer]
});

},{"./../../game":33}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityRepository = new Game.Repository("entities", Game.Entity);

Game.EntityRepository.define("giant zombie", {
  name: "giant zombie",
  character: "Z",
  foreground: "teal",
  maxHp: 30,
  attackValue: 8,
  defenseValue: 5,
  level: 5,
  sightRadius: 6,
  mixins: [Game.EntityMixins.GiantZombieActor, Game.EntityMixins.Sight, Game.EntityMixins.Attacker, Game.EntityMixins.Destructible, Game.EntityMixins.CorpseDropper, Game.EntityMixins.ExperienceGainer]
}, {
  disableRandomCreation: true
});

},{"./../../game":33}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityRepository = new Game.Repository("entities", Game.Entity);

Game.EntityRepository.define("kobold", {
  name: "kobold",
  character: "k",
  foreground: "white",
  maxHp: 6,
  attackValue: 4,
  sightRadius: 5,
  tasks: ["hunt", "wander"],
  mixins: [Game.EntityMixins.TaskActor, Game.EntityMixins.Sight, Game.EntityMixins.Attacker, Game.EntityMixins.Destructible, Game.EntityMixins.CorpseDropper, Game.EntityMixins.ExperienceGainer, Game.EntityMixins.RandomStatGainer]
});

},{"./../../game":33}],6:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.EntityRepository == null) {
  Game.EntityRepository = new Game.Repository("entities", Game.Entity);
}

Game.EntityRepository.define("newt", {
  name: "newt",
  character: ":",
  foreground: "yellow",
  maxHp: 3,
  attackValue: 2,
  mixins: [Game.EntityMixins.TaskActor, Game.EntityMixins.Attacker, Game.EntityMixins.Destructible, Game.EntityMixins.CorpseDropper, Game.EntityMixins.ExperienceGainer, Game.EntityMixins.RandomStatGainer]
});

},{"./../../game":33}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityRepository = new Game.Repository("entities", Game.Entity);

Game.EntityRepository.define("slime", {
  name: "slime",
  character: "s",
  foreground: "lightGreen",
  maxHp: 10,
  attackValue: 5,
  sightRadius: 3,
  tasks: ["hunt", "wander"],
  mixins: [Game.EntityMixins.TaskActor, Game.EntityMixins.Sight, Game.EntityMixins.Attacker, Game.EntityMixins.Destructible, Game.EntityMixins.CorpseDropper, Game.EntityMixins.ExperienceGainer, Game.EntityMixins.RandomStatGainer]
});

},{"./../../game":33}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("apple", {
  name: "apple",
  character: "%",
  foreground: "red",
  foodValue: 50,
  mixins: [Game.ItemMixins.Edible]
});

},{"./../../game":33}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("chainmail", {
  name: "chainmail",
  character: "[",
  foreground: "white",
  defenseValue: 4,
  wearable: true,
  mixins: [Game.ItemMixins.Equippable]
}, {
  disableRandomCreation: true
});

},{"./../../game":33}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("corpse", {
  name: "corpse",
  character: "%",
  foodValue: 75,
  consumptions: 1,
  mixins: [Game.ItemMixins.Edible]
}, {
  disableRandomCreation: true
});

},{"./../../game":33}],11:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("dagger", {
  name: "dagger",
  character: ")",
  foreground: "gray",
  attackValue: 5,
  wieldable: true,
  mixins: [Game.ItemMixins.Equippable]
}, {
  disableRandomCreation: true
});

},{"./../../game":33}],12:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("melon", {
  name: "melon",
  character: "%",
  foreground: "lightGreen",
  foodValue: 35,
  consumptions: 4,
  mixins: [Game.ItemMixins.Edible]
});

},{"./../../game":33}],13:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("platemail", {
  name: "platemail",
  character: "[",
  foreground: "aliceblue",
  defenseValue: 6,
  wearable: true,
  mixins: [Game.ItemMixins.Equippable]
}, {
  disableRandomCreation: true
});

},{"./../../game":33}],14:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("pumpkin", {
  name: "pumpkin",
  character: "%",
  foreground: "orange",
  foodValue: 50,
  attackValue: 2,
  defenseValue: 2,
  wearable: true,
  wieldable: true,
  mixins: [Game.ItemMixins.Edible, Game.ItemMixins.Equippable]
});

},{"./../../game":33}],15:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("rock", {
  name: "rock",
  character: "*",
  foreground: "white"
});

},{"./../../game":33}],16:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("staff", {
  name: "staff",
  character: ")",
  foreground: "yellow",
  attackValue: 5,
  defenseValue: 3,
  wieldable: true,
  mixins: [Game.ItemMixins.Equippable]
}, {
  disableRandomCreation: true
});

},{"./../../game":33}],17:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("sword", {
  name: "sword",
  character: ")",
  foreground: "white",
  attackValue: 10,
  wieldable: true,
  mixins: [Game.ItemMixins.Equippable]
}, {
  disableRandomCreation: true
});

},{"./../../game":33}],18:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.ItemRepository == null) {
  Game.ItemRepository = new Game.Repository("items", Game.Item);
}

Game.ItemRepository.define("tunic", {
  name: "tunic",
  character: "[",
  foreground: "green",
  defenseValue: 2,
  wearable: true,
  mixins: [Game.ItemMixins.Equippable]
}, {
  disableRandomCreation: true
});

},{"./../../game":33}],19:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.dropScreen = new Game.Screen.ItemListScreen({
  caption: "Choose the item you wish to drop",
  canSelect: true,
  canSelectMultipleItems: false,
  ok: function(selectedItems) {
    this._player.dropItem(Object.keys(selectedItems)[0]);
    return true;
  }
});

},{"./../../game":33}],20:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.eatScreen = new Game.Screen.ItemListScreen({
  caption: "Choose the item you wish to eat",
  canSelect: true,
  canSelectMultipleItems: false,
  isAcceptable: function(item) {
    return item && item.hasMixin("Edible");
  },
  ok: function(selectedItems) {
    var item, key;
    key = Object.keys(selectedItems)[0];
    item = selectedItems[key];
    Game.sendMessage(this._player, "You eat %s.", [item.describeThe()]);
    item.eat(this._player);
    if (!item.hasRemainingConsumptions()) {
      this._player.removeItem(key);
    }
    return true;
  }
});

},{"./../../game":33}],21:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.examineScreen = new Game.Screen.ItemListScreen({
  caption: "Choose the item you wish to examine",
  canSelect: true,
  canSelectMultipleItems: false,
  isAcceptable: function(item) {
    return true;
  },
  ok: function(selectedItems) {
    var item, keys;
    keys = Object.keys(selectedItems);
    if (keys.length > 0) {
      item = selectedItems[keys[0]];
      Game.sendMessage(this._player, "It's %s (%s).", [item.describeA(false), item.details()]);
    }
    return true;
  }
});

},{"./../../game":33}],22:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.gainStatScreen = {
  setup: function(entity) {
    this._entity = entity;
    return this._options = entity.getStatOptions();
  },
  render: function(display) {
    var i, letters;
    letters = "abcdefghijklmnopqrstuvwxyz";
    display.drawText(0, 0, "Choose a stat to increase: ");
    i = 0;
    while (i < this._options.length) {
      display.drawText(0, 2 + i, letters.substring(i, i + 1) + " - " + this._options[i][0]);
      i++;
    }
    return display.drawText(0, 4 + this._options.length, "Remaining points: " + this._entity.getStatPoints());
  },
  handleInput: function(inputType, inputData) {
    var index;
    if (inputType === "keydown") {
      if (inputData.keyCode >= ROT.VK_A && inputData.keyCode <= ROT.VK_Z) {
        index = inputData.keyCode - ROT.VK_A;
        if (this._options[index]) {
          this._options[index][1].call(this._entity);
          this._entity.setStatPoints(this._entity.getStatPoints() - 1);
          if (this._entity.getStatPoints() === 0) {
            return Game.Screen.playScreen.setSubScreen(undefined);
          } else {
            return Game.refresh();
          }
        }
      }
    }
  }
};

},{"./../../game":33}],23:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.helpScreen = {
  render: function(display) {
    var border, text, y;
    text = "jsrogue help";
    border = "-------------";
    y = 0;
    display.drawText(Game.getScreenWidth() / 2 - text.length / 2, y++, text);
    display.drawText(Game.getScreenWidth() / 2 - text.length / 2, y++, border);
    display.drawText(0, y++, "The villagers have been complaining of a terrible stench coming from the cave.");
    display.drawText(0, y++, "Find the source of this smell and get rid of it!");
    y += 3;
    display.drawText(0, y++, "[,] to pick up items");
    display.drawText(0, y++, "[d] to drop items");
    display.drawText(0, y++, "[e] to eat items");
    display.drawText(0, y++, "[w] to wield items");
    display.drawText(0, y++, "[W] to wield items");
    display.drawText(0, y++, "[x] to examine items");
    display.drawText(0, y++, "[;] to look around you");
    display.drawText(0, y++, "[?] to show this help screen");
    y += 3;
    text = "--- press any key to continue ---";
    return display.drawText(Game.getScreenWidth() / 2 - text.length / 2, y++, text);
  },
  handleInput: function(inputType, inputData) {
    return Game.Screen.playScreen.setSubScreen(null);
  }
};

},{"./../../game":33}],24:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.inventoryScreen = new Game.Screen.ItemListScreen({
  caption: "Inventory",
  canSelect: false
});

},{"./../../game":33}],25:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.lookScreen = new Game.Screen.TargetBasedScreen({
  captionFunction: function(x, y) {
    var entity, item, items, map, z;
    z = this._player.getZ();
    map = this._player.getMap();
    if (map.isExplored(x, y, z)) {
      if (this._visibleCells[x + "," + y]) {
        items = map.getItemsAt(x, y, z);
        if (items) {
          item = items[items.length - 1];
          return String.format("%s - %s (%s)", item.getRepresentation(), item.describeA(true), item.details());
        } else if (map.getEntityAt(x, y, z)) {
          entity = map.getEntityAt(x, y, z);
          return String.format("%s - %s (%s)", entity.getRepresentation(), entity.describeA(true), entity.details());
        }
      }
      return String.format("%s - %s", map.getTile(x, y, z).getRepresentation(), map.getTile(x, y, z).getDescription());
    } else {
      return String.format("%s - %s", Game.Tile.nullTile.getRepresentation(), Game.Tile.nullTile.getDescription());
    }
  }
});

},{"./../../game":33}],26:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.loseScreen = {
  enter: function() {
    return console.log("Entered lose screen.");
  },
  exit: function() {
    return console.log("Exited lose screen.");
  },
  render: function(display) {
    var i, _results;
    i = 0;
    _results = [];
    while (i < 22) {
      display.drawText(2, i + 1, "%b{red}You lose! :(");
      _results.push(i++);
    }
    return _results;
  },
  handleInput: function(inputType, inputData) {}
};

},{"./../../game":33}],27:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.pickupScreen = new Game.Screen.ItemListScreen({
  caption: "Choose the items you wish to pickup",
  canSelect: true,
  canSelectMultipleItems: true,
  ok: function(selectedItems) {
    if (!this._player.pickupItems(Object.keys(selectedItems))) {
      Game.sendMessage(this._player, "Your inventory is full! Not all items were picked up.");
    }
    return true;
  }
});

},{"./../../game":33}],28:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.playScreen = {
  _player: null,
  _gameEnded: false,
  _subScreen: null,
  enter: function() {
    var depth, height, map, tiles, width;
    width = 100;
    height = 48;
    depth = 6;
    this._player = new Game.Entity(Game.PlayerTemplate);
    tiles = new Game.Builder(width, height, depth).getTiles();
    map = new Game.Map.Cave(tiles, this._player);
    return map.getEngine().start();
  },
  exit: function() {
    return console.log("Exited play screen.");
  },
  render: function(display) {
    var hungerState, i, messageY, messages, screenHeight, screenWidth, stats;
    if (this._subScreen) {
      this._subScreen.render(display);
      return;
    }
    screenWidth = Game.getScreenWidth();
    screenHeight = Game.getScreenHeight();
    this.renderTiles(display);
    messages = this._player.getMessages();
    messageY = 0;
    i = 0;
    while (i < messages.length) {
      messageY += display.drawText(0, messageY, "%c{white}%b{black}" + messages[i]);
      i++;
    }
    stats = "%c{white}%b{black}";
    stats += vsprintf("HP: %d/%d L: %d XP: %d", [this._player.getHp(), this._player.getMaxHp(), this._player.getLevel(), this._player.getExperience()]);
    display.drawText(0, screenHeight, stats);
    hungerState = this._player.getHungerState();
    return display.drawText(screenWidth - hungerState.length, screenHeight, hungerState);
  },
  getScreenOffsets: function() {
    var topLeftX, topLeftY;
    topLeftX = Math.max(0, this._player.getX() - (Game.getScreenWidth() / 2));
    topLeftX = Math.min(topLeftX, this._player.getMap().getWidth() - Game.getScreenWidth());
    topLeftY = Math.max(0, this._player.getY() - (Game.getScreenHeight() / 2));
    topLeftY = Math.min(topLeftY, this._player.getMap().getHeight() - Game.getScreenHeight());
    return {
      x: topLeftX,
      y: topLeftY
    };
  },
  renderTiles: function(display) {
    var currentDepth, foreground, glyph, items, map, offsets, screenHeight, screenWidth, topLeftX, topLeftY, visibleCells, x, y, _results;
    screenWidth = Game.getScreenWidth();
    screenHeight = Game.getScreenHeight();
    offsets = this.getScreenOffsets();
    topLeftX = offsets.x;
    topLeftY = offsets.y;
    visibleCells = {};
    map = this._player.getMap();
    currentDepth = this._player.getZ();
    map.getFov(currentDepth).compute(this._player.getX(), this._player.getY(), this._player.getSightRadius(), function(x, y, radius, visibility) {
      visibleCells[x + "," + y] = true;
      return map.setExplored(x, y, currentDepth, true);
    });
    x = topLeftX;
    _results = [];
    while (x < topLeftX + screenWidth) {
      y = topLeftY;
      while (y < topLeftY + screenHeight) {
        if (map.isExplored(x, y, currentDepth)) {
          glyph = map.getTile(x, y, currentDepth);
          foreground = glyph.getForeground();
          if (visibleCells[x + "," + y]) {
            items = map.getItemsAt(x, y, currentDepth);
            if (items) {
              glyph = items[items.length - 1];
            }
            if (map.getEntityAt(x, y, currentDepth)) {
              glyph = map.getEntityAt(x, y, currentDepth);
            }
            foreground = glyph.getForeground();
          } else {
            foreground = "darkGray";
          }
          display.draw(x - topLeftX, y - topLeftY, glyph.getChar(), foreground, glyph.getBackground());
        }
        y++;
      }
      _results.push(x++);
    }
    return _results;
  },
  handleInput: function(inputType, inputData) {
    var item, items, keyChar, offsets;
    if (this._gameEnded) {
      if (inputType === "keydown" && inputData.keyCode === ROT.VK_RETURN) {
        Game.switchScreen(Game.Screen.loseScreen);
      }
      return;
    }
    if (this._subScreen) {
      this._subScreen.handleInput(inputType, inputData);
      return;
    }
    if (inputType === "keydown") {
      if (inputData.keyCode === ROT.VK_LEFT) {
        this.move(-1, 0, 0);
      } else if (inputData.keyCode === ROT.VK_RIGHT) {
        this.move(1, 0, 0);
      } else if (inputData.keyCode === ROT.VK_UP) {
        this.move(0, -1, 0);
      } else if (inputData.keyCode === ROT.VK_DOWN) {
        this.move(0, 1, 0);
      } else if (inputData.keyCode === ROT.VK_I) {
        this.showItemsSubScreen(Game.Screen.inventoryScreen, this._player.getItems(), "You are not carrying anything.");
        return;
      } else if (inputData.keyCode === ROT.VK_D) {
        this.showItemsSubScreen(Game.Screen.dropScreen, this._player.getItems(), "You have nothing to drop.");
        return;
      } else if (inputData.keyCode === ROT.VK_E) {
        this.showItemsSubScreen(Game.Screen.eatScreen, this._player.getItems(), "You have nothing to eat.");
        return;
      } else if (inputData.keyCode === ROT.VK_W) {
        if (inputData.shiftKey) {
          this.showItemsSubScreen(Game.Screen.wearScreen, this._player.getItems(), "You have nothing to wear.");
        } else {
          this.showItemsSubScreen(Game.Screen.wieldScreen, this._player.getItems(), "You have nothing to wield.");
        }
        return;
      } else if (inputData.keyCode === ROT.VK_X) {
        this.showItemsSubScreen(Game.Screen.examineScreen, this._player.getItems(), "You have nothing to examine.");
        return;
      } else if (inputData.keyCode === ROT.VK_COMMA) {
        items = this._player.getMap().getItemsAt(this._player.getX(), this._player.getY(), this._player.getZ());
        if (items && items.length === 1) {
          item = items[0];
          if (this._player.pickupItems([0])) {
            Game.sendMessage(this._player, "You pick up %s.", [item.describeA()]);
          } else {
            Game.sendMessage(this._player, "Your inventory is full! Nothing was picked up.");
          }
        } else {
          this.showItemsSubScreen(Game.Screen.pickupScreen, items, "There is nothing here to pick up.");
        }
      } else {
        return;
      }
      return this._player.getMap().getEngine().unlock();
    } else if (inputType === "keypress") {
      keyChar = String.fromCharCode(inputData.charCode);
      if (keyChar === ">") {
        this.move(0, 0, 1);
      } else if (keyChar === "<") {
        this.move(0, 0, -1);
      } else if (keyChar === ";") {
        offsets = this.getScreenOffsets();
        Game.Screen.lookScreen.setup(this._player, this._player.getX(), this._player.getY(), offsets.x, offsets.y);
        this.setSubScreen(Game.Screen.lookScreen);
        return;
      } else if (keyChar === "?") {
        this.setSubScreen(Game.Screen.helpScreen);
        return;
      } else {
        return;
      }
      return this._player.getMap().getEngine().unlock();
    }
  },
  move: function(dX, dY, dZ) {
    var newX, newY, newZ;
    newX = this._player.getX() + dX;
    newY = this._player.getY() + dY;
    newZ = this._player.getZ() + dZ;
    return this._player.tryMove(newX, newY, newZ, this._player.getMap());
  },
  setGameEnded: function(gameEnded) {
    return this._gameEnded = gameEnded;
  },
  setSubScreen: function(subScreen) {
    this._subScreen = subScreen;
    return Game.refresh();
  },
  showItemsSubScreen: function(subScreen, items, emptyMessage) {
    if (items && subScreen.setup(this._player, items) > 0) {
      return this.setSubScreen(subScreen);
    } else {
      Game.sendMessage(this._player, emptyMessage);
      return Game.refresh();
    }
  }
};

},{"./../../game":33}],29:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.startScreen = {
  enter: function() {
    return console.log("Entered start screen.");
  },
  exit: function() {
    return console.log("Exited start screen.");
  },
  render: function(display) {
    display.drawText(1, 1, "%c{yellow}Javascript Roguelike");
    return display.drawText(1, 2, "Press [Enter] to start!");
  },
  handleInput: function(inputType, inputData) {
    if (inputType === "keydown") {
      if (inputData.keyCode === ROT.VK_RETURN) {
        return Game.switchScreen(Game.Screen.playScreen);
      }
    }
  }
};

},{"./../../game":33}],30:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.wearScreen = new Game.Screen.ItemListScreen({
  caption: "Choose the item you wish to wear",
  canSelect: true,
  canSelectMultipleItems: false,
  hasNoItemOption: true,
  isAcceptable: function(item) {
    return item && item.hasMixin("Equippable") && item.isWearable();
  },
  ok: function(selectedItems) {
    var item, keys;
    keys = Object.keys(selectedItems);
    if (keys.length === 0) {
      this._player.unwield();
      Game.sendMessage(this._player, "You are not wearing anthing.");
    } else {
      item = selectedItems[keys[0]];
      this._player.unequip(item);
      this._player.wear(item);
      Game.sendMessage(this._player, "You are wearing %s.", [item.describeA()]);
    }
    return true;
  }
});

},{"./../../game":33}],31:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.wieldScreen = new Game.Screen.ItemListScreen({
  caption: "Choose the item you wish to wield",
  canSelect: true,
  canSelectMultipleItems: false,
  hasNoItemOption: true,
  isAcceptable: function(item) {
    return item && item.hasMixin("Equippable") && item.isWieldable();
  },
  ok: function(selectedItems) {
    var item, keys;
    keys = Object.keys(selectedItems);
    if (keys.length === 0) {
      this._player.unwield();
      Game.sendMessage(this._player, "You are empty handed.");
    } else {
      item = selectedItems[keys[0]];
      this._player.unequip(item);
      this._player.wield(item);
      Game.sendMessage(this._player, "You are wielding %s.", [item.describeA()]);
    }
    return true;
  }
});

},{"./../../game":33}],32:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.winScreen = {
  enter: function() {
    return console.log("Entered win screen.");
  },
  exit: function() {
    return console.log("Exited win screen.");
  },
  render: function(display) {
    var b, background, g, i, r, _results;
    i = 0;
    _results = [];
    while (i < 22) {
      r = Math.round(Math.random() * 255);
      g = Math.round(Math.random() * 255);
      b = Math.round(Math.random() * 255);
      background = ROT.Color.toRGB([r, g, b]);
      display.drawText(2, i + 1, "%b{" + background + "}You win!");
      _results.push(i++);
    }
    return _results;
  },
  handleInput: function(inputType, inputData) {}
};

},{"./../../game":33}],33:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

module.exports = Game = {
  _display: null,
  _currentScreen: null,
  _screenWidth: 80,
  _screenHeight: 24,
  init: function() {
    var bindEventToScreen;
    require('./game/Glyph');
    require('./game/DynamicGlyph');
    require('./game/Tile');
    require('./game/Builder');
    require('./game/Map');
    require('./game/map/Cave');
    require('./game/map/BossCavern');
    require('./game/screen/ItemListScreen');
    require('./game/screen/TargetBasedScreen');
    require('./game/Entity');
    require('./game/entity/PlayerActor');
    require('./game/entity/FungusActor');
    require('./game/entity/TaskActor');
    require('./game/entity/GiantZombieActor');
    require('./game/entity/Attacker');
    require('./game/entity/Destructible');
    require('./game/entity/MessageRecipient');
    require('./game/entity/Sight');
    require('./game/entity/InventoryHolder');
    require('./game/entity/FoodConsumer');
    require('./game/entity/CorpseDropper');
    require('./game/entity/Equipper');
    require('./game/entity/ExperienceGainer');
    require('./game/entity/RandomStatGainer');
    require('./game/entity/PlayerStatGainer');
    require('./game/Item');
    require('./game/item/Edible');
    require('./game/item/Equippable');
    require('./game/Repository');
    require('./data/screens/dropScreen');
    require('./data/screens/eatScreen');
    require('./data/screens/examineScreen');
    require('./data/screens/gainStatScreen');
    require('./data/screens/helpScreen');
    require('./data/screens/inventoryScreen');
    require('./data/screens/lookScreen');
    require('./data/screens/loseScreen');
    require('./data/screens/pickupScreen');
    require('./data/screens/playScreen');
    require('./data/screens/startScreen');
    require('./data/screens/wearScreen');
    require('./data/screens/wieldScreen');
    require('./data/screens/winScreen');
    require('./data/entities/PlayerTemplate');
    require('./data/entities/bat');
    require('./data/entities/fungus');
    require('./data/entities/giant_zombie');
    require('./data/entities/kobold');
    require('./data/entities/newt');
    require('./data/entities/slime');
    require('./data/items/apple');
    require('./data/items/melon');
    require('./data/items/pumpkin');
    require('./data/items/corpse');
    require('./data/items/rock');
    require('./data/items/dagger');
    require('./data/items/sword');
    require('./data/items/staff');
    require('./data/items/tunic');
    require('./data/items/chainmail');
    require('./data/items/platemail');
    this._display = new ROT.Display({
      width: this._screenWidth,
      height: this._screenHeight + 1
    });
    bindEventToScreen = (function(_this) {
      return function(event) {
        window.addEventListener(event, function(e) {
          if (_this._currentScreen != null) {
            _this._currentScreen.handleInput(event, e);
          }
        });
      };
    })(this);
    bindEventToScreen("keydown");
    bindEventToScreen("keypress");
  },
  getDisplay: function() {
    return this._display;
  },
  getScreenWidth: function() {
    return this._screenWidth;
  },
  getScreenHeight: function() {
    return this._screenHeight;
  },
  refresh: function() {
    this._display.clear();
    this._currentScreen.render(this._display);
  },
  switchScreen: function(screen) {
    if (this._currentScreen !== null) {
      this._currentScreen.exit();
    }
    this.getDisplay().clear();
    this._currentScreen = screen;
    if (!this._currentScreen !== null) {
      this._currentScreen.enter();
      this.refresh();
    }
  },
  merge: function(src, dest) {
    var key, result;
    result = {};
    for (key in src) {
      result[key] = src[key];
    }
    for (key in dest) {
      result[key] = dest[key];
    }
    return result;
  },
  getNeighborPositions: function(x, y) {
    var dX, dY, tiles, _i, _j;
    tiles = [];
    for (dX = _i = -1; _i < 2; dX = ++_i) {
      for (dY = _j = -1; _j < 2; dY = ++_j) {
        if (dX === 0 && dY === 0) {
          continue;
        }
        tiles.push({
          x: x + dX,
          y: y + dY
        });
      }
    }
    return tiles.randomize();
  },
  sendMessage: function(recipient, message, args) {
    if (recipient.hasMixin(Game.EntityMixins.MessageRecipient)) {
      if (args) {
        message = vsprintf(message, args);
      }
      return recipient.receiveMessage(message);
    }
  },
  sendMessageNearby: function(map, centerX, centerY, centerZ, message, args) {
    var entities, i, _results;
    if (args) {
      message = vsprintf(message, args);
    }
    entities = map.getEntitiesWithinRadius(centerX, centerY, centerZ, 5);
    i = 0;
    _results = [];
    while (i < entities.length) {
      if (entities[i].hasMixin(Game.EntityMixins.MessageRecipient)) {
        entities[i].receiveMessage(message);
      }
      _results.push(i++);
    }
    return _results;
  },
  getLine: function(startX, startY, endX, endY) {
    var dx, dy, e2, err, points, sx, sy;
    points = [];
    dx = Math.abs(endX - startX);
    dy = Math.abs(endY - startY);
    sx = (startX < endX ? 1 : -1);
    sy = (startY < endY ? 1 : -1);
    err = dx - dy;
    e2 = void 0;
    while (true) {
      points.push({
        x: startX,
        y: startY
      });
      if (startX === endX && startY === endY) {
        break;
      }
      e2 = err * 2;
      if (e2 > -dx) {
        err -= dy;
        startX += sx;
      }
      if (e2 < dx) {
        err += dx;
        startY += sy;
      }
    }
    return points;
  }
};

},{"./data/entities/PlayerTemplate":1,"./data/entities/bat":2,"./data/entities/fungus":3,"./data/entities/giant_zombie":4,"./data/entities/kobold":5,"./data/entities/newt":6,"./data/entities/slime":7,"./data/items/apple":8,"./data/items/chainmail":9,"./data/items/corpse":10,"./data/items/dagger":11,"./data/items/melon":12,"./data/items/platemail":13,"./data/items/pumpkin":14,"./data/items/rock":15,"./data/items/staff":16,"./data/items/sword":17,"./data/items/tunic":18,"./data/screens/dropScreen":19,"./data/screens/eatScreen":20,"./data/screens/examineScreen":21,"./data/screens/gainStatScreen":22,"./data/screens/helpScreen":23,"./data/screens/inventoryScreen":24,"./data/screens/lookScreen":25,"./data/screens/loseScreen":26,"./data/screens/pickupScreen":27,"./data/screens/playScreen":28,"./data/screens/startScreen":29,"./data/screens/wearScreen":30,"./data/screens/wieldScreen":31,"./data/screens/winScreen":32,"./game/Builder":34,"./game/DynamicGlyph":35,"./game/Entity":36,"./game/Glyph":37,"./game/Item":38,"./game/Map":39,"./game/Repository":40,"./game/Tile":41,"./game/entity/Attacker":42,"./game/entity/CorpseDropper":43,"./game/entity/Destructible":44,"./game/entity/Equipper":45,"./game/entity/ExperienceGainer":46,"./game/entity/FoodConsumer":47,"./game/entity/FungusActor":48,"./game/entity/GiantZombieActor":49,"./game/entity/InventoryHolder":50,"./game/entity/MessageRecipient":51,"./game/entity/PlayerActor":52,"./game/entity/PlayerStatGainer":53,"./game/entity/RandomStatGainer":54,"./game/entity/Sight":55,"./game/entity/TaskActor":56,"./game/item/Edible":57,"./game/item/Equippable":58,"./game/map/BossCavern":59,"./game/map/Cave":60,"./game/screen/ItemListScreen":61,"./game/screen/TargetBasedScreen":62}],34:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../game');

Game.Builder = (function() {
  function Builder(width, height, depth) {
    var x, y, z;
    this._width = width;
    this._height = height;
    this._depth = depth;
    this._tiles = new Array(depth);
    this._regions = new Array(depth);
    z = 0;
    while (z < depth) {
      this._tiles[z] = this._generateLevel();
      this._regions[z] = new Array(width);
      x = 0;
      while (x < width) {
        this._regions[z][x] = new Array(height);
        y = 0;
        while (y < height) {
          this._regions[z][x][y] = 0;
          y++;
        }
        x++;
      }
      z++;
    }
    z = 0;
    while (z < this._depth) {
      this._setupRegions(z);
      z++;
    }
    this._connectAllRegions();
    return;
  }

  Builder.prototype.getTiles = function() {
    return this._tiles;
  };

  Builder.prototype.getDepth = function() {
    return this._depth;
  };

  Builder.prototype.getWidth = function() {
    return this._width;
  };

  Builder.prototype.getHeight = function() {
    return this._height;
  };

  Builder.prototype._generateLevel = function() {
    var generator, i, map, totalIterations, w;
    map = new Array(this._width);
    w = 0;
    while (w < this._width) {
      map[w] = new Array(this._height);
      w++;
    }
    generator = new ROT.Map.Cellular(this._width, this._height);
    generator.randomize(0.5);
    totalIterations = 3;
    i = 0;
    while (i < totalIterations - 1) {
      generator.create();
      i++;
    }
    generator.create(function(x, y, v) {
      if (v === 1) {
        return map[x][y] = Game.Tile.floorTile;
      } else {
        return map[x][y] = Game.Tile.wallTile;
      }
    });
    return map;
  };

  Builder.prototype._canFillRegion = function(x, y, z) {
    if (x < 0 || y < 0 || z < 0 || x >= this._width || y >= this._height || z >= this._depth) {
      return false;
    }
    if (this._regions[z][x][y] !== 0) {
      return false;
    }
    return this._tiles[z][x][y].isWalkable();
  };

  Builder.prototype._fillRegion = function(region, x, y, z) {
    var neighbors, tile, tiles, tilesFilled;
    tilesFilled = 1;
    tiles = [
      {
        x: x,
        y: y
      }
    ];
    tile = void 0;
    neighbors = void 0;
    this._regions[z][x][y] = region;
    while (tiles.length > 0) {
      tile = tiles.pop();
      neighbors = Game.getNeighborPositions(tile.x, tile.y);
      while (neighbors.length > 0) {
        tile = neighbors.pop();
        if (this._canFillRegion(tile.x, tile.y, z)) {
          this._regions[z][tile.x][tile.y] = region;
          tiles.push(tile);
          tilesFilled++;
        }
      }
    }
    return tilesFilled;
  };

  Builder.prototype._removeRegion = function(region, z) {
    var x, y;
    x = 0;
    while (x < this._width) {
      y = 0;
      while (y < this._height) {
        if (this._regions[z][x][y] === region) {
          this._regions[z][x][y] = 0;
          this._tiles[z][x][y] = Game.Tile.wallTile;
        }
        y++;
      }
      x++;
    }
  };

  Builder.prototype._setupRegions = function(z) {
    var region, tilesFilled, x, y;
    region = 1;
    tilesFilled = void 0;
    x = 0;
    while (x < this._width) {
      y = 0;
      while (y < this._height) {
        if (this._canFillRegion(x, y, z)) {
          tilesFilled = this._fillRegion(region, x, y, z);
          if (tilesFilled <= 20) {
            this._removeRegion(region, z);
          } else {
            region++;
          }
        }
        y++;
      }
      x++;
    }
  };

  Builder.prototype._findRegionOverlaps = function(z, r1, r2) {
    var matches, x, y;
    matches = [];
    x = 0;
    while (x < this._width) {
      y = 0;
      while (y < this._height) {
        if (this._tiles[z][x][y] === Game.Tile.floorTile && this._tiles[z + 1][x][y] === Game.Tile.floorTile && this._regions[z][x][y] === r1 && this._regions[z + 1][x][y] === r2) {
          matches.push({
            x: x,
            y: y
          });
        }
        y++;
      }
      x++;
    }
    return matches.randomize();
  };

  Builder.prototype._connectRegions = function(z, r1, r2) {
    var overlap, point;
    overlap = this._findRegionOverlaps(z, r1, r2);
    if (overlap.length === 0) {
      return false;
    }
    point = overlap[0];
    this._tiles[z][point.x][point.y] = Game.Tile.stairsDownTile;
    this._tiles[z + 1][point.x][point.y] = Game.Tile.stairsUpTile;
    return true;
  };

  Builder.prototype._connectAllRegions = function() {
    var connected, key, x, y, z;
    z = 0;
    while (z < this._depth - 1) {
      connected = {};
      key = void 0;
      x = 0;
      while (x < this._width) {
        y = 0;
        while (y < this._height) {
          key = this._regions[z][x][y] + "," + this._regions[z + 1][x][y];
          if (this._tiles[z][x][y] === Game.Tile.floorTile && this._tiles[z + 1][x][y] === Game.Tile.floorTile && !connected[key]) {
            this._connectRegions(z, this._regions[z][x][y], this._regions[z + 1][x][y]);
            connected[key] = true;
          }
          y++;
        }
        x++;
      }
      z++;
    }
  };

  return Builder;

})();

},{"./../game":33}],35:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Game = require('./../game');

Game.DynamicGlyph = (function(_super) {
  __extends(DynamicGlyph, _super);

  function DynamicGlyph(properties) {
    var i, key, mixins;
    properties = properties || {};
    DynamicGlyph.__super__.constructor.call(this, properties);
    this._name = properties["name"] || "";
    this._attachedMixins = {};
    this._attachedMixinGroups = {};
    this._listeners = {};
    mixins = properties["mixins"] || [];
    i = 0;
    while (i < mixins.length) {
      for (key in mixins[i]) {
        if (key !== "init" && key !== "name" && key !== "listeners" && !this.hasOwnProperty(key)) {
          this[key] = mixins[i][key];
        }
      }
      this._attachedMixins[mixins[i].name] = true;
      if (mixins[i].groupName) {
        this._attachedMixinGroups[mixins[i].groupName] = true;
      }
      if (mixins[i].listeners) {
        for (key in mixins[i].listeners) {
          if (!this._listeners[key]) {
            this._listeners[key] = [];
          }
          this._listeners[key].push(mixins[i].listeners[key]);
        }
      }
      if (mixins[i].init) {
        mixins[i].init.call(this, properties);
      }
      i++;
    }
    return;
  }

  DynamicGlyph.prototype.hasMixin = function(obj) {
    if (typeof obj === "object") {
      return this._attachedMixins[obj.name];
    } else {
      return this._attachedMixins[obj] || this._attachedMixinGroups[obj];
    }
  };

  DynamicGlyph.prototype.setName = function(name) {
    return this._name = name;
  };

  DynamicGlyph.prototype.getName = function() {
    return this._name;
  };

  DynamicGlyph.prototype.describe = function() {
    return this._name;
  };

  DynamicGlyph.prototype.describeA = function(capitalize) {
    var firstLetter, prefix, prefixes, string;
    prefixes = (capitalize ? ["A", "An"] : ["a", "an"]);
    string = this.describe();
    firstLetter = string.charAt(0).toLowerCase();
    prefix = ("aeiou".indexOf(firstLetter) >= 0 ? 1 : 0);
    return prefixes[prefix] + " " + string;
  };

  DynamicGlyph.prototype.describeThe = function(capitalize) {
    var prefix;
    prefix = (capitalize ? "The" : "the");
    return prefix + " " + this.describe();
  };

  DynamicGlyph.prototype.raiseEvent = function(event) {
    var args, i, results;
    if (!this._listeners[event]) {
      return;
    }
    args = Array.prototype.slice.call(arguments, 1);
    results = [];
    i = 0;
    while (i < this._listeners[event].length) {
      results.push(this._listeners[event][i].apply(this, args));
      i++;
    }
    return results;
  };

  DynamicGlyph.prototype.details = function() {
    var detailGroups, details, i, j, l;
    details = [];
    detailGroups = this.raiseEvent("details");
    if (detailGroups) {
      i = 0;
      l = detailGroups.length;
      while (i < l) {
        if (detailGroups[i]) {
          j = 0;
          while (j < detailGroups[i].length) {
            details.push(detailGroups[i][j].key + ": " + detailGroups[i][j].value);
            j++;
          }
        }
        i++;
      }
    }
    return details.join(", ");
  };

  return DynamicGlyph;

})(Game.Glyph);

},{"./../game":33}],36:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Game = require('./../game');

Game.Entity = (function(_super) {
  __extends(Entity, _super);

  function Entity(properties) {
    properties = properties || {};
    Entity.__super__.constructor.call(this, properties);
    this._x = properties["x"] || 0;
    this._y = properties["y"] || 0;
    this._z = properties["z"] || 0;
    this._map = null;
    this._alive = true;
    this._speed = properties["speed"] || 1000;
    return;
  }

  Entity.prototype.setX = function(x) {
    this._x = x;
  };

  Entity.prototype.setY = function(y) {
    this._y = y;
  };

  Entity.prototype.setZ = function(z) {
    this._z = z;
  };

  Entity.prototype.setMap = function(map) {
    this._map = map;
  };

  Entity.prototype.setSpeed = function(speed) {
    this._speed = speed;
  };

  Entity.prototype.setPosition = function(x, y, z) {
    var oldX, oldY, oldZ;
    oldX = this._x;
    oldY = this._y;
    oldZ = this._z;
    this._x = x;
    this._y = y;
    this._z = z;
    if (this._map) {
      this._map.updateEntityPosition(this, oldX, oldY, oldZ);
    }
  };

  Entity.prototype.getX = function() {
    return this._x;
  };

  Entity.prototype.getY = function() {
    return this._y;
  };

  Entity.prototype.getZ = function() {
    return this._z;
  };

  Entity.prototype.getMap = function() {
    return this._map;
  };

  Entity.prototype.getSpeed = function() {
    return this._speed;
  };

  Entity.prototype.tryMove = function(x, y, z, map) {
    var items, target, tile;
    map = this.getMap();
    tile = map.getTile(x, y, this.getZ());
    target = map.getEntityAt(x, y, this.getZ());
    if (z < this.getZ()) {
      if (tile !== Game.Tile.stairsUpTile) {
        Game.sendMessage(this, "You can't go up here!");
      } else {
        Game.sendMessage(this, "You ascend to level %d!", [z + 1]);
        this.setPosition(x, y, z);
      }
    } else if (z > this.getZ()) {
      if (tile === Game.Tile.holeToCavernTile && this.hasMixin(Game.EntityMixins.PlayerActor)) {
        this.switchMap(new Game.Map.BossCavern());
      } else if (tile !== Game.Tile.stairsDownTile) {
        Game.sendMessage(this, "You can't go down here!");
      } else {
        this.setPosition(x, y, z);
        Game.sendMessage(this, "You descend to level %d!", [z + 1]);
      }
    } else if (target) {
      if (this.hasMixin("Attacker") && (this.hasMixin(Game.EntityMixins.PlayerActor) || target.hasMixin(Game.EntityMixins.PlayerActor))) {
        this.attack(target);
        return true;
      }
      return false;
    } else if (tile.isWalkable()) {
      this.setPosition(x, y, z);
      items = this.getMap().getItemsAt(x, y, z);
      if (items) {
        if (items.length === 1) {
          Game.sendMessage(this, "You see %s.", [items[0].describeA()]);
        } else {
          Game.sendMessage(this, "There are several objects here.");
        }
      }
      return true;
    } else if (tile.isDiggable()) {
      if (this.hasMixin(Game.EntityMixins.PlayerActor)) {
        map.dig(x, y, z);
        return true;
      }
      return false;
    }
    return false;
  };

  Entity.prototype.isAlive = function() {
    return this._alive;
  };

  Entity.prototype.kill = function(message) {
    if (!this._alive) {
      return;
    }
    this._alive = false;
    if (message) {
      Game.sendMessage(this, message);
    } else {
      Game.sendMessage(this, "You have died!");
    }
    if (this.hasMixin(Game.EntityMixins.PlayerActor)) {
      this.act();
    } else {
      this.getMap().removeEntity(this);
    }
  };

  Entity.prototype.switchMap = function(newMap) {
    if (newMap === this.getMap()) {
      return;
    }
    this.getMap().removeEntity(this);
    this._x = 0;
    this._y = 0;
    this._z = 0;
    newMap.addEntity(this);
  };

  return Entity;

})(Game.DynamicGlyph);

Game.EntityMixins = {};

},{"./../game":33}],37:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../game');

Game.Glyph = (function() {
  function Glyph(properties) {
    properties = properties || {};
    this._char = properties["character"] || " ";
    this._foreground = properties["foreground"] || "white";
    this._background = properties["background"] || "black";
  }

  Glyph.prototype.getChar = function() {
    return this._char;
  };

  Glyph.prototype.getBackground = function() {
    return this._background;
  };

  Glyph.prototype.getForeground = function() {
    return this._foreground;
  };

  Glyph.prototype.getRepresentation = function() {
    return "%c{" + this._foreground + "}%b{" + this._background + "}" + this._char + "%c{white}%b{black}";
  };

  return Glyph;

})();

},{"./../game":33}],38:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Game = require('./../game');

Game.Item = (function(_super) {
  __extends(Item, _super);

  function Item(properties) {
    properties = properties || {};
    Item.__super__.constructor.call(this, properties);
    return;
  }

  return Item;

})(Game.DynamicGlyph);

Game.ItemMixins = {};

},{"./../game":33}],39:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../game');

Game.Map = (function() {
  function Map(tiles) {
    this._tiles = tiles;
    this._depth = tiles.length;
    this._width = tiles[0].length;
    this._height = tiles[0][0].length;
    this._fov = [];
    this.setupFov();
    this._entities = {};
    this._items = {};
    this._scheduler = new ROT.Scheduler.Speed();
    this._engine = new ROT.Engine(this._scheduler);
    this._explored = new Array(this._depth);
    this._setupExploredArray();
    return;
  }

  Map.prototype._setupExploredArray = function() {
    var x, y, z;
    z = 0;
    while (z < this._depth) {
      this._explored[z] = new Array(this._width);
      x = 0;
      while (x < this._width) {
        this._explored[z][x] = new Array(this._height);
        y = 0;
        while (y < this._height) {
          this._explored[z][x][y] = false;
          y++;
        }
        x++;
      }
      z++;
    }
  };

  Map.prototype.getDepth = function() {
    return this._depth;
  };

  Map.prototype.getWidth = function() {
    return this._width;
  };

  Map.prototype.getHeight = function() {
    return this._height;
  };

  Map.prototype.getTile = function(x, y, z) {
    if (x < 0 || x >= this._width || y < 0 || y >= this._height || z < 0 || z >= this._depth) {
      return Game.Tile.nullTile;
    } else {
      return this._tiles[z][x][y] || Game.Tile.nullTile;
    }
  };

  Map.prototype.dig = function(x, y, z) {
    if (this.getTile(x, y, z).isDiggable()) {
      this._tiles[z][x][y] = Game.Tile.floorTile;
    }
  };

  Map.prototype.isEmptyFloor = function(x, y, z) {
    return this.getTile(x, y, z) === Game.Tile.floorTile && !this.getEntityAt(x, y, z);
  };

  Map.prototype.setExplored = function(x, y, z, state) {
    if (this.getTile(x, y, z) !== Game.Tile.nullTile) {
      this._explored[z][x][y] = state;
    }
  };

  Map.prototype.isExplored = function(x, y, z) {
    if (this.getTile(x, y, z) !== Game.Tile.nullTile) {
      return this._explored[z][x][y];
    } else {
      return false;
    }
  };

  Map.prototype.setupFov = function() {
    var map, z;
    map = this;
    z = 0;
    while (z < this._depth) {
      (function() {
        var depth;
        depth = z;
        return map._fov.push(new ROT.FOV.DiscreteShadowcasting(function(x, y) {
          return !map.getTile(x, y, depth).isBlockingLight();
        }, {
          topology: 4
        }));
      })();
      z++;
    }
  };

  Map.prototype.getFov = function(depth) {
    return this._fov[depth];
  };

  Map.prototype.getEngine = function() {
    return this._engine;
  };

  Map.prototype.getEntities = function() {
    return this._entities;
  };

  Map.prototype.getEntityAt = function(x, y, z) {
    return this._entities[x + "," + y + "," + z];
  };

  Map.prototype.getEntitiesWithinRadius = function(centerX, centerY, centerZ, radius) {
    var bottomY, entity, key, leftX, results, rightX, topY;
    results = [];
    leftX = centerX - radius;
    rightX = centerX + radius;
    topY = centerY - radius;
    bottomY = centerY + radius;
    for (key in this._entities) {
      entity = this._entities[key];
      if (entity.getX() >= leftX && entity.getX() <= rightX && entity.getY() >= topY && entity.getY() <= bottomY && entity.getZ() === centerZ) {
        results.push(entity);
      }
    }
    return results;
  };

  Map.prototype.getRandomFloorPosition = function(z) {
    var x, y;
    x = void 0;
    y = void 0;
    while (true) {
      x = Math.floor(Math.random() * this._width);
      y = Math.floor(Math.random() * this._height);
      if (!!this.isEmptyFloor(x, y, z)) {
        break;
      }
    }
    return {
      x: x,
      y: y,
      z: z
    };
  };

  Map.prototype.addEntityAtRandomPosition = function(entity, z) {
    var position;
    position = this.getRandomFloorPosition(z);
    entity.setX(position.x);
    entity.setY(position.y);
    entity.setZ(position.z);
    this.addEntity(entity);
  };

  Map.prototype.addEntity = function(entity) {
    entity.setMap(this);
    this.updateEntityPosition(entity);
    if (entity.hasMixin("Actor")) {
      this._scheduler.add(entity, true);
    }
    if (entity.hasMixin(Game.EntityMixins.PlayerActor)) {
      this._player = entity;
    }
  };

  Map.prototype.removeEntity = function(entity) {
    var key;
    key = entity.getX() + "," + entity.getY() + "," + entity.getZ();
    if (this._entities[key] === entity) {
      delete this._entities[key];
    }
    if (entity.hasMixin("Actor")) {
      this._scheduler.remove(entity);
    }
    if (entity.hasMixin(Game.EntityMixins.PlayerActor)) {
      this._player = undefined;
    }
  };

  Map.prototype.updateEntityPosition = function(entity, oldX, oldY, oldZ) {
    var key, oldKey;
    if (typeof oldX === "number") {
      oldKey = oldX + "," + oldY + "," + oldZ;
      if (this._entities[oldKey] === entity) {
        delete this._entities[oldKey];
      }
    }
    if (entity.getX() < 0 || entity.getX() >= this._width || entity.getY() < 0 || entity.getY() >= this._height || entity.getZ() < 0 || entity.getZ() >= this._depth) {
      throw new Error("Entity's position is out of bounds.");
    }
    key = entity.getX() + "," + entity.getY() + "," + entity.getZ();
    if (this._entities[key]) {
      throw new Error("Tried to add an entity at an occupied position.");
    }
    this._entities[key] = entity;
  };

  Map.prototype.getItemsAt = function(x, y, z) {
    return this._items[x + "," + y + "," + z];
  };

  Map.prototype.setItemsAt = function(x, y, z, items) {
    var key;
    key = x + "," + y + "," + z;
    if (items.length === 0) {
      if (this._items[key]) {
        delete this._items[key];
      }
    } else {
      this._items[key] = items;
    }
  };

  Map.prototype.addItem = function(x, y, z, item) {
    var key;
    key = x + "," + y + "," + z;
    if (this._items[key]) {
      this._items[key].push(item);
    } else {
      this._items[key] = [item];
    }
  };

  Map.prototype.addItemAtRandomPosition = function(item, z) {
    var position;
    position = this.getRandomFloorPosition(z);
    this.addItem(position.x, position.y, position.z, item);
  };

  Map.prototype.getPlayer = function() {
    return this._player;
  };

  return Map;

})();

},{"./../game":33}],40:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../game');

Game.Repository = (function() {
  function Repository(name, ctor) {
    this._name = name;
    this._templates = {};
    this._ctor = ctor;
    this._randomTemplates = {};
    return;
  }

  Repository.prototype.define = function(name, template, options) {
    var disableRandomCreation;
    this._templates[name] = template;
    disableRandomCreation = options && options["disableRandomCreation"];
    if (!disableRandomCreation) {
      this._randomTemplates[name] = template;
    }
  };

  Repository.prototype.create = function(name, extraProperties) {
    var key, template;
    if (!this._templates[name]) {
      throw new Error("No template named '" + name + "' in repository '" + this._name + "'");
    }
    template = Object.create(this._templates[name]);
    if (extraProperties) {
      for (key in extraProperties) {
        template[key] = extraProperties[key];
      }
    }
    return new this._ctor(template);
  };

  Repository.prototype.createRandom = function() {
    return this.create(Object.keys(this._randomTemplates).random());
  };

  return Repository;

})();

},{"./../game":33}],41:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Game = require('./../game');

Game.Tile = (function(_super) {
  __extends(Tile, _super);

  function Tile(properties) {
    properties = properties || {};
    Tile.__super__.constructor.call(this, properties);
    this._walkable = properties["walkable"] || false;
    this._diggable = properties["diggable"] || false;
    this._blocksLight = (properties["blocksLight"] !== undefined ? properties["blocksLight"] : true);
    this._description = properties["description"] || "";
  }

  Tile.prototype.isWalkable = function() {
    return this._walkable;
  };

  Tile.prototype.isDiggable = function() {
    return this._diggable;
  };

  Tile.prototype.isBlockingLight = function() {
    return this._blocksLight;
  };

  Tile.prototype.getDescription = function() {
    return this._description;
  };

  Tile.nullTile = new Tile({
    description: "(unknown)"
  });

  Tile.floorTile = new Tile({
    character: ".",
    walkable: true,
    blocksLight: false,
    description: "A cave floor"
  });

  Tile.wallTile = new Tile({
    character: "#",
    foreground: "goldenrod",
    diggable: true,
    description: "A cave wall"
  });

  Tile.stairsUpTile = new Tile({
    character: "<",
    foreground: "white",
    walkable: true,
    blocksLight: false,
    description: "A rock staircase leading upwards"
  });

  Tile.stairsDownTile = new Tile({
    character: ">",
    foreground: "white",
    walkable: true,
    blocksLight: false,
    description: "A rock staircase leading downwards"
  });

  Tile.holeToCavernTile = new Tile({
    character: "O",
    foreground: "white",
    walkable: true,
    blocksLight: false,
    description: "A great dark hole in the ground"
  });

  Tile.waterTile = new Tile({
    character: "~",
    foreground: "blue",
    walkable: false,
    blocksLight: false,
    description: "Murky blue water"
  });

  return Tile;

})(Game.Glyph);

},{"./../game":33}],42:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.Attacker = {
  name: "Attacker",
  groupName: "Attacker",
  init: function(template) {
    return this._attackValue = template["attackValue"] || 1;
  },
  getAttackValue: function() {
    var modifier;
    modifier = 0;
    if (this.hasMixin(Game.EntityMixins.Equipper)) {
      if (this.getWeapon()) {
        modifier += this.getWeapon().getAttackValue();
      }
      if (this.getArmor()) {
        modifier += this.getArmor().getAttackValue();
      }
    }
    return this._attackValue + modifier;
  },
  increaseAttackValue: function(value) {
    value = value || 2;
    this._attackValue += value;
    return Game.sendMessage(this, "You look stronger!");
  },
  attack: function(target) {
    var attack, damage, defense, max;
    if (target.hasMixin("Destructible")) {
      attack = this.getAttackValue();
      defense = target.getDefenseValue();
      max = Math.max(0, attack - defense);
      damage = 1 + Math.floor(Math.random() * max);
      Game.sendMessage(this, "You strike the %s for %d damage!", [target.getName(), damage]);
      Game.sendMessage(target, "The %s strikes you for %d damage!", [this.getName(), damage]);
      return target.takeDamage(this, damage);
    }
  },
  listeners: {
    details: function() {
      return [
        {
          key: "attack",
          value: this.getAttackValue()
        }
      ];
    }
  }
};

},{"./../../game":33}],43:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.CorpseDropper = {
  name: "CorpseDropper",
  init: function(template) {
    return this._corpseDropRate = template["corpseDropRate"] || 100;
  },
  listeners: {
    onDeath: function(attacker) {
      if (Math.round(Math.random() * 100) <= this._corpseDropRate) {
        return this._map.addItem(this.getX(), this.getY(), this.getZ(), Game.ItemRepository.create("corpse", {
          name: this._name + " corpse",
          foreground: this._foreground
        }));
      }
    }
  }
};

},{"./../../game":33}],44:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.Destructible = {
  name: "Destructible",
  init: function(template) {
    this._maxHp = template["maxHp"] || 10;
    this._hp = template["hp"] || this._maxHp;
    return this._defenseValue = template["defenseValue"] || 0;
  },
  getDefenseValue: function() {
    var modifier;
    modifier = 0;
    if (this.hasMixin(Game.EntityMixins.Equipper)) {
      if (this.getWeapon()) {
        modifier += this.getWeapon().getDefenseValue();
      }
      if (this.getArmor()) {
        modifier += this.getArmor().getDefenseValue();
      }
    }
    return this._defenseValue + modifier;
  },
  getHp: function() {
    return this._hp;
  },
  getMaxHp: function() {
    return this._maxHp;
  },
  setHp: function(hp) {
    return this._hp = hp;
  },
  increaseDefenseValue: function(value) {
    value = value || 2;
    this._defenseValue += value;
    return Game.sendMessage(this, "You look tougher!");
  },
  increaseMaxHp: function(value) {
    value = value || 10;
    this._maxHp += value;
    this._hp += value;
    return Game.sendMessage(this, "You look healthier!");
  },
  takeDamage: function(attacker, damage) {
    this._hp -= damage;
    if (this._hp <= 0) {
      Game.sendMessage(attacker, "You kill the %s!", [this.getName()]);
      this.raiseEvent("onDeath", attacker);
      attacker.raiseEvent("onKill", this);
      return this.kill();
    }
  },
  listeners: {
    onGainLevel: function() {
      return this.setHp(this.getMaxHp());
    },
    details: function() {
      return [
        {
          key: "defense",
          value: this.getDefenseValue()
        }, {
          key: "hp",
          value: this.getHp()
        }
      ];
    }
  }
};

},{"./../../game":33}],45:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.Equipper = {
  name: "Equipper",
  init: function(template) {
    this._weapon = null;
    return this._armor = null;
  },
  wield: function(item) {
    return this._weapon = item;
  },
  unwield: function() {
    return this._weapon = null;
  },
  wear: function(item) {
    return this._armor = item;
  },
  takeOff: function() {
    return this._armor = null;
  },
  getWeapon: function() {
    return this._weapon;
  },
  getArmor: function() {
    return this._armor;
  },
  unequip: function(item) {
    if (this._weapon === item) {
      this.unwield();
    }
    if (this._armor === item) {
      return this.takeOff();
    }
  }
};

},{"./../../game":33}],46:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.ExperienceGainer = {
  name: "ExperienceGainer",
  init: function(template) {
    this._level = template["level"] || 1;
    this._experience = template["experience"] || 0;
    this._statPointsPerLevel = template["statPointsPerLevel"] || 1;
    this._statPoints = 0;
    this._statOptions = [];
    if (this.hasMixin("Attacker")) {
      this._statOptions.push(["Increase attack value", this.increaseAttackValue]);
    }
    if (this.hasMixin("Destructible")) {
      this._statOptions.push(["Increase defense value", this.increaseDefenseValue]);
      this._statOptions.push(["Increase max health", this.increaseMaxHp]);
    }
    if (this.hasMixin("Sight")) {
      return this._statOptions.push(["Increase sight range", this.increaseSightRadius]);
    }
  },
  getLevel: function() {
    return this._level;
  },
  getExperience: function() {
    return this._experience;
  },
  getNextLevelExperience: function() {
    return (this._level * this._level) * 10;
  },
  getStatPoints: function() {
    return this._statPoints;
  },
  setStatPoints: function(statPoints) {
    return this._statPoints = statPoints;
  },
  getStatOptions: function() {
    return this._statOptions;
  },
  giveExperience: function(points) {
    var levelsGained, statPointsGained, usedPoints;
    statPointsGained = 0;
    levelsGained = 0;
    while (points > 0) {
      if (this._experience + points >= this.getNextLevelExperience()) {
        usedPoints = this.getNextLevelExperience() - this._experience;
        points -= usedPoints;
        this._experience += usedPoints;
        this._level++;
        levelsGained++;
        this._statPoints += this._statPointsPerLevel;
        statPointsGained += this._statPointsPerLevel;
      } else {
        this._experience += points;
        points = 0;
      }
    }
    if (levelsGained > 0) {
      Game.sendMessage(this, "You advance to level %d.", [this._level]);
      return this.raiseEvent("onGainLevel");
    }
  },
  listeners: {
    onKill: function(victim) {
      var exp;
      exp = victim.getMaxHp() + victim.getDefenseValue();
      if (victim.hasMixin("Attacker")) {
        exp += victim.getAttackValue();
      }
      if (victim.hasMixin("ExperienceGainer")) {
        exp -= (this.getLevel() - victim.getLevel()) * 3;
      }
      if (exp > 0) {
        return this.giveExperience(exp);
      }
    },
    details: function() {
      return [
        {
          key: "level",
          value: this.getLevel()
        }
      ];
    }
  }
};

},{"./../../game":33}],47:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.FoodConsumer = {
  name: "FoodConsumer",
  init: function(template) {
    this._maxFullness = template["maxFullness"] || 1000;
    this._fullness = template["fullness"] || (this._maxFullness / 2);
    return this._fullnessDepletionRate = template["fullnessDepletionRate"] || 1;
  },
  addTurnHunger: function() {
    return this.modifyFullnessBy(-this._fullnessDepletionRate);
  },
  modifyFullnessBy: function(points) {
    this._fullness = this._fullness + points;
    if (this._fullness <= 0) {
      return this.kill("You have died of starvation!");
    } else {
      if (this._fullness > this._maxFullness) {
        return this.kill("You choke and die!");
      }
    }
  },
  getHungerState: function() {
    var perPercent;
    perPercent = this._maxFullness / 100;
    if (this._fullness <= perPercent * 5) {
      return "Starving";
    } else if (this._fullness <= perPercent * 25) {
      return "Hungry";
    } else if (this._fullness >= perPercent * 95) {
      return "Oversatiated";
    } else if (this._fullness >= perPercent * 75) {
      return "Full";
    } else {
      return "Not Hungry";
    }
  }
};

},{"./../../game":33}],48:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.FungusActor = {
  name: "FungusActor",
  groupName: "Actor",
  init: function() {
    return this._growthsRemaining = 5;
  },
  act: function() {
    var entity, xOffset, yOffset;
    if (this._growthsRemaining > 0) {
      if (Math.random() <= 0.02) {
        xOffset = Math.floor(Math.random() * 3) - 1;
        yOffset = Math.floor(Math.random() * 3) - 1;
        if (xOffset !== 0 || yOffset !== 0) {
          if (this.getMap().isEmptyFloor(this.getX() + xOffset, this.getY() + yOffset, this.getZ())) {
            entity = Game.EntityRepository.create("fungus");
            entity.setPosition(this.getX() + xOffset, this.getY() + yOffset, this.getZ());
            this.getMap().addEntity(entity);
            this._growthsRemaining--;
            return Game.sendMessageNearby(this.getMap(), entity.getX(), entity.getY(), entity.getZ(), "The fungus is spreading!");
          }
        }
      }
    }
  }
};

},{"./../../game":33}],49:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.GiantZombieActor = Game.merge(Game.EntityMixins.TaskActor, {
  init: function(template) {
    Game.EntityMixins.TaskActor.init.call(this, Game.merge(template, {
      tasks: ["growArm", "spawnSlime", "hunt", "wander"]
    }));
    return this._hasGrownArm = false;
  },
  canDoTask: function(task) {
    if (task === "growArm") {
      return this.getHp() <= 20 && !this._hasGrownArm;
    } else if (task === "spawnSlime") {
      return Math.round(Math.random() * 100) <= 10;
    } else {
      return Game.EntityMixins.TaskActor.canDoTask.call(this, task);
    }
  },
  growArm: function() {
    this._hasGrownArm = true;
    this.increaseAttackValue(5);
    return Game.sendMessageNearby(this.getMap(), this.getX(), this.getY(), this.getZ(), "An extra arm appears on the giant zombie!");
  },
  spawnSlime: function() {
    var slime, xOffset, yOffset;
    xOffset = Math.floor(Math.random() * 3) - 1;
    yOffset = Math.floor(Math.random() * 3) - 1;
    if (!this.getMap().isEmptyFloor(this.getX() + xOffset, this.getY() + yOffset, this.getZ())) {
      return;
    }
    slime = Game.EntityRepository.create("slime");
    slime.setX(this.getX() + xOffset);
    slime.setY(this.getY() + yOffset);
    slime.setZ(this.getZ());
    return this.getMap().addEntity(slime);
  },
  listeners: {
    onDeath: function(attacker) {
      return Game.switchScreen(Game.Screen.winScreen);
    }
  }
});

},{"./../../game":33}],50:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.InventoryHolder = {
  name: "InventoryHolder",
  init: function(template) {
    var inventorySlots;
    inventorySlots = template["inventorySlots"] || 10;
    return this._items = new Array(inventorySlots);
  },
  getItems: function() {
    return this._items;
  },
  getItem: function(i) {
    return this._items[i];
  },
  addItem: function(item) {
    var i;
    i = 0;
    while (i < this._items.length) {
      if (!this._items[i]) {
        this._items[i] = item;
        return true;
      }
      i++;
    }
    return false;
  },
  removeItem: function(i) {
    if (this._items[i] && this.hasMixin(Game.EntityMixins.Equipper)) {
      this.unequip(this._items[i]);
    }
    return this._items[i] = null;
  },
  canAddItem: function() {
    var i;
    i = 0;
    while (i < this._items.length) {
      if (!this._items[i]) {
        return true;
      }
      i++;
    }
    return false;
  },
  pickupItems: function(indices) {
    var added, i, mapItems;
    mapItems = this._map.getItemsAt(this.getX(), this.getY(), this.getZ());
    added = 0;
    i = 0;
    while (i < indices.length) {
      if (this.addItem(mapItems[indices[i] - added])) {
        mapItems.splice(indices[i] - added, 1);
        added++;
      } else {
        break;
      }
      i++;
    }
    this._map.setItemsAt(this.getX(), this.getY(), this.getZ(), mapItems);
    return added === indices.length;
  },
  dropItem: function(i) {
    if (this._items[i]) {
      if (this._map) {
        this._map.addItem(this.getX(), this.getY(), this.getZ(), this._items[i]);
      }
      return this.removeItem(i);
    }
  }
};

},{"./../../game":33}],51:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.MessageRecipient = {
  name: "MessageRecipient",
  init: function(template) {
    return this._messages = [];
  },
  receiveMessage: function(message) {
    return this._messages.push(message);
  },
  getMessages: function() {
    return this._messages;
  },
  clearMessages: function() {
    return this._messages = [];
  }
};

},{"./../../game":33}],52:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.PlayerActor = {
  name: "PlayerActor",
  groupName: "Actor",
  act: function() {
    if (this._acting) {
      return;
    }
    this._acting = true;
    this.addTurnHunger();
    if (!this.isAlive()) {
      Game.Screen.playScreen.setGameEnded(true);
      Game.sendMessage(this, "Press [Enter] to continue!");
    }
    Game.refresh();
    this.getMap().getEngine().lock();
    this.clearMessages();
    this._acting = false;
  }
};

},{"./../../game":33}],53:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.PlayerStatGainer = {
  name: "PlayerStatGainer",
  groupName: "StatGainer",
  listeners: {
    onGainLevel: function() {
      Game.Screen.gainStatScreen.setup(this);
      return Game.Screen.playScreen.setSubScreen(Game.Screen.gainStatScreen);
    }
  }
};

},{"./../../game":33}],54:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.RandomStatGainer = {
  name: "RandomStatGainer",
  groupName: "StatGainer",
  listeners: {
    onGainLevel: function() {
      var statOptions, _results;
      statOptions = this.getStatOptions();
      _results = [];
      while (this.getStatPoints() > 0) {
        statOptions.random()[1].call(this);
        _results.push(this.setStatPoints(this.getStatPoints() - 1));
      }
      return _results;
    }
  }
};

},{"./../../game":33}],55:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.Sight = {
  name: "Sight",
  groupName: "Sight",
  init: function(template) {
    return this._sightRadius = template["sightRadius"] || 5;
  },
  getSightRadius: function() {
    return this._sightRadius;
  },
  increaseSightRadius: function(value) {
    value = value || 1;
    this._sightRadius += value;
    return Game.sendMessage(this, "You are more aware of your surroundings!");
  },
  canSee: function(entity) {
    var found, otherX, otherY;
    if (!entity || this._map !== entity.getMap() || this._z !== entity.getZ()) {
      return false;
    }
    otherX = entity.getX();
    otherY = entity.getY();
    if ((otherX - this._x) * (otherX - this._x) + (otherY - this._y) * (otherY - this._y) > this._sightRadius * this._sightRadius) {
      return false;
    }
    found = false;
    this.getMap().getFov(this.getZ()).compute(this.getX(), this.getY(), this.getSightRadius(), function(x, y, radius, visibility) {
      if (x === otherX && y === otherY) {
        return found = true;
      }
    });
    return found;
  }
};

},{"./../../game":33}],56:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.EntityMixins.TaskActor = {
  name: "TaskActor",
  groupName: "Actor",
  init: function(template) {
    return this._tasks = template["tasks"] || ["wander"];
  },
  act: function() {
    var i;
    i = 0;
    while (i < this._tasks.length) {
      if (this.canDoTask(this._tasks[i])) {
        this[this._tasks[i]]();
        return;
      }
      i++;
    }
  },
  canDoTask: function(task) {
    if (task === "hunt") {
      return this.hasMixin("Sight") && this.canSee(this.getMap().getPlayer());
    } else if (task === "wander") {
      return true;
    } else {
      throw new Error("Tried to perform undefined task " + task);
    }
  },
  hunt: function() {
    var count, offsets, path, player, source, z;
    player = this.getMap().getPlayer();
    offsets = Math.abs(player.getX() - this.getX()) + Math.abs(player.getY() - this.getY());
    if (offsets === 1) {
      if (this.hasMixin("Attacker")) {
        this.attack(player);
        return;
      }
    }
    source = this;
    z = source.getZ();
    path = new ROT.Path.AStar(player.getX(), player.getY(), function(x, y) {
      var entity;
      entity = source.getMap().getEntityAt(x, y, z);
      if (entity && entity !== player && entity !== source) {
        return false;
      }
      return source.getMap().getTile(x, y, z).isWalkable();
    }, {
      topology: 4
    });
    count = 0;
    return path.compute(source.getX(), source.getY(), function(x, y) {
      if (count === 1) {
        source.tryMove(x, y, z);
      }
      return count++;
    });
  },
  wander: function() {
    var moveOffset;
    moveOffset = (Math.round(Math.random()) === 1 ? 1 : -1);
    if (Math.round(Math.random()) === 1) {
      return this.tryMove(this.getX() + moveOffset, this.getY(), this.getZ());
    } else {
      return this.tryMove(this.getX(), this.getY() + moveOffset, this.getZ());
    }
  }
};

},{"./../../game":33}],57:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.ItemMixins.Edible = {
  name: "Edible",
  init: function(template) {
    this._foodValue = template["foodValue"] || 5;
    this._maxConsumptions = template["consumptions"] || 1;
    return this._remainingConsumptions = this._maxConsumptions;
  },
  eat: function(entity) {
    if (entity.hasMixin("FoodConsumer")) {
      if (this.hasRemainingConsumptions()) {
        entity.modifyFullnessBy(this._foodValue);
        return this._remainingConsumptions--;
      }
    }
  },
  hasRemainingConsumptions: function() {
    return this._remainingConsumptions > 0;
  },
  describe: function() {
    if (this._maxConsumptions !== this._remainingConsumptions) {
      return "partly eaten " + Game.Item.prototype.describe.call(this);
    } else {
      return this._name;
    }
  },
  listeners: {
    details: function() {
      return [
        {
          key: "food",
          value: this._foodValue
        }
      ];
    }
  }
};

},{"./../../game":33}],58:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

Game.ItemMixins.Equippable = {
  name: "Equippable",
  init: function(template) {
    this._attackValue = template["attackValue"] || 0;
    this._defenseValue = template["defenseValue"] || 0;
    this._wieldable = template["wieldable"] || false;
    return this._wearable = template["wearable"] || false;
  },
  getAttackValue: function() {
    return this._attackValue;
  },
  getDefenseValue: function() {
    return this._defenseValue;
  },
  isWieldable: function() {
    return this._wieldable;
  },
  isWearable: function() {
    return this._wearable;
  },
  listeners: {
    details: function() {
      var results;
      results = [];
      if (this._wieldable) {
        results.push({
          key: "attack",
          value: this.getAttackValue()
        });
      }
      if (this._wearable) {
        results.push({
          key: "defense",
          value: this.getDefenseValue()
        });
      }
      return results;
    }
  }
};

},{"./../../game":33}],59:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Game = require('./../../game');

Game.Map.BossCavern = (function(_super) {
  __extends(BossCavern, _super);

  function BossCavern() {
    BossCavern.__super__.constructor.call(this, this._generateTiles(80, 24));
    this.addEntityAtRandomPosition(Game.EntityRepository.create("giant zombie"), 0);
    return;
  }

  BossCavern.prototype._fillCircle = function(tiles, centerX, centerY, radius, tile) {
    var i, radiusError, x, xChange, y, yChange;
    x = radius;
    y = 0;
    xChange = 1 - (radius << 1);
    yChange = 0;
    radiusError = 0;
    while (x >= y) {
      i = centerX - x;
      while (i <= centerX + x) {
        tiles[i][centerY + y] = tile;
        tiles[i][centerY - y] = tile;
        i++;
      }
      i = centerX - y;
      while (i <= centerX + y) {
        tiles[i][centerY + x] = tile;
        tiles[i][centerY - x] = tile;
        i++;
      }
      y++;
      radiusError += yChange;
      yChange += 2;
      if (((radiusError << 1) + xChange) > 0) {
        x--;
        radiusError += xChange;
        xChange += 2;
      }
    }
  };

  BossCavern.prototype._generateTiles = function(width, height) {
    var centerX, centerY, i, lakes, maxRadius, radius, tiles, x, y;
    tiles = new Array(width);
    x = 0;
    while (x < width) {
      tiles[x] = new Array(height);
      y = 0;
      while (y < height) {
        tiles[x][y] = Game.Tile.wallTile;
        y++;
      }
      x++;
    }
    radius = (Math.min(width, height) - 2) / 2;
    this._fillCircle(tiles, width / 2, height / 2, radius, Game.Tile.floorTile);
    lakes = Math.round(Math.random() * 3) + 3;
    maxRadius = 2;
    i = 0;
    while (i < lakes) {
      centerX = Math.floor(Math.random() * (width - (maxRadius * 2)));
      centerY = Math.floor(Math.random() * (height - (maxRadius * 2)));
      centerX += maxRadius;
      centerY += maxRadius;
      radius = Math.floor(Math.random() * maxRadius) + 1;
      this._fillCircle(tiles, centerX, centerY, radius, Game.Tile.waterTile);
      i++;
    }
    return [tiles];
  };

  BossCavern.prototype.addEntity = function(entity) {
    var position;
    BossCavern.__super__.addEntity.call(this, entity);
    if (this.getPlayer() === entity) {
      position = this.getRandomFloorPosition(0);
      entity.setPosition(position.x, position.y, 0);
      this.getEngine().start();
    }
  };

  return BossCavern;

})(Game.Map);

},{"./../../game":33}],60:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Game = require('./../../game');

Game.Map.Cave = (function(_super) {
  __extends(Cave, _super);

  function Cave(tiles, player) {
    var entity, holePosition, i, level, templates, z;
    Cave.__super__.constructor.call(this, tiles);
    this.addEntityAtRandomPosition(player, 0);
    z = 0;
    while (z < this._depth) {
      i = 0;
      while (i < 15) {
        entity = Game.EntityRepository.createRandom();
        this.addEntityAtRandomPosition(entity, z);
        if (entity.hasMixin("ExperienceGainer")) {
          level = 0;
          while (level < z) {
            entity.giveExperience(entity.getNextLevelExperience() - entity.getExperience());
            level++;
          }
        }
        i++;
      }
      i = 0;
      while (i < 15) {
        this.addItemAtRandomPosition(Game.ItemRepository.createRandom(), z);
        i++;
      }
      z++;
    }
    templates = ["dagger", "sword", "staff", "tunic", "chainmail", "platemail"];
    i = 0;
    while (i < templates.length) {
      this.addItemAtRandomPosition(Game.ItemRepository.create(templates[i]), Math.floor(this._depth * Math.random()));
      i++;
    }
    holePosition = this.getRandomFloorPosition(this._depth - 1);
    this._tiles[this._depth - 1][holePosition.x][holePosition.y] = Game.Tile.holeToCavernTile;
    return;
  }

  return Cave;

})(Game.Map);

},{"./../../game":33}],61:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.ItemListScreen = (function() {
  function ItemListScreen(template) {
    this._caption = template["caption"];
    this._okFunction = template["ok"];
    this._isAcceptableFunction = template["isAcceptable"] || function(x) {
      return x;
    };
    this._canSelectItem = template["canSelect"];
    this._canSelectMultipleItems = template["canSelectMultipleItems"];
    this._hasNoItemOption = template["hasNoItemOption"];
  }

  ItemListScreen.prototype.setup = function(player, items) {
    var count, that;
    this._player = player;
    count = 0;
    that = this;
    this._items = items.map(function(item) {
      if (that._isAcceptableFunction(item)) {
        count++;
        return item;
      } else {
        return null;
      }
    });
    this._selectedIndices = {};
    return count;
  };

  ItemListScreen.prototype.render = function(display) {
    var i, letter, letters, row, selectionState, suffix, _results;
    letters = "abcdefghijklmnopqrstuvwxyz";
    display.drawText(0, 0, this._caption);
    if (this._hasNoItemOption) {
      display.drawText(0, 1, "0 - no item");
    }
    row = 0;
    i = 0;
    _results = [];
    while (i < this._items.length) {
      if (this._items[i]) {
        letter = letters.substring(i, i + 1);
        selectionState = (this._canSelectItem && this._canSelectMultipleItems && this._selectedIndices[i] ? "+" : "-");
        suffix = "";
        if (this._items[i] === this._player.getArmor()) {
          suffix = " (wearing)";
        } else {
          if (this._items[i] === this._player.getWeapon()) {
            suffix = " (wielding)";
          }
        }
        display.drawText(0, 2 + row, letter + " " + selectionState + " " + this._items[i].describe() + suffix);
        row++;
      }
      _results.push(i++);
    }
    return _results;
  };

  ItemListScreen.prototype.executeOkFunction = function() {
    var key, selectedItems;
    selectedItems = {};
    for (key in this._selectedIndices) {
      selectedItems[key] = this._items[key];
    }
    Game.Screen.playScreen.setSubScreen(undefined);
    if (this._okFunction(selectedItems)) {
      return this._player.getMap().getEngine().unlock();
    }
  };

  ItemListScreen.prototype.handleInput = function(inputType, inputData) {
    var index;
    if (inputType === "keydown") {
      if (inputData.keyCode === ROT.VK_ESCAPE || (inputData.keyCode === ROT.VK_RETURN && (!this._canSelectItem || Object.keys(this._selectedIndices).length === 0))) {
        return Game.Screen.playScreen.setSubScreen(undefined);
      } else if (inputData.keyCode === ROT.VK_RETURN) {
        return this.executeOkFunction();
      } else if (this._canSelectItem && this._hasNoItemOption && inputData.keyCode === ROT.VK_0) {
        this._selectedIndices = {};
        return this.executeOkFunction();
      } else if (this._canSelectItem && inputData.keyCode >= ROT.VK_A && inputData.keyCode <= ROT.VK_Z) {
        index = inputData.keyCode - ROT.VK_A;
        if (this._items[index]) {
          if (this._canSelectMultipleItems) {
            if (this._selectedIndices[index]) {
              delete this._selectedIndices[index];
            } else {
              this._selectedIndices[index] = true;
            }
            return Game.refresh();
          } else {
            this._selectedIndices[index] = true;
            return this.executeOkFunction();
          }
        }
      }
    }
  };

  return ItemListScreen;

})();

},{"./../../game":33}],62:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var Game;

Game = require('./../../game');

if (Game.Screen == null) {
  Game.Screen = {};
}

Game.Screen.TargetBasedScreen = (function() {
  function TargetBasedScreen(template) {
    template = template || {};
    this._isAcceptableFunction = template["okFunction"] || function(x, y) {
      return false;
    };
    this._captionFunction = template["captionFunction"] || function(x, y) {
      return "";
    };
  }

  TargetBasedScreen.prototype.setup = function(player, startX, startY, offsetX, offsetY) {
    var visibleCells;
    this._player = player;
    this._startX = startX - offsetX;
    this._startY = startY - offsetY;
    this._cursorX = this._startX;
    this._cursorY = this._startY;
    this._offsetX = offsetX;
    this._offsetY = offsetY;
    visibleCells = {};
    this._player.getMap().getFov(this._player.getZ()).compute(this._player.getX(), this._player.getY(), this._player.getSightRadius(), function(x, y, radius, visibility) {
      return visibleCells[x + "," + y] = true;
    });
    return this._visibleCells = visibleCells;
  };

  TargetBasedScreen.prototype.render = function(display) {
    var i, l, points;
    Game.Screen.playScreen.renderTiles.call(Game.Screen.playScreen, display);
    points = Game.getLine(this._startX, this._startY, this._cursorX, this._cursorY);
    i = 0;
    l = points.length;
    while (i < l) {
      display.drawText(points[i].x, points[i].y, "%c{magenta}*");
      i++;
    }
    return display.drawText(0, Game.getScreenHeight() - 1, this._captionFunction(this._cursorX + this._offsetX, this._cursorY + this._offsetY));
  };

  TargetBasedScreen.prototype.handleInput = function(inputType, inputData) {
    if (inputType === "keydown") {
      if (inputData.keyCode === ROT.VK_LEFT) {
        this.moveCursor(-1, 0);
      } else if (inputData.keyCode === ROT.VK_RIGHT) {
        this.moveCursor(1, 0);
      } else if (inputData.keyCode === ROT.VK_UP) {
        this.moveCursor(0, -1);
      } else if (inputData.keyCode === ROT.VK_DOWN) {
        this.moveCursor(0, 1);
      } else if (inputData.keyCode === ROT.VK_ESCAPE) {
        Game.Screen.playScreen.setSubScreen(undefined);
      } else {
        if (inputData.keyCode === ROT.VK_RETURN) {
          this.executeOkFunction();
        }
      }
    }
    return Game.refresh();
  };

  TargetBasedScreen.prototype.moveCursor = function(dx, dy) {
    this._cursorX = Math.max(0, Math.min(this._cursorX + dx, Game.getScreenWidth()));
    return this._cursorY = Math.max(0, Math.min(this._cursorY + dy, Game.getScreenHeight() - 1));
  };

  TargetBasedScreen.prototype.executeOkFunction = function() {
    Game.Screen.playScreen.setSubScreen(undefined);
    if (this._okFunction(this._cursorX + this._offsetX, this._cursorY + this._offsetY)) {
      return this._player.getMap().getEngine().unlock();
    }
  };

  return TargetBasedScreen;

})();

},{"./../../game":33}],63:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
window.onload = function() {
  var Game;
  if (ROT.isSupported()) {
    Game = require('./game');
    Game.init();
    document.body.appendChild(Game.getDisplay().getContainer());
    Game.switchScreen(Game.Screen.startScreen);
  } else {
    alert("The rot.js library isn't supported by your browser.");
  }
};

},{"./game":33}]},{},[63])
//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL2VudGl0aWVzL1BsYXllclRlbXBsYXRlLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9lbnRpdGllcy9iYXQuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL2VudGl0aWVzL2Z1bmd1cy5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvZW50aXRpZXMvZ2lhbnRfem9tYmllLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9lbnRpdGllcy9rb2JvbGQuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL2VudGl0aWVzL25ld3QuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL2VudGl0aWVzL3NsaW1lLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9pdGVtcy9hcHBsZS5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvaXRlbXMvY2hhaW5tYWlsLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9pdGVtcy9jb3Jwc2UuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL2l0ZW1zL2RhZ2dlci5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvaXRlbXMvbWVsb24uanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL2l0ZW1zL3BsYXRlbWFpbC5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvaXRlbXMvcHVtcGtpbi5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvaXRlbXMvcm9jay5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvaXRlbXMvc3RhZmYuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL2l0ZW1zL3N3b3JkLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9pdGVtcy90dW5pYy5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvc2NyZWVucy9kcm9wU2NyZWVuLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9zY3JlZW5zL2VhdFNjcmVlbi5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvc2NyZWVucy9leGFtaW5lU2NyZWVuLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9zY3JlZW5zL2dhaW5TdGF0U2NyZWVuLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9zY3JlZW5zL2hlbHBTY3JlZW4uanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL3NjcmVlbnMvaW52ZW50b3J5U2NyZWVuLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9zY3JlZW5zL2xvb2tTY3JlZW4uanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL3NjcmVlbnMvbG9zZVNjcmVlbi5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvc2NyZWVucy9waWNrdXBTY3JlZW4uanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9kYXRhL3NjcmVlbnMvcGxheVNjcmVlbi5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvc2NyZWVucy9zdGFydFNjcmVlbi5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2RhdGEvc2NyZWVucy93ZWFyU2NyZWVuLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9zY3JlZW5zL3dpZWxkU2NyZWVuLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZGF0YS9zY3JlZW5zL3dpblNjcmVlbi5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2dhbWUuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9nYW1lL0J1aWxkZXIuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9nYW1lL0R5bmFtaWNHbHlwaC5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2dhbWUvRW50aXR5LmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9HbHlwaC5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2dhbWUvSXRlbS5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2dhbWUvTWFwLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9SZXBvc2l0b3J5LmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9UaWxlLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9lbnRpdHkvQXR0YWNrZXIuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9nYW1lL2VudGl0eS9Db3Jwc2VEcm9wcGVyLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9lbnRpdHkvRGVzdHJ1Y3RpYmxlLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9lbnRpdHkvRXF1aXBwZXIuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9nYW1lL2VudGl0eS9FeHBlcmllbmNlR2FpbmVyLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9lbnRpdHkvRm9vZENvbnN1bWVyLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9lbnRpdHkvRnVuZ3VzQWN0b3IuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9nYW1lL2VudGl0eS9HaWFudFpvbWJpZUFjdG9yLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9lbnRpdHkvSW52ZW50b3J5SG9sZGVyLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9lbnRpdHkvTWVzc2FnZVJlY2lwaWVudC5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2dhbWUvZW50aXR5L1BsYXllckFjdG9yLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9lbnRpdHkvUGxheWVyU3RhdEdhaW5lci5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2dhbWUvZW50aXR5L1JhbmRvbVN0YXRHYWluZXIuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9nYW1lL2VudGl0eS9TaWdodC5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2dhbWUvZW50aXR5L1Rhc2tBY3Rvci5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2dhbWUvaXRlbS9FZGlibGUuanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9nYW1lL2l0ZW0vRXF1aXBwYWJsZS5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL2dhbWUvbWFwL0Jvc3NDYXZlcm4uanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9nYW1lL21hcC9DYXZlLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L3JvZ3Vlci9hcHAvZ2FtZS9zY3JlZW4vSXRlbUxpc3RTY3JlZW4uanMiLCIvaG9tZS9icnVjZS9HaXQvcm9ndWVyL2FwcC9nYW1lL3NjcmVlbi9UYXJnZXRCYXNlZFNjcmVlbi5qcyIsIi9ob21lL2JydWNlL0dpdC9yb2d1ZXIvYXBwL21haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5HYW1lLlBsYXllclRlbXBsYXRlID0ge1xuICBuYW1lOiBcImh1bWFuICh5b3UpXCIsXG4gIGNoYXJhY3RlcjogXCJAXCIsXG4gIGZvcmVncm91bmQ6IFwid2hpdGVcIixcbiAgbWF4SHA6IDQwLFxuICBhdHRhY2tWYWx1ZTogMTAsXG4gIHNpZ2h0UmFkaXVzOiA2LFxuICBpbnZlbnRvcnlTbG90czogMjIsXG4gIG1peGluczogW0dhbWUuRW50aXR5TWl4aW5zLlBsYXllckFjdG9yLCBHYW1lLkVudGl0eU1peGlucy5BdHRhY2tlciwgR2FtZS5FbnRpdHlNaXhpbnMuRGVzdHJ1Y3RpYmxlLCBHYW1lLkVudGl0eU1peGlucy5JbnZlbnRvcnlIb2xkZXIsIEdhbWUuRW50aXR5TWl4aW5zLkZvb2RDb25zdW1lciwgR2FtZS5FbnRpdHlNaXhpbnMuU2lnaHQsIEdhbWUuRW50aXR5TWl4aW5zLk1lc3NhZ2VSZWNpcGllbnQsIEdhbWUuRW50aXR5TWl4aW5zLkVxdWlwcGVyLCBHYW1lLkVudGl0eU1peGlucy5FeHBlcmllbmNlR2FpbmVyLCBHYW1lLkVudGl0eU1peGlucy5QbGF5ZXJTdGF0R2FpbmVyXVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLkVudGl0eVJlcG9zaXRvcnkgPT0gbnVsbCkge1xuICBHYW1lLkVudGl0eVJlcG9zaXRvcnkgPSBuZXcgR2FtZS5SZXBvc2l0b3J5KFwiZW50aXRpZXNcIiwgR2FtZS5FbnRpdHkpO1xufVxuXG5HYW1lLkVudGl0eVJlcG9zaXRvcnkuZGVmaW5lKFwiYmF0XCIsIHtcbiAgbmFtZTogXCJiYXRcIixcbiAgY2hhcmFjdGVyOiBcIkJcIixcbiAgZm9yZWdyb3VuZDogXCJ3aGl0ZVwiLFxuICBtYXhIcDogNSxcbiAgYXR0YWNrVmFsdWU6IDQsXG4gIHNwZWVkOiAyMDAwLFxuICBtaXhpbnM6IFtHYW1lLkVudGl0eU1peGlucy5UYXNrQWN0b3IsIEdhbWUuRW50aXR5TWl4aW5zLkF0dGFja2VyLCBHYW1lLkVudGl0eU1peGlucy5EZXN0cnVjdGlibGUsIEdhbWUuRW50aXR5TWl4aW5zLkNvcnBzZURyb3BwZXIsIEdhbWUuRW50aXR5TWl4aW5zLkV4cGVyaWVuY2VHYWluZXIsIEdhbWUuRW50aXR5TWl4aW5zLlJhbmRvbVN0YXRHYWluZXJdXG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLkVudGl0eVJlcG9zaXRvcnkgPT0gbnVsbCkge1xuICBHYW1lLkVudGl0eVJlcG9zaXRvcnkgPSBuZXcgR2FtZS5SZXBvc2l0b3J5KFwiZW50aXRpZXNcIiwgR2FtZS5FbnRpdHkpO1xufVxuXG5HYW1lLkVudGl0eVJlcG9zaXRvcnkuZGVmaW5lKFwiZnVuZ3VzXCIsIHtcbiAgbmFtZTogXCJmdW5ndXNcIixcbiAgY2hhcmFjdGVyOiBcIkZcIixcbiAgZm9yZWdyb3VuZDogXCJncmVlblwiLFxuICBtYXhIcDogMTAsXG4gIHNwZWVkOiAyNTAsXG4gIG1peGluczogW0dhbWUuRW50aXR5TWl4aW5zLkZ1bmd1c0FjdG9yLCBHYW1lLkVudGl0eU1peGlucy5EZXN0cnVjdGlibGUsIEdhbWUuRW50aXR5TWl4aW5zLkV4cGVyaWVuY2VHYWluZXIsIEdhbWUuRW50aXR5TWl4aW5zLlJhbmRvbVN0YXRHYWluZXJdXG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbkdhbWUuRW50aXR5UmVwb3NpdG9yeSA9IG5ldyBHYW1lLlJlcG9zaXRvcnkoXCJlbnRpdGllc1wiLCBHYW1lLkVudGl0eSk7XG5cbkdhbWUuRW50aXR5UmVwb3NpdG9yeS5kZWZpbmUoXCJnaWFudCB6b21iaWVcIiwge1xuICBuYW1lOiBcImdpYW50IHpvbWJpZVwiLFxuICBjaGFyYWN0ZXI6IFwiWlwiLFxuICBmb3JlZ3JvdW5kOiBcInRlYWxcIixcbiAgbWF4SHA6IDMwLFxuICBhdHRhY2tWYWx1ZTogOCxcbiAgZGVmZW5zZVZhbHVlOiA1LFxuICBsZXZlbDogNSxcbiAgc2lnaHRSYWRpdXM6IDYsXG4gIG1peGluczogW0dhbWUuRW50aXR5TWl4aW5zLkdpYW50Wm9tYmllQWN0b3IsIEdhbWUuRW50aXR5TWl4aW5zLlNpZ2h0LCBHYW1lLkVudGl0eU1peGlucy5BdHRhY2tlciwgR2FtZS5FbnRpdHlNaXhpbnMuRGVzdHJ1Y3RpYmxlLCBHYW1lLkVudGl0eU1peGlucy5Db3Jwc2VEcm9wcGVyLCBHYW1lLkVudGl0eU1peGlucy5FeHBlcmllbmNlR2FpbmVyXVxufSwge1xuICBkaXNhYmxlUmFuZG9tQ3JlYXRpb246IHRydWVcbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuR2FtZS5FbnRpdHlSZXBvc2l0b3J5ID0gbmV3IEdhbWUuUmVwb3NpdG9yeShcImVudGl0aWVzXCIsIEdhbWUuRW50aXR5KTtcblxuR2FtZS5FbnRpdHlSZXBvc2l0b3J5LmRlZmluZShcImtvYm9sZFwiLCB7XG4gIG5hbWU6IFwia29ib2xkXCIsXG4gIGNoYXJhY3RlcjogXCJrXCIsXG4gIGZvcmVncm91bmQ6IFwid2hpdGVcIixcbiAgbWF4SHA6IDYsXG4gIGF0dGFja1ZhbHVlOiA0LFxuICBzaWdodFJhZGl1czogNSxcbiAgdGFza3M6IFtcImh1bnRcIiwgXCJ3YW5kZXJcIl0sXG4gIG1peGluczogW0dhbWUuRW50aXR5TWl4aW5zLlRhc2tBY3RvciwgR2FtZS5FbnRpdHlNaXhpbnMuU2lnaHQsIEdhbWUuRW50aXR5TWl4aW5zLkF0dGFja2VyLCBHYW1lLkVudGl0eU1peGlucy5EZXN0cnVjdGlibGUsIEdhbWUuRW50aXR5TWl4aW5zLkNvcnBzZURyb3BwZXIsIEdhbWUuRW50aXR5TWl4aW5zLkV4cGVyaWVuY2VHYWluZXIsIEdhbWUuRW50aXR5TWl4aW5zLlJhbmRvbVN0YXRHYWluZXJdXG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLkVudGl0eVJlcG9zaXRvcnkgPT0gbnVsbCkge1xuICBHYW1lLkVudGl0eVJlcG9zaXRvcnkgPSBuZXcgR2FtZS5SZXBvc2l0b3J5KFwiZW50aXRpZXNcIiwgR2FtZS5FbnRpdHkpO1xufVxuXG5HYW1lLkVudGl0eVJlcG9zaXRvcnkuZGVmaW5lKFwibmV3dFwiLCB7XG4gIG5hbWU6IFwibmV3dFwiLFxuICBjaGFyYWN0ZXI6IFwiOlwiLFxuICBmb3JlZ3JvdW5kOiBcInllbGxvd1wiLFxuICBtYXhIcDogMyxcbiAgYXR0YWNrVmFsdWU6IDIsXG4gIG1peGluczogW0dhbWUuRW50aXR5TWl4aW5zLlRhc2tBY3RvciwgR2FtZS5FbnRpdHlNaXhpbnMuQXR0YWNrZXIsIEdhbWUuRW50aXR5TWl4aW5zLkRlc3RydWN0aWJsZSwgR2FtZS5FbnRpdHlNaXhpbnMuQ29ycHNlRHJvcHBlciwgR2FtZS5FbnRpdHlNaXhpbnMuRXhwZXJpZW5jZUdhaW5lciwgR2FtZS5FbnRpdHlNaXhpbnMuUmFuZG9tU3RhdEdhaW5lcl1cbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuR2FtZS5FbnRpdHlSZXBvc2l0b3J5ID0gbmV3IEdhbWUuUmVwb3NpdG9yeShcImVudGl0aWVzXCIsIEdhbWUuRW50aXR5KTtcblxuR2FtZS5FbnRpdHlSZXBvc2l0b3J5LmRlZmluZShcInNsaW1lXCIsIHtcbiAgbmFtZTogXCJzbGltZVwiLFxuICBjaGFyYWN0ZXI6IFwic1wiLFxuICBmb3JlZ3JvdW5kOiBcImxpZ2h0R3JlZW5cIixcbiAgbWF4SHA6IDEwLFxuICBhdHRhY2tWYWx1ZTogNSxcbiAgc2lnaHRSYWRpdXM6IDMsXG4gIHRhc2tzOiBbXCJodW50XCIsIFwid2FuZGVyXCJdLFxuICBtaXhpbnM6IFtHYW1lLkVudGl0eU1peGlucy5UYXNrQWN0b3IsIEdhbWUuRW50aXR5TWl4aW5zLlNpZ2h0LCBHYW1lLkVudGl0eU1peGlucy5BdHRhY2tlciwgR2FtZS5FbnRpdHlNaXhpbnMuRGVzdHJ1Y3RpYmxlLCBHYW1lLkVudGl0eU1peGlucy5Db3Jwc2VEcm9wcGVyLCBHYW1lLkVudGl0eU1peGlucy5FeHBlcmllbmNlR2FpbmVyLCBHYW1lLkVudGl0eU1peGlucy5SYW5kb21TdGF0R2FpbmVyXVxufSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5JdGVtUmVwb3NpdG9yeSA9PSBudWxsKSB7XG4gIEdhbWUuSXRlbVJlcG9zaXRvcnkgPSBuZXcgR2FtZS5SZXBvc2l0b3J5KFwiaXRlbXNcIiwgR2FtZS5JdGVtKTtcbn1cblxuR2FtZS5JdGVtUmVwb3NpdG9yeS5kZWZpbmUoXCJhcHBsZVwiLCB7XG4gIG5hbWU6IFwiYXBwbGVcIixcbiAgY2hhcmFjdGVyOiBcIiVcIixcbiAgZm9yZWdyb3VuZDogXCJyZWRcIixcbiAgZm9vZFZhbHVlOiA1MCxcbiAgbWl4aW5zOiBbR2FtZS5JdGVtTWl4aW5zLkVkaWJsZV1cbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuaWYgKEdhbWUuSXRlbVJlcG9zaXRvcnkgPT0gbnVsbCkge1xuICBHYW1lLkl0ZW1SZXBvc2l0b3J5ID0gbmV3IEdhbWUuUmVwb3NpdG9yeShcIml0ZW1zXCIsIEdhbWUuSXRlbSk7XG59XG5cbkdhbWUuSXRlbVJlcG9zaXRvcnkuZGVmaW5lKFwiY2hhaW5tYWlsXCIsIHtcbiAgbmFtZTogXCJjaGFpbm1haWxcIixcbiAgY2hhcmFjdGVyOiBcIltcIixcbiAgZm9yZWdyb3VuZDogXCJ3aGl0ZVwiLFxuICBkZWZlbnNlVmFsdWU6IDQsXG4gIHdlYXJhYmxlOiB0cnVlLFxuICBtaXhpbnM6IFtHYW1lLkl0ZW1NaXhpbnMuRXF1aXBwYWJsZV1cbn0sIHtcbiAgZGlzYWJsZVJhbmRvbUNyZWF0aW9uOiB0cnVlXG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLkl0ZW1SZXBvc2l0b3J5ID09IG51bGwpIHtcbiAgR2FtZS5JdGVtUmVwb3NpdG9yeSA9IG5ldyBHYW1lLlJlcG9zaXRvcnkoXCJpdGVtc1wiLCBHYW1lLkl0ZW0pO1xufVxuXG5HYW1lLkl0ZW1SZXBvc2l0b3J5LmRlZmluZShcImNvcnBzZVwiLCB7XG4gIG5hbWU6IFwiY29ycHNlXCIsXG4gIGNoYXJhY3RlcjogXCIlXCIsXG4gIGZvb2RWYWx1ZTogNzUsXG4gIGNvbnN1bXB0aW9uczogMSxcbiAgbWl4aW5zOiBbR2FtZS5JdGVtTWl4aW5zLkVkaWJsZV1cbn0sIHtcbiAgZGlzYWJsZVJhbmRvbUNyZWF0aW9uOiB0cnVlXG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLkl0ZW1SZXBvc2l0b3J5ID09IG51bGwpIHtcbiAgR2FtZS5JdGVtUmVwb3NpdG9yeSA9IG5ldyBHYW1lLlJlcG9zaXRvcnkoXCJpdGVtc1wiLCBHYW1lLkl0ZW0pO1xufVxuXG5HYW1lLkl0ZW1SZXBvc2l0b3J5LmRlZmluZShcImRhZ2dlclwiLCB7XG4gIG5hbWU6IFwiZGFnZ2VyXCIsXG4gIGNoYXJhY3RlcjogXCIpXCIsXG4gIGZvcmVncm91bmQ6IFwiZ3JheVwiLFxuICBhdHRhY2tWYWx1ZTogNSxcbiAgd2llbGRhYmxlOiB0cnVlLFxuICBtaXhpbnM6IFtHYW1lLkl0ZW1NaXhpbnMuRXF1aXBwYWJsZV1cbn0sIHtcbiAgZGlzYWJsZVJhbmRvbUNyZWF0aW9uOiB0cnVlXG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLkl0ZW1SZXBvc2l0b3J5ID09IG51bGwpIHtcbiAgR2FtZS5JdGVtUmVwb3NpdG9yeSA9IG5ldyBHYW1lLlJlcG9zaXRvcnkoXCJpdGVtc1wiLCBHYW1lLkl0ZW0pO1xufVxuXG5HYW1lLkl0ZW1SZXBvc2l0b3J5LmRlZmluZShcIm1lbG9uXCIsIHtcbiAgbmFtZTogXCJtZWxvblwiLFxuICBjaGFyYWN0ZXI6IFwiJVwiLFxuICBmb3JlZ3JvdW5kOiBcImxpZ2h0R3JlZW5cIixcbiAgZm9vZFZhbHVlOiAzNSxcbiAgY29uc3VtcHRpb25zOiA0LFxuICBtaXhpbnM6IFtHYW1lLkl0ZW1NaXhpbnMuRWRpYmxlXVxufSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5JdGVtUmVwb3NpdG9yeSA9PSBudWxsKSB7XG4gIEdhbWUuSXRlbVJlcG9zaXRvcnkgPSBuZXcgR2FtZS5SZXBvc2l0b3J5KFwiaXRlbXNcIiwgR2FtZS5JdGVtKTtcbn1cblxuR2FtZS5JdGVtUmVwb3NpdG9yeS5kZWZpbmUoXCJwbGF0ZW1haWxcIiwge1xuICBuYW1lOiBcInBsYXRlbWFpbFwiLFxuICBjaGFyYWN0ZXI6IFwiW1wiLFxuICBmb3JlZ3JvdW5kOiBcImFsaWNlYmx1ZVwiLFxuICBkZWZlbnNlVmFsdWU6IDYsXG4gIHdlYXJhYmxlOiB0cnVlLFxuICBtaXhpbnM6IFtHYW1lLkl0ZW1NaXhpbnMuRXF1aXBwYWJsZV1cbn0sIHtcbiAgZGlzYWJsZVJhbmRvbUNyZWF0aW9uOiB0cnVlXG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLkl0ZW1SZXBvc2l0b3J5ID09IG51bGwpIHtcbiAgR2FtZS5JdGVtUmVwb3NpdG9yeSA9IG5ldyBHYW1lLlJlcG9zaXRvcnkoXCJpdGVtc1wiLCBHYW1lLkl0ZW0pO1xufVxuXG5HYW1lLkl0ZW1SZXBvc2l0b3J5LmRlZmluZShcInB1bXBraW5cIiwge1xuICBuYW1lOiBcInB1bXBraW5cIixcbiAgY2hhcmFjdGVyOiBcIiVcIixcbiAgZm9yZWdyb3VuZDogXCJvcmFuZ2VcIixcbiAgZm9vZFZhbHVlOiA1MCxcbiAgYXR0YWNrVmFsdWU6IDIsXG4gIGRlZmVuc2VWYWx1ZTogMixcbiAgd2VhcmFibGU6IHRydWUsXG4gIHdpZWxkYWJsZTogdHJ1ZSxcbiAgbWl4aW5zOiBbR2FtZS5JdGVtTWl4aW5zLkVkaWJsZSwgR2FtZS5JdGVtTWl4aW5zLkVxdWlwcGFibGVdXG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLkl0ZW1SZXBvc2l0b3J5ID09IG51bGwpIHtcbiAgR2FtZS5JdGVtUmVwb3NpdG9yeSA9IG5ldyBHYW1lLlJlcG9zaXRvcnkoXCJpdGVtc1wiLCBHYW1lLkl0ZW0pO1xufVxuXG5HYW1lLkl0ZW1SZXBvc2l0b3J5LmRlZmluZShcInJvY2tcIiwge1xuICBuYW1lOiBcInJvY2tcIixcbiAgY2hhcmFjdGVyOiBcIipcIixcbiAgZm9yZWdyb3VuZDogXCJ3aGl0ZVwiXG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLkl0ZW1SZXBvc2l0b3J5ID09IG51bGwpIHtcbiAgR2FtZS5JdGVtUmVwb3NpdG9yeSA9IG5ldyBHYW1lLlJlcG9zaXRvcnkoXCJpdGVtc1wiLCBHYW1lLkl0ZW0pO1xufVxuXG5HYW1lLkl0ZW1SZXBvc2l0b3J5LmRlZmluZShcInN0YWZmXCIsIHtcbiAgbmFtZTogXCJzdGFmZlwiLFxuICBjaGFyYWN0ZXI6IFwiKVwiLFxuICBmb3JlZ3JvdW5kOiBcInllbGxvd1wiLFxuICBhdHRhY2tWYWx1ZTogNSxcbiAgZGVmZW5zZVZhbHVlOiAzLFxuICB3aWVsZGFibGU6IHRydWUsXG4gIG1peGluczogW0dhbWUuSXRlbU1peGlucy5FcXVpcHBhYmxlXVxufSwge1xuICBkaXNhYmxlUmFuZG9tQ3JlYXRpb246IHRydWVcbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuaWYgKEdhbWUuSXRlbVJlcG9zaXRvcnkgPT0gbnVsbCkge1xuICBHYW1lLkl0ZW1SZXBvc2l0b3J5ID0gbmV3IEdhbWUuUmVwb3NpdG9yeShcIml0ZW1zXCIsIEdhbWUuSXRlbSk7XG59XG5cbkdhbWUuSXRlbVJlcG9zaXRvcnkuZGVmaW5lKFwic3dvcmRcIiwge1xuICBuYW1lOiBcInN3b3JkXCIsXG4gIGNoYXJhY3RlcjogXCIpXCIsXG4gIGZvcmVncm91bmQ6IFwid2hpdGVcIixcbiAgYXR0YWNrVmFsdWU6IDEwLFxuICB3aWVsZGFibGU6IHRydWUsXG4gIG1peGluczogW0dhbWUuSXRlbU1peGlucy5FcXVpcHBhYmxlXVxufSwge1xuICBkaXNhYmxlUmFuZG9tQ3JlYXRpb246IHRydWVcbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuaWYgKEdhbWUuSXRlbVJlcG9zaXRvcnkgPT0gbnVsbCkge1xuICBHYW1lLkl0ZW1SZXBvc2l0b3J5ID0gbmV3IEdhbWUuUmVwb3NpdG9yeShcIml0ZW1zXCIsIEdhbWUuSXRlbSk7XG59XG5cbkdhbWUuSXRlbVJlcG9zaXRvcnkuZGVmaW5lKFwidHVuaWNcIiwge1xuICBuYW1lOiBcInR1bmljXCIsXG4gIGNoYXJhY3RlcjogXCJbXCIsXG4gIGZvcmVncm91bmQ6IFwiZ3JlZW5cIixcbiAgZGVmZW5zZVZhbHVlOiAyLFxuICB3ZWFyYWJsZTogdHJ1ZSxcbiAgbWl4aW5zOiBbR2FtZS5JdGVtTWl4aW5zLkVxdWlwcGFibGVdXG59LCB7XG4gIGRpc2FibGVSYW5kb21DcmVhdGlvbjogdHJ1ZVxufSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5TY3JlZW4gPT0gbnVsbCkge1xuICBHYW1lLlNjcmVlbiA9IHt9O1xufVxuXG5HYW1lLlNjcmVlbi5kcm9wU2NyZWVuID0gbmV3IEdhbWUuU2NyZWVuLkl0ZW1MaXN0U2NyZWVuKHtcbiAgY2FwdGlvbjogXCJDaG9vc2UgdGhlIGl0ZW0geW91IHdpc2ggdG8gZHJvcFwiLFxuICBjYW5TZWxlY3Q6IHRydWUsXG4gIGNhblNlbGVjdE11bHRpcGxlSXRlbXM6IGZhbHNlLFxuICBvazogZnVuY3Rpb24oc2VsZWN0ZWRJdGVtcykge1xuICAgIHRoaXMuX3BsYXllci5kcm9wSXRlbShPYmplY3Qua2V5cyhzZWxlY3RlZEl0ZW1zKVswXSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuaWYgKEdhbWUuU2NyZWVuID09IG51bGwpIHtcbiAgR2FtZS5TY3JlZW4gPSB7fTtcbn1cblxuR2FtZS5TY3JlZW4uZWF0U2NyZWVuID0gbmV3IEdhbWUuU2NyZWVuLkl0ZW1MaXN0U2NyZWVuKHtcbiAgY2FwdGlvbjogXCJDaG9vc2UgdGhlIGl0ZW0geW91IHdpc2ggdG8gZWF0XCIsXG4gIGNhblNlbGVjdDogdHJ1ZSxcbiAgY2FuU2VsZWN0TXVsdGlwbGVJdGVtczogZmFsc2UsXG4gIGlzQWNjZXB0YWJsZTogZnVuY3Rpb24oaXRlbSkge1xuICAgIHJldHVybiBpdGVtICYmIGl0ZW0uaGFzTWl4aW4oXCJFZGlibGVcIik7XG4gIH0sXG4gIG9rOiBmdW5jdGlvbihzZWxlY3RlZEl0ZW1zKSB7XG4gICAgdmFyIGl0ZW0sIGtleTtcbiAgICBrZXkgPSBPYmplY3Qua2V5cyhzZWxlY3RlZEl0ZW1zKVswXTtcbiAgICBpdGVtID0gc2VsZWN0ZWRJdGVtc1trZXldO1xuICAgIEdhbWUuc2VuZE1lc3NhZ2UodGhpcy5fcGxheWVyLCBcIllvdSBlYXQgJXMuXCIsIFtpdGVtLmRlc2NyaWJlVGhlKCldKTtcbiAgICBpdGVtLmVhdCh0aGlzLl9wbGF5ZXIpO1xuICAgIGlmICghaXRlbS5oYXNSZW1haW5pbmdDb25zdW1wdGlvbnMoKSkge1xuICAgICAgdGhpcy5fcGxheWVyLnJlbW92ZUl0ZW0oa2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuaWYgKEdhbWUuU2NyZWVuID09IG51bGwpIHtcbiAgR2FtZS5TY3JlZW4gPSB7fTtcbn1cblxuR2FtZS5TY3JlZW4uZXhhbWluZVNjcmVlbiA9IG5ldyBHYW1lLlNjcmVlbi5JdGVtTGlzdFNjcmVlbih7XG4gIGNhcHRpb246IFwiQ2hvb3NlIHRoZSBpdGVtIHlvdSB3aXNoIHRvIGV4YW1pbmVcIixcbiAgY2FuU2VsZWN0OiB0cnVlLFxuICBjYW5TZWxlY3RNdWx0aXBsZUl0ZW1zOiBmYWxzZSxcbiAgaXNBY2NlcHRhYmxlOiBmdW5jdGlvbihpdGVtKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG4gIG9rOiBmdW5jdGlvbihzZWxlY3RlZEl0ZW1zKSB7XG4gICAgdmFyIGl0ZW0sIGtleXM7XG4gICAga2V5cyA9IE9iamVjdC5rZXlzKHNlbGVjdGVkSXRlbXMpO1xuICAgIGlmIChrZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgIGl0ZW0gPSBzZWxlY3RlZEl0ZW1zW2tleXNbMF1dO1xuICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLl9wbGF5ZXIsIFwiSXQncyAlcyAoJXMpLlwiLCBbaXRlbS5kZXNjcmliZUEoZmFsc2UpLCBpdGVtLmRldGFpbHMoKV0pO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5TY3JlZW4gPT0gbnVsbCkge1xuICBHYW1lLlNjcmVlbiA9IHt9O1xufVxuXG5HYW1lLlNjcmVlbi5nYWluU3RhdFNjcmVlbiA9IHtcbiAgc2V0dXA6IGZ1bmN0aW9uKGVudGl0eSkge1xuICAgIHRoaXMuX2VudGl0eSA9IGVudGl0eTtcbiAgICByZXR1cm4gdGhpcy5fb3B0aW9ucyA9IGVudGl0eS5nZXRTdGF0T3B0aW9ucygpO1xuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uKGRpc3BsYXkpIHtcbiAgICB2YXIgaSwgbGV0dGVycztcbiAgICBsZXR0ZXJzID0gXCJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5elwiO1xuICAgIGRpc3BsYXkuZHJhd1RleHQoMCwgMCwgXCJDaG9vc2UgYSBzdGF0IHRvIGluY3JlYXNlOiBcIik7XG4gICAgaSA9IDA7XG4gICAgd2hpbGUgKGkgPCB0aGlzLl9vcHRpb25zLmxlbmd0aCkge1xuICAgICAgZGlzcGxheS5kcmF3VGV4dCgwLCAyICsgaSwgbGV0dGVycy5zdWJzdHJpbmcoaSwgaSArIDEpICsgXCIgLSBcIiArIHRoaXMuX29wdGlvbnNbaV1bMF0pO1xuICAgICAgaSsrO1xuICAgIH1cbiAgICByZXR1cm4gZGlzcGxheS5kcmF3VGV4dCgwLCA0ICsgdGhpcy5fb3B0aW9ucy5sZW5ndGgsIFwiUmVtYWluaW5nIHBvaW50czogXCIgKyB0aGlzLl9lbnRpdHkuZ2V0U3RhdFBvaW50cygpKTtcbiAgfSxcbiAgaGFuZGxlSW5wdXQ6IGZ1bmN0aW9uKGlucHV0VHlwZSwgaW5wdXREYXRhKSB7XG4gICAgdmFyIGluZGV4O1xuICAgIGlmIChpbnB1dFR5cGUgPT09IFwia2V5ZG93blwiKSB7XG4gICAgICBpZiAoaW5wdXREYXRhLmtleUNvZGUgPj0gUk9ULlZLX0EgJiYgaW5wdXREYXRhLmtleUNvZGUgPD0gUk9ULlZLX1opIHtcbiAgICAgICAgaW5kZXggPSBpbnB1dERhdGEua2V5Q29kZSAtIFJPVC5WS19BO1xuICAgICAgICBpZiAodGhpcy5fb3B0aW9uc1tpbmRleF0pIHtcbiAgICAgICAgICB0aGlzLl9vcHRpb25zW2luZGV4XVsxXS5jYWxsKHRoaXMuX2VudGl0eSk7XG4gICAgICAgICAgdGhpcy5fZW50aXR5LnNldFN0YXRQb2ludHModGhpcy5fZW50aXR5LmdldFN0YXRQb2ludHMoKSAtIDEpO1xuICAgICAgICAgIGlmICh0aGlzLl9lbnRpdHkuZ2V0U3RhdFBvaW50cygpID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gR2FtZS5TY3JlZW4ucGxheVNjcmVlbi5zZXRTdWJTY3JlZW4odW5kZWZpbmVkKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIEdhbWUucmVmcmVzaCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLlNjcmVlbiA9PSBudWxsKSB7XG4gIEdhbWUuU2NyZWVuID0ge307XG59XG5cbkdhbWUuU2NyZWVuLmhlbHBTY3JlZW4gPSB7XG4gIHJlbmRlcjogZnVuY3Rpb24oZGlzcGxheSkge1xuICAgIHZhciBib3JkZXIsIHRleHQsIHk7XG4gICAgdGV4dCA9IFwianNyb2d1ZSBoZWxwXCI7XG4gICAgYm9yZGVyID0gXCItLS0tLS0tLS0tLS0tXCI7XG4gICAgeSA9IDA7XG4gICAgZGlzcGxheS5kcmF3VGV4dChHYW1lLmdldFNjcmVlbldpZHRoKCkgLyAyIC0gdGV4dC5sZW5ndGggLyAyLCB5KyssIHRleHQpO1xuICAgIGRpc3BsYXkuZHJhd1RleHQoR2FtZS5nZXRTY3JlZW5XaWR0aCgpIC8gMiAtIHRleHQubGVuZ3RoIC8gMiwgeSsrLCBib3JkZXIpO1xuICAgIGRpc3BsYXkuZHJhd1RleHQoMCwgeSsrLCBcIlRoZSB2aWxsYWdlcnMgaGF2ZSBiZWVuIGNvbXBsYWluaW5nIG9mIGEgdGVycmlibGUgc3RlbmNoIGNvbWluZyBmcm9tIHRoZSBjYXZlLlwiKTtcbiAgICBkaXNwbGF5LmRyYXdUZXh0KDAsIHkrKywgXCJGaW5kIHRoZSBzb3VyY2Ugb2YgdGhpcyBzbWVsbCBhbmQgZ2V0IHJpZCBvZiBpdCFcIik7XG4gICAgeSArPSAzO1xuICAgIGRpc3BsYXkuZHJhd1RleHQoMCwgeSsrLCBcIlssXSB0byBwaWNrIHVwIGl0ZW1zXCIpO1xuICAgIGRpc3BsYXkuZHJhd1RleHQoMCwgeSsrLCBcIltkXSB0byBkcm9wIGl0ZW1zXCIpO1xuICAgIGRpc3BsYXkuZHJhd1RleHQoMCwgeSsrLCBcIltlXSB0byBlYXQgaXRlbXNcIik7XG4gICAgZGlzcGxheS5kcmF3VGV4dCgwLCB5KyssIFwiW3ddIHRvIHdpZWxkIGl0ZW1zXCIpO1xuICAgIGRpc3BsYXkuZHJhd1RleHQoMCwgeSsrLCBcIltXXSB0byB3aWVsZCBpdGVtc1wiKTtcbiAgICBkaXNwbGF5LmRyYXdUZXh0KDAsIHkrKywgXCJbeF0gdG8gZXhhbWluZSBpdGVtc1wiKTtcbiAgICBkaXNwbGF5LmRyYXdUZXh0KDAsIHkrKywgXCJbO10gdG8gbG9vayBhcm91bmQgeW91XCIpO1xuICAgIGRpc3BsYXkuZHJhd1RleHQoMCwgeSsrLCBcIls/XSB0byBzaG93IHRoaXMgaGVscCBzY3JlZW5cIik7XG4gICAgeSArPSAzO1xuICAgIHRleHQgPSBcIi0tLSBwcmVzcyBhbnkga2V5IHRvIGNvbnRpbnVlIC0tLVwiO1xuICAgIHJldHVybiBkaXNwbGF5LmRyYXdUZXh0KEdhbWUuZ2V0U2NyZWVuV2lkdGgoKSAvIDIgLSB0ZXh0Lmxlbmd0aCAvIDIsIHkrKywgdGV4dCk7XG4gIH0sXG4gIGhhbmRsZUlucHV0OiBmdW5jdGlvbihpbnB1dFR5cGUsIGlucHV0RGF0YSkge1xuICAgIHJldHVybiBHYW1lLlNjcmVlbi5wbGF5U2NyZWVuLnNldFN1YlNjcmVlbihudWxsKTtcbiAgfVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLlNjcmVlbiA9PSBudWxsKSB7XG4gIEdhbWUuU2NyZWVuID0ge307XG59XG5cbkdhbWUuU2NyZWVuLmludmVudG9yeVNjcmVlbiA9IG5ldyBHYW1lLlNjcmVlbi5JdGVtTGlzdFNjcmVlbih7XG4gIGNhcHRpb246IFwiSW52ZW50b3J5XCIsXG4gIGNhblNlbGVjdDogZmFsc2Vcbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuaWYgKEdhbWUuU2NyZWVuID09IG51bGwpIHtcbiAgR2FtZS5TY3JlZW4gPSB7fTtcbn1cblxuR2FtZS5TY3JlZW4ubG9va1NjcmVlbiA9IG5ldyBHYW1lLlNjcmVlbi5UYXJnZXRCYXNlZFNjcmVlbih7XG4gIGNhcHRpb25GdW5jdGlvbjogZnVuY3Rpb24oeCwgeSkge1xuICAgIHZhciBlbnRpdHksIGl0ZW0sIGl0ZW1zLCBtYXAsIHo7XG4gICAgeiA9IHRoaXMuX3BsYXllci5nZXRaKCk7XG4gICAgbWFwID0gdGhpcy5fcGxheWVyLmdldE1hcCgpO1xuICAgIGlmIChtYXAuaXNFeHBsb3JlZCh4LCB5LCB6KSkge1xuICAgICAgaWYgKHRoaXMuX3Zpc2libGVDZWxsc1t4ICsgXCIsXCIgKyB5XSkge1xuICAgICAgICBpdGVtcyA9IG1hcC5nZXRJdGVtc0F0KHgsIHksIHopO1xuICAgICAgICBpZiAoaXRlbXMpIHtcbiAgICAgICAgICBpdGVtID0gaXRlbXNbaXRlbXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgcmV0dXJuIFN0cmluZy5mb3JtYXQoXCIlcyAtICVzICglcylcIiwgaXRlbS5nZXRSZXByZXNlbnRhdGlvbigpLCBpdGVtLmRlc2NyaWJlQSh0cnVlKSwgaXRlbS5kZXRhaWxzKCkpO1xuICAgICAgICB9IGVsc2UgaWYgKG1hcC5nZXRFbnRpdHlBdCh4LCB5LCB6KSkge1xuICAgICAgICAgIGVudGl0eSA9IG1hcC5nZXRFbnRpdHlBdCh4LCB5LCB6KTtcbiAgICAgICAgICByZXR1cm4gU3RyaW5nLmZvcm1hdChcIiVzIC0gJXMgKCVzKVwiLCBlbnRpdHkuZ2V0UmVwcmVzZW50YXRpb24oKSwgZW50aXR5LmRlc2NyaWJlQSh0cnVlKSwgZW50aXR5LmRldGFpbHMoKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBTdHJpbmcuZm9ybWF0KFwiJXMgLSAlc1wiLCBtYXAuZ2V0VGlsZSh4LCB5LCB6KS5nZXRSZXByZXNlbnRhdGlvbigpLCBtYXAuZ2V0VGlsZSh4LCB5LCB6KS5nZXREZXNjcmlwdGlvbigpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFN0cmluZy5mb3JtYXQoXCIlcyAtICVzXCIsIEdhbWUuVGlsZS5udWxsVGlsZS5nZXRSZXByZXNlbnRhdGlvbigpLCBHYW1lLlRpbGUubnVsbFRpbGUuZ2V0RGVzY3JpcHRpb24oKSk7XG4gICAgfVxuICB9XG59KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbmlmIChHYW1lLlNjcmVlbiA9PSBudWxsKSB7XG4gIEdhbWUuU2NyZWVuID0ge307XG59XG5cbkdhbWUuU2NyZWVuLmxvc2VTY3JlZW4gPSB7XG4gIGVudGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gY29uc29sZS5sb2coXCJFbnRlcmVkIGxvc2Ugc2NyZWVuLlwiKTtcbiAgfSxcbiAgZXhpdDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGNvbnNvbGUubG9nKFwiRXhpdGVkIGxvc2Ugc2NyZWVuLlwiKTtcbiAgfSxcbiAgcmVuZGVyOiBmdW5jdGlvbihkaXNwbGF5KSB7XG4gICAgdmFyIGksIF9yZXN1bHRzO1xuICAgIGkgPSAwO1xuICAgIF9yZXN1bHRzID0gW107XG4gICAgd2hpbGUgKGkgPCAyMikge1xuICAgICAgZGlzcGxheS5kcmF3VGV4dCgyLCBpICsgMSwgXCIlYntyZWR9WW91IGxvc2UhIDooXCIpO1xuICAgICAgX3Jlc3VsdHMucHVzaChpKyspO1xuICAgIH1cbiAgICByZXR1cm4gX3Jlc3VsdHM7XG4gIH0sXG4gIGhhbmRsZUlucHV0OiBmdW5jdGlvbihpbnB1dFR5cGUsIGlucHV0RGF0YSkge31cbn07XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5TY3JlZW4gPT0gbnVsbCkge1xuICBHYW1lLlNjcmVlbiA9IHt9O1xufVxuXG5HYW1lLlNjcmVlbi5waWNrdXBTY3JlZW4gPSBuZXcgR2FtZS5TY3JlZW4uSXRlbUxpc3RTY3JlZW4oe1xuICBjYXB0aW9uOiBcIkNob29zZSB0aGUgaXRlbXMgeW91IHdpc2ggdG8gcGlja3VwXCIsXG4gIGNhblNlbGVjdDogdHJ1ZSxcbiAgY2FuU2VsZWN0TXVsdGlwbGVJdGVtczogdHJ1ZSxcbiAgb2s6IGZ1bmN0aW9uKHNlbGVjdGVkSXRlbXMpIHtcbiAgICBpZiAoIXRoaXMuX3BsYXllci5waWNrdXBJdGVtcyhPYmplY3Qua2V5cyhzZWxlY3RlZEl0ZW1zKSkpIHtcbiAgICAgIEdhbWUuc2VuZE1lc3NhZ2UodGhpcy5fcGxheWVyLCBcIllvdXIgaW52ZW50b3J5IGlzIGZ1bGwhIE5vdCBhbGwgaXRlbXMgd2VyZSBwaWNrZWQgdXAuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5TY3JlZW4gPT0gbnVsbCkge1xuICBHYW1lLlNjcmVlbiA9IHt9O1xufVxuXG5HYW1lLlNjcmVlbi5wbGF5U2NyZWVuID0ge1xuICBfcGxheWVyOiBudWxsLFxuICBfZ2FtZUVuZGVkOiBmYWxzZSxcbiAgX3N1YlNjcmVlbjogbnVsbCxcbiAgZW50ZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkZXB0aCwgaGVpZ2h0LCBtYXAsIHRpbGVzLCB3aWR0aDtcbiAgICB3aWR0aCA9IDEwMDtcbiAgICBoZWlnaHQgPSA0ODtcbiAgICBkZXB0aCA9IDY7XG4gICAgdGhpcy5fcGxheWVyID0gbmV3IEdhbWUuRW50aXR5KEdhbWUuUGxheWVyVGVtcGxhdGUpO1xuICAgIHRpbGVzID0gbmV3IEdhbWUuQnVpbGRlcih3aWR0aCwgaGVpZ2h0LCBkZXB0aCkuZ2V0VGlsZXMoKTtcbiAgICBtYXAgPSBuZXcgR2FtZS5NYXAuQ2F2ZSh0aWxlcywgdGhpcy5fcGxheWVyKTtcbiAgICByZXR1cm4gbWFwLmdldEVuZ2luZSgpLnN0YXJ0KCk7XG4gIH0sXG4gIGV4aXQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBjb25zb2xlLmxvZyhcIkV4aXRlZCBwbGF5IHNjcmVlbi5cIik7XG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24oZGlzcGxheSkge1xuICAgIHZhciBodW5nZXJTdGF0ZSwgaSwgbWVzc2FnZVksIG1lc3NhZ2VzLCBzY3JlZW5IZWlnaHQsIHNjcmVlbldpZHRoLCBzdGF0cztcbiAgICBpZiAodGhpcy5fc3ViU2NyZWVuKSB7XG4gICAgICB0aGlzLl9zdWJTY3JlZW4ucmVuZGVyKGRpc3BsYXkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzY3JlZW5XaWR0aCA9IEdhbWUuZ2V0U2NyZWVuV2lkdGgoKTtcbiAgICBzY3JlZW5IZWlnaHQgPSBHYW1lLmdldFNjcmVlbkhlaWdodCgpO1xuICAgIHRoaXMucmVuZGVyVGlsZXMoZGlzcGxheSk7XG4gICAgbWVzc2FnZXMgPSB0aGlzLl9wbGF5ZXIuZ2V0TWVzc2FnZXMoKTtcbiAgICBtZXNzYWdlWSA9IDA7XG4gICAgaSA9IDA7XG4gICAgd2hpbGUgKGkgPCBtZXNzYWdlcy5sZW5ndGgpIHtcbiAgICAgIG1lc3NhZ2VZICs9IGRpc3BsYXkuZHJhd1RleHQoMCwgbWVzc2FnZVksIFwiJWN7d2hpdGV9JWJ7YmxhY2t9XCIgKyBtZXNzYWdlc1tpXSk7XG4gICAgICBpKys7XG4gICAgfVxuICAgIHN0YXRzID0gXCIlY3t3aGl0ZX0lYntibGFja31cIjtcbiAgICBzdGF0cyArPSB2c3ByaW50ZihcIkhQOiAlZC8lZCBMOiAlZCBYUDogJWRcIiwgW3RoaXMuX3BsYXllci5nZXRIcCgpLCB0aGlzLl9wbGF5ZXIuZ2V0TWF4SHAoKSwgdGhpcy5fcGxheWVyLmdldExldmVsKCksIHRoaXMuX3BsYXllci5nZXRFeHBlcmllbmNlKCldKTtcbiAgICBkaXNwbGF5LmRyYXdUZXh0KDAsIHNjcmVlbkhlaWdodCwgc3RhdHMpO1xuICAgIGh1bmdlclN0YXRlID0gdGhpcy5fcGxheWVyLmdldEh1bmdlclN0YXRlKCk7XG4gICAgcmV0dXJuIGRpc3BsYXkuZHJhd1RleHQoc2NyZWVuV2lkdGggLSBodW5nZXJTdGF0ZS5sZW5ndGgsIHNjcmVlbkhlaWdodCwgaHVuZ2VyU3RhdGUpO1xuICB9LFxuICBnZXRTY3JlZW5PZmZzZXRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgdG9wTGVmdFgsIHRvcExlZnRZO1xuICAgIHRvcExlZnRYID0gTWF0aC5tYXgoMCwgdGhpcy5fcGxheWVyLmdldFgoKSAtIChHYW1lLmdldFNjcmVlbldpZHRoKCkgLyAyKSk7XG4gICAgdG9wTGVmdFggPSBNYXRoLm1pbih0b3BMZWZ0WCwgdGhpcy5fcGxheWVyLmdldE1hcCgpLmdldFdpZHRoKCkgLSBHYW1lLmdldFNjcmVlbldpZHRoKCkpO1xuICAgIHRvcExlZnRZID0gTWF0aC5tYXgoMCwgdGhpcy5fcGxheWVyLmdldFkoKSAtIChHYW1lLmdldFNjcmVlbkhlaWdodCgpIC8gMikpO1xuICAgIHRvcExlZnRZID0gTWF0aC5taW4odG9wTGVmdFksIHRoaXMuX3BsYXllci5nZXRNYXAoKS5nZXRIZWlnaHQoKSAtIEdhbWUuZ2V0U2NyZWVuSGVpZ2h0KCkpO1xuICAgIHJldHVybiB7XG4gICAgICB4OiB0b3BMZWZ0WCxcbiAgICAgIHk6IHRvcExlZnRZXG4gICAgfTtcbiAgfSxcbiAgcmVuZGVyVGlsZXM6IGZ1bmN0aW9uKGRpc3BsYXkpIHtcbiAgICB2YXIgY3VycmVudERlcHRoLCBmb3JlZ3JvdW5kLCBnbHlwaCwgaXRlbXMsIG1hcCwgb2Zmc2V0cywgc2NyZWVuSGVpZ2h0LCBzY3JlZW5XaWR0aCwgdG9wTGVmdFgsIHRvcExlZnRZLCB2aXNpYmxlQ2VsbHMsIHgsIHksIF9yZXN1bHRzO1xuICAgIHNjcmVlbldpZHRoID0gR2FtZS5nZXRTY3JlZW5XaWR0aCgpO1xuICAgIHNjcmVlbkhlaWdodCA9IEdhbWUuZ2V0U2NyZWVuSGVpZ2h0KCk7XG4gICAgb2Zmc2V0cyA9IHRoaXMuZ2V0U2NyZWVuT2Zmc2V0cygpO1xuICAgIHRvcExlZnRYID0gb2Zmc2V0cy54O1xuICAgIHRvcExlZnRZID0gb2Zmc2V0cy55O1xuICAgIHZpc2libGVDZWxscyA9IHt9O1xuICAgIG1hcCA9IHRoaXMuX3BsYXllci5nZXRNYXAoKTtcbiAgICBjdXJyZW50RGVwdGggPSB0aGlzLl9wbGF5ZXIuZ2V0WigpO1xuICAgIG1hcC5nZXRGb3YoY3VycmVudERlcHRoKS5jb21wdXRlKHRoaXMuX3BsYXllci5nZXRYKCksIHRoaXMuX3BsYXllci5nZXRZKCksIHRoaXMuX3BsYXllci5nZXRTaWdodFJhZGl1cygpLCBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHZpc2liaWxpdHkpIHtcbiAgICAgIHZpc2libGVDZWxsc1t4ICsgXCIsXCIgKyB5XSA9IHRydWU7XG4gICAgICByZXR1cm4gbWFwLnNldEV4cGxvcmVkKHgsIHksIGN1cnJlbnREZXB0aCwgdHJ1ZSk7XG4gICAgfSk7XG4gICAgeCA9IHRvcExlZnRYO1xuICAgIF9yZXN1bHRzID0gW107XG4gICAgd2hpbGUgKHggPCB0b3BMZWZ0WCArIHNjcmVlbldpZHRoKSB7XG4gICAgICB5ID0gdG9wTGVmdFk7XG4gICAgICB3aGlsZSAoeSA8IHRvcExlZnRZICsgc2NyZWVuSGVpZ2h0KSB7XG4gICAgICAgIGlmIChtYXAuaXNFeHBsb3JlZCh4LCB5LCBjdXJyZW50RGVwdGgpKSB7XG4gICAgICAgICAgZ2x5cGggPSBtYXAuZ2V0VGlsZSh4LCB5LCBjdXJyZW50RGVwdGgpO1xuICAgICAgICAgIGZvcmVncm91bmQgPSBnbHlwaC5nZXRGb3JlZ3JvdW5kKCk7XG4gICAgICAgICAgaWYgKHZpc2libGVDZWxsc1t4ICsgXCIsXCIgKyB5XSkge1xuICAgICAgICAgICAgaXRlbXMgPSBtYXAuZ2V0SXRlbXNBdCh4LCB5LCBjdXJyZW50RGVwdGgpO1xuICAgICAgICAgICAgaWYgKGl0ZW1zKSB7XG4gICAgICAgICAgICAgIGdseXBoID0gaXRlbXNbaXRlbXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWFwLmdldEVudGl0eUF0KHgsIHksIGN1cnJlbnREZXB0aCkpIHtcbiAgICAgICAgICAgICAgZ2x5cGggPSBtYXAuZ2V0RW50aXR5QXQoeCwgeSwgY3VycmVudERlcHRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvcmVncm91bmQgPSBnbHlwaC5nZXRGb3JlZ3JvdW5kKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvcmVncm91bmQgPSBcImRhcmtHcmF5XCI7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRpc3BsYXkuZHJhdyh4IC0gdG9wTGVmdFgsIHkgLSB0b3BMZWZ0WSwgZ2x5cGguZ2V0Q2hhcigpLCBmb3JlZ3JvdW5kLCBnbHlwaC5nZXRCYWNrZ3JvdW5kKCkpO1xuICAgICAgICB9XG4gICAgICAgIHkrKztcbiAgICAgIH1cbiAgICAgIF9yZXN1bHRzLnB1c2goeCsrKTtcbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9LFxuICBoYW5kbGVJbnB1dDogZnVuY3Rpb24oaW5wdXRUeXBlLCBpbnB1dERhdGEpIHtcbiAgICB2YXIgaXRlbSwgaXRlbXMsIGtleUNoYXIsIG9mZnNldHM7XG4gICAgaWYgKHRoaXMuX2dhbWVFbmRlZCkge1xuICAgICAgaWYgKGlucHV0VHlwZSA9PT0gXCJrZXlkb3duXCIgJiYgaW5wdXREYXRhLmtleUNvZGUgPT09IFJPVC5WS19SRVRVUk4pIHtcbiAgICAgICAgR2FtZS5zd2l0Y2hTY3JlZW4oR2FtZS5TY3JlZW4ubG9zZVNjcmVlbik7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLl9zdWJTY3JlZW4pIHtcbiAgICAgIHRoaXMuX3N1YlNjcmVlbi5oYW5kbGVJbnB1dChpbnB1dFR5cGUsIGlucHV0RGF0YSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChpbnB1dFR5cGUgPT09IFwia2V5ZG93blwiKSB7XG4gICAgICBpZiAoaW5wdXREYXRhLmtleUNvZGUgPT09IFJPVC5WS19MRUZUKSB7XG4gICAgICAgIHRoaXMubW92ZSgtMSwgMCwgMCk7XG4gICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5rZXlDb2RlID09PSBST1QuVktfUklHSFQpIHtcbiAgICAgICAgdGhpcy5tb3ZlKDEsIDAsIDApO1xuICAgICAgfSBlbHNlIGlmIChpbnB1dERhdGEua2V5Q29kZSA9PT0gUk9ULlZLX1VQKSB7XG4gICAgICAgIHRoaXMubW92ZSgwLCAtMSwgMCk7XG4gICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5rZXlDb2RlID09PSBST1QuVktfRE9XTikge1xuICAgICAgICB0aGlzLm1vdmUoMCwgMSwgMCk7XG4gICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5rZXlDb2RlID09PSBST1QuVktfSSkge1xuICAgICAgICB0aGlzLnNob3dJdGVtc1N1YlNjcmVlbihHYW1lLlNjcmVlbi5pbnZlbnRvcnlTY3JlZW4sIHRoaXMuX3BsYXllci5nZXRJdGVtcygpLCBcIllvdSBhcmUgbm90IGNhcnJ5aW5nIGFueXRoaW5nLlwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIGlmIChpbnB1dERhdGEua2V5Q29kZSA9PT0gUk9ULlZLX0QpIHtcbiAgICAgICAgdGhpcy5zaG93SXRlbXNTdWJTY3JlZW4oR2FtZS5TY3JlZW4uZHJvcFNjcmVlbiwgdGhpcy5fcGxheWVyLmdldEl0ZW1zKCksIFwiWW91IGhhdmUgbm90aGluZyB0byBkcm9wLlwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIGlmIChpbnB1dERhdGEua2V5Q29kZSA9PT0gUk9ULlZLX0UpIHtcbiAgICAgICAgdGhpcy5zaG93SXRlbXNTdWJTY3JlZW4oR2FtZS5TY3JlZW4uZWF0U2NyZWVuLCB0aGlzLl9wbGF5ZXIuZ2V0SXRlbXMoKSwgXCJZb3UgaGF2ZSBub3RoaW5nIHRvIGVhdC5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLmtleUNvZGUgPT09IFJPVC5WS19XKSB7XG4gICAgICAgIGlmIChpbnB1dERhdGEuc2hpZnRLZXkpIHtcbiAgICAgICAgICB0aGlzLnNob3dJdGVtc1N1YlNjcmVlbihHYW1lLlNjcmVlbi53ZWFyU2NyZWVuLCB0aGlzLl9wbGF5ZXIuZ2V0SXRlbXMoKSwgXCJZb3UgaGF2ZSBub3RoaW5nIHRvIHdlYXIuXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuc2hvd0l0ZW1zU3ViU2NyZWVuKEdhbWUuU2NyZWVuLndpZWxkU2NyZWVuLCB0aGlzLl9wbGF5ZXIuZ2V0SXRlbXMoKSwgXCJZb3UgaGF2ZSBub3RoaW5nIHRvIHdpZWxkLlwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5rZXlDb2RlID09PSBST1QuVktfWCkge1xuICAgICAgICB0aGlzLnNob3dJdGVtc1N1YlNjcmVlbihHYW1lLlNjcmVlbi5leGFtaW5lU2NyZWVuLCB0aGlzLl9wbGF5ZXIuZ2V0SXRlbXMoKSwgXCJZb3UgaGF2ZSBub3RoaW5nIHRvIGV4YW1pbmUuXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5rZXlDb2RlID09PSBST1QuVktfQ09NTUEpIHtcbiAgICAgICAgaXRlbXMgPSB0aGlzLl9wbGF5ZXIuZ2V0TWFwKCkuZ2V0SXRlbXNBdCh0aGlzLl9wbGF5ZXIuZ2V0WCgpLCB0aGlzLl9wbGF5ZXIuZ2V0WSgpLCB0aGlzLl9wbGF5ZXIuZ2V0WigpKTtcbiAgICAgICAgaWYgKGl0ZW1zICYmIGl0ZW1zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIGl0ZW0gPSBpdGVtc1swXTtcbiAgICAgICAgICBpZiAodGhpcy5fcGxheWVyLnBpY2t1cEl0ZW1zKFswXSkpIHtcbiAgICAgICAgICAgIEdhbWUuc2VuZE1lc3NhZ2UodGhpcy5fcGxheWVyLCBcIllvdSBwaWNrIHVwICVzLlwiLCBbaXRlbS5kZXNjcmliZUEoKV0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBHYW1lLnNlbmRNZXNzYWdlKHRoaXMuX3BsYXllciwgXCJZb3VyIGludmVudG9yeSBpcyBmdWxsISBOb3RoaW5nIHdhcyBwaWNrZWQgdXAuXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNob3dJdGVtc1N1YlNjcmVlbihHYW1lLlNjcmVlbi5waWNrdXBTY3JlZW4sIGl0ZW1zLCBcIlRoZXJlIGlzIG5vdGhpbmcgaGVyZSB0byBwaWNrIHVwLlwiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuX3BsYXllci5nZXRNYXAoKS5nZXRFbmdpbmUoKS51bmxvY2soKTtcbiAgICB9IGVsc2UgaWYgKGlucHV0VHlwZSA9PT0gXCJrZXlwcmVzc1wiKSB7XG4gICAgICBrZXlDaGFyID0gU3RyaW5nLmZyb21DaGFyQ29kZShpbnB1dERhdGEuY2hhckNvZGUpO1xuICAgICAgaWYgKGtleUNoYXIgPT09IFwiPlwiKSB7XG4gICAgICAgIHRoaXMubW92ZSgwLCAwLCAxKTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5Q2hhciA9PT0gXCI8XCIpIHtcbiAgICAgICAgdGhpcy5tb3ZlKDAsIDAsIC0xKTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5Q2hhciA9PT0gXCI7XCIpIHtcbiAgICAgICAgb2Zmc2V0cyA9IHRoaXMuZ2V0U2NyZWVuT2Zmc2V0cygpO1xuICAgICAgICBHYW1lLlNjcmVlbi5sb29rU2NyZWVuLnNldHVwKHRoaXMuX3BsYXllciwgdGhpcy5fcGxheWVyLmdldFgoKSwgdGhpcy5fcGxheWVyLmdldFkoKSwgb2Zmc2V0cy54LCBvZmZzZXRzLnkpO1xuICAgICAgICB0aGlzLnNldFN1YlNjcmVlbihHYW1lLlNjcmVlbi5sb29rU2NyZWVuKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIGlmIChrZXlDaGFyID09PSBcIj9cIikge1xuICAgICAgICB0aGlzLnNldFN1YlNjcmVlbihHYW1lLlNjcmVlbi5oZWxwU2NyZWVuKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuX3BsYXllci5nZXRNYXAoKS5nZXRFbmdpbmUoKS51bmxvY2soKTtcbiAgICB9XG4gIH0sXG4gIG1vdmU6IGZ1bmN0aW9uKGRYLCBkWSwgZFopIHtcbiAgICB2YXIgbmV3WCwgbmV3WSwgbmV3WjtcbiAgICBuZXdYID0gdGhpcy5fcGxheWVyLmdldFgoKSArIGRYO1xuICAgIG5ld1kgPSB0aGlzLl9wbGF5ZXIuZ2V0WSgpICsgZFk7XG4gICAgbmV3WiA9IHRoaXMuX3BsYXllci5nZXRaKCkgKyBkWjtcbiAgICByZXR1cm4gdGhpcy5fcGxheWVyLnRyeU1vdmUobmV3WCwgbmV3WSwgbmV3WiwgdGhpcy5fcGxheWVyLmdldE1hcCgpKTtcbiAgfSxcbiAgc2V0R2FtZUVuZGVkOiBmdW5jdGlvbihnYW1lRW5kZWQpIHtcbiAgICByZXR1cm4gdGhpcy5fZ2FtZUVuZGVkID0gZ2FtZUVuZGVkO1xuICB9LFxuICBzZXRTdWJTY3JlZW46IGZ1bmN0aW9uKHN1YlNjcmVlbikge1xuICAgIHRoaXMuX3N1YlNjcmVlbiA9IHN1YlNjcmVlbjtcbiAgICByZXR1cm4gR2FtZS5yZWZyZXNoKCk7XG4gIH0sXG4gIHNob3dJdGVtc1N1YlNjcmVlbjogZnVuY3Rpb24oc3ViU2NyZWVuLCBpdGVtcywgZW1wdHlNZXNzYWdlKSB7XG4gICAgaWYgKGl0ZW1zICYmIHN1YlNjcmVlbi5zZXR1cCh0aGlzLl9wbGF5ZXIsIGl0ZW1zKSA+IDApIHtcbiAgICAgIHJldHVybiB0aGlzLnNldFN1YlNjcmVlbihzdWJTY3JlZW4pO1xuICAgIH0gZWxzZSB7XG4gICAgICBHYW1lLnNlbmRNZXNzYWdlKHRoaXMuX3BsYXllciwgZW1wdHlNZXNzYWdlKTtcbiAgICAgIHJldHVybiBHYW1lLnJlZnJlc2goKTtcbiAgICB9XG4gIH1cbn07XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5TY3JlZW4gPT0gbnVsbCkge1xuICBHYW1lLlNjcmVlbiA9IHt9O1xufVxuXG5HYW1lLlNjcmVlbi5zdGFydFNjcmVlbiA9IHtcbiAgZW50ZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBjb25zb2xlLmxvZyhcIkVudGVyZWQgc3RhcnQgc2NyZWVuLlwiKTtcbiAgfSxcbiAgZXhpdDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGNvbnNvbGUubG9nKFwiRXhpdGVkIHN0YXJ0IHNjcmVlbi5cIik7XG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24oZGlzcGxheSkge1xuICAgIGRpc3BsYXkuZHJhd1RleHQoMSwgMSwgXCIlY3t5ZWxsb3d9SmF2YXNjcmlwdCBSb2d1ZWxpa2VcIik7XG4gICAgcmV0dXJuIGRpc3BsYXkuZHJhd1RleHQoMSwgMiwgXCJQcmVzcyBbRW50ZXJdIHRvIHN0YXJ0IVwiKTtcbiAgfSxcbiAgaGFuZGxlSW5wdXQ6IGZ1bmN0aW9uKGlucHV0VHlwZSwgaW5wdXREYXRhKSB7XG4gICAgaWYgKGlucHV0VHlwZSA9PT0gXCJrZXlkb3duXCIpIHtcbiAgICAgIGlmIChpbnB1dERhdGEua2V5Q29kZSA9PT0gUk9ULlZLX1JFVFVSTikge1xuICAgICAgICByZXR1cm4gR2FtZS5zd2l0Y2hTY3JlZW4oR2FtZS5TY3JlZW4ucGxheVNjcmVlbik7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuaWYgKEdhbWUuU2NyZWVuID09IG51bGwpIHtcbiAgR2FtZS5TY3JlZW4gPSB7fTtcbn1cblxuR2FtZS5TY3JlZW4ud2VhclNjcmVlbiA9IG5ldyBHYW1lLlNjcmVlbi5JdGVtTGlzdFNjcmVlbih7XG4gIGNhcHRpb246IFwiQ2hvb3NlIHRoZSBpdGVtIHlvdSB3aXNoIHRvIHdlYXJcIixcbiAgY2FuU2VsZWN0OiB0cnVlLFxuICBjYW5TZWxlY3RNdWx0aXBsZUl0ZW1zOiBmYWxzZSxcbiAgaGFzTm9JdGVtT3B0aW9uOiB0cnVlLFxuICBpc0FjY2VwdGFibGU6IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICByZXR1cm4gaXRlbSAmJiBpdGVtLmhhc01peGluKFwiRXF1aXBwYWJsZVwiKSAmJiBpdGVtLmlzV2VhcmFibGUoKTtcbiAgfSxcbiAgb2s6IGZ1bmN0aW9uKHNlbGVjdGVkSXRlbXMpIHtcbiAgICB2YXIgaXRlbSwga2V5cztcbiAgICBrZXlzID0gT2JqZWN0LmtleXMoc2VsZWN0ZWRJdGVtcyk7XG4gICAgaWYgKGtleXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLl9wbGF5ZXIudW53aWVsZCgpO1xuICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLl9wbGF5ZXIsIFwiWW91IGFyZSBub3Qgd2VhcmluZyBhbnRoaW5nLlwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaXRlbSA9IHNlbGVjdGVkSXRlbXNba2V5c1swXV07XG4gICAgICB0aGlzLl9wbGF5ZXIudW5lcXVpcChpdGVtKTtcbiAgICAgIHRoaXMuX3BsYXllci53ZWFyKGl0ZW0pO1xuICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLl9wbGF5ZXIsIFwiWW91IGFyZSB3ZWFyaW5nICVzLlwiLCBbaXRlbS5kZXNjcmliZUEoKV0pO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5TY3JlZW4gPT0gbnVsbCkge1xuICBHYW1lLlNjcmVlbiA9IHt9O1xufVxuXG5HYW1lLlNjcmVlbi53aWVsZFNjcmVlbiA9IG5ldyBHYW1lLlNjcmVlbi5JdGVtTGlzdFNjcmVlbih7XG4gIGNhcHRpb246IFwiQ2hvb3NlIHRoZSBpdGVtIHlvdSB3aXNoIHRvIHdpZWxkXCIsXG4gIGNhblNlbGVjdDogdHJ1ZSxcbiAgY2FuU2VsZWN0TXVsdGlwbGVJdGVtczogZmFsc2UsXG4gIGhhc05vSXRlbU9wdGlvbjogdHJ1ZSxcbiAgaXNBY2NlcHRhYmxlOiBmdW5jdGlvbihpdGVtKSB7XG4gICAgcmV0dXJuIGl0ZW0gJiYgaXRlbS5oYXNNaXhpbihcIkVxdWlwcGFibGVcIikgJiYgaXRlbS5pc1dpZWxkYWJsZSgpO1xuICB9LFxuICBvazogZnVuY3Rpb24oc2VsZWN0ZWRJdGVtcykge1xuICAgIHZhciBpdGVtLCBrZXlzO1xuICAgIGtleXMgPSBPYmplY3Qua2V5cyhzZWxlY3RlZEl0ZW1zKTtcbiAgICBpZiAoa2V5cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuX3BsYXllci51bndpZWxkKCk7XG4gICAgICBHYW1lLnNlbmRNZXNzYWdlKHRoaXMuX3BsYXllciwgXCJZb3UgYXJlIGVtcHR5IGhhbmRlZC5cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGl0ZW0gPSBzZWxlY3RlZEl0ZW1zW2tleXNbMF1dO1xuICAgICAgdGhpcy5fcGxheWVyLnVuZXF1aXAoaXRlbSk7XG4gICAgICB0aGlzLl9wbGF5ZXIud2llbGQoaXRlbSk7XG4gICAgICBHYW1lLnNlbmRNZXNzYWdlKHRoaXMuX3BsYXllciwgXCJZb3UgYXJlIHdpZWxkaW5nICVzLlwiLCBbaXRlbS5kZXNjcmliZUEoKV0pO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5TY3JlZW4gPT0gbnVsbCkge1xuICBHYW1lLlNjcmVlbiA9IHt9O1xufVxuXG5HYW1lLlNjcmVlbi53aW5TY3JlZW4gPSB7XG4gIGVudGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gY29uc29sZS5sb2coXCJFbnRlcmVkIHdpbiBzY3JlZW4uXCIpO1xuICB9LFxuICBleGl0OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gY29uc29sZS5sb2coXCJFeGl0ZWQgd2luIHNjcmVlbi5cIik7XG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24oZGlzcGxheSkge1xuICAgIHZhciBiLCBiYWNrZ3JvdW5kLCBnLCBpLCByLCBfcmVzdWx0cztcbiAgICBpID0gMDtcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIHdoaWxlIChpIDwgMjIpIHtcbiAgICAgIHIgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAyNTUpO1xuICAgICAgZyA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDI1NSk7XG4gICAgICBiID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMjU1KTtcbiAgICAgIGJhY2tncm91bmQgPSBST1QuQ29sb3IudG9SR0IoW3IsIGcsIGJdKTtcbiAgICAgIGRpc3BsYXkuZHJhd1RleHQoMiwgaSArIDEsIFwiJWJ7XCIgKyBiYWNrZ3JvdW5kICsgXCJ9WW91IHdpbiFcIik7XG4gICAgICBfcmVzdWx0cy5wdXNoKGkrKyk7XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfSxcbiAgaGFuZGxlSW5wdXQ6IGZ1bmN0aW9uKGlucHV0VHlwZSwgaW5wdXREYXRhKSB7fVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWUgPSB7XG4gIF9kaXNwbGF5OiBudWxsLFxuICBfY3VycmVudFNjcmVlbjogbnVsbCxcbiAgX3NjcmVlbldpZHRoOiA4MCxcbiAgX3NjcmVlbkhlaWdodDogMjQsXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBiaW5kRXZlbnRUb1NjcmVlbjtcbiAgICByZXF1aXJlKCcuL2dhbWUvR2x5cGgnKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvRHluYW1pY0dseXBoJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL1RpbGUnKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvQnVpbGRlcicpO1xuICAgIHJlcXVpcmUoJy4vZ2FtZS9NYXAnKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvbWFwL0NhdmUnKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvbWFwL0Jvc3NDYXZlcm4nKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvc2NyZWVuL0l0ZW1MaXN0U2NyZWVuJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL3NjcmVlbi9UYXJnZXRCYXNlZFNjcmVlbicpO1xuICAgIHJlcXVpcmUoJy4vZ2FtZS9FbnRpdHknKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvZW50aXR5L1BsYXllckFjdG9yJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL2VudGl0eS9GdW5ndXNBY3RvcicpO1xuICAgIHJlcXVpcmUoJy4vZ2FtZS9lbnRpdHkvVGFza0FjdG9yJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL2VudGl0eS9HaWFudFpvbWJpZUFjdG9yJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL2VudGl0eS9BdHRhY2tlcicpO1xuICAgIHJlcXVpcmUoJy4vZ2FtZS9lbnRpdHkvRGVzdHJ1Y3RpYmxlJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL2VudGl0eS9NZXNzYWdlUmVjaXBpZW50Jyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL2VudGl0eS9TaWdodCcpO1xuICAgIHJlcXVpcmUoJy4vZ2FtZS9lbnRpdHkvSW52ZW50b3J5SG9sZGVyJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL2VudGl0eS9Gb29kQ29uc3VtZXInKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvZW50aXR5L0NvcnBzZURyb3BwZXInKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvZW50aXR5L0VxdWlwcGVyJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL2VudGl0eS9FeHBlcmllbmNlR2FpbmVyJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL2VudGl0eS9SYW5kb21TdGF0R2FpbmVyJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL2VudGl0eS9QbGF5ZXJTdGF0R2FpbmVyJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL0l0ZW0nKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvaXRlbS9FZGlibGUnKTtcbiAgICByZXF1aXJlKCcuL2dhbWUvaXRlbS9FcXVpcHBhYmxlJyk7XG4gICAgcmVxdWlyZSgnLi9nYW1lL1JlcG9zaXRvcnknKTtcbiAgICByZXF1aXJlKCcuL2RhdGEvc2NyZWVucy9kcm9wU2NyZWVuJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL3NjcmVlbnMvZWF0U2NyZWVuJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL3NjcmVlbnMvZXhhbWluZVNjcmVlbicpO1xuICAgIHJlcXVpcmUoJy4vZGF0YS9zY3JlZW5zL2dhaW5TdGF0U2NyZWVuJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL3NjcmVlbnMvaGVscFNjcmVlbicpO1xuICAgIHJlcXVpcmUoJy4vZGF0YS9zY3JlZW5zL2ludmVudG9yeVNjcmVlbicpO1xuICAgIHJlcXVpcmUoJy4vZGF0YS9zY3JlZW5zL2xvb2tTY3JlZW4nKTtcbiAgICByZXF1aXJlKCcuL2RhdGEvc2NyZWVucy9sb3NlU2NyZWVuJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL3NjcmVlbnMvcGlja3VwU2NyZWVuJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL3NjcmVlbnMvcGxheVNjcmVlbicpO1xuICAgIHJlcXVpcmUoJy4vZGF0YS9zY3JlZW5zL3N0YXJ0U2NyZWVuJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL3NjcmVlbnMvd2VhclNjcmVlbicpO1xuICAgIHJlcXVpcmUoJy4vZGF0YS9zY3JlZW5zL3dpZWxkU2NyZWVuJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL3NjcmVlbnMvd2luU2NyZWVuJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2VudGl0aWVzL1BsYXllclRlbXBsYXRlJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2VudGl0aWVzL2JhdCcpO1xuICAgIHJlcXVpcmUoJy4vZGF0YS9lbnRpdGllcy9mdW5ndXMnKTtcbiAgICByZXF1aXJlKCcuL2RhdGEvZW50aXRpZXMvZ2lhbnRfem9tYmllJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2VudGl0aWVzL2tvYm9sZCcpO1xuICAgIHJlcXVpcmUoJy4vZGF0YS9lbnRpdGllcy9uZXd0Jyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2VudGl0aWVzL3NsaW1lJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2l0ZW1zL2FwcGxlJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2l0ZW1zL21lbG9uJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2l0ZW1zL3B1bXBraW4nKTtcbiAgICByZXF1aXJlKCcuL2RhdGEvaXRlbXMvY29ycHNlJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2l0ZW1zL3JvY2snKTtcbiAgICByZXF1aXJlKCcuL2RhdGEvaXRlbXMvZGFnZ2VyJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2l0ZW1zL3N3b3JkJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2l0ZW1zL3N0YWZmJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2l0ZW1zL3R1bmljJyk7XG4gICAgcmVxdWlyZSgnLi9kYXRhL2l0ZW1zL2NoYWlubWFpbCcpO1xuICAgIHJlcXVpcmUoJy4vZGF0YS9pdGVtcy9wbGF0ZW1haWwnKTtcbiAgICB0aGlzLl9kaXNwbGF5ID0gbmV3IFJPVC5EaXNwbGF5KHtcbiAgICAgIHdpZHRoOiB0aGlzLl9zY3JlZW5XaWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5fc2NyZWVuSGVpZ2h0ICsgMVxuICAgIH0pO1xuICAgIGJpbmRFdmVudFRvU2NyZWVuID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBpZiAoX3RoaXMuX2N1cnJlbnRTY3JlZW4gIT0gbnVsbCkge1xuICAgICAgICAgICAgX3RoaXMuX2N1cnJlbnRTY3JlZW4uaGFuZGxlSW5wdXQoZXZlbnQsIGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH0pKHRoaXMpO1xuICAgIGJpbmRFdmVudFRvU2NyZWVuKFwia2V5ZG93blwiKTtcbiAgICBiaW5kRXZlbnRUb1NjcmVlbihcImtleXByZXNzXCIpO1xuICB9LFxuICBnZXREaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fZGlzcGxheTtcbiAgfSxcbiAgZ2V0U2NyZWVuV2lkdGg6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9zY3JlZW5XaWR0aDtcbiAgfSxcbiAgZ2V0U2NyZWVuSGVpZ2h0OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fc2NyZWVuSGVpZ2h0O1xuICB9LFxuICByZWZyZXNoOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9kaXNwbGF5LmNsZWFyKCk7XG4gICAgdGhpcy5fY3VycmVudFNjcmVlbi5yZW5kZXIodGhpcy5fZGlzcGxheSk7XG4gIH0sXG4gIHN3aXRjaFNjcmVlbjogZnVuY3Rpb24oc2NyZWVuKSB7XG4gICAgaWYgKHRoaXMuX2N1cnJlbnRTY3JlZW4gIT09IG51bGwpIHtcbiAgICAgIHRoaXMuX2N1cnJlbnRTY3JlZW4uZXhpdCgpO1xuICAgIH1cbiAgICB0aGlzLmdldERpc3BsYXkoKS5jbGVhcigpO1xuICAgIHRoaXMuX2N1cnJlbnRTY3JlZW4gPSBzY3JlZW47XG4gICAgaWYgKCF0aGlzLl9jdXJyZW50U2NyZWVuICE9PSBudWxsKSB7XG4gICAgICB0aGlzLl9jdXJyZW50U2NyZWVuLmVudGVyKCk7XG4gICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICB9XG4gIH0sXG4gIG1lcmdlOiBmdW5jdGlvbihzcmMsIGRlc3QpIHtcbiAgICB2YXIga2V5LCByZXN1bHQ7XG4gICAgcmVzdWx0ID0ge307XG4gICAgZm9yIChrZXkgaW4gc3JjKSB7XG4gICAgICByZXN1bHRba2V5XSA9IHNyY1trZXldO1xuICAgIH1cbiAgICBmb3IgKGtleSBpbiBkZXN0KSB7XG4gICAgICByZXN1bHRba2V5XSA9IGRlc3Rba2V5XTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSxcbiAgZ2V0TmVpZ2hib3JQb3NpdGlvbnM6IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICB2YXIgZFgsIGRZLCB0aWxlcywgX2ksIF9qO1xuICAgIHRpbGVzID0gW107XG4gICAgZm9yIChkWCA9IF9pID0gLTE7IF9pIDwgMjsgZFggPSArK19pKSB7XG4gICAgICBmb3IgKGRZID0gX2ogPSAtMTsgX2ogPCAyOyBkWSA9ICsrX2opIHtcbiAgICAgICAgaWYgKGRYID09PSAwICYmIGRZID09PSAwKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgdGlsZXMucHVzaCh7XG4gICAgICAgICAgeDogeCArIGRYLFxuICAgICAgICAgIHk6IHkgKyBkWVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRpbGVzLnJhbmRvbWl6ZSgpO1xuICB9LFxuICBzZW5kTWVzc2FnZTogZnVuY3Rpb24ocmVjaXBpZW50LCBtZXNzYWdlLCBhcmdzKSB7XG4gICAgaWYgKHJlY2lwaWVudC5oYXNNaXhpbihHYW1lLkVudGl0eU1peGlucy5NZXNzYWdlUmVjaXBpZW50KSkge1xuICAgICAgaWYgKGFyZ3MpIHtcbiAgICAgICAgbWVzc2FnZSA9IHZzcHJpbnRmKG1lc3NhZ2UsIGFyZ3MpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlY2lwaWVudC5yZWNlaXZlTWVzc2FnZShtZXNzYWdlKTtcbiAgICB9XG4gIH0sXG4gIHNlbmRNZXNzYWdlTmVhcmJ5OiBmdW5jdGlvbihtYXAsIGNlbnRlclgsIGNlbnRlclksIGNlbnRlclosIG1lc3NhZ2UsIGFyZ3MpIHtcbiAgICB2YXIgZW50aXRpZXMsIGksIF9yZXN1bHRzO1xuICAgIGlmIChhcmdzKSB7XG4gICAgICBtZXNzYWdlID0gdnNwcmludGYobWVzc2FnZSwgYXJncyk7XG4gICAgfVxuICAgIGVudGl0aWVzID0gbWFwLmdldEVudGl0aWVzV2l0aGluUmFkaXVzKGNlbnRlclgsIGNlbnRlclksIGNlbnRlclosIDUpO1xuICAgIGkgPSAwO1xuICAgIF9yZXN1bHRzID0gW107XG4gICAgd2hpbGUgKGkgPCBlbnRpdGllcy5sZW5ndGgpIHtcbiAgICAgIGlmIChlbnRpdGllc1tpXS5oYXNNaXhpbihHYW1lLkVudGl0eU1peGlucy5NZXNzYWdlUmVjaXBpZW50KSkge1xuICAgICAgICBlbnRpdGllc1tpXS5yZWNlaXZlTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIF9yZXN1bHRzLnB1c2goaSsrKTtcbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9LFxuICBnZXRMaW5lOiBmdW5jdGlvbihzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSkge1xuICAgIHZhciBkeCwgZHksIGUyLCBlcnIsIHBvaW50cywgc3gsIHN5O1xuICAgIHBvaW50cyA9IFtdO1xuICAgIGR4ID0gTWF0aC5hYnMoZW5kWCAtIHN0YXJ0WCk7XG4gICAgZHkgPSBNYXRoLmFicyhlbmRZIC0gc3RhcnRZKTtcbiAgICBzeCA9IChzdGFydFggPCBlbmRYID8gMSA6IC0xKTtcbiAgICBzeSA9IChzdGFydFkgPCBlbmRZID8gMSA6IC0xKTtcbiAgICBlcnIgPSBkeCAtIGR5O1xuICAgIGUyID0gdm9pZCAwO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBwb2ludHMucHVzaCh7XG4gICAgICAgIHg6IHN0YXJ0WCxcbiAgICAgICAgeTogc3RhcnRZXG4gICAgICB9KTtcbiAgICAgIGlmIChzdGFydFggPT09IGVuZFggJiYgc3RhcnRZID09PSBlbmRZKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZTIgPSBlcnIgKiAyO1xuICAgICAgaWYgKGUyID4gLWR4KSB7XG4gICAgICAgIGVyciAtPSBkeTtcbiAgICAgICAgc3RhcnRYICs9IHN4O1xuICAgICAgfVxuICAgICAgaWYgKGUyIDwgZHgpIHtcbiAgICAgICAgZXJyICs9IGR4O1xuICAgICAgICBzdGFydFkgKz0gc3k7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwb2ludHM7XG4gIH1cbn07XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vZ2FtZScpO1xuXG5HYW1lLkJ1aWxkZXIgPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIEJ1aWxkZXIod2lkdGgsIGhlaWdodCwgZGVwdGgpIHtcbiAgICB2YXIgeCwgeSwgejtcbiAgICB0aGlzLl93aWR0aCA9IHdpZHRoO1xuICAgIHRoaXMuX2hlaWdodCA9IGhlaWdodDtcbiAgICB0aGlzLl9kZXB0aCA9IGRlcHRoO1xuICAgIHRoaXMuX3RpbGVzID0gbmV3IEFycmF5KGRlcHRoKTtcbiAgICB0aGlzLl9yZWdpb25zID0gbmV3IEFycmF5KGRlcHRoKTtcbiAgICB6ID0gMDtcbiAgICB3aGlsZSAoeiA8IGRlcHRoKSB7XG4gICAgICB0aGlzLl90aWxlc1t6XSA9IHRoaXMuX2dlbmVyYXRlTGV2ZWwoKTtcbiAgICAgIHRoaXMuX3JlZ2lvbnNbel0gPSBuZXcgQXJyYXkod2lkdGgpO1xuICAgICAgeCA9IDA7XG4gICAgICB3aGlsZSAoeCA8IHdpZHRoKSB7XG4gICAgICAgIHRoaXMuX3JlZ2lvbnNbel1beF0gPSBuZXcgQXJyYXkoaGVpZ2h0KTtcbiAgICAgICAgeSA9IDA7XG4gICAgICAgIHdoaWxlICh5IDwgaGVpZ2h0KSB7XG4gICAgICAgICAgdGhpcy5fcmVnaW9uc1t6XVt4XVt5XSA9IDA7XG4gICAgICAgICAgeSsrO1xuICAgICAgICB9XG4gICAgICAgIHgrKztcbiAgICAgIH1cbiAgICAgIHorKztcbiAgICB9XG4gICAgeiA9IDA7XG4gICAgd2hpbGUgKHogPCB0aGlzLl9kZXB0aCkge1xuICAgICAgdGhpcy5fc2V0dXBSZWdpb25zKHopO1xuICAgICAgeisrO1xuICAgIH1cbiAgICB0aGlzLl9jb25uZWN0QWxsUmVnaW9ucygpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIEJ1aWxkZXIucHJvdG90eXBlLmdldFRpbGVzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RpbGVzO1xuICB9O1xuXG4gIEJ1aWxkZXIucHJvdG90eXBlLmdldERlcHRoID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RlcHRoO1xuICB9O1xuXG4gIEJ1aWxkZXIucHJvdG90eXBlLmdldFdpZHRoID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3dpZHRoO1xuICB9O1xuXG4gIEJ1aWxkZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9oZWlnaHQ7XG4gIH07XG5cbiAgQnVpbGRlci5wcm90b3R5cGUuX2dlbmVyYXRlTGV2ZWwgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZ2VuZXJhdG9yLCBpLCBtYXAsIHRvdGFsSXRlcmF0aW9ucywgdztcbiAgICBtYXAgPSBuZXcgQXJyYXkodGhpcy5fd2lkdGgpO1xuICAgIHcgPSAwO1xuICAgIHdoaWxlICh3IDwgdGhpcy5fd2lkdGgpIHtcbiAgICAgIG1hcFt3XSA9IG5ldyBBcnJheSh0aGlzLl9oZWlnaHQpO1xuICAgICAgdysrO1xuICAgIH1cbiAgICBnZW5lcmF0b3IgPSBuZXcgUk9ULk1hcC5DZWxsdWxhcih0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KTtcbiAgICBnZW5lcmF0b3IucmFuZG9taXplKDAuNSk7XG4gICAgdG90YWxJdGVyYXRpb25zID0gMztcbiAgICBpID0gMDtcbiAgICB3aGlsZSAoaSA8IHRvdGFsSXRlcmF0aW9ucyAtIDEpIHtcbiAgICAgIGdlbmVyYXRvci5jcmVhdGUoKTtcbiAgICAgIGkrKztcbiAgICB9XG4gICAgZ2VuZXJhdG9yLmNyZWF0ZShmdW5jdGlvbih4LCB5LCB2KSB7XG4gICAgICBpZiAodiA9PT0gMSkge1xuICAgICAgICByZXR1cm4gbWFwW3hdW3ldID0gR2FtZS5UaWxlLmZsb29yVGlsZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBtYXBbeF1beV0gPSBHYW1lLlRpbGUud2FsbFRpbGU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG1hcDtcbiAgfTtcblxuICBCdWlsZGVyLnByb3RvdHlwZS5fY2FuRmlsbFJlZ2lvbiA9IGZ1bmN0aW9uKHgsIHksIHopIHtcbiAgICBpZiAoeCA8IDAgfHwgeSA8IDAgfHwgeiA8IDAgfHwgeCA+PSB0aGlzLl93aWR0aCB8fCB5ID49IHRoaXMuX2hlaWdodCB8fCB6ID49IHRoaXMuX2RlcHRoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0aGlzLl9yZWdpb25zW3pdW3hdW3ldICE9PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl90aWxlc1t6XVt4XVt5XS5pc1dhbGthYmxlKCk7XG4gIH07XG5cbiAgQnVpbGRlci5wcm90b3R5cGUuX2ZpbGxSZWdpb24gPSBmdW5jdGlvbihyZWdpb24sIHgsIHksIHopIHtcbiAgICB2YXIgbmVpZ2hib3JzLCB0aWxlLCB0aWxlcywgdGlsZXNGaWxsZWQ7XG4gICAgdGlsZXNGaWxsZWQgPSAxO1xuICAgIHRpbGVzID0gW1xuICAgICAge1xuICAgICAgICB4OiB4LFxuICAgICAgICB5OiB5XG4gICAgICB9XG4gICAgXTtcbiAgICB0aWxlID0gdm9pZCAwO1xuICAgIG5laWdoYm9ycyA9IHZvaWQgMDtcbiAgICB0aGlzLl9yZWdpb25zW3pdW3hdW3ldID0gcmVnaW9uO1xuICAgIHdoaWxlICh0aWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICB0aWxlID0gdGlsZXMucG9wKCk7XG4gICAgICBuZWlnaGJvcnMgPSBHYW1lLmdldE5laWdoYm9yUG9zaXRpb25zKHRpbGUueCwgdGlsZS55KTtcbiAgICAgIHdoaWxlIChuZWlnaGJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aWxlID0gbmVpZ2hib3JzLnBvcCgpO1xuICAgICAgICBpZiAodGhpcy5fY2FuRmlsbFJlZ2lvbih0aWxlLngsIHRpbGUueSwgeikpIHtcbiAgICAgICAgICB0aGlzLl9yZWdpb25zW3pdW3RpbGUueF1bdGlsZS55XSA9IHJlZ2lvbjtcbiAgICAgICAgICB0aWxlcy5wdXNoKHRpbGUpO1xuICAgICAgICAgIHRpbGVzRmlsbGVkKys7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRpbGVzRmlsbGVkO1xuICB9O1xuXG4gIEJ1aWxkZXIucHJvdG90eXBlLl9yZW1vdmVSZWdpb24gPSBmdW5jdGlvbihyZWdpb24sIHopIHtcbiAgICB2YXIgeCwgeTtcbiAgICB4ID0gMDtcbiAgICB3aGlsZSAoeCA8IHRoaXMuX3dpZHRoKSB7XG4gICAgICB5ID0gMDtcbiAgICAgIHdoaWxlICh5IDwgdGhpcy5faGVpZ2h0KSB7XG4gICAgICAgIGlmICh0aGlzLl9yZWdpb25zW3pdW3hdW3ldID09PSByZWdpb24pIHtcbiAgICAgICAgICB0aGlzLl9yZWdpb25zW3pdW3hdW3ldID0gMDtcbiAgICAgICAgICB0aGlzLl90aWxlc1t6XVt4XVt5XSA9IEdhbWUuVGlsZS53YWxsVGlsZTtcbiAgICAgICAgfVxuICAgICAgICB5Kys7XG4gICAgICB9XG4gICAgICB4Kys7XG4gICAgfVxuICB9O1xuXG4gIEJ1aWxkZXIucHJvdG90eXBlLl9zZXR1cFJlZ2lvbnMgPSBmdW5jdGlvbih6KSB7XG4gICAgdmFyIHJlZ2lvbiwgdGlsZXNGaWxsZWQsIHgsIHk7XG4gICAgcmVnaW9uID0gMTtcbiAgICB0aWxlc0ZpbGxlZCA9IHZvaWQgMDtcbiAgICB4ID0gMDtcbiAgICB3aGlsZSAoeCA8IHRoaXMuX3dpZHRoKSB7XG4gICAgICB5ID0gMDtcbiAgICAgIHdoaWxlICh5IDwgdGhpcy5faGVpZ2h0KSB7XG4gICAgICAgIGlmICh0aGlzLl9jYW5GaWxsUmVnaW9uKHgsIHksIHopKSB7XG4gICAgICAgICAgdGlsZXNGaWxsZWQgPSB0aGlzLl9maWxsUmVnaW9uKHJlZ2lvbiwgeCwgeSwgeik7XG4gICAgICAgICAgaWYgKHRpbGVzRmlsbGVkIDw9IDIwKSB7XG4gICAgICAgICAgICB0aGlzLl9yZW1vdmVSZWdpb24ocmVnaW9uLCB6KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVnaW9uKys7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHkrKztcbiAgICAgIH1cbiAgICAgIHgrKztcbiAgICB9XG4gIH07XG5cbiAgQnVpbGRlci5wcm90b3R5cGUuX2ZpbmRSZWdpb25PdmVybGFwcyA9IGZ1bmN0aW9uKHosIHIxLCByMikge1xuICAgIHZhciBtYXRjaGVzLCB4LCB5O1xuICAgIG1hdGNoZXMgPSBbXTtcbiAgICB4ID0gMDtcbiAgICB3aGlsZSAoeCA8IHRoaXMuX3dpZHRoKSB7XG4gICAgICB5ID0gMDtcbiAgICAgIHdoaWxlICh5IDwgdGhpcy5faGVpZ2h0KSB7XG4gICAgICAgIGlmICh0aGlzLl90aWxlc1t6XVt4XVt5XSA9PT0gR2FtZS5UaWxlLmZsb29yVGlsZSAmJiB0aGlzLl90aWxlc1t6ICsgMV1beF1beV0gPT09IEdhbWUuVGlsZS5mbG9vclRpbGUgJiYgdGhpcy5fcmVnaW9uc1t6XVt4XVt5XSA9PT0gcjEgJiYgdGhpcy5fcmVnaW9uc1t6ICsgMV1beF1beV0gPT09IHIyKSB7XG4gICAgICAgICAgbWF0Y2hlcy5wdXNoKHtcbiAgICAgICAgICAgIHg6IHgsXG4gICAgICAgICAgICB5OiB5XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgeSsrO1xuICAgICAgfVxuICAgICAgeCsrO1xuICAgIH1cbiAgICByZXR1cm4gbWF0Y2hlcy5yYW5kb21pemUoKTtcbiAgfTtcblxuICBCdWlsZGVyLnByb3RvdHlwZS5fY29ubmVjdFJlZ2lvbnMgPSBmdW5jdGlvbih6LCByMSwgcjIpIHtcbiAgICB2YXIgb3ZlcmxhcCwgcG9pbnQ7XG4gICAgb3ZlcmxhcCA9IHRoaXMuX2ZpbmRSZWdpb25PdmVybGFwcyh6LCByMSwgcjIpO1xuICAgIGlmIChvdmVybGFwLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBwb2ludCA9IG92ZXJsYXBbMF07XG4gICAgdGhpcy5fdGlsZXNbel1bcG9pbnQueF1bcG9pbnQueV0gPSBHYW1lLlRpbGUuc3RhaXJzRG93blRpbGU7XG4gICAgdGhpcy5fdGlsZXNbeiArIDFdW3BvaW50LnhdW3BvaW50LnldID0gR2FtZS5UaWxlLnN0YWlyc1VwVGlsZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICBCdWlsZGVyLnByb3RvdHlwZS5fY29ubmVjdEFsbFJlZ2lvbnMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgY29ubmVjdGVkLCBrZXksIHgsIHksIHo7XG4gICAgeiA9IDA7XG4gICAgd2hpbGUgKHogPCB0aGlzLl9kZXB0aCAtIDEpIHtcbiAgICAgIGNvbm5lY3RlZCA9IHt9O1xuICAgICAga2V5ID0gdm9pZCAwO1xuICAgICAgeCA9IDA7XG4gICAgICB3aGlsZSAoeCA8IHRoaXMuX3dpZHRoKSB7XG4gICAgICAgIHkgPSAwO1xuICAgICAgICB3aGlsZSAoeSA8IHRoaXMuX2hlaWdodCkge1xuICAgICAgICAgIGtleSA9IHRoaXMuX3JlZ2lvbnNbel1beF1beV0gKyBcIixcIiArIHRoaXMuX3JlZ2lvbnNbeiArIDFdW3hdW3ldO1xuICAgICAgICAgIGlmICh0aGlzLl90aWxlc1t6XVt4XVt5XSA9PT0gR2FtZS5UaWxlLmZsb29yVGlsZSAmJiB0aGlzLl90aWxlc1t6ICsgMV1beF1beV0gPT09IEdhbWUuVGlsZS5mbG9vclRpbGUgJiYgIWNvbm5lY3RlZFtrZXldKSB7XG4gICAgICAgICAgICB0aGlzLl9jb25uZWN0UmVnaW9ucyh6LCB0aGlzLl9yZWdpb25zW3pdW3hdW3ldLCB0aGlzLl9yZWdpb25zW3ogKyAxXVt4XVt5XSk7XG4gICAgICAgICAgICBjb25uZWN0ZWRba2V5XSA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHkrKztcbiAgICAgICAgfVxuICAgICAgICB4Kys7XG4gICAgICB9XG4gICAgICB6Kys7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBCdWlsZGVyO1xuXG59KSgpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWUsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vZ2FtZScpO1xuXG5HYW1lLkR5bmFtaWNHbHlwaCA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKER5bmFtaWNHbHlwaCwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBEeW5hbWljR2x5cGgocHJvcGVydGllcykge1xuICAgIHZhciBpLCBrZXksIG1peGlucztcbiAgICBwcm9wZXJ0aWVzID0gcHJvcGVydGllcyB8fCB7fTtcbiAgICBEeW5hbWljR2x5cGguX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgcHJvcGVydGllcyk7XG4gICAgdGhpcy5fbmFtZSA9IHByb3BlcnRpZXNbXCJuYW1lXCJdIHx8IFwiXCI7XG4gICAgdGhpcy5fYXR0YWNoZWRNaXhpbnMgPSB7fTtcbiAgICB0aGlzLl9hdHRhY2hlZE1peGluR3JvdXBzID0ge307XG4gICAgdGhpcy5fbGlzdGVuZXJzID0ge307XG4gICAgbWl4aW5zID0gcHJvcGVydGllc1tcIm1peGluc1wiXSB8fCBbXTtcbiAgICBpID0gMDtcbiAgICB3aGlsZSAoaSA8IG1peGlucy5sZW5ndGgpIHtcbiAgICAgIGZvciAoa2V5IGluIG1peGluc1tpXSkge1xuICAgICAgICBpZiAoa2V5ICE9PSBcImluaXRcIiAmJiBrZXkgIT09IFwibmFtZVwiICYmIGtleSAhPT0gXCJsaXN0ZW5lcnNcIiAmJiAhdGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgdGhpc1trZXldID0gbWl4aW5zW2ldW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuX2F0dGFjaGVkTWl4aW5zW21peGluc1tpXS5uYW1lXSA9IHRydWU7XG4gICAgICBpZiAobWl4aW5zW2ldLmdyb3VwTmFtZSkge1xuICAgICAgICB0aGlzLl9hdHRhY2hlZE1peGluR3JvdXBzW21peGluc1tpXS5ncm91cE5hbWVdID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChtaXhpbnNbaV0ubGlzdGVuZXJzKSB7XG4gICAgICAgIGZvciAoa2V5IGluIG1peGluc1tpXS5saXN0ZW5lcnMpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuX2xpc3RlbmVyc1trZXldKSB7XG4gICAgICAgICAgICB0aGlzLl9saXN0ZW5lcnNba2V5XSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLl9saXN0ZW5lcnNba2V5XS5wdXNoKG1peGluc1tpXS5saXN0ZW5lcnNba2V5XSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChtaXhpbnNbaV0uaW5pdCkge1xuICAgICAgICBtaXhpbnNbaV0uaW5pdC5jYWxsKHRoaXMsIHByb3BlcnRpZXMpO1xuICAgICAgfVxuICAgICAgaSsrO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICBEeW5hbWljR2x5cGgucHJvdG90eXBlLmhhc01peGluID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKHR5cGVvZiBvYmogPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIHJldHVybiB0aGlzLl9hdHRhY2hlZE1peGluc1tvYmoubmFtZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLl9hdHRhY2hlZE1peGluc1tvYmpdIHx8IHRoaXMuX2F0dGFjaGVkTWl4aW5Hcm91cHNbb2JqXTtcbiAgICB9XG4gIH07XG5cbiAgRHluYW1pY0dseXBoLnByb3RvdHlwZS5zZXROYW1lID0gZnVuY3Rpb24obmFtZSkge1xuICAgIHJldHVybiB0aGlzLl9uYW1lID0gbmFtZTtcbiAgfTtcblxuICBEeW5hbWljR2x5cGgucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fbmFtZTtcbiAgfTtcblxuICBEeW5hbWljR2x5cGgucHJvdG90eXBlLmRlc2NyaWJlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX25hbWU7XG4gIH07XG5cbiAgRHluYW1pY0dseXBoLnByb3RvdHlwZS5kZXNjcmliZUEgPSBmdW5jdGlvbihjYXBpdGFsaXplKSB7XG4gICAgdmFyIGZpcnN0TGV0dGVyLCBwcmVmaXgsIHByZWZpeGVzLCBzdHJpbmc7XG4gICAgcHJlZml4ZXMgPSAoY2FwaXRhbGl6ZSA/IFtcIkFcIiwgXCJBblwiXSA6IFtcImFcIiwgXCJhblwiXSk7XG4gICAgc3RyaW5nID0gdGhpcy5kZXNjcmliZSgpO1xuICAgIGZpcnN0TGV0dGVyID0gc3RyaW5nLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpO1xuICAgIHByZWZpeCA9IChcImFlaW91XCIuaW5kZXhPZihmaXJzdExldHRlcikgPj0gMCA/IDEgOiAwKTtcbiAgICByZXR1cm4gcHJlZml4ZXNbcHJlZml4XSArIFwiIFwiICsgc3RyaW5nO1xuICB9O1xuXG4gIER5bmFtaWNHbHlwaC5wcm90b3R5cGUuZGVzY3JpYmVUaGUgPSBmdW5jdGlvbihjYXBpdGFsaXplKSB7XG4gICAgdmFyIHByZWZpeDtcbiAgICBwcmVmaXggPSAoY2FwaXRhbGl6ZSA/IFwiVGhlXCIgOiBcInRoZVwiKTtcbiAgICByZXR1cm4gcHJlZml4ICsgXCIgXCIgKyB0aGlzLmRlc2NyaWJlKCk7XG4gIH07XG5cbiAgRHluYW1pY0dseXBoLnByb3RvdHlwZS5yYWlzZUV2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgYXJncywgaSwgcmVzdWx0cztcbiAgICBpZiAoIXRoaXMuX2xpc3RlbmVyc1tldmVudF0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgcmVzdWx0cyA9IFtdO1xuICAgIGkgPSAwO1xuICAgIHdoaWxlIChpIDwgdGhpcy5fbGlzdGVuZXJzW2V2ZW50XS5sZW5ndGgpIHtcbiAgICAgIHJlc3VsdHMucHVzaCh0aGlzLl9saXN0ZW5lcnNbZXZlbnRdW2ldLmFwcGx5KHRoaXMsIGFyZ3MpKTtcbiAgICAgIGkrKztcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH07XG5cbiAgRHluYW1pY0dseXBoLnByb3RvdHlwZS5kZXRhaWxzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGRldGFpbEdyb3VwcywgZGV0YWlscywgaSwgaiwgbDtcbiAgICBkZXRhaWxzID0gW107XG4gICAgZGV0YWlsR3JvdXBzID0gdGhpcy5yYWlzZUV2ZW50KFwiZGV0YWlsc1wiKTtcbiAgICBpZiAoZGV0YWlsR3JvdXBzKSB7XG4gICAgICBpID0gMDtcbiAgICAgIGwgPSBkZXRhaWxHcm91cHMubGVuZ3RoO1xuICAgICAgd2hpbGUgKGkgPCBsKSB7XG4gICAgICAgIGlmIChkZXRhaWxHcm91cHNbaV0pIHtcbiAgICAgICAgICBqID0gMDtcbiAgICAgICAgICB3aGlsZSAoaiA8IGRldGFpbEdyb3Vwc1tpXS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRldGFpbHMucHVzaChkZXRhaWxHcm91cHNbaV1bal0ua2V5ICsgXCI6IFwiICsgZGV0YWlsR3JvdXBzW2ldW2pdLnZhbHVlKTtcbiAgICAgICAgICAgIGorKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaSsrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGV0YWlscy5qb2luKFwiLCBcIik7XG4gIH07XG5cbiAgcmV0dXJuIER5bmFtaWNHbHlwaDtcblxufSkoR2FtZS5HbHlwaCk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi9nYW1lJyk7XG5cbkdhbWUuRW50aXR5ID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoRW50aXR5LCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIEVudGl0eShwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcyA9IHByb3BlcnRpZXMgfHwge307XG4gICAgRW50aXR5Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHByb3BlcnRpZXMpO1xuICAgIHRoaXMuX3ggPSBwcm9wZXJ0aWVzW1wieFwiXSB8fCAwO1xuICAgIHRoaXMuX3kgPSBwcm9wZXJ0aWVzW1wieVwiXSB8fCAwO1xuICAgIHRoaXMuX3ogPSBwcm9wZXJ0aWVzW1wielwiXSB8fCAwO1xuICAgIHRoaXMuX21hcCA9IG51bGw7XG4gICAgdGhpcy5fYWxpdmUgPSB0cnVlO1xuICAgIHRoaXMuX3NwZWVkID0gcHJvcGVydGllc1tcInNwZWVkXCJdIHx8IDEwMDA7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgRW50aXR5LnByb3RvdHlwZS5zZXRYID0gZnVuY3Rpb24oeCkge1xuICAgIHRoaXMuX3ggPSB4O1xuICB9O1xuXG4gIEVudGl0eS5wcm90b3R5cGUuc2V0WSA9IGZ1bmN0aW9uKHkpIHtcbiAgICB0aGlzLl95ID0geTtcbiAgfTtcblxuICBFbnRpdHkucHJvdG90eXBlLnNldFogPSBmdW5jdGlvbih6KSB7XG4gICAgdGhpcy5feiA9IHo7XG4gIH07XG5cbiAgRW50aXR5LnByb3RvdHlwZS5zZXRNYXAgPSBmdW5jdGlvbihtYXApIHtcbiAgICB0aGlzLl9tYXAgPSBtYXA7XG4gIH07XG5cbiAgRW50aXR5LnByb3RvdHlwZS5zZXRTcGVlZCA9IGZ1bmN0aW9uKHNwZWVkKSB7XG4gICAgdGhpcy5fc3BlZWQgPSBzcGVlZDtcbiAgfTtcblxuICBFbnRpdHkucHJvdG90eXBlLnNldFBvc2l0aW9uID0gZnVuY3Rpb24oeCwgeSwgeikge1xuICAgIHZhciBvbGRYLCBvbGRZLCBvbGRaO1xuICAgIG9sZFggPSB0aGlzLl94O1xuICAgIG9sZFkgPSB0aGlzLl95O1xuICAgIG9sZFogPSB0aGlzLl96O1xuICAgIHRoaXMuX3ggPSB4O1xuICAgIHRoaXMuX3kgPSB5O1xuICAgIHRoaXMuX3ogPSB6O1xuICAgIGlmICh0aGlzLl9tYXApIHtcbiAgICAgIHRoaXMuX21hcC51cGRhdGVFbnRpdHlQb3NpdGlvbih0aGlzLCBvbGRYLCBvbGRZLCBvbGRaKTtcbiAgICB9XG4gIH07XG5cbiAgRW50aXR5LnByb3RvdHlwZS5nZXRYID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3g7XG4gIH07XG5cbiAgRW50aXR5LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3k7XG4gIH07XG5cbiAgRW50aXR5LnByb3RvdHlwZS5nZXRaID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3o7XG4gIH07XG5cbiAgRW50aXR5LnByb3RvdHlwZS5nZXRNYXAgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fbWFwO1xuICB9O1xuXG4gIEVudGl0eS5wcm90b3R5cGUuZ2V0U3BlZWQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fc3BlZWQ7XG4gIH07XG5cbiAgRW50aXR5LnByb3RvdHlwZS50cnlNb3ZlID0gZnVuY3Rpb24oeCwgeSwgeiwgbWFwKSB7XG4gICAgdmFyIGl0ZW1zLCB0YXJnZXQsIHRpbGU7XG4gICAgbWFwID0gdGhpcy5nZXRNYXAoKTtcbiAgICB0aWxlID0gbWFwLmdldFRpbGUoeCwgeSwgdGhpcy5nZXRaKCkpO1xuICAgIHRhcmdldCA9IG1hcC5nZXRFbnRpdHlBdCh4LCB5LCB0aGlzLmdldFooKSk7XG4gICAgaWYgKHogPCB0aGlzLmdldFooKSkge1xuICAgICAgaWYgKHRpbGUgIT09IEdhbWUuVGlsZS5zdGFpcnNVcFRpbGUpIHtcbiAgICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLCBcIllvdSBjYW4ndCBnbyB1cCBoZXJlIVwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIEdhbWUuc2VuZE1lc3NhZ2UodGhpcywgXCJZb3UgYXNjZW5kIHRvIGxldmVsICVkIVwiLCBbeiArIDFdKTtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvbih4LCB5LCB6KTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHogPiB0aGlzLmdldFooKSkge1xuICAgICAgaWYgKHRpbGUgPT09IEdhbWUuVGlsZS5ob2xlVG9DYXZlcm5UaWxlICYmIHRoaXMuaGFzTWl4aW4oR2FtZS5FbnRpdHlNaXhpbnMuUGxheWVyQWN0b3IpKSB7XG4gICAgICAgIHRoaXMuc3dpdGNoTWFwKG5ldyBHYW1lLk1hcC5Cb3NzQ2F2ZXJuKCkpO1xuICAgICAgfSBlbHNlIGlmICh0aWxlICE9PSBHYW1lLlRpbGUuc3RhaXJzRG93blRpbGUpIHtcbiAgICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLCBcIllvdSBjYW4ndCBnbyBkb3duIGhlcmUhXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvbih4LCB5LCB6KTtcbiAgICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLCBcIllvdSBkZXNjZW5kIHRvIGxldmVsICVkIVwiLCBbeiArIDFdKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRhcmdldCkge1xuICAgICAgaWYgKHRoaXMuaGFzTWl4aW4oXCJBdHRhY2tlclwiKSAmJiAodGhpcy5oYXNNaXhpbihHYW1lLkVudGl0eU1peGlucy5QbGF5ZXJBY3RvcikgfHwgdGFyZ2V0Lmhhc01peGluKEdhbWUuRW50aXR5TWl4aW5zLlBsYXllckFjdG9yKSkpIHtcbiAgICAgICAgdGhpcy5hdHRhY2sodGFyZ2V0KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIGlmICh0aWxlLmlzV2Fsa2FibGUoKSkge1xuICAgICAgdGhpcy5zZXRQb3NpdGlvbih4LCB5LCB6KTtcbiAgICAgIGl0ZW1zID0gdGhpcy5nZXRNYXAoKS5nZXRJdGVtc0F0KHgsIHksIHopO1xuICAgICAgaWYgKGl0ZW1zKSB7XG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICBHYW1lLnNlbmRNZXNzYWdlKHRoaXMsIFwiWW91IHNlZSAlcy5cIiwgW2l0ZW1zWzBdLmRlc2NyaWJlQSgpXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLCBcIlRoZXJlIGFyZSBzZXZlcmFsIG9iamVjdHMgaGVyZS5cIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSBpZiAodGlsZS5pc0RpZ2dhYmxlKCkpIHtcbiAgICAgIGlmICh0aGlzLmhhc01peGluKEdhbWUuRW50aXR5TWl4aW5zLlBsYXllckFjdG9yKSkge1xuICAgICAgICBtYXAuZGlnKHgsIHksIHopO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIEVudGl0eS5wcm90b3R5cGUuaXNBbGl2ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9hbGl2ZTtcbiAgfTtcblxuICBFbnRpdHkucHJvdG90eXBlLmtpbGwgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgaWYgKCF0aGlzLl9hbGl2ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl9hbGl2ZSA9IGZhbHNlO1xuICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICBHYW1lLnNlbmRNZXNzYWdlKHRoaXMsIG1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBHYW1lLnNlbmRNZXNzYWdlKHRoaXMsIFwiWW91IGhhdmUgZGllZCFcIik7XG4gICAgfVxuICAgIGlmICh0aGlzLmhhc01peGluKEdhbWUuRW50aXR5TWl4aW5zLlBsYXllckFjdG9yKSkge1xuICAgICAgdGhpcy5hY3QoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5nZXRNYXAoKS5yZW1vdmVFbnRpdHkodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIEVudGl0eS5wcm90b3R5cGUuc3dpdGNoTWFwID0gZnVuY3Rpb24obmV3TWFwKSB7XG4gICAgaWYgKG5ld01hcCA9PT0gdGhpcy5nZXRNYXAoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmdldE1hcCgpLnJlbW92ZUVudGl0eSh0aGlzKTtcbiAgICB0aGlzLl94ID0gMDtcbiAgICB0aGlzLl95ID0gMDtcbiAgICB0aGlzLl96ID0gMDtcbiAgICBuZXdNYXAuYWRkRW50aXR5KHRoaXMpO1xuICB9O1xuXG4gIHJldHVybiBFbnRpdHk7XG5cbn0pKEdhbWUuRHluYW1pY0dseXBoKTtcblxuR2FtZS5FbnRpdHlNaXhpbnMgPSB7fTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi9nYW1lJyk7XG5cbkdhbWUuR2x5cGggPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIEdseXBoKHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzID0gcHJvcGVydGllcyB8fCB7fTtcbiAgICB0aGlzLl9jaGFyID0gcHJvcGVydGllc1tcImNoYXJhY3RlclwiXSB8fCBcIiBcIjtcbiAgICB0aGlzLl9mb3JlZ3JvdW5kID0gcHJvcGVydGllc1tcImZvcmVncm91bmRcIl0gfHwgXCJ3aGl0ZVwiO1xuICAgIHRoaXMuX2JhY2tncm91bmQgPSBwcm9wZXJ0aWVzW1wiYmFja2dyb3VuZFwiXSB8fCBcImJsYWNrXCI7XG4gIH1cblxuICBHbHlwaC5wcm90b3R5cGUuZ2V0Q2hhciA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9jaGFyO1xuICB9O1xuXG4gIEdseXBoLnByb3RvdHlwZS5nZXRCYWNrZ3JvdW5kID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2JhY2tncm91bmQ7XG4gIH07XG5cbiAgR2x5cGgucHJvdG90eXBlLmdldEZvcmVncm91bmQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fZm9yZWdyb3VuZDtcbiAgfTtcblxuICBHbHlwaC5wcm90b3R5cGUuZ2V0UmVwcmVzZW50YXRpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gXCIlY3tcIiArIHRoaXMuX2ZvcmVncm91bmQgKyBcIn0lYntcIiArIHRoaXMuX2JhY2tncm91bmQgKyBcIn1cIiArIHRoaXMuX2NoYXIgKyBcIiVje3doaXRlfSVie2JsYWNrfVwiO1xuICB9O1xuXG4gIHJldHVybiBHbHlwaDtcblxufSkoKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lLFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uL2dhbWUnKTtcblxuR2FtZS5JdGVtID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoSXRlbSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBJdGVtKHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzID0gcHJvcGVydGllcyB8fCB7fTtcbiAgICBJdGVtLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHByb3BlcnRpZXMpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHJldHVybiBJdGVtO1xuXG59KShHYW1lLkR5bmFtaWNHbHlwaCk7XG5cbkdhbWUuSXRlbU1peGlucyA9IHt9O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uL2dhbWUnKTtcblxuR2FtZS5NYXAgPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIE1hcCh0aWxlcykge1xuICAgIHRoaXMuX3RpbGVzID0gdGlsZXM7XG4gICAgdGhpcy5fZGVwdGggPSB0aWxlcy5sZW5ndGg7XG4gICAgdGhpcy5fd2lkdGggPSB0aWxlc1swXS5sZW5ndGg7XG4gICAgdGhpcy5faGVpZ2h0ID0gdGlsZXNbMF1bMF0ubGVuZ3RoO1xuICAgIHRoaXMuX2ZvdiA9IFtdO1xuICAgIHRoaXMuc2V0dXBGb3YoKTtcbiAgICB0aGlzLl9lbnRpdGllcyA9IHt9O1xuICAgIHRoaXMuX2l0ZW1zID0ge307XG4gICAgdGhpcy5fc2NoZWR1bGVyID0gbmV3IFJPVC5TY2hlZHVsZXIuU3BlZWQoKTtcbiAgICB0aGlzLl9lbmdpbmUgPSBuZXcgUk9ULkVuZ2luZSh0aGlzLl9zY2hlZHVsZXIpO1xuICAgIHRoaXMuX2V4cGxvcmVkID0gbmV3IEFycmF5KHRoaXMuX2RlcHRoKTtcbiAgICB0aGlzLl9zZXR1cEV4cGxvcmVkQXJyYXkoKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBNYXAucHJvdG90eXBlLl9zZXR1cEV4cGxvcmVkQXJyYXkgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgeCwgeSwgejtcbiAgICB6ID0gMDtcbiAgICB3aGlsZSAoeiA8IHRoaXMuX2RlcHRoKSB7XG4gICAgICB0aGlzLl9leHBsb3JlZFt6XSA9IG5ldyBBcnJheSh0aGlzLl93aWR0aCk7XG4gICAgICB4ID0gMDtcbiAgICAgIHdoaWxlICh4IDwgdGhpcy5fd2lkdGgpIHtcbiAgICAgICAgdGhpcy5fZXhwbG9yZWRbel1beF0gPSBuZXcgQXJyYXkodGhpcy5faGVpZ2h0KTtcbiAgICAgICAgeSA9IDA7XG4gICAgICAgIHdoaWxlICh5IDwgdGhpcy5faGVpZ2h0KSB7XG4gICAgICAgICAgdGhpcy5fZXhwbG9yZWRbel1beF1beV0gPSBmYWxzZTtcbiAgICAgICAgICB5Kys7XG4gICAgICAgIH1cbiAgICAgICAgeCsrO1xuICAgICAgfVxuICAgICAgeisrO1xuICAgIH1cbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmdldERlcHRoID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RlcHRoO1xuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fd2lkdGg7XG4gIH07XG5cbiAgTWFwLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5faGVpZ2h0O1xuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUuZ2V0VGlsZSA9IGZ1bmN0aW9uKHgsIHksIHopIHtcbiAgICBpZiAoeCA8IDAgfHwgeCA+PSB0aGlzLl93aWR0aCB8fCB5IDwgMCB8fCB5ID49IHRoaXMuX2hlaWdodCB8fCB6IDwgMCB8fCB6ID49IHRoaXMuX2RlcHRoKSB7XG4gICAgICByZXR1cm4gR2FtZS5UaWxlLm51bGxUaWxlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5fdGlsZXNbel1beF1beV0gfHwgR2FtZS5UaWxlLm51bGxUaWxlO1xuICAgIH1cbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmRpZyA9IGZ1bmN0aW9uKHgsIHksIHopIHtcbiAgICBpZiAodGhpcy5nZXRUaWxlKHgsIHksIHopLmlzRGlnZ2FibGUoKSkge1xuICAgICAgdGhpcy5fdGlsZXNbel1beF1beV0gPSBHYW1lLlRpbGUuZmxvb3JUaWxlO1xuICAgIH1cbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmlzRW1wdHlGbG9vciA9IGZ1bmN0aW9uKHgsIHksIHopIHtcbiAgICByZXR1cm4gdGhpcy5nZXRUaWxlKHgsIHksIHopID09PSBHYW1lLlRpbGUuZmxvb3JUaWxlICYmICF0aGlzLmdldEVudGl0eUF0KHgsIHksIHopO1xuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUuc2V0RXhwbG9yZWQgPSBmdW5jdGlvbih4LCB5LCB6LCBzdGF0ZSkge1xuICAgIGlmICh0aGlzLmdldFRpbGUoeCwgeSwgeikgIT09IEdhbWUuVGlsZS5udWxsVGlsZSkge1xuICAgICAgdGhpcy5fZXhwbG9yZWRbel1beF1beV0gPSBzdGF0ZTtcbiAgICB9XG4gIH07XG5cbiAgTWFwLnByb3RvdHlwZS5pc0V4cGxvcmVkID0gZnVuY3Rpb24oeCwgeSwgeikge1xuICAgIGlmICh0aGlzLmdldFRpbGUoeCwgeSwgeikgIT09IEdhbWUuVGlsZS5udWxsVGlsZSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2V4cGxvcmVkW3pdW3hdW3ldO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUuc2V0dXBGb3YgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbWFwLCB6O1xuICAgIG1hcCA9IHRoaXM7XG4gICAgeiA9IDA7XG4gICAgd2hpbGUgKHogPCB0aGlzLl9kZXB0aCkge1xuICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZGVwdGg7XG4gICAgICAgIGRlcHRoID0gejtcbiAgICAgICAgcmV0dXJuIG1hcC5fZm92LnB1c2gobmV3IFJPVC5GT1YuRGlzY3JldGVTaGFkb3djYXN0aW5nKGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgICAgICByZXR1cm4gIW1hcC5nZXRUaWxlKHgsIHksIGRlcHRoKS5pc0Jsb2NraW5nTGlnaHQoKTtcbiAgICAgICAgfSwge1xuICAgICAgICAgIHRvcG9sb2d5OiA0XG4gICAgICAgIH0pKTtcbiAgICAgIH0pKCk7XG4gICAgICB6Kys7XG4gICAgfVxuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUuZ2V0Rm92ID0gZnVuY3Rpb24oZGVwdGgpIHtcbiAgICByZXR1cm4gdGhpcy5fZm92W2RlcHRoXTtcbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmdldEVuZ2luZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9lbmdpbmU7XG4gIH07XG5cbiAgTWFwLnByb3RvdHlwZS5nZXRFbnRpdGllcyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9lbnRpdGllcztcbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmdldEVudGl0eUF0ID0gZnVuY3Rpb24oeCwgeSwgeikge1xuICAgIHJldHVybiB0aGlzLl9lbnRpdGllc1t4ICsgXCIsXCIgKyB5ICsgXCIsXCIgKyB6XTtcbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmdldEVudGl0aWVzV2l0aGluUmFkaXVzID0gZnVuY3Rpb24oY2VudGVyWCwgY2VudGVyWSwgY2VudGVyWiwgcmFkaXVzKSB7XG4gICAgdmFyIGJvdHRvbVksIGVudGl0eSwga2V5LCBsZWZ0WCwgcmVzdWx0cywgcmlnaHRYLCB0b3BZO1xuICAgIHJlc3VsdHMgPSBbXTtcbiAgICBsZWZ0WCA9IGNlbnRlclggLSByYWRpdXM7XG4gICAgcmlnaHRYID0gY2VudGVyWCArIHJhZGl1cztcbiAgICB0b3BZID0gY2VudGVyWSAtIHJhZGl1cztcbiAgICBib3R0b21ZID0gY2VudGVyWSArIHJhZGl1cztcbiAgICBmb3IgKGtleSBpbiB0aGlzLl9lbnRpdGllcykge1xuICAgICAgZW50aXR5ID0gdGhpcy5fZW50aXRpZXNba2V5XTtcbiAgICAgIGlmIChlbnRpdHkuZ2V0WCgpID49IGxlZnRYICYmIGVudGl0eS5nZXRYKCkgPD0gcmlnaHRYICYmIGVudGl0eS5nZXRZKCkgPj0gdG9wWSAmJiBlbnRpdHkuZ2V0WSgpIDw9IGJvdHRvbVkgJiYgZW50aXR5LmdldFooKSA9PT0gY2VudGVyWikge1xuICAgICAgICByZXN1bHRzLnB1c2goZW50aXR5KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH07XG5cbiAgTWFwLnByb3RvdHlwZS5nZXRSYW5kb21GbG9vclBvc2l0aW9uID0gZnVuY3Rpb24oeikge1xuICAgIHZhciB4LCB5O1xuICAgIHggPSB2b2lkIDA7XG4gICAgeSA9IHZvaWQgMDtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuX3dpZHRoKTtcbiAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLl9oZWlnaHQpO1xuICAgICAgaWYgKCEhdGhpcy5pc0VtcHR5Rmxvb3IoeCwgeSwgeikpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICB4OiB4LFxuICAgICAgeTogeSxcbiAgICAgIHo6IHpcbiAgICB9O1xuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUuYWRkRW50aXR5QXRSYW5kb21Qb3NpdGlvbiA9IGZ1bmN0aW9uKGVudGl0eSwgeikge1xuICAgIHZhciBwb3NpdGlvbjtcbiAgICBwb3NpdGlvbiA9IHRoaXMuZ2V0UmFuZG9tRmxvb3JQb3NpdGlvbih6KTtcbiAgICBlbnRpdHkuc2V0WChwb3NpdGlvbi54KTtcbiAgICBlbnRpdHkuc2V0WShwb3NpdGlvbi55KTtcbiAgICBlbnRpdHkuc2V0Wihwb3NpdGlvbi56KTtcbiAgICB0aGlzLmFkZEVudGl0eShlbnRpdHkpO1xuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUuYWRkRW50aXR5ID0gZnVuY3Rpb24oZW50aXR5KSB7XG4gICAgZW50aXR5LnNldE1hcCh0aGlzKTtcbiAgICB0aGlzLnVwZGF0ZUVudGl0eVBvc2l0aW9uKGVudGl0eSk7XG4gICAgaWYgKGVudGl0eS5oYXNNaXhpbihcIkFjdG9yXCIpKSB7XG4gICAgICB0aGlzLl9zY2hlZHVsZXIuYWRkKGVudGl0eSwgdHJ1ZSk7XG4gICAgfVxuICAgIGlmIChlbnRpdHkuaGFzTWl4aW4oR2FtZS5FbnRpdHlNaXhpbnMuUGxheWVyQWN0b3IpKSB7XG4gICAgICB0aGlzLl9wbGF5ZXIgPSBlbnRpdHk7XG4gICAgfVxuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUucmVtb3ZlRW50aXR5ID0gZnVuY3Rpb24oZW50aXR5KSB7XG4gICAgdmFyIGtleTtcbiAgICBrZXkgPSBlbnRpdHkuZ2V0WCgpICsgXCIsXCIgKyBlbnRpdHkuZ2V0WSgpICsgXCIsXCIgKyBlbnRpdHkuZ2V0WigpO1xuICAgIGlmICh0aGlzLl9lbnRpdGllc1trZXldID09PSBlbnRpdHkpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLl9lbnRpdGllc1trZXldO1xuICAgIH1cbiAgICBpZiAoZW50aXR5Lmhhc01peGluKFwiQWN0b3JcIikpIHtcbiAgICAgIHRoaXMuX3NjaGVkdWxlci5yZW1vdmUoZW50aXR5KTtcbiAgICB9XG4gICAgaWYgKGVudGl0eS5oYXNNaXhpbihHYW1lLkVudGl0eU1peGlucy5QbGF5ZXJBY3RvcikpIHtcbiAgICAgIHRoaXMuX3BsYXllciA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH07XG5cbiAgTWFwLnByb3RvdHlwZS51cGRhdGVFbnRpdHlQb3NpdGlvbiA9IGZ1bmN0aW9uKGVudGl0eSwgb2xkWCwgb2xkWSwgb2xkWikge1xuICAgIHZhciBrZXksIG9sZEtleTtcbiAgICBpZiAodHlwZW9mIG9sZFggPT09IFwibnVtYmVyXCIpIHtcbiAgICAgIG9sZEtleSA9IG9sZFggKyBcIixcIiArIG9sZFkgKyBcIixcIiArIG9sZFo7XG4gICAgICBpZiAodGhpcy5fZW50aXRpZXNbb2xkS2V5XSA9PT0gZW50aXR5KSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLl9lbnRpdGllc1tvbGRLZXldO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZW50aXR5LmdldFgoKSA8IDAgfHwgZW50aXR5LmdldFgoKSA+PSB0aGlzLl93aWR0aCB8fCBlbnRpdHkuZ2V0WSgpIDwgMCB8fCBlbnRpdHkuZ2V0WSgpID49IHRoaXMuX2hlaWdodCB8fCBlbnRpdHkuZ2V0WigpIDwgMCB8fCBlbnRpdHkuZ2V0WigpID49IHRoaXMuX2RlcHRoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbnRpdHkncyBwb3NpdGlvbiBpcyBvdXQgb2YgYm91bmRzLlwiKTtcbiAgICB9XG4gICAga2V5ID0gZW50aXR5LmdldFgoKSArIFwiLFwiICsgZW50aXR5LmdldFkoKSArIFwiLFwiICsgZW50aXR5LmdldFooKTtcbiAgICBpZiAodGhpcy5fZW50aXRpZXNba2V5XSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVHJpZWQgdG8gYWRkIGFuIGVudGl0eSBhdCBhbiBvY2N1cGllZCBwb3NpdGlvbi5cIik7XG4gICAgfVxuICAgIHRoaXMuX2VudGl0aWVzW2tleV0gPSBlbnRpdHk7XG4gIH07XG5cbiAgTWFwLnByb3RvdHlwZS5nZXRJdGVtc0F0ID0gZnVuY3Rpb24oeCwgeSwgeikge1xuICAgIHJldHVybiB0aGlzLl9pdGVtc1t4ICsgXCIsXCIgKyB5ICsgXCIsXCIgKyB6XTtcbiAgfTtcblxuICBNYXAucHJvdG90eXBlLnNldEl0ZW1zQXQgPSBmdW5jdGlvbih4LCB5LCB6LCBpdGVtcykge1xuICAgIHZhciBrZXk7XG4gICAga2V5ID0geCArIFwiLFwiICsgeSArIFwiLFwiICsgejtcbiAgICBpZiAoaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBpZiAodGhpcy5faXRlbXNba2V5XSkge1xuICAgICAgICBkZWxldGUgdGhpcy5faXRlbXNba2V5XTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faXRlbXNba2V5XSA9IGl0ZW1zO1xuICAgIH1cbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmFkZEl0ZW0gPSBmdW5jdGlvbih4LCB5LCB6LCBpdGVtKSB7XG4gICAgdmFyIGtleTtcbiAgICBrZXkgPSB4ICsgXCIsXCIgKyB5ICsgXCIsXCIgKyB6O1xuICAgIGlmICh0aGlzLl9pdGVtc1trZXldKSB7XG4gICAgICB0aGlzLl9pdGVtc1trZXldLnB1c2goaXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2l0ZW1zW2tleV0gPSBbaXRlbV07XG4gICAgfVxuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUuYWRkSXRlbUF0UmFuZG9tUG9zaXRpb24gPSBmdW5jdGlvbihpdGVtLCB6KSB7XG4gICAgdmFyIHBvc2l0aW9uO1xuICAgIHBvc2l0aW9uID0gdGhpcy5nZXRSYW5kb21GbG9vclBvc2l0aW9uKHopO1xuICAgIHRoaXMuYWRkSXRlbShwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56LCBpdGVtKTtcbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmdldFBsYXllciA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9wbGF5ZXI7XG4gIH07XG5cbiAgcmV0dXJuIE1hcDtcblxufSkoKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi9nYW1lJyk7XG5cbkdhbWUuUmVwb3NpdG9yeSA9IChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gUmVwb3NpdG9yeShuYW1lLCBjdG9yKSB7XG4gICAgdGhpcy5fbmFtZSA9IG5hbWU7XG4gICAgdGhpcy5fdGVtcGxhdGVzID0ge307XG4gICAgdGhpcy5fY3RvciA9IGN0b3I7XG4gICAgdGhpcy5fcmFuZG9tVGVtcGxhdGVzID0ge307XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgUmVwb3NpdG9yeS5wcm90b3R5cGUuZGVmaW5lID0gZnVuY3Rpb24obmFtZSwgdGVtcGxhdGUsIG9wdGlvbnMpIHtcbiAgICB2YXIgZGlzYWJsZVJhbmRvbUNyZWF0aW9uO1xuICAgIHRoaXMuX3RlbXBsYXRlc1tuYW1lXSA9IHRlbXBsYXRlO1xuICAgIGRpc2FibGVSYW5kb21DcmVhdGlvbiA9IG9wdGlvbnMgJiYgb3B0aW9uc1tcImRpc2FibGVSYW5kb21DcmVhdGlvblwiXTtcbiAgICBpZiAoIWRpc2FibGVSYW5kb21DcmVhdGlvbikge1xuICAgICAgdGhpcy5fcmFuZG9tVGVtcGxhdGVzW25hbWVdID0gdGVtcGxhdGU7XG4gICAgfVxuICB9O1xuXG4gIFJlcG9zaXRvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKG5hbWUsIGV4dHJhUHJvcGVydGllcykge1xuICAgIHZhciBrZXksIHRlbXBsYXRlO1xuICAgIGlmICghdGhpcy5fdGVtcGxhdGVzW25hbWVdKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyB0ZW1wbGF0ZSBuYW1lZCAnXCIgKyBuYW1lICsgXCInIGluIHJlcG9zaXRvcnkgJ1wiICsgdGhpcy5fbmFtZSArIFwiJ1wiKTtcbiAgICB9XG4gICAgdGVtcGxhdGUgPSBPYmplY3QuY3JlYXRlKHRoaXMuX3RlbXBsYXRlc1tuYW1lXSk7XG4gICAgaWYgKGV4dHJhUHJvcGVydGllcykge1xuICAgICAgZm9yIChrZXkgaW4gZXh0cmFQcm9wZXJ0aWVzKSB7XG4gICAgICAgIHRlbXBsYXRlW2tleV0gPSBleHRyYVByb3BlcnRpZXNba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ldyB0aGlzLl9jdG9yKHRlbXBsYXRlKTtcbiAgfTtcblxuICBSZXBvc2l0b3J5LnByb3RvdHlwZS5jcmVhdGVSYW5kb20gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGUoT2JqZWN0LmtleXModGhpcy5fcmFuZG9tVGVtcGxhdGVzKS5yYW5kb20oKSk7XG4gIH07XG5cbiAgcmV0dXJuIFJlcG9zaXRvcnk7XG5cbn0pKCk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi9nYW1lJyk7XG5cbkdhbWUuVGlsZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKFRpbGUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gVGlsZShwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcyA9IHByb3BlcnRpZXMgfHwge307XG4gICAgVGlsZS5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCBwcm9wZXJ0aWVzKTtcbiAgICB0aGlzLl93YWxrYWJsZSA9IHByb3BlcnRpZXNbXCJ3YWxrYWJsZVwiXSB8fCBmYWxzZTtcbiAgICB0aGlzLl9kaWdnYWJsZSA9IHByb3BlcnRpZXNbXCJkaWdnYWJsZVwiXSB8fCBmYWxzZTtcbiAgICB0aGlzLl9ibG9ja3NMaWdodCA9IChwcm9wZXJ0aWVzW1wiYmxvY2tzTGlnaHRcIl0gIT09IHVuZGVmaW5lZCA/IHByb3BlcnRpZXNbXCJibG9ja3NMaWdodFwiXSA6IHRydWUpO1xuICAgIHRoaXMuX2Rlc2NyaXB0aW9uID0gcHJvcGVydGllc1tcImRlc2NyaXB0aW9uXCJdIHx8IFwiXCI7XG4gIH1cblxuICBUaWxlLnByb3RvdHlwZS5pc1dhbGthYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3dhbGthYmxlO1xuICB9O1xuXG4gIFRpbGUucHJvdG90eXBlLmlzRGlnZ2FibGUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fZGlnZ2FibGU7XG4gIH07XG5cbiAgVGlsZS5wcm90b3R5cGUuaXNCbG9ja2luZ0xpZ2h0ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Jsb2Nrc0xpZ2h0O1xuICB9O1xuXG4gIFRpbGUucHJvdG90eXBlLmdldERlc2NyaXB0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0aW9uO1xuICB9O1xuXG4gIFRpbGUubnVsbFRpbGUgPSBuZXcgVGlsZSh7XG4gICAgZGVzY3JpcHRpb246IFwiKHVua25vd24pXCJcbiAgfSk7XG5cbiAgVGlsZS5mbG9vclRpbGUgPSBuZXcgVGlsZSh7XG4gICAgY2hhcmFjdGVyOiBcIi5cIixcbiAgICB3YWxrYWJsZTogdHJ1ZSxcbiAgICBibG9ja3NMaWdodDogZmFsc2UsXG4gICAgZGVzY3JpcHRpb246IFwiQSBjYXZlIGZsb29yXCJcbiAgfSk7XG5cbiAgVGlsZS53YWxsVGlsZSA9IG5ldyBUaWxlKHtcbiAgICBjaGFyYWN0ZXI6IFwiI1wiLFxuICAgIGZvcmVncm91bmQ6IFwiZ29sZGVucm9kXCIsXG4gICAgZGlnZ2FibGU6IHRydWUsXG4gICAgZGVzY3JpcHRpb246IFwiQSBjYXZlIHdhbGxcIlxuICB9KTtcblxuICBUaWxlLnN0YWlyc1VwVGlsZSA9IG5ldyBUaWxlKHtcbiAgICBjaGFyYWN0ZXI6IFwiPFwiLFxuICAgIGZvcmVncm91bmQ6IFwid2hpdGVcIixcbiAgICB3YWxrYWJsZTogdHJ1ZSxcbiAgICBibG9ja3NMaWdodDogZmFsc2UsXG4gICAgZGVzY3JpcHRpb246IFwiQSByb2NrIHN0YWlyY2FzZSBsZWFkaW5nIHVwd2FyZHNcIlxuICB9KTtcblxuICBUaWxlLnN0YWlyc0Rvd25UaWxlID0gbmV3IFRpbGUoe1xuICAgIGNoYXJhY3RlcjogXCI+XCIsXG4gICAgZm9yZWdyb3VuZDogXCJ3aGl0ZVwiLFxuICAgIHdhbGthYmxlOiB0cnVlLFxuICAgIGJsb2Nrc0xpZ2h0OiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogXCJBIHJvY2sgc3RhaXJjYXNlIGxlYWRpbmcgZG93bndhcmRzXCJcbiAgfSk7XG5cbiAgVGlsZS5ob2xlVG9DYXZlcm5UaWxlID0gbmV3IFRpbGUoe1xuICAgIGNoYXJhY3RlcjogXCJPXCIsXG4gICAgZm9yZWdyb3VuZDogXCJ3aGl0ZVwiLFxuICAgIHdhbGthYmxlOiB0cnVlLFxuICAgIGJsb2Nrc0xpZ2h0OiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogXCJBIGdyZWF0IGRhcmsgaG9sZSBpbiB0aGUgZ3JvdW5kXCJcbiAgfSk7XG5cbiAgVGlsZS53YXRlclRpbGUgPSBuZXcgVGlsZSh7XG4gICAgY2hhcmFjdGVyOiBcIn5cIixcbiAgICBmb3JlZ3JvdW5kOiBcImJsdWVcIixcbiAgICB3YWxrYWJsZTogZmFsc2UsXG4gICAgYmxvY2tzTGlnaHQ6IGZhbHNlLFxuICAgIGRlc2NyaXB0aW9uOiBcIk11cmt5IGJsdWUgd2F0ZXJcIlxuICB9KTtcblxuICByZXR1cm4gVGlsZTtcblxufSkoR2FtZS5HbHlwaCk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5HYW1lLkVudGl0eU1peGlucy5BdHRhY2tlciA9IHtcbiAgbmFtZTogXCJBdHRhY2tlclwiLFxuICBncm91cE5hbWU6IFwiQXR0YWNrZXJcIixcbiAgaW5pdDogZnVuY3Rpb24odGVtcGxhdGUpIHtcbiAgICByZXR1cm4gdGhpcy5fYXR0YWNrVmFsdWUgPSB0ZW1wbGF0ZVtcImF0dGFja1ZhbHVlXCJdIHx8IDE7XG4gIH0sXG4gIGdldEF0dGFja1ZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbW9kaWZpZXI7XG4gICAgbW9kaWZpZXIgPSAwO1xuICAgIGlmICh0aGlzLmhhc01peGluKEdhbWUuRW50aXR5TWl4aW5zLkVxdWlwcGVyKSkge1xuICAgICAgaWYgKHRoaXMuZ2V0V2VhcG9uKCkpIHtcbiAgICAgICAgbW9kaWZpZXIgKz0gdGhpcy5nZXRXZWFwb24oKS5nZXRBdHRhY2tWYWx1ZSgpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZ2V0QXJtb3IoKSkge1xuICAgICAgICBtb2RpZmllciArPSB0aGlzLmdldEFybW9yKCkuZ2V0QXR0YWNrVmFsdWUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2F0dGFja1ZhbHVlICsgbW9kaWZpZXI7XG4gIH0sXG4gIGluY3JlYXNlQXR0YWNrVmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgdmFsdWUgPSB2YWx1ZSB8fCAyO1xuICAgIHRoaXMuX2F0dGFja1ZhbHVlICs9IHZhbHVlO1xuICAgIHJldHVybiBHYW1lLnNlbmRNZXNzYWdlKHRoaXMsIFwiWW91IGxvb2sgc3Ryb25nZXIhXCIpO1xuICB9LFxuICBhdHRhY2s6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgIHZhciBhdHRhY2ssIGRhbWFnZSwgZGVmZW5zZSwgbWF4O1xuICAgIGlmICh0YXJnZXQuaGFzTWl4aW4oXCJEZXN0cnVjdGlibGVcIikpIHtcbiAgICAgIGF0dGFjayA9IHRoaXMuZ2V0QXR0YWNrVmFsdWUoKTtcbiAgICAgIGRlZmVuc2UgPSB0YXJnZXQuZ2V0RGVmZW5zZVZhbHVlKCk7XG4gICAgICBtYXggPSBNYXRoLm1heCgwLCBhdHRhY2sgLSBkZWZlbnNlKTtcbiAgICAgIGRhbWFnZSA9IDEgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXgpO1xuICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLCBcIllvdSBzdHJpa2UgdGhlICVzIGZvciAlZCBkYW1hZ2UhXCIsIFt0YXJnZXQuZ2V0TmFtZSgpLCBkYW1hZ2VdKTtcbiAgICAgIEdhbWUuc2VuZE1lc3NhZ2UodGFyZ2V0LCBcIlRoZSAlcyBzdHJpa2VzIHlvdSBmb3IgJWQgZGFtYWdlIVwiLCBbdGhpcy5nZXROYW1lKCksIGRhbWFnZV0pO1xuICAgICAgcmV0dXJuIHRhcmdldC50YWtlRGFtYWdlKHRoaXMsIGRhbWFnZSk7XG4gICAgfVxuICB9LFxuICBsaXN0ZW5lcnM6IHtcbiAgICBkZXRhaWxzOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6IFwiYXR0YWNrXCIsXG4gICAgICAgICAgdmFsdWU6IHRoaXMuZ2V0QXR0YWNrVmFsdWUoKVxuICAgICAgICB9XG4gICAgICBdO1xuICAgIH1cbiAgfVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbkdhbWUuRW50aXR5TWl4aW5zLkNvcnBzZURyb3BwZXIgPSB7XG4gIG5hbWU6IFwiQ29ycHNlRHJvcHBlclwiLFxuICBpbml0OiBmdW5jdGlvbih0ZW1wbGF0ZSkge1xuICAgIHJldHVybiB0aGlzLl9jb3Jwc2VEcm9wUmF0ZSA9IHRlbXBsYXRlW1wiY29ycHNlRHJvcFJhdGVcIl0gfHwgMTAwO1xuICB9LFxuICBsaXN0ZW5lcnM6IHtcbiAgICBvbkRlYXRoOiBmdW5jdGlvbihhdHRhY2tlcikge1xuICAgICAgaWYgKE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDEwMCkgPD0gdGhpcy5fY29ycHNlRHJvcFJhdGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX21hcC5hZGRJdGVtKHRoaXMuZ2V0WCgpLCB0aGlzLmdldFkoKSwgdGhpcy5nZXRaKCksIEdhbWUuSXRlbVJlcG9zaXRvcnkuY3JlYXRlKFwiY29ycHNlXCIsIHtcbiAgICAgICAgICBuYW1lOiB0aGlzLl9uYW1lICsgXCIgY29ycHNlXCIsXG4gICAgICAgICAgZm9yZWdyb3VuZDogdGhpcy5fZm9yZWdyb3VuZFxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuR2FtZS5FbnRpdHlNaXhpbnMuRGVzdHJ1Y3RpYmxlID0ge1xuICBuYW1lOiBcIkRlc3RydWN0aWJsZVwiLFxuICBpbml0OiBmdW5jdGlvbih0ZW1wbGF0ZSkge1xuICAgIHRoaXMuX21heEhwID0gdGVtcGxhdGVbXCJtYXhIcFwiXSB8fCAxMDtcbiAgICB0aGlzLl9ocCA9IHRlbXBsYXRlW1wiaHBcIl0gfHwgdGhpcy5fbWF4SHA7XG4gICAgcmV0dXJuIHRoaXMuX2RlZmVuc2VWYWx1ZSA9IHRlbXBsYXRlW1wiZGVmZW5zZVZhbHVlXCJdIHx8IDA7XG4gIH0sXG4gIGdldERlZmVuc2VWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIG1vZGlmaWVyO1xuICAgIG1vZGlmaWVyID0gMDtcbiAgICBpZiAodGhpcy5oYXNNaXhpbihHYW1lLkVudGl0eU1peGlucy5FcXVpcHBlcikpIHtcbiAgICAgIGlmICh0aGlzLmdldFdlYXBvbigpKSB7XG4gICAgICAgIG1vZGlmaWVyICs9IHRoaXMuZ2V0V2VhcG9uKCkuZ2V0RGVmZW5zZVZhbHVlKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5nZXRBcm1vcigpKSB7XG4gICAgICAgIG1vZGlmaWVyICs9IHRoaXMuZ2V0QXJtb3IoKS5nZXREZWZlbnNlVmFsdWUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2RlZmVuc2VWYWx1ZSArIG1vZGlmaWVyO1xuICB9LFxuICBnZXRIcDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2hwO1xuICB9LFxuICBnZXRNYXhIcDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX21heEhwO1xuICB9LFxuICBzZXRIcDogZnVuY3Rpb24oaHApIHtcbiAgICByZXR1cm4gdGhpcy5faHAgPSBocDtcbiAgfSxcbiAgaW5jcmVhc2VEZWZlbnNlVmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgdmFsdWUgPSB2YWx1ZSB8fCAyO1xuICAgIHRoaXMuX2RlZmVuc2VWYWx1ZSArPSB2YWx1ZTtcbiAgICByZXR1cm4gR2FtZS5zZW5kTWVzc2FnZSh0aGlzLCBcIllvdSBsb29rIHRvdWdoZXIhXCIpO1xuICB9LFxuICBpbmNyZWFzZU1heEhwOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHZhbHVlID0gdmFsdWUgfHwgMTA7XG4gICAgdGhpcy5fbWF4SHAgKz0gdmFsdWU7XG4gICAgdGhpcy5faHAgKz0gdmFsdWU7XG4gICAgcmV0dXJuIEdhbWUuc2VuZE1lc3NhZ2UodGhpcywgXCJZb3UgbG9vayBoZWFsdGhpZXIhXCIpO1xuICB9LFxuICB0YWtlRGFtYWdlOiBmdW5jdGlvbihhdHRhY2tlciwgZGFtYWdlKSB7XG4gICAgdGhpcy5faHAgLT0gZGFtYWdlO1xuICAgIGlmICh0aGlzLl9ocCA8PSAwKSB7XG4gICAgICBHYW1lLnNlbmRNZXNzYWdlKGF0dGFja2VyLCBcIllvdSBraWxsIHRoZSAlcyFcIiwgW3RoaXMuZ2V0TmFtZSgpXSk7XG4gICAgICB0aGlzLnJhaXNlRXZlbnQoXCJvbkRlYXRoXCIsIGF0dGFja2VyKTtcbiAgICAgIGF0dGFja2VyLnJhaXNlRXZlbnQoXCJvbktpbGxcIiwgdGhpcyk7XG4gICAgICByZXR1cm4gdGhpcy5raWxsKCk7XG4gICAgfVxuICB9LFxuICBsaXN0ZW5lcnM6IHtcbiAgICBvbkdhaW5MZXZlbDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXRIcCh0aGlzLmdldE1heEhwKCkpO1xuICAgIH0sXG4gICAgZGV0YWlsczogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICB7XG4gICAgICAgICAga2V5OiBcImRlZmVuc2VcIixcbiAgICAgICAgICB2YWx1ZTogdGhpcy5nZXREZWZlbnNlVmFsdWUoKVxuICAgICAgICB9LCB7XG4gICAgICAgICAga2V5OiBcImhwXCIsXG4gICAgICAgICAgdmFsdWU6IHRoaXMuZ2V0SHAoKVxuICAgICAgICB9XG4gICAgICBdO1xuICAgIH1cbiAgfVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbkdhbWUuRW50aXR5TWl4aW5zLkVxdWlwcGVyID0ge1xuICBuYW1lOiBcIkVxdWlwcGVyXCIsXG4gIGluaXQ6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgdGhpcy5fd2VhcG9uID0gbnVsbDtcbiAgICByZXR1cm4gdGhpcy5fYXJtb3IgPSBudWxsO1xuICB9LFxuICB3aWVsZDogZnVuY3Rpb24oaXRlbSkge1xuICAgIHJldHVybiB0aGlzLl93ZWFwb24gPSBpdGVtO1xuICB9LFxuICB1bndpZWxkOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fd2VhcG9uID0gbnVsbDtcbiAgfSxcbiAgd2VhcjogZnVuY3Rpb24oaXRlbSkge1xuICAgIHJldHVybiB0aGlzLl9hcm1vciA9IGl0ZW07XG4gIH0sXG4gIHRha2VPZmY6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9hcm1vciA9IG51bGw7XG4gIH0sXG4gIGdldFdlYXBvbjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3dlYXBvbjtcbiAgfSxcbiAgZ2V0QXJtb3I6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9hcm1vcjtcbiAgfSxcbiAgdW5lcXVpcDogZnVuY3Rpb24oaXRlbSkge1xuICAgIGlmICh0aGlzLl93ZWFwb24gPT09IGl0ZW0pIHtcbiAgICAgIHRoaXMudW53aWVsZCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fYXJtb3IgPT09IGl0ZW0pIHtcbiAgICAgIHJldHVybiB0aGlzLnRha2VPZmYoKTtcbiAgICB9XG4gIH1cbn07XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5HYW1lLkVudGl0eU1peGlucy5FeHBlcmllbmNlR2FpbmVyID0ge1xuICBuYW1lOiBcIkV4cGVyaWVuY2VHYWluZXJcIixcbiAgaW5pdDogZnVuY3Rpb24odGVtcGxhdGUpIHtcbiAgICB0aGlzLl9sZXZlbCA9IHRlbXBsYXRlW1wibGV2ZWxcIl0gfHwgMTtcbiAgICB0aGlzLl9leHBlcmllbmNlID0gdGVtcGxhdGVbXCJleHBlcmllbmNlXCJdIHx8IDA7XG4gICAgdGhpcy5fc3RhdFBvaW50c1BlckxldmVsID0gdGVtcGxhdGVbXCJzdGF0UG9pbnRzUGVyTGV2ZWxcIl0gfHwgMTtcbiAgICB0aGlzLl9zdGF0UG9pbnRzID0gMDtcbiAgICB0aGlzLl9zdGF0T3B0aW9ucyA9IFtdO1xuICAgIGlmICh0aGlzLmhhc01peGluKFwiQXR0YWNrZXJcIikpIHtcbiAgICAgIHRoaXMuX3N0YXRPcHRpb25zLnB1c2goW1wiSW5jcmVhc2UgYXR0YWNrIHZhbHVlXCIsIHRoaXMuaW5jcmVhc2VBdHRhY2tWYWx1ZV0pO1xuICAgIH1cbiAgICBpZiAodGhpcy5oYXNNaXhpbihcIkRlc3RydWN0aWJsZVwiKSkge1xuICAgICAgdGhpcy5fc3RhdE9wdGlvbnMucHVzaChbXCJJbmNyZWFzZSBkZWZlbnNlIHZhbHVlXCIsIHRoaXMuaW5jcmVhc2VEZWZlbnNlVmFsdWVdKTtcbiAgICAgIHRoaXMuX3N0YXRPcHRpb25zLnB1c2goW1wiSW5jcmVhc2UgbWF4IGhlYWx0aFwiLCB0aGlzLmluY3JlYXNlTWF4SHBdKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaGFzTWl4aW4oXCJTaWdodFwiKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N0YXRPcHRpb25zLnB1c2goW1wiSW5jcmVhc2Ugc2lnaHQgcmFuZ2VcIiwgdGhpcy5pbmNyZWFzZVNpZ2h0UmFkaXVzXSk7XG4gICAgfVxuICB9LFxuICBnZXRMZXZlbDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xldmVsO1xuICB9LFxuICBnZXRFeHBlcmllbmNlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fZXhwZXJpZW5jZTtcbiAgfSxcbiAgZ2V0TmV4dExldmVsRXhwZXJpZW5jZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICh0aGlzLl9sZXZlbCAqIHRoaXMuX2xldmVsKSAqIDEwO1xuICB9LFxuICBnZXRTdGF0UG9pbnRzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fc3RhdFBvaW50cztcbiAgfSxcbiAgc2V0U3RhdFBvaW50czogZnVuY3Rpb24oc3RhdFBvaW50cykge1xuICAgIHJldHVybiB0aGlzLl9zdGF0UG9pbnRzID0gc3RhdFBvaW50cztcbiAgfSxcbiAgZ2V0U3RhdE9wdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9zdGF0T3B0aW9ucztcbiAgfSxcbiAgZ2l2ZUV4cGVyaWVuY2U6IGZ1bmN0aW9uKHBvaW50cykge1xuICAgIHZhciBsZXZlbHNHYWluZWQsIHN0YXRQb2ludHNHYWluZWQsIHVzZWRQb2ludHM7XG4gICAgc3RhdFBvaW50c0dhaW5lZCA9IDA7XG4gICAgbGV2ZWxzR2FpbmVkID0gMDtcbiAgICB3aGlsZSAocG9pbnRzID4gMCkge1xuICAgICAgaWYgKHRoaXMuX2V4cGVyaWVuY2UgKyBwb2ludHMgPj0gdGhpcy5nZXROZXh0TGV2ZWxFeHBlcmllbmNlKCkpIHtcbiAgICAgICAgdXNlZFBvaW50cyA9IHRoaXMuZ2V0TmV4dExldmVsRXhwZXJpZW5jZSgpIC0gdGhpcy5fZXhwZXJpZW5jZTtcbiAgICAgICAgcG9pbnRzIC09IHVzZWRQb2ludHM7XG4gICAgICAgIHRoaXMuX2V4cGVyaWVuY2UgKz0gdXNlZFBvaW50cztcbiAgICAgICAgdGhpcy5fbGV2ZWwrKztcbiAgICAgICAgbGV2ZWxzR2FpbmVkKys7XG4gICAgICAgIHRoaXMuX3N0YXRQb2ludHMgKz0gdGhpcy5fc3RhdFBvaW50c1BlckxldmVsO1xuICAgICAgICBzdGF0UG9pbnRzR2FpbmVkICs9IHRoaXMuX3N0YXRQb2ludHNQZXJMZXZlbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2V4cGVyaWVuY2UgKz0gcG9pbnRzO1xuICAgICAgICBwb2ludHMgPSAwO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAobGV2ZWxzR2FpbmVkID4gMCkge1xuICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLCBcIllvdSBhZHZhbmNlIHRvIGxldmVsICVkLlwiLCBbdGhpcy5fbGV2ZWxdKTtcbiAgICAgIHJldHVybiB0aGlzLnJhaXNlRXZlbnQoXCJvbkdhaW5MZXZlbFwiKTtcbiAgICB9XG4gIH0sXG4gIGxpc3RlbmVyczoge1xuICAgIG9uS2lsbDogZnVuY3Rpb24odmljdGltKSB7XG4gICAgICB2YXIgZXhwO1xuICAgICAgZXhwID0gdmljdGltLmdldE1heEhwKCkgKyB2aWN0aW0uZ2V0RGVmZW5zZVZhbHVlKCk7XG4gICAgICBpZiAodmljdGltLmhhc01peGluKFwiQXR0YWNrZXJcIikpIHtcbiAgICAgICAgZXhwICs9IHZpY3RpbS5nZXRBdHRhY2tWYWx1ZSgpO1xuICAgICAgfVxuICAgICAgaWYgKHZpY3RpbS5oYXNNaXhpbihcIkV4cGVyaWVuY2VHYWluZXJcIikpIHtcbiAgICAgICAgZXhwIC09ICh0aGlzLmdldExldmVsKCkgLSB2aWN0aW0uZ2V0TGV2ZWwoKSkgKiAzO1xuICAgICAgfVxuICAgICAgaWYgKGV4cCA+IDApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2l2ZUV4cGVyaWVuY2UoZXhwKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGRldGFpbHM6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAge1xuICAgICAgICAgIGtleTogXCJsZXZlbFwiLFxuICAgICAgICAgIHZhbHVlOiB0aGlzLmdldExldmVsKClcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICB9XG4gIH1cbn07XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5HYW1lLkVudGl0eU1peGlucy5Gb29kQ29uc3VtZXIgPSB7XG4gIG5hbWU6IFwiRm9vZENvbnN1bWVyXCIsXG4gIGluaXQ6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgdGhpcy5fbWF4RnVsbG5lc3MgPSB0ZW1wbGF0ZVtcIm1heEZ1bGxuZXNzXCJdIHx8IDEwMDA7XG4gICAgdGhpcy5fZnVsbG5lc3MgPSB0ZW1wbGF0ZVtcImZ1bGxuZXNzXCJdIHx8ICh0aGlzLl9tYXhGdWxsbmVzcyAvIDIpO1xuICAgIHJldHVybiB0aGlzLl9mdWxsbmVzc0RlcGxldGlvblJhdGUgPSB0ZW1wbGF0ZVtcImZ1bGxuZXNzRGVwbGV0aW9uUmF0ZVwiXSB8fCAxO1xuICB9LFxuICBhZGRUdXJuSHVuZ2VyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5tb2RpZnlGdWxsbmVzc0J5KC10aGlzLl9mdWxsbmVzc0RlcGxldGlvblJhdGUpO1xuICB9LFxuICBtb2RpZnlGdWxsbmVzc0J5OiBmdW5jdGlvbihwb2ludHMpIHtcbiAgICB0aGlzLl9mdWxsbmVzcyA9IHRoaXMuX2Z1bGxuZXNzICsgcG9pbnRzO1xuICAgIGlmICh0aGlzLl9mdWxsbmVzcyA8PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5raWxsKFwiWW91IGhhdmUgZGllZCBvZiBzdGFydmF0aW9uIVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuX2Z1bGxuZXNzID4gdGhpcy5fbWF4RnVsbG5lc3MpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMua2lsbChcIllvdSBjaG9rZSBhbmQgZGllIVwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGdldEh1bmdlclN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcGVyUGVyY2VudDtcbiAgICBwZXJQZXJjZW50ID0gdGhpcy5fbWF4RnVsbG5lc3MgLyAxMDA7XG4gICAgaWYgKHRoaXMuX2Z1bGxuZXNzIDw9IHBlclBlcmNlbnQgKiA1KSB7XG4gICAgICByZXR1cm4gXCJTdGFydmluZ1wiO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fZnVsbG5lc3MgPD0gcGVyUGVyY2VudCAqIDI1KSB7XG4gICAgICByZXR1cm4gXCJIdW5ncnlcIjtcbiAgICB9IGVsc2UgaWYgKHRoaXMuX2Z1bGxuZXNzID49IHBlclBlcmNlbnQgKiA5NSkge1xuICAgICAgcmV0dXJuIFwiT3ZlcnNhdGlhdGVkXCI7XG4gICAgfSBlbHNlIGlmICh0aGlzLl9mdWxsbmVzcyA+PSBwZXJQZXJjZW50ICogNzUpIHtcbiAgICAgIHJldHVybiBcIkZ1bGxcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwiTm90IEh1bmdyeVwiO1xuICAgIH1cbiAgfVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbkdhbWUuRW50aXR5TWl4aW5zLkZ1bmd1c0FjdG9yID0ge1xuICBuYW1lOiBcIkZ1bmd1c0FjdG9yXCIsXG4gIGdyb3VwTmFtZTogXCJBY3RvclwiLFxuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fZ3Jvd3Roc1JlbWFpbmluZyA9IDU7XG4gIH0sXG4gIGFjdDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVudGl0eSwgeE9mZnNldCwgeU9mZnNldDtcbiAgICBpZiAodGhpcy5fZ3Jvd3Roc1JlbWFpbmluZyA+IDApIHtcbiAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDw9IDAuMDIpIHtcbiAgICAgICAgeE9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMpIC0gMTtcbiAgICAgICAgeU9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMpIC0gMTtcbiAgICAgICAgaWYgKHhPZmZzZXQgIT09IDAgfHwgeU9mZnNldCAhPT0gMCkge1xuICAgICAgICAgIGlmICh0aGlzLmdldE1hcCgpLmlzRW1wdHlGbG9vcih0aGlzLmdldFgoKSArIHhPZmZzZXQsIHRoaXMuZ2V0WSgpICsgeU9mZnNldCwgdGhpcy5nZXRaKCkpKSB7XG4gICAgICAgICAgICBlbnRpdHkgPSBHYW1lLkVudGl0eVJlcG9zaXRvcnkuY3JlYXRlKFwiZnVuZ3VzXCIpO1xuICAgICAgICAgICAgZW50aXR5LnNldFBvc2l0aW9uKHRoaXMuZ2V0WCgpICsgeE9mZnNldCwgdGhpcy5nZXRZKCkgKyB5T2Zmc2V0LCB0aGlzLmdldFooKSk7XG4gICAgICAgICAgICB0aGlzLmdldE1hcCgpLmFkZEVudGl0eShlbnRpdHkpO1xuICAgICAgICAgICAgdGhpcy5fZ3Jvd3Roc1JlbWFpbmluZy0tO1xuICAgICAgICAgICAgcmV0dXJuIEdhbWUuc2VuZE1lc3NhZ2VOZWFyYnkodGhpcy5nZXRNYXAoKSwgZW50aXR5LmdldFgoKSwgZW50aXR5LmdldFkoKSwgZW50aXR5LmdldFooKSwgXCJUaGUgZnVuZ3VzIGlzIHNwcmVhZGluZyFcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuR2FtZS5FbnRpdHlNaXhpbnMuR2lhbnRab21iaWVBY3RvciA9IEdhbWUubWVyZ2UoR2FtZS5FbnRpdHlNaXhpbnMuVGFza0FjdG9yLCB7XG4gIGluaXQ6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgR2FtZS5FbnRpdHlNaXhpbnMuVGFza0FjdG9yLmluaXQuY2FsbCh0aGlzLCBHYW1lLm1lcmdlKHRlbXBsYXRlLCB7XG4gICAgICB0YXNrczogW1wiZ3Jvd0FybVwiLCBcInNwYXduU2xpbWVcIiwgXCJodW50XCIsIFwid2FuZGVyXCJdXG4gICAgfSkpO1xuICAgIHJldHVybiB0aGlzLl9oYXNHcm93bkFybSA9IGZhbHNlO1xuICB9LFxuICBjYW5Eb1Rhc2s6IGZ1bmN0aW9uKHRhc2spIHtcbiAgICBpZiAodGFzayA9PT0gXCJncm93QXJtXCIpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldEhwKCkgPD0gMjAgJiYgIXRoaXMuX2hhc0dyb3duQXJtO1xuICAgIH0gZWxzZSBpZiAodGFzayA9PT0gXCJzcGF3blNsaW1lXCIpIHtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDApIDw9IDEwO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gR2FtZS5FbnRpdHlNaXhpbnMuVGFza0FjdG9yLmNhbkRvVGFzay5jYWxsKHRoaXMsIHRhc2spO1xuICAgIH1cbiAgfSxcbiAgZ3Jvd0FybTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5faGFzR3Jvd25Bcm0gPSB0cnVlO1xuICAgIHRoaXMuaW5jcmVhc2VBdHRhY2tWYWx1ZSg1KTtcbiAgICByZXR1cm4gR2FtZS5zZW5kTWVzc2FnZU5lYXJieSh0aGlzLmdldE1hcCgpLCB0aGlzLmdldFgoKSwgdGhpcy5nZXRZKCksIHRoaXMuZ2V0WigpLCBcIkFuIGV4dHJhIGFybSBhcHBlYXJzIG9uIHRoZSBnaWFudCB6b21iaWUhXCIpO1xuICB9LFxuICBzcGF3blNsaW1lOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2xpbWUsIHhPZmZzZXQsIHlPZmZzZXQ7XG4gICAgeE9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMpIC0gMTtcbiAgICB5T2Zmc2V0ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMykgLSAxO1xuICAgIGlmICghdGhpcy5nZXRNYXAoKS5pc0VtcHR5Rmxvb3IodGhpcy5nZXRYKCkgKyB4T2Zmc2V0LCB0aGlzLmdldFkoKSArIHlPZmZzZXQsIHRoaXMuZ2V0WigpKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzbGltZSA9IEdhbWUuRW50aXR5UmVwb3NpdG9yeS5jcmVhdGUoXCJzbGltZVwiKTtcbiAgICBzbGltZS5zZXRYKHRoaXMuZ2V0WCgpICsgeE9mZnNldCk7XG4gICAgc2xpbWUuc2V0WSh0aGlzLmdldFkoKSArIHlPZmZzZXQpO1xuICAgIHNsaW1lLnNldFoodGhpcy5nZXRaKCkpO1xuICAgIHJldHVybiB0aGlzLmdldE1hcCgpLmFkZEVudGl0eShzbGltZSk7XG4gIH0sXG4gIGxpc3RlbmVyczoge1xuICAgIG9uRGVhdGg6IGZ1bmN0aW9uKGF0dGFja2VyKSB7XG4gICAgICByZXR1cm4gR2FtZS5zd2l0Y2hTY3JlZW4oR2FtZS5TY3JlZW4ud2luU2NyZWVuKTtcbiAgICB9XG4gIH1cbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuR2FtZS5FbnRpdHlNaXhpbnMuSW52ZW50b3J5SG9sZGVyID0ge1xuICBuYW1lOiBcIkludmVudG9yeUhvbGRlclwiLFxuICBpbml0OiBmdW5jdGlvbih0ZW1wbGF0ZSkge1xuICAgIHZhciBpbnZlbnRvcnlTbG90cztcbiAgICBpbnZlbnRvcnlTbG90cyA9IHRlbXBsYXRlW1wiaW52ZW50b3J5U2xvdHNcIl0gfHwgMTA7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zID0gbmV3IEFycmF5KGludmVudG9yeVNsb3RzKTtcbiAgfSxcbiAgZ2V0SXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9pdGVtcztcbiAgfSxcbiAgZ2V0SXRlbTogZnVuY3Rpb24oaSkge1xuICAgIHJldHVybiB0aGlzLl9pdGVtc1tpXTtcbiAgfSxcbiAgYWRkSXRlbTogZnVuY3Rpb24oaXRlbSkge1xuICAgIHZhciBpO1xuICAgIGkgPSAwO1xuICAgIHdoaWxlIChpIDwgdGhpcy5faXRlbXMubGVuZ3RoKSB7XG4gICAgICBpZiAoIXRoaXMuX2l0ZW1zW2ldKSB7XG4gICAgICAgIHRoaXMuX2l0ZW1zW2ldID0gaXRlbTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBpKys7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgcmVtb3ZlSXRlbTogZnVuY3Rpb24oaSkge1xuICAgIGlmICh0aGlzLl9pdGVtc1tpXSAmJiB0aGlzLmhhc01peGluKEdhbWUuRW50aXR5TWl4aW5zLkVxdWlwcGVyKSkge1xuICAgICAgdGhpcy51bmVxdWlwKHRoaXMuX2l0ZW1zW2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zW2ldID0gbnVsbDtcbiAgfSxcbiAgY2FuQWRkSXRlbTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGk7XG4gICAgaSA9IDA7XG4gICAgd2hpbGUgKGkgPCB0aGlzLl9pdGVtcy5sZW5ndGgpIHtcbiAgICAgIGlmICghdGhpcy5faXRlbXNbaV0pIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBpKys7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgcGlja3VwSXRlbXM6IGZ1bmN0aW9uKGluZGljZXMpIHtcbiAgICB2YXIgYWRkZWQsIGksIG1hcEl0ZW1zO1xuICAgIG1hcEl0ZW1zID0gdGhpcy5fbWFwLmdldEl0ZW1zQXQodGhpcy5nZXRYKCksIHRoaXMuZ2V0WSgpLCB0aGlzLmdldFooKSk7XG4gICAgYWRkZWQgPSAwO1xuICAgIGkgPSAwO1xuICAgIHdoaWxlIChpIDwgaW5kaWNlcy5sZW5ndGgpIHtcbiAgICAgIGlmICh0aGlzLmFkZEl0ZW0obWFwSXRlbXNbaW5kaWNlc1tpXSAtIGFkZGVkXSkpIHtcbiAgICAgICAgbWFwSXRlbXMuc3BsaWNlKGluZGljZXNbaV0gLSBhZGRlZCwgMSk7XG4gICAgICAgIGFkZGVkKys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGkrKztcbiAgICB9XG4gICAgdGhpcy5fbWFwLnNldEl0ZW1zQXQodGhpcy5nZXRYKCksIHRoaXMuZ2V0WSgpLCB0aGlzLmdldFooKSwgbWFwSXRlbXMpO1xuICAgIHJldHVybiBhZGRlZCA9PT0gaW5kaWNlcy5sZW5ndGg7XG4gIH0sXG4gIGRyb3BJdGVtOiBmdW5jdGlvbihpKSB7XG4gICAgaWYgKHRoaXMuX2l0ZW1zW2ldKSB7XG4gICAgICBpZiAodGhpcy5fbWFwKSB7XG4gICAgICAgIHRoaXMuX21hcC5hZGRJdGVtKHRoaXMuZ2V0WCgpLCB0aGlzLmdldFkoKSwgdGhpcy5nZXRaKCksIHRoaXMuX2l0ZW1zW2ldKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLnJlbW92ZUl0ZW0oaSk7XG4gICAgfVxuICB9XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuR2FtZS5FbnRpdHlNaXhpbnMuTWVzc2FnZVJlY2lwaWVudCA9IHtcbiAgbmFtZTogXCJNZXNzYWdlUmVjaXBpZW50XCIsXG4gIGluaXQ6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VzID0gW107XG4gIH0sXG4gIHJlY2VpdmVNZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XG4gIH0sXG4gIGdldE1lc3NhZ2VzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVzc2FnZXM7XG4gIH0sXG4gIGNsZWFyTWVzc2FnZXM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9tZXNzYWdlcyA9IFtdO1xuICB9XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuR2FtZS5FbnRpdHlNaXhpbnMuUGxheWVyQWN0b3IgPSB7XG4gIG5hbWU6IFwiUGxheWVyQWN0b3JcIixcbiAgZ3JvdXBOYW1lOiBcIkFjdG9yXCIsXG4gIGFjdDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2FjdGluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl9hY3RpbmcgPSB0cnVlO1xuICAgIHRoaXMuYWRkVHVybkh1bmdlcigpO1xuICAgIGlmICghdGhpcy5pc0FsaXZlKCkpIHtcbiAgICAgIEdhbWUuU2NyZWVuLnBsYXlTY3JlZW4uc2V0R2FtZUVuZGVkKHRydWUpO1xuICAgICAgR2FtZS5zZW5kTWVzc2FnZSh0aGlzLCBcIlByZXNzIFtFbnRlcl0gdG8gY29udGludWUhXCIpO1xuICAgIH1cbiAgICBHYW1lLnJlZnJlc2goKTtcbiAgICB0aGlzLmdldE1hcCgpLmdldEVuZ2luZSgpLmxvY2soKTtcbiAgICB0aGlzLmNsZWFyTWVzc2FnZXMoKTtcbiAgICB0aGlzLl9hY3RpbmcgPSBmYWxzZTtcbiAgfVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbkdhbWUuRW50aXR5TWl4aW5zLlBsYXllclN0YXRHYWluZXIgPSB7XG4gIG5hbWU6IFwiUGxheWVyU3RhdEdhaW5lclwiLFxuICBncm91cE5hbWU6IFwiU3RhdEdhaW5lclwiLFxuICBsaXN0ZW5lcnM6IHtcbiAgICBvbkdhaW5MZXZlbDogZnVuY3Rpb24oKSB7XG4gICAgICBHYW1lLlNjcmVlbi5nYWluU3RhdFNjcmVlbi5zZXR1cCh0aGlzKTtcbiAgICAgIHJldHVybiBHYW1lLlNjcmVlbi5wbGF5U2NyZWVuLnNldFN1YlNjcmVlbihHYW1lLlNjcmVlbi5nYWluU3RhdFNjcmVlbik7XG4gICAgfVxuICB9XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuR2FtZS5FbnRpdHlNaXhpbnMuUmFuZG9tU3RhdEdhaW5lciA9IHtcbiAgbmFtZTogXCJSYW5kb21TdGF0R2FpbmVyXCIsXG4gIGdyb3VwTmFtZTogXCJTdGF0R2FpbmVyXCIsXG4gIGxpc3RlbmVyczoge1xuICAgIG9uR2FpbkxldmVsOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzdGF0T3B0aW9ucywgX3Jlc3VsdHM7XG4gICAgICBzdGF0T3B0aW9ucyA9IHRoaXMuZ2V0U3RhdE9wdGlvbnMoKTtcbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICB3aGlsZSAodGhpcy5nZXRTdGF0UG9pbnRzKCkgPiAwKSB7XG4gICAgICAgIHN0YXRPcHRpb25zLnJhbmRvbSgpWzFdLmNhbGwodGhpcyk7XG4gICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5zZXRTdGF0UG9pbnRzKHRoaXMuZ2V0U3RhdFBvaW50cygpIC0gMSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgIH1cbiAgfVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbkdhbWUuRW50aXR5TWl4aW5zLlNpZ2h0ID0ge1xuICBuYW1lOiBcIlNpZ2h0XCIsXG4gIGdyb3VwTmFtZTogXCJTaWdodFwiLFxuICBpbml0OiBmdW5jdGlvbih0ZW1wbGF0ZSkge1xuICAgIHJldHVybiB0aGlzLl9zaWdodFJhZGl1cyA9IHRlbXBsYXRlW1wic2lnaHRSYWRpdXNcIl0gfHwgNTtcbiAgfSxcbiAgZ2V0U2lnaHRSYWRpdXM6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9zaWdodFJhZGl1cztcbiAgfSxcbiAgaW5jcmVhc2VTaWdodFJhZGl1czogZnVuY3Rpb24odmFsdWUpIHtcbiAgICB2YWx1ZSA9IHZhbHVlIHx8IDE7XG4gICAgdGhpcy5fc2lnaHRSYWRpdXMgKz0gdmFsdWU7XG4gICAgcmV0dXJuIEdhbWUuc2VuZE1lc3NhZ2UodGhpcywgXCJZb3UgYXJlIG1vcmUgYXdhcmUgb2YgeW91ciBzdXJyb3VuZGluZ3MhXCIpO1xuICB9LFxuICBjYW5TZWU6IGZ1bmN0aW9uKGVudGl0eSkge1xuICAgIHZhciBmb3VuZCwgb3RoZXJYLCBvdGhlclk7XG4gICAgaWYgKCFlbnRpdHkgfHwgdGhpcy5fbWFwICE9PSBlbnRpdHkuZ2V0TWFwKCkgfHwgdGhpcy5feiAhPT0gZW50aXR5LmdldFooKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBvdGhlclggPSBlbnRpdHkuZ2V0WCgpO1xuICAgIG90aGVyWSA9IGVudGl0eS5nZXRZKCk7XG4gICAgaWYgKChvdGhlclggLSB0aGlzLl94KSAqIChvdGhlclggLSB0aGlzLl94KSArIChvdGhlclkgLSB0aGlzLl95KSAqIChvdGhlclkgLSB0aGlzLl95KSA+IHRoaXMuX3NpZ2h0UmFkaXVzICogdGhpcy5fc2lnaHRSYWRpdXMpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm91bmQgPSBmYWxzZTtcbiAgICB0aGlzLmdldE1hcCgpLmdldEZvdih0aGlzLmdldFooKSkuY29tcHV0ZSh0aGlzLmdldFgoKSwgdGhpcy5nZXRZKCksIHRoaXMuZ2V0U2lnaHRSYWRpdXMoKSwgZnVuY3Rpb24oeCwgeSwgcmFkaXVzLCB2aXNpYmlsaXR5KSB7XG4gICAgICBpZiAoeCA9PT0gb3RoZXJYICYmIHkgPT09IG90aGVyWSkge1xuICAgICAgICByZXR1cm4gZm91bmQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBmb3VuZDtcbiAgfVxufTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBHYW1lO1xuXG5HYW1lID0gcmVxdWlyZSgnLi8uLi8uLi9nYW1lJyk7XG5cbkdhbWUuRW50aXR5TWl4aW5zLlRhc2tBY3RvciA9IHtcbiAgbmFtZTogXCJUYXNrQWN0b3JcIixcbiAgZ3JvdXBOYW1lOiBcIkFjdG9yXCIsXG4gIGluaXQ6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMuX3Rhc2tzID0gdGVtcGxhdGVbXCJ0YXNrc1wiXSB8fCBbXCJ3YW5kZXJcIl07XG4gIH0sXG4gIGFjdDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGk7XG4gICAgaSA9IDA7XG4gICAgd2hpbGUgKGkgPCB0aGlzLl90YXNrcy5sZW5ndGgpIHtcbiAgICAgIGlmICh0aGlzLmNhbkRvVGFzayh0aGlzLl90YXNrc1tpXSkpIHtcbiAgICAgICAgdGhpc1t0aGlzLl90YXNrc1tpXV0oKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaSsrO1xuICAgIH1cbiAgfSxcbiAgY2FuRG9UYXNrOiBmdW5jdGlvbih0YXNrKSB7XG4gICAgaWYgKHRhc2sgPT09IFwiaHVudFwiKSB7XG4gICAgICByZXR1cm4gdGhpcy5oYXNNaXhpbihcIlNpZ2h0XCIpICYmIHRoaXMuY2FuU2VlKHRoaXMuZ2V0TWFwKCkuZ2V0UGxheWVyKCkpO1xuICAgIH0gZWxzZSBpZiAodGFzayA9PT0gXCJ3YW5kZXJcIikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRyaWVkIHRvIHBlcmZvcm0gdW5kZWZpbmVkIHRhc2sgXCIgKyB0YXNrKTtcbiAgICB9XG4gIH0sXG4gIGh1bnQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb3VudCwgb2Zmc2V0cywgcGF0aCwgcGxheWVyLCBzb3VyY2UsIHo7XG4gICAgcGxheWVyID0gdGhpcy5nZXRNYXAoKS5nZXRQbGF5ZXIoKTtcbiAgICBvZmZzZXRzID0gTWF0aC5hYnMocGxheWVyLmdldFgoKSAtIHRoaXMuZ2V0WCgpKSArIE1hdGguYWJzKHBsYXllci5nZXRZKCkgLSB0aGlzLmdldFkoKSk7XG4gICAgaWYgKG9mZnNldHMgPT09IDEpIHtcbiAgICAgIGlmICh0aGlzLmhhc01peGluKFwiQXR0YWNrZXJcIikpIHtcbiAgICAgICAgdGhpcy5hdHRhY2socGxheWVyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBzb3VyY2UgPSB0aGlzO1xuICAgIHogPSBzb3VyY2UuZ2V0WigpO1xuICAgIHBhdGggPSBuZXcgUk9ULlBhdGguQVN0YXIocGxheWVyLmdldFgoKSwgcGxheWVyLmdldFkoKSwgZnVuY3Rpb24oeCwgeSkge1xuICAgICAgdmFyIGVudGl0eTtcbiAgICAgIGVudGl0eSA9IHNvdXJjZS5nZXRNYXAoKS5nZXRFbnRpdHlBdCh4LCB5LCB6KTtcbiAgICAgIGlmIChlbnRpdHkgJiYgZW50aXR5ICE9PSBwbGF5ZXIgJiYgZW50aXR5ICE9PSBzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNvdXJjZS5nZXRNYXAoKS5nZXRUaWxlKHgsIHksIHopLmlzV2Fsa2FibGUoKTtcbiAgICB9LCB7XG4gICAgICB0b3BvbG9neTogNFxuICAgIH0pO1xuICAgIGNvdW50ID0gMDtcbiAgICByZXR1cm4gcGF0aC5jb21wdXRlKHNvdXJjZS5nZXRYKCksIHNvdXJjZS5nZXRZKCksIGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgIGlmIChjb3VudCA9PT0gMSkge1xuICAgICAgICBzb3VyY2UudHJ5TW92ZSh4LCB5LCB6KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb3VudCsrO1xuICAgIH0pO1xuICB9LFxuICB3YW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtb3ZlT2Zmc2V0O1xuICAgIG1vdmVPZmZzZXQgPSAoTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKSA9PT0gMSA/IDEgOiAtMSk7XG4gICAgaWYgKE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSkgPT09IDEpIHtcbiAgICAgIHJldHVybiB0aGlzLnRyeU1vdmUodGhpcy5nZXRYKCkgKyBtb3ZlT2Zmc2V0LCB0aGlzLmdldFkoKSwgdGhpcy5nZXRaKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy50cnlNb3ZlKHRoaXMuZ2V0WCgpLCB0aGlzLmdldFkoKSArIG1vdmVPZmZzZXQsIHRoaXMuZ2V0WigpKTtcbiAgICB9XG4gIH1cbn07XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5HYW1lLkl0ZW1NaXhpbnMuRWRpYmxlID0ge1xuICBuYW1lOiBcIkVkaWJsZVwiLFxuICBpbml0OiBmdW5jdGlvbih0ZW1wbGF0ZSkge1xuICAgIHRoaXMuX2Zvb2RWYWx1ZSA9IHRlbXBsYXRlW1wiZm9vZFZhbHVlXCJdIHx8IDU7XG4gICAgdGhpcy5fbWF4Q29uc3VtcHRpb25zID0gdGVtcGxhdGVbXCJjb25zdW1wdGlvbnNcIl0gfHwgMTtcbiAgICByZXR1cm4gdGhpcy5fcmVtYWluaW5nQ29uc3VtcHRpb25zID0gdGhpcy5fbWF4Q29uc3VtcHRpb25zO1xuICB9LFxuICBlYXQ6IGZ1bmN0aW9uKGVudGl0eSkge1xuICAgIGlmIChlbnRpdHkuaGFzTWl4aW4oXCJGb29kQ29uc3VtZXJcIikpIHtcbiAgICAgIGlmICh0aGlzLmhhc1JlbWFpbmluZ0NvbnN1bXB0aW9ucygpKSB7XG4gICAgICAgIGVudGl0eS5tb2RpZnlGdWxsbmVzc0J5KHRoaXMuX2Zvb2RWYWx1ZSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZW1haW5pbmdDb25zdW1wdGlvbnMtLTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGhhc1JlbWFpbmluZ0NvbnN1bXB0aW9uczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlbWFpbmluZ0NvbnN1bXB0aW9ucyA+IDA7XG4gIH0sXG4gIGRlc2NyaWJlOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5fbWF4Q29uc3VtcHRpb25zICE9PSB0aGlzLl9yZW1haW5pbmdDb25zdW1wdGlvbnMpIHtcbiAgICAgIHJldHVybiBcInBhcnRseSBlYXRlbiBcIiArIEdhbWUuSXRlbS5wcm90b3R5cGUuZGVzY3JpYmUuY2FsbCh0aGlzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuX25hbWU7XG4gICAgfVxuICB9LFxuICBsaXN0ZW5lcnM6IHtcbiAgICBkZXRhaWxzOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6IFwiZm9vZFwiLFxuICAgICAgICAgIHZhbHVlOiB0aGlzLl9mb29kVmFsdWVcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICB9XG4gIH1cbn07XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5HYW1lLkl0ZW1NaXhpbnMuRXF1aXBwYWJsZSA9IHtcbiAgbmFtZTogXCJFcXVpcHBhYmxlXCIsXG4gIGluaXQ6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgdGhpcy5fYXR0YWNrVmFsdWUgPSB0ZW1wbGF0ZVtcImF0dGFja1ZhbHVlXCJdIHx8IDA7XG4gICAgdGhpcy5fZGVmZW5zZVZhbHVlID0gdGVtcGxhdGVbXCJkZWZlbnNlVmFsdWVcIl0gfHwgMDtcbiAgICB0aGlzLl93aWVsZGFibGUgPSB0ZW1wbGF0ZVtcIndpZWxkYWJsZVwiXSB8fCBmYWxzZTtcbiAgICByZXR1cm4gdGhpcy5fd2VhcmFibGUgPSB0ZW1wbGF0ZVtcIndlYXJhYmxlXCJdIHx8IGZhbHNlO1xuICB9LFxuICBnZXRBdHRhY2tWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2F0dGFja1ZhbHVlO1xuICB9LFxuICBnZXREZWZlbnNlVmFsdWU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9kZWZlbnNlVmFsdWU7XG4gIH0sXG4gIGlzV2llbGRhYmxlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fd2llbGRhYmxlO1xuICB9LFxuICBpc1dlYXJhYmxlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fd2VhcmFibGU7XG4gIH0sXG4gIGxpc3RlbmVyczoge1xuICAgIGRldGFpbHM6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHJlc3VsdHM7XG4gICAgICByZXN1bHRzID0gW107XG4gICAgICBpZiAodGhpcy5fd2llbGRhYmxlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAga2V5OiBcImF0dGFja1wiLFxuICAgICAgICAgIHZhbHVlOiB0aGlzLmdldEF0dGFja1ZhbHVlKClcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5fd2VhcmFibGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwiZGVmZW5zZVwiLFxuICAgICAgICAgIHZhbHVlOiB0aGlzLmdldERlZmVuc2VWYWx1ZSgpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuICB9XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWUsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5HYW1lLk1hcC5Cb3NzQ2F2ZXJuID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoQm9zc0NhdmVybiwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBCb3NzQ2F2ZXJuKCkge1xuICAgIEJvc3NDYXZlcm4uX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgdGhpcy5fZ2VuZXJhdGVUaWxlcyg4MCwgMjQpKTtcbiAgICB0aGlzLmFkZEVudGl0eUF0UmFuZG9tUG9zaXRpb24oR2FtZS5FbnRpdHlSZXBvc2l0b3J5LmNyZWF0ZShcImdpYW50IHpvbWJpZVwiKSwgMCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgQm9zc0NhdmVybi5wcm90b3R5cGUuX2ZpbGxDaXJjbGUgPSBmdW5jdGlvbih0aWxlcywgY2VudGVyWCwgY2VudGVyWSwgcmFkaXVzLCB0aWxlKSB7XG4gICAgdmFyIGksIHJhZGl1c0Vycm9yLCB4LCB4Q2hhbmdlLCB5LCB5Q2hhbmdlO1xuICAgIHggPSByYWRpdXM7XG4gICAgeSA9IDA7XG4gICAgeENoYW5nZSA9IDEgLSAocmFkaXVzIDw8IDEpO1xuICAgIHlDaGFuZ2UgPSAwO1xuICAgIHJhZGl1c0Vycm9yID0gMDtcbiAgICB3aGlsZSAoeCA+PSB5KSB7XG4gICAgICBpID0gY2VudGVyWCAtIHg7XG4gICAgICB3aGlsZSAoaSA8PSBjZW50ZXJYICsgeCkge1xuICAgICAgICB0aWxlc1tpXVtjZW50ZXJZICsgeV0gPSB0aWxlO1xuICAgICAgICB0aWxlc1tpXVtjZW50ZXJZIC0geV0gPSB0aWxlO1xuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgICBpID0gY2VudGVyWCAtIHk7XG4gICAgICB3aGlsZSAoaSA8PSBjZW50ZXJYICsgeSkge1xuICAgICAgICB0aWxlc1tpXVtjZW50ZXJZICsgeF0gPSB0aWxlO1xuICAgICAgICB0aWxlc1tpXVtjZW50ZXJZIC0geF0gPSB0aWxlO1xuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgICB5Kys7XG4gICAgICByYWRpdXNFcnJvciArPSB5Q2hhbmdlO1xuICAgICAgeUNoYW5nZSArPSAyO1xuICAgICAgaWYgKCgocmFkaXVzRXJyb3IgPDwgMSkgKyB4Q2hhbmdlKSA+IDApIHtcbiAgICAgICAgeC0tO1xuICAgICAgICByYWRpdXNFcnJvciArPSB4Q2hhbmdlO1xuICAgICAgICB4Q2hhbmdlICs9IDI7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEJvc3NDYXZlcm4ucHJvdG90eXBlLl9nZW5lcmF0ZVRpbGVzID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCkge1xuICAgIHZhciBjZW50ZXJYLCBjZW50ZXJZLCBpLCBsYWtlcywgbWF4UmFkaXVzLCByYWRpdXMsIHRpbGVzLCB4LCB5O1xuICAgIHRpbGVzID0gbmV3IEFycmF5KHdpZHRoKTtcbiAgICB4ID0gMDtcbiAgICB3aGlsZSAoeCA8IHdpZHRoKSB7XG4gICAgICB0aWxlc1t4XSA9IG5ldyBBcnJheShoZWlnaHQpO1xuICAgICAgeSA9IDA7XG4gICAgICB3aGlsZSAoeSA8IGhlaWdodCkge1xuICAgICAgICB0aWxlc1t4XVt5XSA9IEdhbWUuVGlsZS53YWxsVGlsZTtcbiAgICAgICAgeSsrO1xuICAgICAgfVxuICAgICAgeCsrO1xuICAgIH1cbiAgICByYWRpdXMgPSAoTWF0aC5taW4od2lkdGgsIGhlaWdodCkgLSAyKSAvIDI7XG4gICAgdGhpcy5fZmlsbENpcmNsZSh0aWxlcywgd2lkdGggLyAyLCBoZWlnaHQgLyAyLCByYWRpdXMsIEdhbWUuVGlsZS5mbG9vclRpbGUpO1xuICAgIGxha2VzID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMykgKyAzO1xuICAgIG1heFJhZGl1cyA9IDI7XG4gICAgaSA9IDA7XG4gICAgd2hpbGUgKGkgPCBsYWtlcykge1xuICAgICAgY2VudGVyWCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh3aWR0aCAtIChtYXhSYWRpdXMgKiAyKSkpO1xuICAgICAgY2VudGVyWSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChoZWlnaHQgLSAobWF4UmFkaXVzICogMikpKTtcbiAgICAgIGNlbnRlclggKz0gbWF4UmFkaXVzO1xuICAgICAgY2VudGVyWSArPSBtYXhSYWRpdXM7XG4gICAgICByYWRpdXMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhSYWRpdXMpICsgMTtcbiAgICAgIHRoaXMuX2ZpbGxDaXJjbGUodGlsZXMsIGNlbnRlclgsIGNlbnRlclksIHJhZGl1cywgR2FtZS5UaWxlLndhdGVyVGlsZSk7XG4gICAgICBpKys7XG4gICAgfVxuICAgIHJldHVybiBbdGlsZXNdO1xuICB9O1xuXG4gIEJvc3NDYXZlcm4ucHJvdG90eXBlLmFkZEVudGl0eSA9IGZ1bmN0aW9uKGVudGl0eSkge1xuICAgIHZhciBwb3NpdGlvbjtcbiAgICBCb3NzQ2F2ZXJuLl9fc3VwZXJfXy5hZGRFbnRpdHkuY2FsbCh0aGlzLCBlbnRpdHkpO1xuICAgIGlmICh0aGlzLmdldFBsYXllcigpID09PSBlbnRpdHkpIHtcbiAgICAgIHBvc2l0aW9uID0gdGhpcy5nZXRSYW5kb21GbG9vclBvc2l0aW9uKDApO1xuICAgICAgZW50aXR5LnNldFBvc2l0aW9uKHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIDApO1xuICAgICAgdGhpcy5nZXRFbmdpbmUoKS5zdGFydCgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQm9zc0NhdmVybjtcblxufSkoR2FtZS5NYXApO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWUsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5HYW1lLk1hcC5DYXZlID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoQ2F2ZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBDYXZlKHRpbGVzLCBwbGF5ZXIpIHtcbiAgICB2YXIgZW50aXR5LCBob2xlUG9zaXRpb24sIGksIGxldmVsLCB0ZW1wbGF0ZXMsIHo7XG4gICAgQ2F2ZS5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCB0aWxlcyk7XG4gICAgdGhpcy5hZGRFbnRpdHlBdFJhbmRvbVBvc2l0aW9uKHBsYXllciwgMCk7XG4gICAgeiA9IDA7XG4gICAgd2hpbGUgKHogPCB0aGlzLl9kZXB0aCkge1xuICAgICAgaSA9IDA7XG4gICAgICB3aGlsZSAoaSA8IDE1KSB7XG4gICAgICAgIGVudGl0eSA9IEdhbWUuRW50aXR5UmVwb3NpdG9yeS5jcmVhdGVSYW5kb20oKTtcbiAgICAgICAgdGhpcy5hZGRFbnRpdHlBdFJhbmRvbVBvc2l0aW9uKGVudGl0eSwgeik7XG4gICAgICAgIGlmIChlbnRpdHkuaGFzTWl4aW4oXCJFeHBlcmllbmNlR2FpbmVyXCIpKSB7XG4gICAgICAgICAgbGV2ZWwgPSAwO1xuICAgICAgICAgIHdoaWxlIChsZXZlbCA8IHopIHtcbiAgICAgICAgICAgIGVudGl0eS5naXZlRXhwZXJpZW5jZShlbnRpdHkuZ2V0TmV4dExldmVsRXhwZXJpZW5jZSgpIC0gZW50aXR5LmdldEV4cGVyaWVuY2UoKSk7XG4gICAgICAgICAgICBsZXZlbCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgICBpID0gMDtcbiAgICAgIHdoaWxlIChpIDwgMTUpIHtcbiAgICAgICAgdGhpcy5hZGRJdGVtQXRSYW5kb21Qb3NpdGlvbihHYW1lLkl0ZW1SZXBvc2l0b3J5LmNyZWF0ZVJhbmRvbSgpLCB6KTtcbiAgICAgICAgaSsrO1xuICAgICAgfVxuICAgICAgeisrO1xuICAgIH1cbiAgICB0ZW1wbGF0ZXMgPSBbXCJkYWdnZXJcIiwgXCJzd29yZFwiLCBcInN0YWZmXCIsIFwidHVuaWNcIiwgXCJjaGFpbm1haWxcIiwgXCJwbGF0ZW1haWxcIl07XG4gICAgaSA9IDA7XG4gICAgd2hpbGUgKGkgPCB0ZW1wbGF0ZXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmFkZEl0ZW1BdFJhbmRvbVBvc2l0aW9uKEdhbWUuSXRlbVJlcG9zaXRvcnkuY3JlYXRlKHRlbXBsYXRlc1tpXSksIE1hdGguZmxvb3IodGhpcy5fZGVwdGggKiBNYXRoLnJhbmRvbSgpKSk7XG4gICAgICBpKys7XG4gICAgfVxuICAgIGhvbGVQb3NpdGlvbiA9IHRoaXMuZ2V0UmFuZG9tRmxvb3JQb3NpdGlvbih0aGlzLl9kZXB0aCAtIDEpO1xuICAgIHRoaXMuX3RpbGVzW3RoaXMuX2RlcHRoIC0gMV1baG9sZVBvc2l0aW9uLnhdW2hvbGVQb3NpdGlvbi55XSA9IEdhbWUuVGlsZS5ob2xlVG9DYXZlcm5UaWxlO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHJldHVybiBDYXZlO1xuXG59KShHYW1lLk1hcCk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgR2FtZTtcblxuR2FtZSA9IHJlcXVpcmUoJy4vLi4vLi4vZ2FtZScpO1xuXG5pZiAoR2FtZS5TY3JlZW4gPT0gbnVsbCkge1xuICBHYW1lLlNjcmVlbiA9IHt9O1xufVxuXG5HYW1lLlNjcmVlbi5JdGVtTGlzdFNjcmVlbiA9IChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gSXRlbUxpc3RTY3JlZW4odGVtcGxhdGUpIHtcbiAgICB0aGlzLl9jYXB0aW9uID0gdGVtcGxhdGVbXCJjYXB0aW9uXCJdO1xuICAgIHRoaXMuX29rRnVuY3Rpb24gPSB0ZW1wbGF0ZVtcIm9rXCJdO1xuICAgIHRoaXMuX2lzQWNjZXB0YWJsZUZ1bmN0aW9uID0gdGVtcGxhdGVbXCJpc0FjY2VwdGFibGVcIl0gfHwgZnVuY3Rpb24oeCkge1xuICAgICAgcmV0dXJuIHg7XG4gICAgfTtcbiAgICB0aGlzLl9jYW5TZWxlY3RJdGVtID0gdGVtcGxhdGVbXCJjYW5TZWxlY3RcIl07XG4gICAgdGhpcy5fY2FuU2VsZWN0TXVsdGlwbGVJdGVtcyA9IHRlbXBsYXRlW1wiY2FuU2VsZWN0TXVsdGlwbGVJdGVtc1wiXTtcbiAgICB0aGlzLl9oYXNOb0l0ZW1PcHRpb24gPSB0ZW1wbGF0ZVtcImhhc05vSXRlbU9wdGlvblwiXTtcbiAgfVxuXG4gIEl0ZW1MaXN0U2NyZWVuLnByb3RvdHlwZS5zZXR1cCA9IGZ1bmN0aW9uKHBsYXllciwgaXRlbXMpIHtcbiAgICB2YXIgY291bnQsIHRoYXQ7XG4gICAgdGhpcy5fcGxheWVyID0gcGxheWVyO1xuICAgIGNvdW50ID0gMDtcbiAgICB0aGF0ID0gdGhpcztcbiAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICBpZiAodGhhdC5faXNBY2NlcHRhYmxlRnVuY3Rpb24oaXRlbSkpIHtcbiAgICAgICAgY291bnQrKztcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLl9zZWxlY3RlZEluZGljZXMgPSB7fTtcbiAgICByZXR1cm4gY291bnQ7XG4gIH07XG5cbiAgSXRlbUxpc3RTY3JlZW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKGRpc3BsYXkpIHtcbiAgICB2YXIgaSwgbGV0dGVyLCBsZXR0ZXJzLCByb3csIHNlbGVjdGlvblN0YXRlLCBzdWZmaXgsIF9yZXN1bHRzO1xuICAgIGxldHRlcnMgPSBcImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6XCI7XG4gICAgZGlzcGxheS5kcmF3VGV4dCgwLCAwLCB0aGlzLl9jYXB0aW9uKTtcbiAgICBpZiAodGhpcy5faGFzTm9JdGVtT3B0aW9uKSB7XG4gICAgICBkaXNwbGF5LmRyYXdUZXh0KDAsIDEsIFwiMCAtIG5vIGl0ZW1cIik7XG4gICAgfVxuICAgIHJvdyA9IDA7XG4gICAgaSA9IDA7XG4gICAgX3Jlc3VsdHMgPSBbXTtcbiAgICB3aGlsZSAoaSA8IHRoaXMuX2l0ZW1zLmxlbmd0aCkge1xuICAgICAgaWYgKHRoaXMuX2l0ZW1zW2ldKSB7XG4gICAgICAgIGxldHRlciA9IGxldHRlcnMuc3Vic3RyaW5nKGksIGkgKyAxKTtcbiAgICAgICAgc2VsZWN0aW9uU3RhdGUgPSAodGhpcy5fY2FuU2VsZWN0SXRlbSAmJiB0aGlzLl9jYW5TZWxlY3RNdWx0aXBsZUl0ZW1zICYmIHRoaXMuX3NlbGVjdGVkSW5kaWNlc1tpXSA/IFwiK1wiIDogXCItXCIpO1xuICAgICAgICBzdWZmaXggPSBcIlwiO1xuICAgICAgICBpZiAodGhpcy5faXRlbXNbaV0gPT09IHRoaXMuX3BsYXllci5nZXRBcm1vcigpKSB7XG4gICAgICAgICAgc3VmZml4ID0gXCIgKHdlYXJpbmcpXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHRoaXMuX2l0ZW1zW2ldID09PSB0aGlzLl9wbGF5ZXIuZ2V0V2VhcG9uKCkpIHtcbiAgICAgICAgICAgIHN1ZmZpeCA9IFwiICh3aWVsZGluZylcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZGlzcGxheS5kcmF3VGV4dCgwLCAyICsgcm93LCBsZXR0ZXIgKyBcIiBcIiArIHNlbGVjdGlvblN0YXRlICsgXCIgXCIgKyB0aGlzLl9pdGVtc1tpXS5kZXNjcmliZSgpICsgc3VmZml4KTtcbiAgICAgICAgcm93Kys7XG4gICAgICB9XG4gICAgICBfcmVzdWx0cy5wdXNoKGkrKyk7XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfTtcblxuICBJdGVtTGlzdFNjcmVlbi5wcm90b3R5cGUuZXhlY3V0ZU9rRnVuY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICB2YXIga2V5LCBzZWxlY3RlZEl0ZW1zO1xuICAgIHNlbGVjdGVkSXRlbXMgPSB7fTtcbiAgICBmb3IgKGtleSBpbiB0aGlzLl9zZWxlY3RlZEluZGljZXMpIHtcbiAgICAgIHNlbGVjdGVkSXRlbXNba2V5XSA9IHRoaXMuX2l0ZW1zW2tleV07XG4gICAgfVxuICAgIEdhbWUuU2NyZWVuLnBsYXlTY3JlZW4uc2V0U3ViU2NyZWVuKHVuZGVmaW5lZCk7XG4gICAgaWYgKHRoaXMuX29rRnVuY3Rpb24oc2VsZWN0ZWRJdGVtcykpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wbGF5ZXIuZ2V0TWFwKCkuZ2V0RW5naW5lKCkudW5sb2NrKCk7XG4gICAgfVxuICB9O1xuXG4gIEl0ZW1MaXN0U2NyZWVuLnByb3RvdHlwZS5oYW5kbGVJbnB1dCA9IGZ1bmN0aW9uKGlucHV0VHlwZSwgaW5wdXREYXRhKSB7XG4gICAgdmFyIGluZGV4O1xuICAgIGlmIChpbnB1dFR5cGUgPT09IFwia2V5ZG93blwiKSB7XG4gICAgICBpZiAoaW5wdXREYXRhLmtleUNvZGUgPT09IFJPVC5WS19FU0NBUEUgfHwgKGlucHV0RGF0YS5rZXlDb2RlID09PSBST1QuVktfUkVUVVJOICYmICghdGhpcy5fY2FuU2VsZWN0SXRlbSB8fCBPYmplY3Qua2V5cyh0aGlzLl9zZWxlY3RlZEluZGljZXMpLmxlbmd0aCA9PT0gMCkpKSB7XG4gICAgICAgIHJldHVybiBHYW1lLlNjcmVlbi5wbGF5U2NyZWVuLnNldFN1YlNjcmVlbih1bmRlZmluZWQpO1xuICAgICAgfSBlbHNlIGlmIChpbnB1dERhdGEua2V5Q29kZSA9PT0gUk9ULlZLX1JFVFVSTikge1xuICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRlT2tGdW5jdGlvbigpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9jYW5TZWxlY3RJdGVtICYmIHRoaXMuX2hhc05vSXRlbU9wdGlvbiAmJiBpbnB1dERhdGEua2V5Q29kZSA9PT0gUk9ULlZLXzApIHtcbiAgICAgICAgdGhpcy5fc2VsZWN0ZWRJbmRpY2VzID0ge307XG4gICAgICAgIHJldHVybiB0aGlzLmV4ZWN1dGVPa0Z1bmN0aW9uKCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX2NhblNlbGVjdEl0ZW0gJiYgaW5wdXREYXRhLmtleUNvZGUgPj0gUk9ULlZLX0EgJiYgaW5wdXREYXRhLmtleUNvZGUgPD0gUk9ULlZLX1opIHtcbiAgICAgICAgaW5kZXggPSBpbnB1dERhdGEua2V5Q29kZSAtIFJPVC5WS19BO1xuICAgICAgICBpZiAodGhpcy5faXRlbXNbaW5kZXhdKSB7XG4gICAgICAgICAgaWYgKHRoaXMuX2NhblNlbGVjdE11bHRpcGxlSXRlbXMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zZWxlY3RlZEluZGljZXNbaW5kZXhdKSB7XG4gICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9zZWxlY3RlZEluZGljZXNbaW5kZXhdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0ZWRJbmRpY2VzW2luZGV4XSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gR2FtZS5yZWZyZXNoKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdGVkSW5kaWNlc1tpbmRleF0gPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhlY3V0ZU9rRnVuY3Rpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIEl0ZW1MaXN0U2NyZWVuO1xuXG59KSgpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIEdhbWU7XG5cbkdhbWUgPSByZXF1aXJlKCcuLy4uLy4uL2dhbWUnKTtcblxuaWYgKEdhbWUuU2NyZWVuID09IG51bGwpIHtcbiAgR2FtZS5TY3JlZW4gPSB7fTtcbn1cblxuR2FtZS5TY3JlZW4uVGFyZ2V0QmFzZWRTY3JlZW4gPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIFRhcmdldEJhc2VkU2NyZWVuKHRlbXBsYXRlKSB7XG4gICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZSB8fCB7fTtcbiAgICB0aGlzLl9pc0FjY2VwdGFibGVGdW5jdGlvbiA9IHRlbXBsYXRlW1wib2tGdW5jdGlvblwiXSB8fCBmdW5jdGlvbih4LCB5KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICB0aGlzLl9jYXB0aW9uRnVuY3Rpb24gPSB0ZW1wbGF0ZVtcImNhcHRpb25GdW5jdGlvblwiXSB8fCBmdW5jdGlvbih4LCB5KSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9O1xuICB9XG5cbiAgVGFyZ2V0QmFzZWRTY3JlZW4ucHJvdG90eXBlLnNldHVwID0gZnVuY3Rpb24ocGxheWVyLCBzdGFydFgsIHN0YXJ0WSwgb2Zmc2V0WCwgb2Zmc2V0WSkge1xuICAgIHZhciB2aXNpYmxlQ2VsbHM7XG4gICAgdGhpcy5fcGxheWVyID0gcGxheWVyO1xuICAgIHRoaXMuX3N0YXJ0WCA9IHN0YXJ0WCAtIG9mZnNldFg7XG4gICAgdGhpcy5fc3RhcnRZID0gc3RhcnRZIC0gb2Zmc2V0WTtcbiAgICB0aGlzLl9jdXJzb3JYID0gdGhpcy5fc3RhcnRYO1xuICAgIHRoaXMuX2N1cnNvclkgPSB0aGlzLl9zdGFydFk7XG4gICAgdGhpcy5fb2Zmc2V0WCA9IG9mZnNldFg7XG4gICAgdGhpcy5fb2Zmc2V0WSA9IG9mZnNldFk7XG4gICAgdmlzaWJsZUNlbGxzID0ge307XG4gICAgdGhpcy5fcGxheWVyLmdldE1hcCgpLmdldEZvdih0aGlzLl9wbGF5ZXIuZ2V0WigpKS5jb21wdXRlKHRoaXMuX3BsYXllci5nZXRYKCksIHRoaXMuX3BsYXllci5nZXRZKCksIHRoaXMuX3BsYXllci5nZXRTaWdodFJhZGl1cygpLCBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHZpc2liaWxpdHkpIHtcbiAgICAgIHJldHVybiB2aXNpYmxlQ2VsbHNbeCArIFwiLFwiICsgeV0gPSB0cnVlO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzLl92aXNpYmxlQ2VsbHMgPSB2aXNpYmxlQ2VsbHM7XG4gIH07XG5cbiAgVGFyZ2V0QmFzZWRTY3JlZW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKGRpc3BsYXkpIHtcbiAgICB2YXIgaSwgbCwgcG9pbnRzO1xuICAgIEdhbWUuU2NyZWVuLnBsYXlTY3JlZW4ucmVuZGVyVGlsZXMuY2FsbChHYW1lLlNjcmVlbi5wbGF5U2NyZWVuLCBkaXNwbGF5KTtcbiAgICBwb2ludHMgPSBHYW1lLmdldExpbmUodGhpcy5fc3RhcnRYLCB0aGlzLl9zdGFydFksIHRoaXMuX2N1cnNvclgsIHRoaXMuX2N1cnNvclkpO1xuICAgIGkgPSAwO1xuICAgIGwgPSBwb2ludHMubGVuZ3RoO1xuICAgIHdoaWxlIChpIDwgbCkge1xuICAgICAgZGlzcGxheS5kcmF3VGV4dChwb2ludHNbaV0ueCwgcG9pbnRzW2ldLnksIFwiJWN7bWFnZW50YX0qXCIpO1xuICAgICAgaSsrO1xuICAgIH1cbiAgICByZXR1cm4gZGlzcGxheS5kcmF3VGV4dCgwLCBHYW1lLmdldFNjcmVlbkhlaWdodCgpIC0gMSwgdGhpcy5fY2FwdGlvbkZ1bmN0aW9uKHRoaXMuX2N1cnNvclggKyB0aGlzLl9vZmZzZXRYLCB0aGlzLl9jdXJzb3JZICsgdGhpcy5fb2Zmc2V0WSkpO1xuICB9O1xuXG4gIFRhcmdldEJhc2VkU2NyZWVuLnByb3RvdHlwZS5oYW5kbGVJbnB1dCA9IGZ1bmN0aW9uKGlucHV0VHlwZSwgaW5wdXREYXRhKSB7XG4gICAgaWYgKGlucHV0VHlwZSA9PT0gXCJrZXlkb3duXCIpIHtcbiAgICAgIGlmIChpbnB1dERhdGEua2V5Q29kZSA9PT0gUk9ULlZLX0xFRlQpIHtcbiAgICAgICAgdGhpcy5tb3ZlQ3Vyc29yKC0xLCAwKTtcbiAgICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLmtleUNvZGUgPT09IFJPVC5WS19SSUdIVCkge1xuICAgICAgICB0aGlzLm1vdmVDdXJzb3IoMSwgMCk7XG4gICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5rZXlDb2RlID09PSBST1QuVktfVVApIHtcbiAgICAgICAgdGhpcy5tb3ZlQ3Vyc29yKDAsIC0xKTtcbiAgICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLmtleUNvZGUgPT09IFJPVC5WS19ET1dOKSB7XG4gICAgICAgIHRoaXMubW92ZUN1cnNvcigwLCAxKTtcbiAgICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLmtleUNvZGUgPT09IFJPVC5WS19FU0NBUEUpIHtcbiAgICAgICAgR2FtZS5TY3JlZW4ucGxheVNjcmVlbi5zZXRTdWJTY3JlZW4odW5kZWZpbmVkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChpbnB1dERhdGEua2V5Q29kZSA9PT0gUk9ULlZLX1JFVFVSTikge1xuICAgICAgICAgIHRoaXMuZXhlY3V0ZU9rRnVuY3Rpb24oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gR2FtZS5yZWZyZXNoKCk7XG4gIH07XG5cbiAgVGFyZ2V0QmFzZWRTY3JlZW4ucHJvdG90eXBlLm1vdmVDdXJzb3IgPSBmdW5jdGlvbihkeCwgZHkpIHtcbiAgICB0aGlzLl9jdXJzb3JYID0gTWF0aC5tYXgoMCwgTWF0aC5taW4odGhpcy5fY3Vyc29yWCArIGR4LCBHYW1lLmdldFNjcmVlbldpZHRoKCkpKTtcbiAgICByZXR1cm4gdGhpcy5fY3Vyc29yWSA9IE1hdGgubWF4KDAsIE1hdGgubWluKHRoaXMuX2N1cnNvclkgKyBkeSwgR2FtZS5nZXRTY3JlZW5IZWlnaHQoKSAtIDEpKTtcbiAgfTtcblxuICBUYXJnZXRCYXNlZFNjcmVlbi5wcm90b3R5cGUuZXhlY3V0ZU9rRnVuY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICBHYW1lLlNjcmVlbi5wbGF5U2NyZWVuLnNldFN1YlNjcmVlbih1bmRlZmluZWQpO1xuICAgIGlmICh0aGlzLl9va0Z1bmN0aW9uKHRoaXMuX2N1cnNvclggKyB0aGlzLl9vZmZzZXRYLCB0aGlzLl9jdXJzb3JZICsgdGhpcy5fb2Zmc2V0WSkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wbGF5ZXIuZ2V0TWFwKCkuZ2V0RW5naW5lKCkudW5sb2NrKCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBUYXJnZXRCYXNlZFNjcmVlbjtcblxufSkoKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgdmFyIEdhbWU7XG4gIGlmIChST1QuaXNTdXBwb3J0ZWQoKSkge1xuICAgIEdhbWUgPSByZXF1aXJlKCcuL2dhbWUnKTtcbiAgICBHYW1lLmluaXQoKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKEdhbWUuZ2V0RGlzcGxheSgpLmdldENvbnRhaW5lcigpKTtcbiAgICBHYW1lLnN3aXRjaFNjcmVlbihHYW1lLlNjcmVlbi5zdGFydFNjcmVlbik7XG4gIH0gZWxzZSB7XG4gICAgYWxlcnQoXCJUaGUgcm90LmpzIGxpYnJhcnkgaXNuJ3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3Nlci5cIik7XG4gIH1cbn07XG4iXX0=
