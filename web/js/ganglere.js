(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere;

ganglere = require('../ganglere');

ganglere.AI = (function() {
  var hunt, reshuffle, wander;

  AI.prototype.game = null;

  reshuffle = [
    {
      x: -1,
      y: 0
    }, {
      x: 1,
      y: 0
    }, {
      x: 0,
      y: -1
    }, {
      x: 0,
      y: 1
    }
  ];

  wander = function() {
    var i, j, t;
    i = reshuffle.length;
    while (--i > 0) {
      j = ~~(Math.random() * (i + 1));
      t = reshuffle[j];
      reshuffle[j] = reshuffle[i];
      reshuffle[i] = t;
    }
    return reshuffle;
  };

  hunt = function(deltaX, deltaY) {
    return [
      {
        x: -1,
        y: 0
      }, {
        x: 1,
        y: 0
      }, {
        x: 0,
        y: -1
      }, {
        x: 0,
        y: 1
      }
    ].map(function(direction) {
      return {
        x: direction.x,
        y: direction.y,
        distance: Math.pow(deltaX + direction.x, 2) + Math.pow(deltaY + direction.y, 2)
      };
    }).sort(function(a, b) {
      return b.distance - a.distance;
    });
  };

  function AI(game) {
    this.game = game;
  }

  AI.prototype.wander = function(actor) {
    var direction, _i, _len, _ref, _results;
    _ref = wander();
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      direction = _ref[_i];
      if (this.game.moveTo(actor, direction)) {
        break;
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  AI.prototype.hunt = function(actor, deltaX, deltaY) {
    var direction, _i, _len, _ref, _results;
    _ref = hunt(deltaX, deltaY);
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      direction = _ref[_i];
      if (this.game.moveTo(actor, direction)) {
        break;
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  return AI;

})();

},{"../ganglere":15}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ganglere = require('../ganglere');

ganglere.Actor = (function() {
  var FRAME_BACK, FRAME_FRONT, FRAME_LEFT, FRAME_RIGHT, HUNTER, WHITE, _ref;

  Actor.all = [];

  Actor.map = {};

  _ref = ganglere.config, FRAME_FRONT = _ref.FRAME_FRONT, FRAME_BACK = _ref.FRAME_BACK, FRAME_LEFT = _ref.FRAME_LEFT, FRAME_RIGHT = _ref.FRAME_RIGHT;

  WHITE = '#fff';

  HUNTER = '#ff0044';

  Actor.prototype.isPlayer = false;

  Actor.prototype.game = null;

  Actor.prototype.sprite = null;

  Actor.prototype.x = 0;

  Actor.prototype.y = 0;

  Actor.prototype.hp = 0;

  Actor.prototype.damage = "d8+2";

  function Actor(game, x, y, key) {
    this.setFrame = __bind(this.setFrame, this);
    this.setOfset = __bind(this.setOfset, this);
    this.setXY = __bind(this.setXY, this);
    this.attack = __bind(this.attack, this);
    this.move = __bind(this.move, this);
    this.hp = 3;
    this.x = x;
    this.y = y;
    this.config = ganglere.config.sprites[key];
    this.setOfset(this.config.axis);
    this.key = this.config.selected != null ? "" + key + "[" + this.config.selected + "]" : key;
    if (game) {
      this.game = game;
      this.sprite = game.add.sprite(x * 32, y * 32, this.key);
    }
  }

  Actor.prototype.move = function() {};

  Actor.prototype.attack = function(victim) {
    var axis, color, damage, dir, pos1, pos2;
    damage = ganglere.Random.diceRoll(this.damage).total;
    victim.hp -= damage;
    axis = this.x === victim.x ? "y" : "x";
    dir = victim[axis] - this[axis];
    dir = dir / Math.abs(dir);
    pos1 = {};
    pos2 = {};
    pos1[axis] = (dir * 15).toString();
    pos2[axis] = (dir * 15 * (-1)).toString();
    this.game.camera.follow(false);
    this.game.add.tween(this.sprite).to(pos1, 200, Phaser.Easing.Elastic.In, true).to(pos2, 200, Phaser.Easing.Elastic.Out, true).onComplete.add(((function(_this) {
      return function() {
        return _this.game.camera.follow(_this.sprite);
      };
    })(this)), this);
    color = victim.isPlayer ? HUNTER : WHITE;
    return this.game.showDamage(damage.toString(), victim.sprite, 450, color);
  };

  Actor.prototype.setXY = function(x, y) {
    this.x = x;
    this.y = y;
    this.game.add.tween(this.sprite).to({
      x: x * 32,
      y: y * 32
    }, 500, Phaser.Easing.Linear.None, true);
  };

  Actor.prototype.setOfset = function(axis) {
    var r0, r1, r2, r3;
    switch (this.config.type) {
      case 0:
        r0 = axis * 4 + this.config.order[0];
        r1 = axis * 4 + this.config.order[1];
        r2 = axis * 4 + this.config.order[2];
        r3 = axis * 4 + this.config.order[3];
        break;
      case 1:
        r0 = axis + this.config.cols * this.config.order[0];
        r1 = axis + this.config.cols * this.config.order[1];
        r2 = axis + this.config.cols * this.config.order[2];
        r3 = axis + this.config.cols * this.config.order[3];
        break;
      default:
        r0 = 0;
        r1 = 0;
        r2 = 0;
        r3 = 0;
    }
    return this.ofset = [r0, r1, r2, r3];
  };

  Actor.prototype.setFrame = function(dir) {
    if (dir.x === 1) {
      return this.sprite.frame = this.ofset[FRAME_RIGHT];
    } else if (dir.x === -1) {
      return this.sprite.frame = this.ofset[FRAME_LEFT];
    } else if (dir.y === -1) {
      return this.sprite.frame = this.ofset[FRAME_BACK];
    } else if (dir.y === 1) {
      return this.sprite.frame = this.ofset[FRAME_FRONT];
    }
  };

  return Actor;

})();

},{"../ganglere":15}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ganglere = require('../ganglere');

ganglere.Assets = (function(_super) {
  __extends(Assets, _super);

  Assets.prototype.splashScreen = Phaser.Sprite;

  function Assets() {}

  Assets.background = null;

  Assets.preloadBar = null;

  Assets.preloadBgd = null;

  Assets.ready = false;

  Assets.prototype.preload = function() {
    var file, ix, key, level, sprite, _ref, _ref1, _results;
    this.add.sprite(0, 0, 'splash');
    this.preloadBgd = this.add.sprite(this.game.width / 2 - 250, this.game.height - 100, 'preloaderBackground');
    this.preloadBar = this.add.sprite(this.game.width / 2 - 250, this.game.height - 100, 'preloaderBar');
    this.load.setPreloadSprite(this.preloadBar);
    this.load.image('background', 'assets/images/background.png');
    this.load.image('backButton', 'assets/images/buttons/back1.png');
    this.load.image('playButton', 'assets/images/buttons/play1.png');
    this.load.image('scoreButton', 'assets/images/buttons/score1.png');
    this.load.image('creditsButton', 'assets/images/buttons/credits1.png');
    this.load.image('quote', 'assets/images/quote.png');
    this.load.image('icon', 'assets/images/icon.png');
    _ref = ganglere.config.levels;
    for (key in _ref) {
      level = _ref[key];
      this.load.json("" + level.options.map + ".json", "assets/levels/" + level.options.map + ".json");
    }
    _ref1 = ganglere.config.sprites;
    _results = [];
    for (key in _ref1) {
      sprite = _ref1[key];
      if ('string' === typeof sprite.file) {
        _results.push(this.load.spritesheet(key, sprite.file, sprite.width, sprite.height));
      } else {
        if (sprite.selected != null) {
          this.load.spritesheet(key, sprite.file[sprite.selected], sprite.width, sprite.height);
        }
        _results.push((function() {
          var _i, _len, _ref2, _results1;
          _ref2 = sprite.file;
          _results1 = [];
          for (ix = _i = 0, _len = _ref2.length; _i < _len; ix = ++_i) {
            file = _ref2[ix];
            _results1.push(this.load.spritesheet("" + key + "[" + ix + "]", file, sprite.width, sprite.height));
          }
          return _results1;
        }).call(this));
      }
    }
    return _results;
  };

  Assets.prototype.create = function() {
    return this.preloadBar.cropEnabled = false;
  };

  Assets.prototype.update = function() {
    return this.state.start('Intro', true, false, {
      level: 0
    });
  };

  return Assets;

})(Phaser.State);

},{"../ganglere":15}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var Config, FRAME_BACK, FRAME_FRONT, FRAME_LEFT, FRAME_RIGHT, ganglere;

FRAME_FRONT = 0;

FRAME_BACK = 1;

FRAME_RIGHT = 2;

FRAME_LEFT = 3;

ganglere = require("../ganglere");

ganglere.config = new (Config = (function() {
  function Config() {}

  Config.prototype.FRAME_FRONT = FRAME_FRONT;

  Config.prototype.FRAME_BACK = FRAME_BACK;

  Config.prototype.FRAME_RIGHT = FRAME_RIGHT;

  Config.prototype.FRAME_LEFT = FRAME_LEFT;

  Config.prototype.name = 'The Deluding of Gylfe';

  Config.prototype.sprites = {
    'forest-tiles': {
      file: 'assets/images/foresttiles_0.png',
      width: 32,
      height: 32,
      cols: 5,
      rows: 7
    },
    heroes: {
      file: ['assets/sprites/Heroes/Fighter-F-01.png', 'assets/sprites/Heroes/Fighter-F-02.png', 'assets/sprites/Heroes/Fighter-M-01.png', 'assets/sprites/Heroes/Fighter-M-02.png', 'assets/sprites/Heroes/Healer-F-01.png', 'assets/sprites/Heroes/Healer-M-01.png', 'assets/sprites/Heroes/Mage-F-01.png', 'assets/sprites/Heroes/Mage-M-01.png', 'assets/sprites/Heroes/Ranger-F-01.png', 'assets/sprites/Heroes/Ranger-M-01.png'],
      selected: 9,
      width: 24,
      height: 32,
      cols: 6,
      rows: 4,
      type: 1,
      axis: 0,
      order: [FRAME_RIGHT, FRAME_FRONT, FRAME_BACK, FRAME_LEFT]
    },
    fenris: {
      file: 'assets/images/wolves.png',
      width: 32,
      height: 32,
      cols: 3,
      rows: 4,
      type: 1,
      axis: 0,
      order: [FRAME_FRONT, FRAME_LEFT, FRAME_RIGHT, FRAME_BACK]
    },
    loke: {
      file: ['assets/images/ogres1.png', 'assets/images/ogres2.png'],
      selected: 1,
      width: 32,
      height: 32,
      cols: 4,
      rows: 4,
      type: 0,
      axis: 3,
      order: [FRAME_FRONT, FRAME_LEFT, FRAME_BACK, FRAME_RIGHT]
    },
    thor: {
      file: ['assets/images/ogres1.png', 'assets/images/ogres2.png'],
      selected: 1,
      width: 32,
      height: 32,
      cols: 4,
      rows: 4,
      type: 0,
      axis: 2,
      order: [FRAME_FRONT, FRAME_LEFT, FRAME_BACK, FRAME_RIGHT]
    }
  };

  Config.prototype.levels = {
    Fenris: {
      title: 'Fenris at the Gate',
      options: {
        actors: 20,
        map: 'fenris',
        hide: false,
        artifacts: false
      },
      player: {
        hp: 60,
        sprite: "heroes",
        damage: "d6+2"
      },
      enemy: {
        hp: 5,
        sprite: "fenris",
        damage: "d2+0"
      }
    },
    Loke: {
      title: 'Combat with Loke',
      options: {
        actors: 10,
        map: 'loke',
        hide: false,
        artifacts: false
      },
      player: {
        hp: 200,
        sprite: "heroes",
        damage: "d6+2"
      },
      enemy: {
        hp: 5,
        sprite: "loke",
        damage: "d2+1"
      }
    },
    Thor: {
      title: 'Thor beats your a$$!',
      options: {
        actors: 25,
        map: 'thor',
        hide: true,
        artifacts: false
      },
      player: {
        hp: 500,
        sprite: "heroes",
        damage: "d6+2"
      },
      enemy: {
        hp: 5,
        sprite: "thor",
        damage: "d2+2"
      }
    }
  };

  return Config;

})());

},{"../ganglere":15}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ganglere = require('../ganglere');

ganglere.Credits = (function(_super) {
  __extends(Credits, _super);

  function Credits() {
    return Credits.__super__.constructor.apply(this, arguments);
  }

  Credits.prototype.text = "Program by darkoverlordofdata\n\nSprites by Svetlana Kushnariova\n  lana-chan@yandex.ru\n\nWeb font Eagle Lake by astigmatic\n\nVellum toned paper texture by sporkystock";

  Credits.prototype.copyright = "Copyright 2014 Dark Overlord of Data";

  Credits.prototype.quoteStyle = {
    font: "italic 14px Arial",
    fill: '#000',
    align: 'center'
  };

  Credits.prototype.style = {
    font: "14px Arial",
    fill: '#000',
    align: 'center'
  };

  Credits.prototype.preload = function() {};

  Credits.prototype.create = function() {
    this.add.sprite(0, 0, 'background');
    this.add.sprite(0, 0, 'icon');
    this.add.sprite(0, 10, 'quote');
    this.add.text(10, 150, this.text, this.style);
    this.add.button(this.game.width / 2 - 38, this.game.height - 80, 'backButton', this.goBack, this, 2, 1, 0);
    return this.add.text(50, this.game.height - 40, this.copyright, this.style);
  };

  Credits.prototype.goBack = function() {
    return this.state.start('Intro', true, false);
  };

  return Credits;

})(Phaser.State);

},{"../ganglere":15}],6:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ganglere = require('../ganglere');

ganglere.Enemy = (function(_super) {
  __extends(Enemy, _super);

  Enemy.prototype.ai = null;

  function Enemy(game, x, y) {
    this.move = __bind(this.move, this);
    Enemy.__super__.constructor.call(this, game, x, y, game.enemy.sprite);
    this.hp = game.enemy.hp;
    this.damage = game.enemy.damage;
    this.isPlayer = false;
    this.ai = new ganglere.AI(game);
  }

  Enemy.prototype.move = function(player) {
    var deltaX, deltaY;
    deltaX = player.x - this.x;
    deltaY = player.y - this.y;
    if (Math.abs(deltaX) + Math.abs(deltaY) > 6) {
      return this.ai.wander(this);
    } else {
      return this.ai.hunt(this, deltaX, deltaY);
    }
  };

  return Enemy;

})(ganglere.Actor);

},{"../ganglere":15}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ganglere = require("../ganglere");

ganglere.GameOver = (function(_super) {
  __extends(GameOver, _super);

  function GameOver() {
    this.create = __bind(this.create, this);
    return GameOver.__super__.constructor.apply(this, arguments);
  }

  GameOver.prototype.create = function() {
    var gameOver;
    gameOver = this.add.text(0, 0, "Game Over\nCtrl+r to restart", {
      fill: "#e22",
      align: "center"
    });
    gameOver.fixedToCamera = true;
    return gameOver.cameraOffset.setTo(0, 0);
  };

  return GameOver;

})(Phaser.State);

},{"../ganglere":15}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ganglere = require('../ganglere');

ganglere.Initialize = (function(_super) {
  __extends(Initialize, _super);

  function Initialize() {
    return Initialize.__super__.constructor.apply(this, arguments);
  }

  Initialize.score = 0;

  Initialize.music = null;

  Initialize.orientated = false;

  Initialize.prototype.preload = function() {
    this.load.image('splash', 'assets/images/splash.png');
    this.load.image('preloaderBackground', 'assets/images/progress_bar_background.png');
    return this.load.image('preloaderBar', 'assets/images/progress_bar.png');
  };

  Initialize.prototype.create = function() {
    this.input.maxPointers = 1;
    this.stage.disableVisibilityChange = true;
    if (this.game.device.desktop) {
      this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.scale.minWidth = 320;
      this.scale.minHeight = 480;
      this.scale.maxWidth = 640;
      this.scale.maxHeight = 960;
      this.scale.pageAlignHorizontally = true;
      this.scale.pageAlignVertically = true;
      this.scale.setScreenSize(true);
    } else {
      this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.scale.minWidth = 320;
      this.scale.minHeight = 480;
      this.scale.maxWidth = 640;
      this.scale.maxHeight = 960;
      this.scale.pageAlignHorizontally = true;
      this.scale.pageAlignVertically = true;
      this.scale.forceOrientation(false);
      this.scale.hasResized.add(this.gameResized, this);
      this.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation, this);
      this.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation, this);
      this.scale.setScreenSize(true);
    }
    return this.state.start('Assets', true, false);
  };

  Initialize.prototype.gameResized = function(width, height) {};

  Initialize.prototype.enterIncorrectOrientation = function() {
    Ganglere.orientated = false;
    return document.getElementById('orientation').style.display = 'block';
  };

  Initialize.prototype.leaveIncorrectOrientation = function() {
    Ganglere.orientated = true;
    return document.getElementById('orientation').style.display = 'none';
  };

  return Initialize;

})(Phaser.State);

},{"../ganglere":15}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ganglere = require('../ganglere');

ganglere.Intro = (function(_super) {
  __extends(Intro, _super);

  function Intro() {
    return Intro.__super__.constructor.apply(this, arguments);
  }

  Intro.prototype.preload = function() {};

  Intro.prototype.create = function() {
    this.add.sprite(0, 0, 'splash');
    this.add.button(100, 270, 'playButton', this.startGame, this, 2, 1, 0);
    this.add.button(100, 310, 'creditsButton', this.showCredits, this, 2, 1, 0);
    return this.add.button(100, 350, 'scoreButton', this.showScores, this, 2, 1, 0);
  };

  Intro.prototype.showCredits = function() {
    return this.state.start('Credits', true, false);
  };

  Intro.prototype.showScores = function() {
    return this.state.start('Scores', true, false);
  };

  Intro.prototype.startGame = function() {
    return this.state.start('Levels', true, false, {
      level: 0
    });
  };

  return Intro;

})(Phaser.State);

},{"../ganglere":15}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ganglere = require("../ganglere");

ganglere.Levels = (function(_super) {
  var BLACK, HUNTER, WHITE;

  __extends(Levels, _super);

  function Levels() {
    this.showDamage = __bind(this.showDamage, this);
    this.initActors = __bind(this.initActors, this);
    this.fadeOut = __bind(this.fadeOut, this);
    this.label = __bind(this.label, this);
    this.startGame = __bind(this.startGame, this);
    this.moveTo = __bind(this.moveTo, this);
    this.doKeyUp = __bind(this.doKeyUp, this);
    this.onKeyUp = __bind(this.onKeyUp, this);
    this.moveCallback = __bind(this.moveCallback, this);
    this.create = __bind(this.create, this);
    this.init = __bind(this.init, this);
    return Levels.__super__.constructor.apply(this, arguments);
  }

  WHITE = '#fff';

  BLACK = '#000';

  HUNTER = '#ff0044';

  Levels.prototype.automove = true;

  Levels.prototype.inmotion = false;

  Levels.prototype.actorList = null;

  Levels.prototype.actorMap = null;

  Levels.prototype.player = null;

  Levels.prototype.options = null;

  Levels.prototype.hud = null;

  Levels.prototype.map = null;

  Levels.prototype.clickeable = true;

  Levels.prototype.score = 0;

  Levels.prototype.level = 0;

  Levels.prototype.name = 'Splash';

  Levels.prototype.levels = ['Fenris', 'Loke', 'Thor', 'Game Over'];

  Levels.prototype.init = function(options) {
    var key, value;
    for (key in options) {
      value = options[key];
      this[key] = value;
    }
    return this.name = this.levels[this.level];
  };

  Levels.prototype.create = function() {
    var hudStyle, key, value, _ref;
    this.time.advancedTiming = true;
    hudStyle = {
      font: "bold 18px monospace",
      fill: BLACK
    };
    _ref = ganglere.config.levels[this.name];
    for (key in _ref) {
      value = _ref[key];
      console.log(key);
      console.log(value);
      this[key] = value;
    }
    this.map = new ganglere.Map(this);
    this.stage.backgroundColor = "#F0DE9C";
    this.initActors();
    this.map.light();
    this.hud = this.add.text(0, 0, this.label(this.actorList[0].hp, this.score, this.level), hudStyle);
    this.hud.fixedToCamera = true;
    this.hud.cameraOffset.setTo(0, this.game.height - 35);
    this.input.keyboard.addCallbacks(null, null, this.onKeyUp);
    this.input.onDown.add(this.onKeyUp, this);
    this.input.setMoveCallback(this.moveCallback, this);
  };

  Levels.prototype.moveCallback = function() {
    var dx, dy, x, y;
    if (this.clickeable && this.input.activePointer.isDown) {
      this.clickeable = false;
      setTimeout(((function(_this) {
        return function() {
          return _this.clickeable = true;
        };
      })(this)), 400);
      x = this.input.activePointer.worldX;
      y = this.input.activePointer.worldY;
      dx = Math.abs(this.player.sprite.x - x);
      dy = Math.abs(this.player.sprite.y - y);
      if (dx > dy) {
        if (x > this.player.sprite.x) {
          this.onKeyUp({
            keyCode: Phaser.Keyboard.RIGHT
          });
        } else {
          this.onKeyUp({
            keyCode: Phaser.Keyboard.LEFT
          });
        }
      } else {
        if (y > this.player.sprite.y) {
          this.onKeyUp({
            keyCode: Phaser.Keyboard.DOWN
          });
        } else {
          this.onKeyUp({
            keyCode: Phaser.Keyboard.UP
          });
        }
      }
    }
  };

  Levels.prototype.onKeyUp = function(event) {
    var actor, _i, _len, _ref;
    if (!this.actorList[0].isPlayer) {
      return;
    }
    if (this.doKeyUp(event)) {
      this.map.computeLight();
      _ref = this.actorList;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        actor = _ref[_i];
        actor.move(this.player);
        if (this.player.hp < 1) {
          this.fadeOut((function(_this) {
            return function() {
              return _this.state.start('Levels', false, false, {
                level: _this.levels.length,
                win: false
              });
            };
          })(this));
          break;
        }
      }
    }
  };

  Levels.prototype.doKeyUp = function(event) {
    switch (event.keyCode) {
      case Phaser.Keyboard.LEFT:
        return this.moveTo(this.player, {
          x: -1,
          y: 0
        });
      case Phaser.Keyboard.RIGHT:
        return this.moveTo(this.player, {
          x: 1,
          y: 0
        });
      case Phaser.Keyboard.UP:
        return this.moveTo(this.player, {
          x: 0,
          y: -1
        });
      case Phaser.Keyboard.DOWN:
        return this.moveTo(this.player, {
          x: 0,
          y: 1
        });
      default:
        return false;
    }
  };

  Levels.prototype.moveTo = function(actor, delta) {
    var pos, victim;
    if (!this.map.isValidMove(actor, delta)) {
      return false;
    }
    actor.setFrame(delta);
    pos = (actor.x + delta.x) + "_" + (actor.y + delta.y);
    if (this.actorMap[pos] != null) {
      victim = this.actorMap[pos];
      if (actor.isPlayer || victim.isPlayer) {
        actor.attack(victim);
        if (victim.isPlayer) {
          this.hud.setText(this.label(victim.hp, this.score, this.level));
        } else {
          this.score += ganglere.Random.diceRoll("d2+1").total;
          this.hud.setText(this.label(this.actorList[0].hp, this.score, this.level));
        }
        if (victim.hp <= 0) {
          victim.sprite.kill();
          delete this.actorMap[pos];
          this.actorList.splice(this.actorList.indexOf(victim), 1);
          if (victim !== this.player) {
            if (this.actorList.length === 1) {
              this.level++;
              if (this.level < this.levels.length) {
                this.fadeOut((function(_this) {
                  return function() {
                    return _this.state.start('Levels', true, false, {
                      level: _this.level
                    });
                  };
                })(this));
              } else {
                this.fadeOut((function(_this) {
                  return function() {
                    return _this.state.start('Levels', false, false, {
                      level: _this.levels.length,
                      win: true
                    });
                  };
                })(this));
              }
            }
          }
        }
      }
    } else {
      delete this.actorMap[actor.x + "_" + actor.y];
      actor.setXY(actor.x + delta.x, actor.y + delta.y);
      this.actorMap[actor.x + "_" + actor.y] = actor;
    }
    return true;
  };

  Levels.prototype.startGame = function() {
    var startGame;
    startGame = (function(_this) {
      return function() {
        return _this.state.start('Levels', true, false, {
          level: 1
        });
      };
    })(this);
    this.time.events.add(Phaser.Timer.SECOND, startGame, this);
    return this.add.tween(this.start).to({
      alpha: 0
    }, 2000, Phaser.Easing.Linear.None, true);
  };

  Levels.prototype.label = function(hp, score, level) {
    return "life:  " + hp + " score: " + score + " level: " + level;
  };

  Levels.prototype.fadeOut = function(next) {
    return this.time.events.add(Phaser.Timer.SECOND, next, this);
  };

  Levels.prototype.initActors = function() {
    var a, actor, random, validpos, x, y, _i, _j, _k, _ref, _ref1, _ref2, _ref3;
    this.actorList = [];
    this.actorMap = {};
    random = function(max) {
      return Math.floor(Math.random() * max);
    };
    validpos = [];
    for (x = _i = 0, _ref = this.map.width; 0 <= _ref ? _i < _ref : _i > _ref; x = 0 <= _ref ? ++_i : --_i) {
      for (y = _j = 0, _ref1 = this.map.height; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; y = 0 <= _ref1 ? ++_j : --_j) {
        if (!this.map.tiles[x][y]) {
          validpos.push({
            x: x,
            y: y
          });
        }
      }
    }
    for (a = _k = 0, _ref2 = this.options.actors; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; a = 0 <= _ref2 ? ++_k : --_k) {
      while (true) {
        _ref3 = validpos[random(validpos.length)], x = _ref3.x, y = _ref3.y;
        if (!this.actorMap[x + "_" + y]) {
          break;
        }
      }
      actor = a === 0 ? new ganglere.Player(this, x, y) : new ganglere.Enemy(this, x, y);
      this.actorMap[actor.x + "_" + actor.y] = actor;
      this.actorList.push(actor);
    }
    this.player = this.actorList[0];
    this.camera.follow(this.player.sprite);
  };

  Levels.prototype.showDamage = function(text, sprite, speed, color) {
    var damageStyle, x, y;
    if (navigator.notification != null) {
      navigator.notification.vibrate(10);
    }
    damageStyle = {
      align: 'center',
      font: 'bold 40px Courier New, Courier',
      fill: color
    };
    y = sprite.y - 15;
    x = sprite.x + sprite.width / 3;
    text = this.add.text(x, y, text, damageStyle);
    this.add.tween(text).to({
      alpha: 1
    }, Math.floor(speed * 0.75), Phaser.Easing.Bounce.Out, true).to({
      alpha: 0
    }, Math.floor(speed * 0.25), Phaser.Easing.Bounce.In, true);
    return setTimeout(((function(_this) {
      return function() {
        return _this.world.remove(text);
      };
    })(this)), speed);
  };

  return Levels;

})(Phaser.State);

},{"../ganglere":15}],11:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ganglere = require('../ganglere');

ganglere.Map = (function() {
  var clone;

  Map.prototype.options = null;

  Map.prototype.tiles = null;

  Map.prototype.map = null;

  Map.prototype.rot = null;

  Map.prototype.height = 0;

  Map.prototype.width = 0;

  Map.prototype.imageheight = 0;

  Map.prototype.imagewidth = 0;

  Map.prototype.tileheight = 0;

  Map.prototype.tilewidth = 0;

  Map.prototype.tileset = '';

  Map.prototype.wall = 0;

  Map.prototype.space = 0;

  Map.prototype.artifacts = null;

  Map.prototype.data = null;

  clone = function(object) {
    return JSON.parse(JSON.stringify(object));
  };

  function Map(level) {
    this.level = level;
    this.addArtifacts = __bind(this.addArtifacts, this);
    this.computeLight = __bind(this.computeLight, this);
    this.resetLight = __bind(this.resetLight, this);
    this.light = __bind(this.light, this);
    this.isValidMove = __bind(this.isValidMove, this);
    this.loadTilemap = __bind(this.loadTilemap, this);
    this.options = this.level.options;
    this.map = this.level.add.tilemap(this.loadTilemap(this.options.map));
    this.map.addTilesetImage(this.tileset, this.tileset);
    this.map.createLayer('layer0', this.level.game.width, this.level.game.height - 40).resizeWorld();
    this.map.createLayer('layer1', this.level.game.width, this.level.game.height - 40).resizeWorld();
    this.tiles = JSON.parse(JSON.stringify(this.rot.map));
  }

  Map.prototype.loadTilemap = function(mapkey) {
    var json;
    json = this.getProperties(clone(this.level.cache.getJSON("" + mapkey + ".json")));
    this.rot = new ROT.Map.Rogue(this.width, this.height);
    this.rot.create((function(_this) {
      return function(x, y, v) {
        return json.layers[0].data[y * _this.width + x] = v === 1 ? _this.wall : _this.space;
      };
    })(this));
    if (this.options.artifacts) {
      this.addArtifacts(json, this.artifacts);
    }
    this.level.cache.addTilemap(mapkey, '', json);
    return mapkey;
  };

  Map.prototype.isValidMove = function(from, delta) {
    return from.x + delta.x >= 0 && from.x + delta.x < this.width && from.y + delta.y >= 0 && from.y + delta.y < this.height && this.tiles[from.x + delta.x][from.y + delta.y] === 0;
  };

  Map.prototype.light = function() {
    this.resetLight();
    this.fov = new ROT.FOV.PreciseShadowcasting((function(_this) {
      return function(x, y) {
        return typeof _this.tiles[x] === 'undefined' || typeof _this.tiles[x][y] === 'undefined' || _this.tiles[x][y] === 0;
      };
    })(this));
    return this.computeLight();
  };

  Map.prototype.resetLight = function() {
    var tile, x, y, _i, _ref, _results;
    if (this.options.hide !== true) {
      return;
    }
    _results = [];
    for (x = _i = 0, _ref = this.width; 0 <= _ref ? _i < _ref : _i > _ref; x = 0 <= _ref ? ++_i : --_i) {
      _results.push((function() {
        var _j, _ref1, _results1;
        _results1 = [];
        for (y = _j = 0, _ref1 = this.height; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; y = 0 <= _ref1 ? ++_j : --_j) {
          tile = this.map.getTile(x, y, 0);
          if (tile) {
            tile.alpha = 0;
          }
          tile = this.map.getTile(x, y, 1);
          if (tile) {
            _results1.push(tile.alpha = 0);
          } else {
            _results1.push(void 0);
          }
        }
        return _results1;
      }).call(this));
    }
    return _results;
  };

  Map.prototype.computeLight = function() {
    this.resetLight();
    this.level.actorList.forEach(function(a) {
      return a.sprite.alpha = 0;
    });
    this.level.actorList[0].sprite.alpha = 1;
    this.fov.compute(this.level.actorList[0].x, this.level.actorList[0].y, 10, (function(_this) {
      return function(x, y, r, visibility) {
        var tile;
        tile = _this.map.getTile(x, y, 0);
        if (tile) {
          tile.alpha = visibility;
        }
        tile = _this.map.getTile(x, y, 1);
        if (tile) {
          tile.alpha = visibility;
        }
        if (_this.level.actorMap.hasOwnProperty(x + '_' + y)) {
          return _this.level.actorMap[x + '_' + y].sprite.alpha = visibility;
        }
      };
    })(this));
    this.map.layers[0].dirty = true;
    return this.map.layers[1].dirty = true;
  };

  Map.prototype.getProperties = function(tilemap) {
    var key, value, _ref;
    this.width = tilemap.width;
    this.height = tilemap.height;
    this.tileset = tilemap.tilesets[0].name;
    this.imageheight = tilemap.tilesets[0].imageheight;
    this.imagewidth = tilemap.tilesets[0].imagewidth;
    this.tileheight = tilemap.tileheight;
    this.tilewidth = tilemap.tilewidth;
    this.backgroundcolor = tilemap.backgroundcolor;
    if (tilemap.properties.wall != null) {
      this.wall = parseInt(tilemap.properties.wall, 10);
    } else {
      this.wall = 0;
    }
    if (tilemap.properties.space != null) {
      this.space = parseInt(tilemap.properties.space, 10);
    } else {
      this.space = (this.imageheight / this.tileheight) * (this.imagewidth / this.tilewidth);
    }
    if (tilemap.properties.artifacts != null) {
      this.artifacts = tilemap.properties.artifacts.split(',').map(function(v) {
        return parseInt(v, 10);
      });
    } else {
      this.artifacts = [];
    }
    this.data = {};
    _ref = tilemap.properties;
    for (key in _ref) {
      value = _ref[key];
      if (/^m\d\d\$/.test(key)) {
        this.data[key.split('$')[1]] = value.split(',').map(function(v) {
          return parseInt(v, 10);
        });
      }
    }
    return tilemap;
  };

  Map.prototype.addArtifacts = function(tilemap, artifacts) {
    var data, direction, exist, i, key, patternArray, tilepos, x, y, _fn, _i, _j, _k, _ref, _ref1, _ref2, _ref3;
    exist = (function(_this) {
      return function(x, y) {
        if (typeof _this.rot.map[x] !== 'undefined' && typeof _this.rot.map[x][y] !== 'undefined' && _this.rot.map[x][y] === 0) {
          return '1';
        } else {
          return '0';
        }
      };
    })(this);
    patternArray = [];
    _ref = this.data;
    _fn = (function(_this) {
      return function(key, data) {
        return patternArray.push({
          pattern: new RegExp(key.replace(/\_/g, '[0-1]')),
          setTile: function(tilepos, x, y) {
            if (data[0] != null) {
              tilemap.layers[1].data[tilepos] = data[0];
              if ((data[1] != null) && y > 0) {
                return tilemap.layers[1].data[(y - 1) * _this.width + x] = data[1];
              }
            } else {
              return tilemap.layers[1].data[tilepos] = ganglere.Random.pick(artifacts);
            }
          }
        });
      };
    })(this);
    for (key in _ref) {
      data = _ref[key];
      _fn(key, data);
    }
    for (y = _i = 0, _ref1 = this.height; 0 <= _ref1 ? _i < _ref1 : _i > _ref1; y = 0 <= _ref1 ? ++_i : --_i) {
      for (x = _j = 0, _ref2 = this.width; 0 <= _ref2 ? _j < _ref2 : _j > _ref2; x = 0 <= _ref2 ? ++_j : --_j) {
        if (this.rot.map[x][y] === 0) {
          continue;
        }
        tilepos = y * this.width + x;
        direction = exist(x - 1, y - 1) + exist(x, y - 1) + exist(x + 1, y - 1) + exist(x - 1, y) + '1' + exist(x + 1, y) + exist(x - 1, y + 1) + exist(x, y + 1) + exist(x + 1, y + 1);
        for (i = _k = 0, _ref3 = patternArray.length; 0 <= _ref3 ? _k < _ref3 : _k > _ref3; i = 0 <= _ref3 ? ++_k : --_k) {
          if (patternArray[i].pattern.test(direction)) {
            patternArray[i].setTile(tilepos, x, y);
            break;
          }
        }
      }
    }
    return tilemap;
  };

  return Map;

})();

},{"../ganglere":15}],12:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ganglere = require('../ganglere');

ganglere.Player = (function(_super) {
  __extends(Player, _super);

  function Player(game, x, y) {
    Player.__super__.constructor.call(this, game, x, y, game.player.sprite);
    this.hp = game.player.hp;
    this.damage = game.player.damage;
    this.isPlayer = true;
  }

  return Player;

})(ganglere.Actor);

},{"../ganglere":15}],13:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere;

ganglere = require('../ganglere');

ganglere.Random = (function() {
  function Random() {}

  Random.pick = function(array) {
    return array[Math.floor(Math.random() * array.length)];
  };

  Random.diceRoll = function(data) {
    var dataSplit, dices, i, n, ret, sides;
    data = " " + data;
    dataSplit = data.split(/-|\+|d/g);
    dices = parseInt(dataSplit[0], 10);
    if (!dices) {
      dices = 1;
    }
    sides = parseInt(dataSplit[1], 10);
    ret = {
      diceRoll: [],
      number: 0,
      bonus: 0
    };
    ret.number = 0;
    n = void 0;
    i = 0;
    while (i < dices) {
      n = 1 + Math.floor(Math.random() * sides);
      ret.diceRoll.push(n);
      ret.number += n;
      i++;
    }
    if (dataSplit[2]) {
      ret.bonus = parseInt(dataSplit[2], 10);
      if (data.indexOf("-") > -1) {
        ret.bonus = ret.bonus * -1;
      }
    }
    ret.total = ret.number + ret.bonus;
    return ret;
  };

  return Random;

})();

},{"../ganglere":15}],14:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ganglere = require('../ganglere');

ganglere.Scores = (function(_super) {
  __extends(Scores, _super);

  function Scores() {
    return Scores.__super__.constructor.apply(this, arguments);
  }

  Scores.prototype.preload = function() {};

  Scores.prototype.create = function() {
    this.add.sprite(0, 0, 'background');
    this.add.sprite(0, 0, 'icon');
    this.add.sprite(0, 10, 'quote');
    return this.add.button(this.game.width / 2 - 38, this.game.height - 80, 'backButton', this.goBack, this, 2, 1, 0);
  };

  Scores.prototype.goBack = function() {
    return this.state.start('Intro', true, false);
  };

  return Scores;

})(Phaser.State);

},{"../ganglere":15}],15:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

module.exports = ganglere = (function(_super) {
  __extends(ganglere, _super);

  ganglere.prototype.id = '';

  ganglere.prototype.width = 320;

  ganglere.prototype.height = 480;

  ganglere.prototype.renderer = Phaser.AUTO;

  function ganglere(id) {
    this.id = id;
    ganglere.__super__.constructor.call(this, this.width, this.height, this.renderer, this.id);
    this.state.add('Initialize', ganglere.Initialize, false);
    this.state.add('Assets', ganglere.Assets, false);
    this.state.add('Intro', ganglere.Intro, false);
    this.state.add('Credits', ganglere.Credits, false);
    this.state.add('Scores', ganglere.Scores, false);
    this.state.add('Levels', ganglere.Levels, false);
    this.state.add('GameOver', ganglere.GameOver, false);
    this.state.start('Initialize');
  }

  return ganglere;

})(Phaser.Game);

require('./Config');

require('./Random');

require('./AI');

require('./Actor');

require('./Player');

require('./Enemy');

require('./Map');

require('./Assets');

require('./Initialize');

require('./Intro');

require('./Credits');

require('./Scores');

require('./Levels');

require('./GameOver');

},{"./AI":1,"./Actor":2,"./Assets":3,"./Config":4,"./Credits":5,"./Enemy":6,"./GameOver":7,"./Initialize":8,"./Intro":9,"./Levels":10,"./Map":11,"./Player":12,"./Random":13,"./Scores":14}],16:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
"use strict";
var ganglere;

window.game = null;

ganglere = require('./ganglere');

window.addEventListener('load', function() {
  if (typeof FastClick !== "undefined" && FastClick !== null) {
    FastClick.attach(document.body);
  }
  return setTimeout(function() {
    document.getElementById("logo").style.display = 'none';
    document.getElementById("title").style.display = 'none';
    document.body.style.backgroundColor = 'black';
    return new ganglere('game');
  }, 1000);
}, false);

},{"./ganglere":15}]},{},[16])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3IvbG9jYWwvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9icnVjZS9HaXQvR2FuZ2xlcmUvdG1wL2dhbmdsZXJlL0FJLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0dhbmdsZXJlL3RtcC9nYW5nbGVyZS9BY3Rvci5qcyIsIi9ob21lL2JydWNlL0dpdC9HYW5nbGVyZS90bXAvZ2FuZ2xlcmUvQXNzZXRzLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0dhbmdsZXJlL3RtcC9nYW5nbGVyZS9Db25maWcuanMiLCIvaG9tZS9icnVjZS9HaXQvR2FuZ2xlcmUvdG1wL2dhbmdsZXJlL0NyZWRpdHMuanMiLCIvaG9tZS9icnVjZS9HaXQvR2FuZ2xlcmUvdG1wL2dhbmdsZXJlL0VuZW15LmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0dhbmdsZXJlL3RtcC9nYW5nbGVyZS9HYW1lT3Zlci5qcyIsIi9ob21lL2JydWNlL0dpdC9HYW5nbGVyZS90bXAvZ2FuZ2xlcmUvSW5pdGlhbGl6ZS5qcyIsIi9ob21lL2JydWNlL0dpdC9HYW5nbGVyZS90bXAvZ2FuZ2xlcmUvSW50cm8uanMiLCIvaG9tZS9icnVjZS9HaXQvR2FuZ2xlcmUvdG1wL2dhbmdsZXJlL0xldmVscy5qcyIsIi9ob21lL2JydWNlL0dpdC9HYW5nbGVyZS90bXAvZ2FuZ2xlcmUvTWFwLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0dhbmdsZXJlL3RtcC9nYW5nbGVyZS9QbGF5ZXIuanMiLCIvaG9tZS9icnVjZS9HaXQvR2FuZ2xlcmUvdG1wL2dhbmdsZXJlL1JhbmRvbS5qcyIsIi9ob21lL2JydWNlL0dpdC9HYW5nbGVyZS90bXAvZ2FuZ2xlcmUvU2NvcmVzLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0dhbmdsZXJlL3RtcC9nYW5nbGVyZS9pbmRleC5qcyIsIi9ob21lL2JydWNlL0dpdC9HYW5nbGVyZS90bXAvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9PQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG5cInVzZSBzdHJpY3RcIjtcbnZhciBnYW5nbGVyZTtcblxuZ2FuZ2xlcmUgPSByZXF1aXJlKCcuLi9nYW5nbGVyZScpO1xuXG5nYW5nbGVyZS5BSSA9IChmdW5jdGlvbigpIHtcbiAgdmFyIGh1bnQsIHJlc2h1ZmZsZSwgd2FuZGVyO1xuXG4gIEFJLnByb3RvdHlwZS5nYW1lID0gbnVsbDtcblxuICByZXNodWZmbGUgPSBbXG4gICAge1xuICAgICAgeDogLTEsXG4gICAgICB5OiAwXG4gICAgfSwge1xuICAgICAgeDogMSxcbiAgICAgIHk6IDBcbiAgICB9LCB7XG4gICAgICB4OiAwLFxuICAgICAgeTogLTFcbiAgICB9LCB7XG4gICAgICB4OiAwLFxuICAgICAgeTogMVxuICAgIH1cbiAgXTtcblxuICB3YW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaSwgaiwgdDtcbiAgICBpID0gcmVzaHVmZmxlLmxlbmd0aDtcbiAgICB3aGlsZSAoLS1pID4gMCkge1xuICAgICAgaiA9IH5+KE1hdGgucmFuZG9tKCkgKiAoaSArIDEpKTtcbiAgICAgIHQgPSByZXNodWZmbGVbal07XG4gICAgICByZXNodWZmbGVbal0gPSByZXNodWZmbGVbaV07XG4gICAgICByZXNodWZmbGVbaV0gPSB0O1xuICAgIH1cbiAgICByZXR1cm4gcmVzaHVmZmxlO1xuICB9O1xuXG4gIGh1bnQgPSBmdW5jdGlvbihkZWx0YVgsIGRlbHRhWSkge1xuICAgIHJldHVybiBbXG4gICAgICB7XG4gICAgICAgIHg6IC0xLFxuICAgICAgICB5OiAwXG4gICAgICB9LCB7XG4gICAgICAgIHg6IDEsXG4gICAgICAgIHk6IDBcbiAgICAgIH0sIHtcbiAgICAgICAgeDogMCxcbiAgICAgICAgeTogLTFcbiAgICAgIH0sIHtcbiAgICAgICAgeDogMCxcbiAgICAgICAgeTogMVxuICAgICAgfVxuICAgIF0ubWFwKGZ1bmN0aW9uKGRpcmVjdGlvbikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeDogZGlyZWN0aW9uLngsXG4gICAgICAgIHk6IGRpcmVjdGlvbi55LFxuICAgICAgICBkaXN0YW5jZTogTWF0aC5wb3coZGVsdGFYICsgZGlyZWN0aW9uLngsIDIpICsgTWF0aC5wb3coZGVsdGFZICsgZGlyZWN0aW9uLnksIDIpXG4gICAgICB9O1xuICAgIH0pLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgICAgcmV0dXJuIGIuZGlzdGFuY2UgLSBhLmRpc3RhbmNlO1xuICAgIH0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIEFJKGdhbWUpIHtcbiAgICB0aGlzLmdhbWUgPSBnYW1lO1xuICB9XG5cbiAgQUkucHJvdG90eXBlLndhbmRlciA9IGZ1bmN0aW9uKGFjdG9yKSB7XG4gICAgdmFyIGRpcmVjdGlvbiwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgIF9yZWYgPSB3YW5kZXIoKTtcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgZGlyZWN0aW9uID0gX3JlZltfaV07XG4gICAgICBpZiAodGhpcy5nYW1lLm1vdmVUbyhhY3RvciwgZGlyZWN0aW9uKSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9yZXN1bHRzLnB1c2godm9pZCAwKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9O1xuXG4gIEFJLnByb3RvdHlwZS5odW50ID0gZnVuY3Rpb24oYWN0b3IsIGRlbHRhWCwgZGVsdGFZKSB7XG4gICAgdmFyIGRpcmVjdGlvbiwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgIF9yZWYgPSBodW50KGRlbHRhWCwgZGVsdGFZKTtcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgZGlyZWN0aW9uID0gX3JlZltfaV07XG4gICAgICBpZiAodGhpcy5nYW1lLm1vdmVUbyhhY3RvciwgZGlyZWN0aW9uKSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9yZXN1bHRzLnB1c2godm9pZCAwKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9O1xuXG4gIHJldHVybiBBSTtcblxufSkoKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcblwidXNlIHN0cmljdFwiO1xudmFyIGdhbmdsZXJlLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9O1xuXG5nYW5nbGVyZSA9IHJlcXVpcmUoJy4uL2dhbmdsZXJlJyk7XG5cbmdhbmdsZXJlLkFjdG9yID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgRlJBTUVfQkFDSywgRlJBTUVfRlJPTlQsIEZSQU1FX0xFRlQsIEZSQU1FX1JJR0hULCBIVU5URVIsIFdISVRFLCBfcmVmO1xuXG4gIEFjdG9yLmFsbCA9IFtdO1xuXG4gIEFjdG9yLm1hcCA9IHt9O1xuXG4gIF9yZWYgPSBnYW5nbGVyZS5jb25maWcsIEZSQU1FX0ZST05UID0gX3JlZi5GUkFNRV9GUk9OVCwgRlJBTUVfQkFDSyA9IF9yZWYuRlJBTUVfQkFDSywgRlJBTUVfTEVGVCA9IF9yZWYuRlJBTUVfTEVGVCwgRlJBTUVfUklHSFQgPSBfcmVmLkZSQU1FX1JJR0hUO1xuXG4gIFdISVRFID0gJyNmZmYnO1xuXG4gIEhVTlRFUiA9ICcjZmYwMDQ0JztcblxuICBBY3Rvci5wcm90b3R5cGUuaXNQbGF5ZXIgPSBmYWxzZTtcblxuICBBY3Rvci5wcm90b3R5cGUuZ2FtZSA9IG51bGw7XG5cbiAgQWN0b3IucHJvdG90eXBlLnNwcml0ZSA9IG51bGw7XG5cbiAgQWN0b3IucHJvdG90eXBlLnggPSAwO1xuXG4gIEFjdG9yLnByb3RvdHlwZS55ID0gMDtcblxuICBBY3Rvci5wcm90b3R5cGUuaHAgPSAwO1xuXG4gIEFjdG9yLnByb3RvdHlwZS5kYW1hZ2UgPSBcImQ4KzJcIjtcblxuICBmdW5jdGlvbiBBY3RvcihnYW1lLCB4LCB5LCBrZXkpIHtcbiAgICB0aGlzLnNldEZyYW1lID0gX19iaW5kKHRoaXMuc2V0RnJhbWUsIHRoaXMpO1xuICAgIHRoaXMuc2V0T2ZzZXQgPSBfX2JpbmQodGhpcy5zZXRPZnNldCwgdGhpcyk7XG4gICAgdGhpcy5zZXRYWSA9IF9fYmluZCh0aGlzLnNldFhZLCB0aGlzKTtcbiAgICB0aGlzLmF0dGFjayA9IF9fYmluZCh0aGlzLmF0dGFjaywgdGhpcyk7XG4gICAgdGhpcy5tb3ZlID0gX19iaW5kKHRoaXMubW92ZSwgdGhpcyk7XG4gICAgdGhpcy5ocCA9IDM7XG4gICAgdGhpcy54ID0geDtcbiAgICB0aGlzLnkgPSB5O1xuICAgIHRoaXMuY29uZmlnID0gZ2FuZ2xlcmUuY29uZmlnLnNwcml0ZXNba2V5XTtcbiAgICB0aGlzLnNldE9mc2V0KHRoaXMuY29uZmlnLmF4aXMpO1xuICAgIHRoaXMua2V5ID0gdGhpcy5jb25maWcuc2VsZWN0ZWQgIT0gbnVsbCA/IFwiXCIgKyBrZXkgKyBcIltcIiArIHRoaXMuY29uZmlnLnNlbGVjdGVkICsgXCJdXCIgOiBrZXk7XG4gICAgaWYgKGdhbWUpIHtcbiAgICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgICB0aGlzLnNwcml0ZSA9IGdhbWUuYWRkLnNwcml0ZSh4ICogMzIsIHkgKiAzMiwgdGhpcy5rZXkpO1xuICAgIH1cbiAgfVxuXG4gIEFjdG9yLnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24oKSB7fTtcblxuICBBY3Rvci5wcm90b3R5cGUuYXR0YWNrID0gZnVuY3Rpb24odmljdGltKSB7XG4gICAgdmFyIGF4aXMsIGNvbG9yLCBkYW1hZ2UsIGRpciwgcG9zMSwgcG9zMjtcbiAgICBkYW1hZ2UgPSBnYW5nbGVyZS5SYW5kb20uZGljZVJvbGwodGhpcy5kYW1hZ2UpLnRvdGFsO1xuICAgIHZpY3RpbS5ocCAtPSBkYW1hZ2U7XG4gICAgYXhpcyA9IHRoaXMueCA9PT0gdmljdGltLnggPyBcInlcIiA6IFwieFwiO1xuICAgIGRpciA9IHZpY3RpbVtheGlzXSAtIHRoaXNbYXhpc107XG4gICAgZGlyID0gZGlyIC8gTWF0aC5hYnMoZGlyKTtcbiAgICBwb3MxID0ge307XG4gICAgcG9zMiA9IHt9O1xuICAgIHBvczFbYXhpc10gPSAoZGlyICogMTUpLnRvU3RyaW5nKCk7XG4gICAgcG9zMltheGlzXSA9IChkaXIgKiAxNSAqICgtMSkpLnRvU3RyaW5nKCk7XG4gICAgdGhpcy5nYW1lLmNhbWVyYS5mb2xsb3coZmFsc2UpO1xuICAgIHRoaXMuZ2FtZS5hZGQudHdlZW4odGhpcy5zcHJpdGUpLnRvKHBvczEsIDIwMCwgUGhhc2VyLkVhc2luZy5FbGFzdGljLkluLCB0cnVlKS50byhwb3MyLCAyMDAsIFBoYXNlci5FYXNpbmcuRWxhc3RpYy5PdXQsIHRydWUpLm9uQ29tcGxldGUuYWRkKCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLmdhbWUuY2FtZXJhLmZvbGxvdyhfdGhpcy5zcHJpdGUpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSksIHRoaXMpO1xuICAgIGNvbG9yID0gdmljdGltLmlzUGxheWVyID8gSFVOVEVSIDogV0hJVEU7XG4gICAgcmV0dXJuIHRoaXMuZ2FtZS5zaG93RGFtYWdlKGRhbWFnZS50b1N0cmluZygpLCB2aWN0aW0uc3ByaXRlLCA0NTAsIGNvbG9yKTtcbiAgfTtcblxuICBBY3Rvci5wcm90b3R5cGUuc2V0WFkgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgdGhpcy54ID0geDtcbiAgICB0aGlzLnkgPSB5O1xuICAgIHRoaXMuZ2FtZS5hZGQudHdlZW4odGhpcy5zcHJpdGUpLnRvKHtcbiAgICAgIHg6IHggKiAzMixcbiAgICAgIHk6IHkgKiAzMlxuICAgIH0sIDUwMCwgUGhhc2VyLkVhc2luZy5MaW5lYXIuTm9uZSwgdHJ1ZSk7XG4gIH07XG5cbiAgQWN0b3IucHJvdG90eXBlLnNldE9mc2V0ID0gZnVuY3Rpb24oYXhpcykge1xuICAgIHZhciByMCwgcjEsIHIyLCByMztcbiAgICBzd2l0Y2ggKHRoaXMuY29uZmlnLnR5cGUpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgcjAgPSBheGlzICogNCArIHRoaXMuY29uZmlnLm9yZGVyWzBdO1xuICAgICAgICByMSA9IGF4aXMgKiA0ICsgdGhpcy5jb25maWcub3JkZXJbMV07XG4gICAgICAgIHIyID0gYXhpcyAqIDQgKyB0aGlzLmNvbmZpZy5vcmRlclsyXTtcbiAgICAgICAgcjMgPSBheGlzICogNCArIHRoaXMuY29uZmlnLm9yZGVyWzNdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjAgPSBheGlzICsgdGhpcy5jb25maWcuY29scyAqIHRoaXMuY29uZmlnLm9yZGVyWzBdO1xuICAgICAgICByMSA9IGF4aXMgKyB0aGlzLmNvbmZpZy5jb2xzICogdGhpcy5jb25maWcub3JkZXJbMV07XG4gICAgICAgIHIyID0gYXhpcyArIHRoaXMuY29uZmlnLmNvbHMgKiB0aGlzLmNvbmZpZy5vcmRlclsyXTtcbiAgICAgICAgcjMgPSBheGlzICsgdGhpcy5jb25maWcuY29scyAqIHRoaXMuY29uZmlnLm9yZGVyWzNdO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHIwID0gMDtcbiAgICAgICAgcjEgPSAwO1xuICAgICAgICByMiA9IDA7XG4gICAgICAgIHIzID0gMDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMub2ZzZXQgPSBbcjAsIHIxLCByMiwgcjNdO1xuICB9O1xuXG4gIEFjdG9yLnByb3RvdHlwZS5zZXRGcmFtZSA9IGZ1bmN0aW9uKGRpcikge1xuICAgIGlmIChkaXIueCA9PT0gMSkge1xuICAgICAgcmV0dXJuIHRoaXMuc3ByaXRlLmZyYW1lID0gdGhpcy5vZnNldFtGUkFNRV9SSUdIVF07XG4gICAgfSBlbHNlIGlmIChkaXIueCA9PT0gLTEpIHtcbiAgICAgIHJldHVybiB0aGlzLnNwcml0ZS5mcmFtZSA9IHRoaXMub2ZzZXRbRlJBTUVfTEVGVF07XG4gICAgfSBlbHNlIGlmIChkaXIueSA9PT0gLTEpIHtcbiAgICAgIHJldHVybiB0aGlzLnNwcml0ZS5mcmFtZSA9IHRoaXMub2ZzZXRbRlJBTUVfQkFDS107XG4gICAgfSBlbHNlIGlmIChkaXIueSA9PT0gMSkge1xuICAgICAgcmV0dXJuIHRoaXMuc3ByaXRlLmZyYW1lID0gdGhpcy5vZnNldFtGUkFNRV9GUk9OVF07XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBBY3RvcjtcblxufSkoKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcblwidXNlIHN0cmljdFwiO1xudmFyIGdhbmdsZXJlLFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmdhbmdsZXJlID0gcmVxdWlyZSgnLi4vZ2FuZ2xlcmUnKTtcblxuZ2FuZ2xlcmUuQXNzZXRzID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoQXNzZXRzLCBfc3VwZXIpO1xuXG4gIEFzc2V0cy5wcm90b3R5cGUuc3BsYXNoU2NyZWVuID0gUGhhc2VyLlNwcml0ZTtcblxuICBmdW5jdGlvbiBBc3NldHMoKSB7fVxuXG4gIEFzc2V0cy5iYWNrZ3JvdW5kID0gbnVsbDtcblxuICBBc3NldHMucHJlbG9hZEJhciA9IG51bGw7XG5cbiAgQXNzZXRzLnByZWxvYWRCZ2QgPSBudWxsO1xuXG4gIEFzc2V0cy5yZWFkeSA9IGZhbHNlO1xuXG4gIEFzc2V0cy5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBmaWxlLCBpeCwga2V5LCBsZXZlbCwgc3ByaXRlLCBfcmVmLCBfcmVmMSwgX3Jlc3VsdHM7XG4gICAgdGhpcy5hZGQuc3ByaXRlKDAsIDAsICdzcGxhc2gnKTtcbiAgICB0aGlzLnByZWxvYWRCZ2QgPSB0aGlzLmFkZC5zcHJpdGUodGhpcy5nYW1lLndpZHRoIC8gMiAtIDI1MCwgdGhpcy5nYW1lLmhlaWdodCAtIDEwMCwgJ3ByZWxvYWRlckJhY2tncm91bmQnKTtcbiAgICB0aGlzLnByZWxvYWRCYXIgPSB0aGlzLmFkZC5zcHJpdGUodGhpcy5nYW1lLndpZHRoIC8gMiAtIDI1MCwgdGhpcy5nYW1lLmhlaWdodCAtIDEwMCwgJ3ByZWxvYWRlckJhcicpO1xuICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMucHJlbG9hZEJhcik7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdiYWNrZ3JvdW5kJywgJ2Fzc2V0cy9pbWFnZXMvYmFja2dyb3VuZC5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2JhY2tCdXR0b24nLCAnYXNzZXRzL2ltYWdlcy9idXR0b25zL2JhY2sxLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgncGxheUJ1dHRvbicsICdhc3NldHMvaW1hZ2VzL2J1dHRvbnMvcGxheTEucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdzY29yZUJ1dHRvbicsICdhc3NldHMvaW1hZ2VzL2J1dHRvbnMvc2NvcmUxLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnY3JlZGl0c0J1dHRvbicsICdhc3NldHMvaW1hZ2VzL2J1dHRvbnMvY3JlZGl0czEucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdxdW90ZScsICdhc3NldHMvaW1hZ2VzL3F1b3RlLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnaWNvbicsICdhc3NldHMvaW1hZ2VzL2ljb24ucG5nJyk7XG4gICAgX3JlZiA9IGdhbmdsZXJlLmNvbmZpZy5sZXZlbHM7XG4gICAgZm9yIChrZXkgaW4gX3JlZikge1xuICAgICAgbGV2ZWwgPSBfcmVmW2tleV07XG4gICAgICB0aGlzLmxvYWQuanNvbihcIlwiICsgbGV2ZWwub3B0aW9ucy5tYXAgKyBcIi5qc29uXCIsIFwiYXNzZXRzL2xldmVscy9cIiArIGxldmVsLm9wdGlvbnMubWFwICsgXCIuanNvblwiKTtcbiAgICB9XG4gICAgX3JlZjEgPSBnYW5nbGVyZS5jb25maWcuc3ByaXRlcztcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoa2V5IGluIF9yZWYxKSB7XG4gICAgICBzcHJpdGUgPSBfcmVmMVtrZXldO1xuICAgICAgaWYgKCdzdHJpbmcnID09PSB0eXBlb2Ygc3ByaXRlLmZpbGUpIHtcbiAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLmxvYWQuc3ByaXRlc2hlZXQoa2V5LCBzcHJpdGUuZmlsZSwgc3ByaXRlLndpZHRoLCBzcHJpdGUuaGVpZ2h0KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc3ByaXRlLnNlbGVjdGVkICE9IG51bGwpIHtcbiAgICAgICAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoa2V5LCBzcHJpdGUuZmlsZVtzcHJpdGUuc2VsZWN0ZWRdLCBzcHJpdGUud2lkdGgsIHNwcml0ZS5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIF9yZXN1bHRzLnB1c2goKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZjIsIF9yZXN1bHRzMTtcbiAgICAgICAgICBfcmVmMiA9IHNwcml0ZS5maWxlO1xuICAgICAgICAgIF9yZXN1bHRzMSA9IFtdO1xuICAgICAgICAgIGZvciAoaXggPSBfaSA9IDAsIF9sZW4gPSBfcmVmMi5sZW5ndGg7IF9pIDwgX2xlbjsgaXggPSArK19pKSB7XG4gICAgICAgICAgICBmaWxlID0gX3JlZjJbaXhdO1xuICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2godGhpcy5sb2FkLnNwcml0ZXNoZWV0KFwiXCIgKyBrZXkgKyBcIltcIiArIGl4ICsgXCJdXCIsIGZpbGUsIHNwcml0ZS53aWR0aCwgc3ByaXRlLmhlaWdodCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX3Jlc3VsdHMxO1xuICAgICAgICB9KS5jYWxsKHRoaXMpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9O1xuXG4gIEFzc2V0cy5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucHJlbG9hZEJhci5jcm9wRW5hYmxlZCA9IGZhbHNlO1xuICB9O1xuXG4gIEFzc2V0cy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUuc3RhcnQoJ0ludHJvJywgdHJ1ZSwgZmFsc2UsIHtcbiAgICAgIGxldmVsOiAwXG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIEFzc2V0cztcblxufSkoUGhhc2VyLlN0YXRlKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcblwidXNlIHN0cmljdFwiO1xudmFyIENvbmZpZywgRlJBTUVfQkFDSywgRlJBTUVfRlJPTlQsIEZSQU1FX0xFRlQsIEZSQU1FX1JJR0hULCBnYW5nbGVyZTtcblxuRlJBTUVfRlJPTlQgPSAwO1xuXG5GUkFNRV9CQUNLID0gMTtcblxuRlJBTUVfUklHSFQgPSAyO1xuXG5GUkFNRV9MRUZUID0gMztcblxuZ2FuZ2xlcmUgPSByZXF1aXJlKFwiLi4vZ2FuZ2xlcmVcIik7XG5cbmdhbmdsZXJlLmNvbmZpZyA9IG5ldyAoQ29uZmlnID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBDb25maWcoKSB7fVxuXG4gIENvbmZpZy5wcm90b3R5cGUuRlJBTUVfRlJPTlQgPSBGUkFNRV9GUk9OVDtcblxuICBDb25maWcucHJvdG90eXBlLkZSQU1FX0JBQ0sgPSBGUkFNRV9CQUNLO1xuXG4gIENvbmZpZy5wcm90b3R5cGUuRlJBTUVfUklHSFQgPSBGUkFNRV9SSUdIVDtcblxuICBDb25maWcucHJvdG90eXBlLkZSQU1FX0xFRlQgPSBGUkFNRV9MRUZUO1xuXG4gIENvbmZpZy5wcm90b3R5cGUubmFtZSA9ICdUaGUgRGVsdWRpbmcgb2YgR3lsZmUnO1xuXG4gIENvbmZpZy5wcm90b3R5cGUuc3ByaXRlcyA9IHtcbiAgICAnZm9yZXN0LXRpbGVzJzoge1xuICAgICAgZmlsZTogJ2Fzc2V0cy9pbWFnZXMvZm9yZXN0dGlsZXNfMC5wbmcnLFxuICAgICAgd2lkdGg6IDMyLFxuICAgICAgaGVpZ2h0OiAzMixcbiAgICAgIGNvbHM6IDUsXG4gICAgICByb3dzOiA3XG4gICAgfSxcbiAgICBoZXJvZXM6IHtcbiAgICAgIGZpbGU6IFsnYXNzZXRzL3Nwcml0ZXMvSGVyb2VzL0ZpZ2h0ZXItRi0wMS5wbmcnLCAnYXNzZXRzL3Nwcml0ZXMvSGVyb2VzL0ZpZ2h0ZXItRi0wMi5wbmcnLCAnYXNzZXRzL3Nwcml0ZXMvSGVyb2VzL0ZpZ2h0ZXItTS0wMS5wbmcnLCAnYXNzZXRzL3Nwcml0ZXMvSGVyb2VzL0ZpZ2h0ZXItTS0wMi5wbmcnLCAnYXNzZXRzL3Nwcml0ZXMvSGVyb2VzL0hlYWxlci1GLTAxLnBuZycsICdhc3NldHMvc3ByaXRlcy9IZXJvZXMvSGVhbGVyLU0tMDEucG5nJywgJ2Fzc2V0cy9zcHJpdGVzL0hlcm9lcy9NYWdlLUYtMDEucG5nJywgJ2Fzc2V0cy9zcHJpdGVzL0hlcm9lcy9NYWdlLU0tMDEucG5nJywgJ2Fzc2V0cy9zcHJpdGVzL0hlcm9lcy9SYW5nZXItRi0wMS5wbmcnLCAnYXNzZXRzL3Nwcml0ZXMvSGVyb2VzL1Jhbmdlci1NLTAxLnBuZyddLFxuICAgICAgc2VsZWN0ZWQ6IDksXG4gICAgICB3aWR0aDogMjQsXG4gICAgICBoZWlnaHQ6IDMyLFxuICAgICAgY29sczogNixcbiAgICAgIHJvd3M6IDQsXG4gICAgICB0eXBlOiAxLFxuICAgICAgYXhpczogMCxcbiAgICAgIG9yZGVyOiBbRlJBTUVfUklHSFQsIEZSQU1FX0ZST05ULCBGUkFNRV9CQUNLLCBGUkFNRV9MRUZUXVxuICAgIH0sXG4gICAgZmVucmlzOiB7XG4gICAgICBmaWxlOiAnYXNzZXRzL2ltYWdlcy93b2x2ZXMucG5nJyxcbiAgICAgIHdpZHRoOiAzMixcbiAgICAgIGhlaWdodDogMzIsXG4gICAgICBjb2xzOiAzLFxuICAgICAgcm93czogNCxcbiAgICAgIHR5cGU6IDEsXG4gICAgICBheGlzOiAwLFxuICAgICAgb3JkZXI6IFtGUkFNRV9GUk9OVCwgRlJBTUVfTEVGVCwgRlJBTUVfUklHSFQsIEZSQU1FX0JBQ0tdXG4gICAgfSxcbiAgICBsb2tlOiB7XG4gICAgICBmaWxlOiBbJ2Fzc2V0cy9pbWFnZXMvb2dyZXMxLnBuZycsICdhc3NldHMvaW1hZ2VzL29ncmVzMi5wbmcnXSxcbiAgICAgIHNlbGVjdGVkOiAxLFxuICAgICAgd2lkdGg6IDMyLFxuICAgICAgaGVpZ2h0OiAzMixcbiAgICAgIGNvbHM6IDQsXG4gICAgICByb3dzOiA0LFxuICAgICAgdHlwZTogMCxcbiAgICAgIGF4aXM6IDMsXG4gICAgICBvcmRlcjogW0ZSQU1FX0ZST05ULCBGUkFNRV9MRUZULCBGUkFNRV9CQUNLLCBGUkFNRV9SSUdIVF1cbiAgICB9LFxuICAgIHRob3I6IHtcbiAgICAgIGZpbGU6IFsnYXNzZXRzL2ltYWdlcy9vZ3JlczEucG5nJywgJ2Fzc2V0cy9pbWFnZXMvb2dyZXMyLnBuZyddLFxuICAgICAgc2VsZWN0ZWQ6IDEsXG4gICAgICB3aWR0aDogMzIsXG4gICAgICBoZWlnaHQ6IDMyLFxuICAgICAgY29sczogNCxcbiAgICAgIHJvd3M6IDQsXG4gICAgICB0eXBlOiAwLFxuICAgICAgYXhpczogMixcbiAgICAgIG9yZGVyOiBbRlJBTUVfRlJPTlQsIEZSQU1FX0xFRlQsIEZSQU1FX0JBQ0ssIEZSQU1FX1JJR0hUXVxuICAgIH1cbiAgfTtcblxuICBDb25maWcucHJvdG90eXBlLmxldmVscyA9IHtcbiAgICBGZW5yaXM6IHtcbiAgICAgIHRpdGxlOiAnRmVucmlzIGF0IHRoZSBHYXRlJyxcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgYWN0b3JzOiAyMCxcbiAgICAgICAgbWFwOiAnZmVucmlzJyxcbiAgICAgICAgaGlkZTogZmFsc2UsXG4gICAgICAgIGFydGlmYWN0czogZmFsc2VcbiAgICAgIH0sXG4gICAgICBwbGF5ZXI6IHtcbiAgICAgICAgaHA6IDYwLFxuICAgICAgICBzcHJpdGU6IFwiaGVyb2VzXCIsXG4gICAgICAgIGRhbWFnZTogXCJkNisyXCJcbiAgICAgIH0sXG4gICAgICBlbmVteToge1xuICAgICAgICBocDogNSxcbiAgICAgICAgc3ByaXRlOiBcImZlbnJpc1wiLFxuICAgICAgICBkYW1hZ2U6IFwiZDIrMFwiXG4gICAgICB9XG4gICAgfSxcbiAgICBMb2tlOiB7XG4gICAgICB0aXRsZTogJ0NvbWJhdCB3aXRoIExva2UnLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICBhY3RvcnM6IDEwLFxuICAgICAgICBtYXA6ICdsb2tlJyxcbiAgICAgICAgaGlkZTogZmFsc2UsXG4gICAgICAgIGFydGlmYWN0czogZmFsc2VcbiAgICAgIH0sXG4gICAgICBwbGF5ZXI6IHtcbiAgICAgICAgaHA6IDIwMCxcbiAgICAgICAgc3ByaXRlOiBcImhlcm9lc1wiLFxuICAgICAgICBkYW1hZ2U6IFwiZDYrMlwiXG4gICAgICB9LFxuICAgICAgZW5lbXk6IHtcbiAgICAgICAgaHA6IDUsXG4gICAgICAgIHNwcml0ZTogXCJsb2tlXCIsXG4gICAgICAgIGRhbWFnZTogXCJkMisxXCJcbiAgICAgIH1cbiAgICB9LFxuICAgIFRob3I6IHtcbiAgICAgIHRpdGxlOiAnVGhvciBiZWF0cyB5b3VyIGEkJCEnLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICBhY3RvcnM6IDI1LFxuICAgICAgICBtYXA6ICd0aG9yJyxcbiAgICAgICAgaGlkZTogdHJ1ZSxcbiAgICAgICAgYXJ0aWZhY3RzOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIHBsYXllcjoge1xuICAgICAgICBocDogNTAwLFxuICAgICAgICBzcHJpdGU6IFwiaGVyb2VzXCIsXG4gICAgICAgIGRhbWFnZTogXCJkNisyXCJcbiAgICAgIH0sXG4gICAgICBlbmVteToge1xuICAgICAgICBocDogNSxcbiAgICAgICAgc3ByaXRlOiBcInRob3JcIixcbiAgICAgICAgZGFtYWdlOiBcImQyKzJcIlxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ29uZmlnO1xuXG59KSgpKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcblwidXNlIHN0cmljdFwiO1xudmFyIGdhbmdsZXJlLFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmdhbmdsZXJlID0gcmVxdWlyZSgnLi4vZ2FuZ2xlcmUnKTtcblxuZ2FuZ2xlcmUuQ3JlZGl0cyA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKENyZWRpdHMsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gQ3JlZGl0cygpIHtcbiAgICByZXR1cm4gQ3JlZGl0cy5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIENyZWRpdHMucHJvdG90eXBlLnRleHQgPSBcIlByb2dyYW0gYnkgZGFya292ZXJsb3Jkb2ZkYXRhXFxuXFxuU3ByaXRlcyBieSBTdmV0bGFuYSBLdXNobmFyaW92YVxcbiAgbGFuYS1jaGFuQHlhbmRleC5ydVxcblxcbldlYiBmb250IEVhZ2xlIExha2UgYnkgYXN0aWdtYXRpY1xcblxcblZlbGx1bSB0b25lZCBwYXBlciB0ZXh0dXJlIGJ5IHNwb3JreXN0b2NrXCI7XG5cbiAgQ3JlZGl0cy5wcm90b3R5cGUuY29weXJpZ2h0ID0gXCJDb3B5cmlnaHQgMjAxNCBEYXJrIE92ZXJsb3JkIG9mIERhdGFcIjtcblxuICBDcmVkaXRzLnByb3RvdHlwZS5xdW90ZVN0eWxlID0ge1xuICAgIGZvbnQ6IFwiaXRhbGljIDE0cHggQXJpYWxcIixcbiAgICBmaWxsOiAnIzAwMCcsXG4gICAgYWxpZ246ICdjZW50ZXInXG4gIH07XG5cbiAgQ3JlZGl0cy5wcm90b3R5cGUuc3R5bGUgPSB7XG4gICAgZm9udDogXCIxNHB4IEFyaWFsXCIsXG4gICAgZmlsbDogJyMwMDAnLFxuICAgIGFsaWduOiAnY2VudGVyJ1xuICB9O1xuXG4gIENyZWRpdHMucHJvdG90eXBlLnByZWxvYWQgPSBmdW5jdGlvbigpIHt9O1xuXG4gIENyZWRpdHMucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuYWRkLnNwcml0ZSgwLCAwLCAnYmFja2dyb3VuZCcpO1xuICAgIHRoaXMuYWRkLnNwcml0ZSgwLCAwLCAnaWNvbicpO1xuICAgIHRoaXMuYWRkLnNwcml0ZSgwLCAxMCwgJ3F1b3RlJyk7XG4gICAgdGhpcy5hZGQudGV4dCgxMCwgMTUwLCB0aGlzLnRleHQsIHRoaXMuc3R5bGUpO1xuICAgIHRoaXMuYWRkLmJ1dHRvbih0aGlzLmdhbWUud2lkdGggLyAyIC0gMzgsIHRoaXMuZ2FtZS5oZWlnaHQgLSA4MCwgJ2JhY2tCdXR0b24nLCB0aGlzLmdvQmFjaywgdGhpcywgMiwgMSwgMCk7XG4gICAgcmV0dXJuIHRoaXMuYWRkLnRleHQoNTAsIHRoaXMuZ2FtZS5oZWlnaHQgLSA0MCwgdGhpcy5jb3B5cmlnaHQsIHRoaXMuc3R5bGUpO1xuICB9O1xuXG4gIENyZWRpdHMucHJvdG90eXBlLmdvQmFjayA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXRlLnN0YXJ0KCdJbnRybycsIHRydWUsIGZhbHNlKTtcbiAgfTtcblxuICByZXR1cm4gQ3JlZGl0cztcblxufSkoUGhhc2VyLlN0YXRlKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcblwidXNlIHN0cmljdFwiO1xudmFyIGdhbmdsZXJlLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmdhbmdsZXJlID0gcmVxdWlyZSgnLi4vZ2FuZ2xlcmUnKTtcblxuZ2FuZ2xlcmUuRW5lbXkgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhFbmVteSwgX3N1cGVyKTtcblxuICBFbmVteS5wcm90b3R5cGUuYWkgPSBudWxsO1xuXG4gIGZ1bmN0aW9uIEVuZW15KGdhbWUsIHgsIHkpIHtcbiAgICB0aGlzLm1vdmUgPSBfX2JpbmQodGhpcy5tb3ZlLCB0aGlzKTtcbiAgICBFbmVteS5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCBnYW1lLmVuZW15LnNwcml0ZSk7XG4gICAgdGhpcy5ocCA9IGdhbWUuZW5lbXkuaHA7XG4gICAgdGhpcy5kYW1hZ2UgPSBnYW1lLmVuZW15LmRhbWFnZTtcbiAgICB0aGlzLmlzUGxheWVyID0gZmFsc2U7XG4gICAgdGhpcy5haSA9IG5ldyBnYW5nbGVyZS5BSShnYW1lKTtcbiAgfVxuXG4gIEVuZW15LnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24ocGxheWVyKSB7XG4gICAgdmFyIGRlbHRhWCwgZGVsdGFZO1xuICAgIGRlbHRhWCA9IHBsYXllci54IC0gdGhpcy54O1xuICAgIGRlbHRhWSA9IHBsYXllci55IC0gdGhpcy55O1xuICAgIGlmIChNYXRoLmFicyhkZWx0YVgpICsgTWF0aC5hYnMoZGVsdGFZKSA+IDYpIHtcbiAgICAgIHJldHVybiB0aGlzLmFpLndhbmRlcih0aGlzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuYWkuaHVudCh0aGlzLCBkZWx0YVgsIGRlbHRhWSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBFbmVteTtcblxufSkoZ2FuZ2xlcmUuQWN0b3IpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuXCJ1c2Ugc3RyaWN0XCI7XG52YXIgZ2FuZ2xlcmUsXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuZ2FuZ2xlcmUgPSByZXF1aXJlKFwiLi4vZ2FuZ2xlcmVcIik7XG5cbmdhbmdsZXJlLkdhbWVPdmVyID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoR2FtZU92ZXIsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gR2FtZU92ZXIoKSB7XG4gICAgdGhpcy5jcmVhdGUgPSBfX2JpbmQodGhpcy5jcmVhdGUsIHRoaXMpO1xuICAgIHJldHVybiBHYW1lT3Zlci5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIEdhbWVPdmVyLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZ2FtZU92ZXI7XG4gICAgZ2FtZU92ZXIgPSB0aGlzLmFkZC50ZXh0KDAsIDAsIFwiR2FtZSBPdmVyXFxuQ3RybCtyIHRvIHJlc3RhcnRcIiwge1xuICAgICAgZmlsbDogXCIjZTIyXCIsXG4gICAgICBhbGlnbjogXCJjZW50ZXJcIlxuICAgIH0pO1xuICAgIGdhbWVPdmVyLmZpeGVkVG9DYW1lcmEgPSB0cnVlO1xuICAgIHJldHVybiBnYW1lT3Zlci5jYW1lcmFPZmZzZXQuc2V0VG8oMCwgMCk7XG4gIH07XG5cbiAgcmV0dXJuIEdhbWVPdmVyO1xuXG59KShQaGFzZXIuU3RhdGUpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuXCJ1c2Ugc3RyaWN0XCI7XG52YXIgZ2FuZ2xlcmUsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuZ2FuZ2xlcmUgPSByZXF1aXJlKCcuLi9nYW5nbGVyZScpO1xuXG5nYW5nbGVyZS5Jbml0aWFsaXplID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoSW5pdGlhbGl6ZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBJbml0aWFsaXplKCkge1xuICAgIHJldHVybiBJbml0aWFsaXplLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgSW5pdGlhbGl6ZS5zY29yZSA9IDA7XG5cbiAgSW5pdGlhbGl6ZS5tdXNpYyA9IG51bGw7XG5cbiAgSW5pdGlhbGl6ZS5vcmllbnRhdGVkID0gZmFsc2U7XG5cbiAgSW5pdGlhbGl6ZS5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubG9hZC5pbWFnZSgnc3BsYXNoJywgJ2Fzc2V0cy9pbWFnZXMvc3BsYXNoLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgncHJlbG9hZGVyQmFja2dyb3VuZCcsICdhc3NldHMvaW1hZ2VzL3Byb2dyZXNzX2Jhcl9iYWNrZ3JvdW5kLnBuZycpO1xuICAgIHJldHVybiB0aGlzLmxvYWQuaW1hZ2UoJ3ByZWxvYWRlckJhcicsICdhc3NldHMvaW1hZ2VzL3Byb2dyZXNzX2Jhci5wbmcnKTtcbiAgfTtcblxuICBJbml0aWFsaXplLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmlucHV0Lm1heFBvaW50ZXJzID0gMTtcbiAgICB0aGlzLnN0YWdlLmRpc2FibGVWaXNpYmlsaXR5Q2hhbmdlID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5nYW1lLmRldmljZS5kZXNrdG9wKSB7XG4gICAgICB0aGlzLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XG4gICAgICB0aGlzLnNjYWxlLm1pbldpZHRoID0gMzIwO1xuICAgICAgdGhpcy5zY2FsZS5taW5IZWlnaHQgPSA0ODA7XG4gICAgICB0aGlzLnNjYWxlLm1heFdpZHRoID0gNjQwO1xuICAgICAgdGhpcy5zY2FsZS5tYXhIZWlnaHQgPSA5NjA7XG4gICAgICB0aGlzLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgICB0aGlzLnNjYWxlLnBhZ2VBbGlnblZlcnRpY2FsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XG4gICAgICB0aGlzLnNjYWxlLm1pbldpZHRoID0gMzIwO1xuICAgICAgdGhpcy5zY2FsZS5taW5IZWlnaHQgPSA0ODA7XG4gICAgICB0aGlzLnNjYWxlLm1heFdpZHRoID0gNjQwO1xuICAgICAgdGhpcy5zY2FsZS5tYXhIZWlnaHQgPSA5NjA7XG4gICAgICB0aGlzLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgICB0aGlzLnNjYWxlLnBhZ2VBbGlnblZlcnRpY2FsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5zY2FsZS5mb3JjZU9yaWVudGF0aW9uKGZhbHNlKTtcbiAgICAgIHRoaXMuc2NhbGUuaGFzUmVzaXplZC5hZGQodGhpcy5nYW1lUmVzaXplZCwgdGhpcyk7XG4gICAgICB0aGlzLnNjYWxlLmVudGVySW5jb3JyZWN0T3JpZW50YXRpb24uYWRkKHRoaXMuZW50ZXJJbmNvcnJlY3RPcmllbnRhdGlvbiwgdGhpcyk7XG4gICAgICB0aGlzLnNjYWxlLmxlYXZlSW5jb3JyZWN0T3JpZW50YXRpb24uYWRkKHRoaXMubGVhdmVJbmNvcnJlY3RPcmllbnRhdGlvbiwgdGhpcyk7XG4gICAgICB0aGlzLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnN0YXRlLnN0YXJ0KCdBc3NldHMnLCB0cnVlLCBmYWxzZSk7XG4gIH07XG5cbiAgSW5pdGlhbGl6ZS5wcm90b3R5cGUuZ2FtZVJlc2l6ZWQgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7fTtcblxuICBJbml0aWFsaXplLnByb3RvdHlwZS5lbnRlckluY29ycmVjdE9yaWVudGF0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgR2FuZ2xlcmUub3JpZW50YXRlZCA9IGZhbHNlO1xuICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3JpZW50YXRpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgfTtcblxuICBJbml0aWFsaXplLnByb3RvdHlwZS5sZWF2ZUluY29ycmVjdE9yaWVudGF0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgR2FuZ2xlcmUub3JpZW50YXRlZCA9IHRydWU7XG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcmllbnRhdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gIH07XG5cbiAgcmV0dXJuIEluaXRpYWxpemU7XG5cbn0pKFBoYXNlci5TdGF0ZSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG5cInVzZSBzdHJpY3RcIjtcbnZhciBnYW5nbGVyZSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5nYW5nbGVyZSA9IHJlcXVpcmUoJy4uL2dhbmdsZXJlJyk7XG5cbmdhbmdsZXJlLkludHJvID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoSW50cm8sIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gSW50cm8oKSB7XG4gICAgcmV0dXJuIEludHJvLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgSW50cm8ucHJvdG90eXBlLnByZWxvYWQgPSBmdW5jdGlvbigpIHt9O1xuXG4gIEludHJvLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmFkZC5zcHJpdGUoMCwgMCwgJ3NwbGFzaCcpO1xuICAgIHRoaXMuYWRkLmJ1dHRvbigxMDAsIDI3MCwgJ3BsYXlCdXR0b24nLCB0aGlzLnN0YXJ0R2FtZSwgdGhpcywgMiwgMSwgMCk7XG4gICAgdGhpcy5hZGQuYnV0dG9uKDEwMCwgMzEwLCAnY3JlZGl0c0J1dHRvbicsIHRoaXMuc2hvd0NyZWRpdHMsIHRoaXMsIDIsIDEsIDApO1xuICAgIHJldHVybiB0aGlzLmFkZC5idXR0b24oMTAwLCAzNTAsICdzY29yZUJ1dHRvbicsIHRoaXMuc2hvd1Njb3JlcywgdGhpcywgMiwgMSwgMCk7XG4gIH07XG5cbiAgSW50cm8ucHJvdG90eXBlLnNob3dDcmVkaXRzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUuc3RhcnQoJ0NyZWRpdHMnLCB0cnVlLCBmYWxzZSk7XG4gIH07XG5cbiAgSW50cm8ucHJvdG90eXBlLnNob3dTY29yZXMgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5zdGFydCgnU2NvcmVzJywgdHJ1ZSwgZmFsc2UpO1xuICB9O1xuXG4gIEludHJvLnByb3RvdHlwZS5zdGFydEdhbWUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5zdGFydCgnTGV2ZWxzJywgdHJ1ZSwgZmFsc2UsIHtcbiAgICAgIGxldmVsOiAwXG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIEludHJvO1xuXG59KShQaGFzZXIuU3RhdGUpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuXCJ1c2Ugc3RyaWN0XCI7XG52YXIgZ2FuZ2xlcmUsXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuZ2FuZ2xlcmUgPSByZXF1aXJlKFwiLi4vZ2FuZ2xlcmVcIik7XG5cbmdhbmdsZXJlLkxldmVscyA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgdmFyIEJMQUNLLCBIVU5URVIsIFdISVRFO1xuXG4gIF9fZXh0ZW5kcyhMZXZlbHMsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gTGV2ZWxzKCkge1xuICAgIHRoaXMuc2hvd0RhbWFnZSA9IF9fYmluZCh0aGlzLnNob3dEYW1hZ2UsIHRoaXMpO1xuICAgIHRoaXMuaW5pdEFjdG9ycyA9IF9fYmluZCh0aGlzLmluaXRBY3RvcnMsIHRoaXMpO1xuICAgIHRoaXMuZmFkZU91dCA9IF9fYmluZCh0aGlzLmZhZGVPdXQsIHRoaXMpO1xuICAgIHRoaXMubGFiZWwgPSBfX2JpbmQodGhpcy5sYWJlbCwgdGhpcyk7XG4gICAgdGhpcy5zdGFydEdhbWUgPSBfX2JpbmQodGhpcy5zdGFydEdhbWUsIHRoaXMpO1xuICAgIHRoaXMubW92ZVRvID0gX19iaW5kKHRoaXMubW92ZVRvLCB0aGlzKTtcbiAgICB0aGlzLmRvS2V5VXAgPSBfX2JpbmQodGhpcy5kb0tleVVwLCB0aGlzKTtcbiAgICB0aGlzLm9uS2V5VXAgPSBfX2JpbmQodGhpcy5vbktleVVwLCB0aGlzKTtcbiAgICB0aGlzLm1vdmVDYWxsYmFjayA9IF9fYmluZCh0aGlzLm1vdmVDYWxsYmFjaywgdGhpcyk7XG4gICAgdGhpcy5jcmVhdGUgPSBfX2JpbmQodGhpcy5jcmVhdGUsIHRoaXMpO1xuICAgIHRoaXMuaW5pdCA9IF9fYmluZCh0aGlzLmluaXQsIHRoaXMpO1xuICAgIHJldHVybiBMZXZlbHMuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBXSElURSA9ICcjZmZmJztcblxuICBCTEFDSyA9ICcjMDAwJztcblxuICBIVU5URVIgPSAnI2ZmMDA0NCc7XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5hdXRvbW92ZSA9IHRydWU7XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5pbm1vdGlvbiA9IGZhbHNlO1xuXG4gIExldmVscy5wcm90b3R5cGUuYWN0b3JMaXN0ID0gbnVsbDtcblxuICBMZXZlbHMucHJvdG90eXBlLmFjdG9yTWFwID0gbnVsbDtcblxuICBMZXZlbHMucHJvdG90eXBlLnBsYXllciA9IG51bGw7XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5vcHRpb25zID0gbnVsbDtcblxuICBMZXZlbHMucHJvdG90eXBlLmh1ZCA9IG51bGw7XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5tYXAgPSBudWxsO1xuXG4gIExldmVscy5wcm90b3R5cGUuY2xpY2tlYWJsZSA9IHRydWU7XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5zY29yZSA9IDA7XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5sZXZlbCA9IDA7XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5uYW1lID0gJ1NwbGFzaCc7XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5sZXZlbHMgPSBbJ0ZlbnJpcycsICdMb2tlJywgJ1Rob3InLCAnR2FtZSBPdmVyJ107XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHZhciBrZXksIHZhbHVlO1xuICAgIGZvciAoa2V5IGluIG9wdGlvbnMpIHtcbiAgICAgIHZhbHVlID0gb3B0aW9uc1trZXldO1xuICAgICAgdGhpc1trZXldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm5hbWUgPSB0aGlzLmxldmVsc1t0aGlzLmxldmVsXTtcbiAgfTtcblxuICBMZXZlbHMucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBodWRTdHlsZSwga2V5LCB2YWx1ZSwgX3JlZjtcbiAgICB0aGlzLnRpbWUuYWR2YW5jZWRUaW1pbmcgPSB0cnVlO1xuICAgIGh1ZFN0eWxlID0ge1xuICAgICAgZm9udDogXCJib2xkIDE4cHggbW9ub3NwYWNlXCIsXG4gICAgICBmaWxsOiBCTEFDS1xuICAgIH07XG4gICAgX3JlZiA9IGdhbmdsZXJlLmNvbmZpZy5sZXZlbHNbdGhpcy5uYW1lXTtcbiAgICBmb3IgKGtleSBpbiBfcmVmKSB7XG4gICAgICB2YWx1ZSA9IF9yZWZba2V5XTtcbiAgICAgIGNvbnNvbGUubG9nKGtleSk7XG4gICAgICBjb25zb2xlLmxvZyh2YWx1ZSk7XG4gICAgICB0aGlzW2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgdGhpcy5tYXAgPSBuZXcgZ2FuZ2xlcmUuTWFwKHRoaXMpO1xuICAgIHRoaXMuc3RhZ2UuYmFja2dyb3VuZENvbG9yID0gXCIjRjBERTlDXCI7XG4gICAgdGhpcy5pbml0QWN0b3JzKCk7XG4gICAgdGhpcy5tYXAubGlnaHQoKTtcbiAgICB0aGlzLmh1ZCA9IHRoaXMuYWRkLnRleHQoMCwgMCwgdGhpcy5sYWJlbCh0aGlzLmFjdG9yTGlzdFswXS5ocCwgdGhpcy5zY29yZSwgdGhpcy5sZXZlbCksIGh1ZFN0eWxlKTtcbiAgICB0aGlzLmh1ZC5maXhlZFRvQ2FtZXJhID0gdHJ1ZTtcbiAgICB0aGlzLmh1ZC5jYW1lcmFPZmZzZXQuc2V0VG8oMCwgdGhpcy5nYW1lLmhlaWdodCAtIDM1KTtcbiAgICB0aGlzLmlucHV0LmtleWJvYXJkLmFkZENhbGxiYWNrcyhudWxsLCBudWxsLCB0aGlzLm9uS2V5VXApO1xuICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uS2V5VXAsIHRoaXMpO1xuICAgIHRoaXMuaW5wdXQuc2V0TW92ZUNhbGxiYWNrKHRoaXMubW92ZUNhbGxiYWNrLCB0aGlzKTtcbiAgfTtcblxuICBMZXZlbHMucHJvdG90eXBlLm1vdmVDYWxsYmFjayA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkeCwgZHksIHgsIHk7XG4gICAgaWYgKHRoaXMuY2xpY2tlYWJsZSAmJiB0aGlzLmlucHV0LmFjdGl2ZVBvaW50ZXIuaXNEb3duKSB7XG4gICAgICB0aGlzLmNsaWNrZWFibGUgPSBmYWxzZTtcbiAgICAgIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLmNsaWNrZWFibGUgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpLCA0MDApO1xuICAgICAgeCA9IHRoaXMuaW5wdXQuYWN0aXZlUG9pbnRlci53b3JsZFg7XG4gICAgICB5ID0gdGhpcy5pbnB1dC5hY3RpdmVQb2ludGVyLndvcmxkWTtcbiAgICAgIGR4ID0gTWF0aC5hYnModGhpcy5wbGF5ZXIuc3ByaXRlLnggLSB4KTtcbiAgICAgIGR5ID0gTWF0aC5hYnModGhpcy5wbGF5ZXIuc3ByaXRlLnkgLSB5KTtcbiAgICAgIGlmIChkeCA+IGR5KSB7XG4gICAgICAgIGlmICh4ID4gdGhpcy5wbGF5ZXIuc3ByaXRlLngpIHtcbiAgICAgICAgICB0aGlzLm9uS2V5VXAoe1xuICAgICAgICAgICAga2V5Q29kZTogUGhhc2VyLktleWJvYXJkLlJJR0hUXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5vbktleVVwKHtcbiAgICAgICAgICAgIGtleUNvZGU6IFBoYXNlci5LZXlib2FyZC5MRUZUXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh5ID4gdGhpcy5wbGF5ZXIuc3ByaXRlLnkpIHtcbiAgICAgICAgICB0aGlzLm9uS2V5VXAoe1xuICAgICAgICAgICAga2V5Q29kZTogUGhhc2VyLktleWJvYXJkLkRPV05cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLm9uS2V5VXAoe1xuICAgICAgICAgICAga2V5Q29kZTogUGhhc2VyLktleWJvYXJkLlVQXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5vbktleVVwID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgYWN0b3IsIF9pLCBfbGVuLCBfcmVmO1xuICAgIGlmICghdGhpcy5hY3Rvckxpc3RbMF0uaXNQbGF5ZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMuZG9LZXlVcChldmVudCkpIHtcbiAgICAgIHRoaXMubWFwLmNvbXB1dGVMaWdodCgpO1xuICAgICAgX3JlZiA9IHRoaXMuYWN0b3JMaXN0O1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGFjdG9yID0gX3JlZltfaV07XG4gICAgICAgIGFjdG9yLm1vdmUodGhpcy5wbGF5ZXIpO1xuICAgICAgICBpZiAodGhpcy5wbGF5ZXIuaHAgPCAxKSB7XG4gICAgICAgICAgdGhpcy5mYWRlT3V0KChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc3RhdGUuc3RhcnQoJ0xldmVscycsIGZhbHNlLCBmYWxzZSwge1xuICAgICAgICAgICAgICAgIGxldmVsOiBfdGhpcy5sZXZlbHMubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHdpbjogZmFsc2VcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pKHRoaXMpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBMZXZlbHMucHJvdG90eXBlLmRvS2V5VXAgPSBmdW5jdGlvbihldmVudCkge1xuICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuICAgICAgY2FzZSBQaGFzZXIuS2V5Ym9hcmQuTEVGVDpcbiAgICAgICAgcmV0dXJuIHRoaXMubW92ZVRvKHRoaXMucGxheWVyLCB7XG4gICAgICAgICAgeDogLTEsXG4gICAgICAgICAgeTogMFxuICAgICAgICB9KTtcbiAgICAgIGNhc2UgUGhhc2VyLktleWJvYXJkLlJJR0hUOlxuICAgICAgICByZXR1cm4gdGhpcy5tb3ZlVG8odGhpcy5wbGF5ZXIsIHtcbiAgICAgICAgICB4OiAxLFxuICAgICAgICAgIHk6IDBcbiAgICAgICAgfSk7XG4gICAgICBjYXNlIFBoYXNlci5LZXlib2FyZC5VUDpcbiAgICAgICAgcmV0dXJuIHRoaXMubW92ZVRvKHRoaXMucGxheWVyLCB7XG4gICAgICAgICAgeDogMCxcbiAgICAgICAgICB5OiAtMVxuICAgICAgICB9KTtcbiAgICAgIGNhc2UgUGhhc2VyLktleWJvYXJkLkRPV046XG4gICAgICAgIHJldHVybiB0aGlzLm1vdmVUbyh0aGlzLnBsYXllciwge1xuICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgeTogMVxuICAgICAgICB9KTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5tb3ZlVG8gPSBmdW5jdGlvbihhY3RvciwgZGVsdGEpIHtcbiAgICB2YXIgcG9zLCB2aWN0aW07XG4gICAgaWYgKCF0aGlzLm1hcC5pc1ZhbGlkTW92ZShhY3RvciwgZGVsdGEpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGFjdG9yLnNldEZyYW1lKGRlbHRhKTtcbiAgICBwb3MgPSAoYWN0b3IueCArIGRlbHRhLngpICsgXCJfXCIgKyAoYWN0b3IueSArIGRlbHRhLnkpO1xuICAgIGlmICh0aGlzLmFjdG9yTWFwW3Bvc10gIT0gbnVsbCkge1xuICAgICAgdmljdGltID0gdGhpcy5hY3Rvck1hcFtwb3NdO1xuICAgICAgaWYgKGFjdG9yLmlzUGxheWVyIHx8IHZpY3RpbS5pc1BsYXllcikge1xuICAgICAgICBhY3Rvci5hdHRhY2sodmljdGltKTtcbiAgICAgICAgaWYgKHZpY3RpbS5pc1BsYXllcikge1xuICAgICAgICAgIHRoaXMuaHVkLnNldFRleHQodGhpcy5sYWJlbCh2aWN0aW0uaHAsIHRoaXMuc2NvcmUsIHRoaXMubGV2ZWwpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNjb3JlICs9IGdhbmdsZXJlLlJhbmRvbS5kaWNlUm9sbChcImQyKzFcIikudG90YWw7XG4gICAgICAgICAgdGhpcy5odWQuc2V0VGV4dCh0aGlzLmxhYmVsKHRoaXMuYWN0b3JMaXN0WzBdLmhwLCB0aGlzLnNjb3JlLCB0aGlzLmxldmVsKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZpY3RpbS5ocCA8PSAwKSB7XG4gICAgICAgICAgdmljdGltLnNwcml0ZS5raWxsKCk7XG4gICAgICAgICAgZGVsZXRlIHRoaXMuYWN0b3JNYXBbcG9zXTtcbiAgICAgICAgICB0aGlzLmFjdG9yTGlzdC5zcGxpY2UodGhpcy5hY3Rvckxpc3QuaW5kZXhPZih2aWN0aW0pLCAxKTtcbiAgICAgICAgICBpZiAodmljdGltICE9PSB0aGlzLnBsYXllcikge1xuICAgICAgICAgICAgaWYgKHRoaXMuYWN0b3JMaXN0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICB0aGlzLmxldmVsKys7XG4gICAgICAgICAgICAgIGlmICh0aGlzLmxldmVsIDwgdGhpcy5sZXZlbHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mYWRlT3V0KChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc3RhdGUuc3RhcnQoJ0xldmVscycsIHRydWUsIGZhbHNlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IF90aGlzLmxldmVsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KSh0aGlzKSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mYWRlT3V0KChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc3RhdGUuc3RhcnQoJ0xldmVscycsIGZhbHNlLCBmYWxzZSwge1xuICAgICAgICAgICAgICAgICAgICAgIGxldmVsOiBfdGhpcy5sZXZlbHMubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICAgIHdpbjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSkodGhpcykpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmFjdG9yTWFwW2FjdG9yLnggKyBcIl9cIiArIGFjdG9yLnldO1xuICAgICAgYWN0b3Iuc2V0WFkoYWN0b3IueCArIGRlbHRhLngsIGFjdG9yLnkgKyBkZWx0YS55KTtcbiAgICAgIHRoaXMuYWN0b3JNYXBbYWN0b3IueCArIFwiX1wiICsgYWN0b3IueV0gPSBhY3RvcjtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5zdGFydEdhbWUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3RhcnRHYW1lO1xuICAgIHN0YXJ0R2FtZSA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMuc3RhdGUuc3RhcnQoJ0xldmVscycsIHRydWUsIGZhbHNlLCB7XG4gICAgICAgICAgbGV2ZWw6IDFcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH0pKHRoaXMpO1xuICAgIHRoaXMudGltZS5ldmVudHMuYWRkKFBoYXNlci5UaW1lci5TRUNPTkQsIHN0YXJ0R2FtZSwgdGhpcyk7XG4gICAgcmV0dXJuIHRoaXMuYWRkLnR3ZWVuKHRoaXMuc3RhcnQpLnRvKHtcbiAgICAgIGFscGhhOiAwXG4gICAgfSwgMjAwMCwgUGhhc2VyLkVhc2luZy5MaW5lYXIuTm9uZSwgdHJ1ZSk7XG4gIH07XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5sYWJlbCA9IGZ1bmN0aW9uKGhwLCBzY29yZSwgbGV2ZWwpIHtcbiAgICByZXR1cm4gXCJsaWZlOiAgXCIgKyBocCArIFwiIHNjb3JlOiBcIiArIHNjb3JlICsgXCIgbGV2ZWw6IFwiICsgbGV2ZWw7XG4gIH07XG5cbiAgTGV2ZWxzLnByb3RvdHlwZS5mYWRlT3V0ID0gZnVuY3Rpb24obmV4dCkge1xuICAgIHJldHVybiB0aGlzLnRpbWUuZXZlbnRzLmFkZChQaGFzZXIuVGltZXIuU0VDT05ELCBuZXh0LCB0aGlzKTtcbiAgfTtcblxuICBMZXZlbHMucHJvdG90eXBlLmluaXRBY3RvcnMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgYSwgYWN0b3IsIHJhbmRvbSwgdmFsaWRwb3MsIHgsIHksIF9pLCBfaiwgX2ssIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjM7XG4gICAgdGhpcy5hY3Rvckxpc3QgPSBbXTtcbiAgICB0aGlzLmFjdG9yTWFwID0ge307XG4gICAgcmFuZG9tID0gZnVuY3Rpb24obWF4KSB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4KTtcbiAgICB9O1xuICAgIHZhbGlkcG9zID0gW107XG4gICAgZm9yICh4ID0gX2kgPSAwLCBfcmVmID0gdGhpcy5tYXAud2lkdGg7IDAgPD0gX3JlZiA/IF9pIDwgX3JlZiA6IF9pID4gX3JlZjsgeCA9IDAgPD0gX3JlZiA/ICsrX2kgOiAtLV9pKSB7XG4gICAgICBmb3IgKHkgPSBfaiA9IDAsIF9yZWYxID0gdGhpcy5tYXAuaGVpZ2h0OyAwIDw9IF9yZWYxID8gX2ogPCBfcmVmMSA6IF9qID4gX3JlZjE7IHkgPSAwIDw9IF9yZWYxID8gKytfaiA6IC0tX2opIHtcbiAgICAgICAgaWYgKCF0aGlzLm1hcC50aWxlc1t4XVt5XSkge1xuICAgICAgICAgIHZhbGlkcG9zLnB1c2goe1xuICAgICAgICAgICAgeDogeCxcbiAgICAgICAgICAgIHk6IHlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGEgPSBfayA9IDAsIF9yZWYyID0gdGhpcy5vcHRpb25zLmFjdG9yczsgMCA8PSBfcmVmMiA/IF9rIDwgX3JlZjIgOiBfayA+IF9yZWYyOyBhID0gMCA8PSBfcmVmMiA/ICsrX2sgOiAtLV9rKSB7XG4gICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICBfcmVmMyA9IHZhbGlkcG9zW3JhbmRvbSh2YWxpZHBvcy5sZW5ndGgpXSwgeCA9IF9yZWYzLngsIHkgPSBfcmVmMy55O1xuICAgICAgICBpZiAoIXRoaXMuYWN0b3JNYXBbeCArIFwiX1wiICsgeV0pIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYWN0b3IgPSBhID09PSAwID8gbmV3IGdhbmdsZXJlLlBsYXllcih0aGlzLCB4LCB5KSA6IG5ldyBnYW5nbGVyZS5FbmVteSh0aGlzLCB4LCB5KTtcbiAgICAgIHRoaXMuYWN0b3JNYXBbYWN0b3IueCArIFwiX1wiICsgYWN0b3IueV0gPSBhY3RvcjtcbiAgICAgIHRoaXMuYWN0b3JMaXN0LnB1c2goYWN0b3IpO1xuICAgIH1cbiAgICB0aGlzLnBsYXllciA9IHRoaXMuYWN0b3JMaXN0WzBdO1xuICAgIHRoaXMuY2FtZXJhLmZvbGxvdyh0aGlzLnBsYXllci5zcHJpdGUpO1xuICB9O1xuXG4gIExldmVscy5wcm90b3R5cGUuc2hvd0RhbWFnZSA9IGZ1bmN0aW9uKHRleHQsIHNwcml0ZSwgc3BlZWQsIGNvbG9yKSB7XG4gICAgdmFyIGRhbWFnZVN0eWxlLCB4LCB5O1xuICAgIGlmIChuYXZpZ2F0b3Iubm90aWZpY2F0aW9uICE9IG51bGwpIHtcbiAgICAgIG5hdmlnYXRvci5ub3RpZmljYXRpb24udmlicmF0ZSgxMCk7XG4gICAgfVxuICAgIGRhbWFnZVN0eWxlID0ge1xuICAgICAgYWxpZ246ICdjZW50ZXInLFxuICAgICAgZm9udDogJ2JvbGQgNDBweCBDb3VyaWVyIE5ldywgQ291cmllcicsXG4gICAgICBmaWxsOiBjb2xvclxuICAgIH07XG4gICAgeSA9IHNwcml0ZS55IC0gMTU7XG4gICAgeCA9IHNwcml0ZS54ICsgc3ByaXRlLndpZHRoIC8gMztcbiAgICB0ZXh0ID0gdGhpcy5hZGQudGV4dCh4LCB5LCB0ZXh0LCBkYW1hZ2VTdHlsZSk7XG4gICAgdGhpcy5hZGQudHdlZW4odGV4dCkudG8oe1xuICAgICAgYWxwaGE6IDFcbiAgICB9LCBNYXRoLmZsb29yKHNwZWVkICogMC43NSksIFBoYXNlci5FYXNpbmcuQm91bmNlLk91dCwgdHJ1ZSkudG8oe1xuICAgICAgYWxwaGE6IDBcbiAgICB9LCBNYXRoLmZsb29yKHNwZWVkICogMC4yNSksIFBoYXNlci5FYXNpbmcuQm91bmNlLkluLCB0cnVlKTtcbiAgICByZXR1cm4gc2V0VGltZW91dCgoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBfdGhpcy53b3JsZC5yZW1vdmUodGV4dCk7XG4gICAgICB9O1xuICAgIH0pKHRoaXMpKSwgc3BlZWQpO1xuICB9O1xuXG4gIHJldHVybiBMZXZlbHM7XG5cbn0pKFBoYXNlci5TdGF0ZSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG5cInVzZSBzdHJpY3RcIjtcbnZhciBnYW5nbGVyZSxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfTtcblxuZ2FuZ2xlcmUgPSByZXF1aXJlKCcuLi9nYW5nbGVyZScpO1xuXG5nYW5nbGVyZS5NYXAgPSAoZnVuY3Rpb24oKSB7XG4gIHZhciBjbG9uZTtcblxuICBNYXAucHJvdG90eXBlLm9wdGlvbnMgPSBudWxsO1xuXG4gIE1hcC5wcm90b3R5cGUudGlsZXMgPSBudWxsO1xuXG4gIE1hcC5wcm90b3R5cGUubWFwID0gbnVsbDtcblxuICBNYXAucHJvdG90eXBlLnJvdCA9IG51bGw7XG5cbiAgTWFwLnByb3RvdHlwZS5oZWlnaHQgPSAwO1xuXG4gIE1hcC5wcm90b3R5cGUud2lkdGggPSAwO1xuXG4gIE1hcC5wcm90b3R5cGUuaW1hZ2VoZWlnaHQgPSAwO1xuXG4gIE1hcC5wcm90b3R5cGUuaW1hZ2V3aWR0aCA9IDA7XG5cbiAgTWFwLnByb3RvdHlwZS50aWxlaGVpZ2h0ID0gMDtcblxuICBNYXAucHJvdG90eXBlLnRpbGV3aWR0aCA9IDA7XG5cbiAgTWFwLnByb3RvdHlwZS50aWxlc2V0ID0gJyc7XG5cbiAgTWFwLnByb3RvdHlwZS53YWxsID0gMDtcblxuICBNYXAucHJvdG90eXBlLnNwYWNlID0gMDtcblxuICBNYXAucHJvdG90eXBlLmFydGlmYWN0cyA9IG51bGw7XG5cbiAgTWFwLnByb3RvdHlwZS5kYXRhID0gbnVsbDtcblxuICBjbG9uZSA9IGZ1bmN0aW9uKG9iamVjdCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iamVjdCkpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIE1hcChsZXZlbCkge1xuICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICB0aGlzLmFkZEFydGlmYWN0cyA9IF9fYmluZCh0aGlzLmFkZEFydGlmYWN0cywgdGhpcyk7XG4gICAgdGhpcy5jb21wdXRlTGlnaHQgPSBfX2JpbmQodGhpcy5jb21wdXRlTGlnaHQsIHRoaXMpO1xuICAgIHRoaXMucmVzZXRMaWdodCA9IF9fYmluZCh0aGlzLnJlc2V0TGlnaHQsIHRoaXMpO1xuICAgIHRoaXMubGlnaHQgPSBfX2JpbmQodGhpcy5saWdodCwgdGhpcyk7XG4gICAgdGhpcy5pc1ZhbGlkTW92ZSA9IF9fYmluZCh0aGlzLmlzVmFsaWRNb3ZlLCB0aGlzKTtcbiAgICB0aGlzLmxvYWRUaWxlbWFwID0gX19iaW5kKHRoaXMubG9hZFRpbGVtYXAsIHRoaXMpO1xuICAgIHRoaXMub3B0aW9ucyA9IHRoaXMubGV2ZWwub3B0aW9ucztcbiAgICB0aGlzLm1hcCA9IHRoaXMubGV2ZWwuYWRkLnRpbGVtYXAodGhpcy5sb2FkVGlsZW1hcCh0aGlzLm9wdGlvbnMubWFwKSk7XG4gICAgdGhpcy5tYXAuYWRkVGlsZXNldEltYWdlKHRoaXMudGlsZXNldCwgdGhpcy50aWxlc2V0KTtcbiAgICB0aGlzLm1hcC5jcmVhdGVMYXllcignbGF5ZXIwJywgdGhpcy5sZXZlbC5nYW1lLndpZHRoLCB0aGlzLmxldmVsLmdhbWUuaGVpZ2h0IC0gNDApLnJlc2l6ZVdvcmxkKCk7XG4gICAgdGhpcy5tYXAuY3JlYXRlTGF5ZXIoJ2xheWVyMScsIHRoaXMubGV2ZWwuZ2FtZS53aWR0aCwgdGhpcy5sZXZlbC5nYW1lLmhlaWdodCAtIDQwKS5yZXNpemVXb3JsZCgpO1xuICAgIHRoaXMudGlsZXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMucm90Lm1hcCkpO1xuICB9XG5cbiAgTWFwLnByb3RvdHlwZS5sb2FkVGlsZW1hcCA9IGZ1bmN0aW9uKG1hcGtleSkge1xuICAgIHZhciBqc29uO1xuICAgIGpzb24gPSB0aGlzLmdldFByb3BlcnRpZXMoY2xvbmUodGhpcy5sZXZlbC5jYWNoZS5nZXRKU09OKFwiXCIgKyBtYXBrZXkgKyBcIi5qc29uXCIpKSk7XG4gICAgdGhpcy5yb3QgPSBuZXcgUk9ULk1hcC5Sb2d1ZSh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgdGhpcy5yb3QuY3JlYXRlKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKHgsIHksIHYpIHtcbiAgICAgICAgcmV0dXJuIGpzb24ubGF5ZXJzWzBdLmRhdGFbeSAqIF90aGlzLndpZHRoICsgeF0gPSB2ID09PSAxID8gX3RoaXMud2FsbCA6IF90aGlzLnNwYWNlO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5hcnRpZmFjdHMpIHtcbiAgICAgIHRoaXMuYWRkQXJ0aWZhY3RzKGpzb24sIHRoaXMuYXJ0aWZhY3RzKTtcbiAgICB9XG4gICAgdGhpcy5sZXZlbC5jYWNoZS5hZGRUaWxlbWFwKG1hcGtleSwgJycsIGpzb24pO1xuICAgIHJldHVybiBtYXBrZXk7XG4gIH07XG5cbiAgTWFwLnByb3RvdHlwZS5pc1ZhbGlkTW92ZSA9IGZ1bmN0aW9uKGZyb20sIGRlbHRhKSB7XG4gICAgcmV0dXJuIGZyb20ueCArIGRlbHRhLnggPj0gMCAmJiBmcm9tLnggKyBkZWx0YS54IDwgdGhpcy53aWR0aCAmJiBmcm9tLnkgKyBkZWx0YS55ID49IDAgJiYgZnJvbS55ICsgZGVsdGEueSA8IHRoaXMuaGVpZ2h0ICYmIHRoaXMudGlsZXNbZnJvbS54ICsgZGVsdGEueF1bZnJvbS55ICsgZGVsdGEueV0gPT09IDA7XG4gIH07XG5cbiAgTWFwLnByb3RvdHlwZS5saWdodCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucmVzZXRMaWdodCgpO1xuICAgIHRoaXMuZm92ID0gbmV3IFJPVC5GT1YuUHJlY2lzZVNoYWRvd2Nhc3RpbmcoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oeCwgeSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIF90aGlzLnRpbGVzW3hdID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgX3RoaXMudGlsZXNbeF1beV0gPT09ICd1bmRlZmluZWQnIHx8IF90aGlzLnRpbGVzW3hdW3ldID09PSAwO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gICAgcmV0dXJuIHRoaXMuY29tcHV0ZUxpZ2h0KCk7XG4gIH07XG5cbiAgTWFwLnByb3RvdHlwZS5yZXNldExpZ2h0ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRpbGUsIHgsIHksIF9pLCBfcmVmLCBfcmVzdWx0cztcbiAgICBpZiAodGhpcy5vcHRpb25zLmhpZGUgIT09IHRydWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgX3Jlc3VsdHMgPSBbXTtcbiAgICBmb3IgKHggPSBfaSA9IDAsIF9yZWYgPSB0aGlzLndpZHRoOyAwIDw9IF9yZWYgPyBfaSA8IF9yZWYgOiBfaSA+IF9yZWY7IHggPSAwIDw9IF9yZWYgPyArK19pIDogLS1faSkge1xuICAgICAgX3Jlc3VsdHMucHVzaCgoZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBfaiwgX3JlZjEsIF9yZXN1bHRzMTtcbiAgICAgICAgX3Jlc3VsdHMxID0gW107XG4gICAgICAgIGZvciAoeSA9IF9qID0gMCwgX3JlZjEgPSB0aGlzLmhlaWdodDsgMCA8PSBfcmVmMSA/IF9qIDwgX3JlZjEgOiBfaiA+IF9yZWYxOyB5ID0gMCA8PSBfcmVmMSA/ICsrX2ogOiAtLV9qKSB7XG4gICAgICAgICAgdGlsZSA9IHRoaXMubWFwLmdldFRpbGUoeCwgeSwgMCk7XG4gICAgICAgICAgaWYgKHRpbGUpIHtcbiAgICAgICAgICAgIHRpbGUuYWxwaGEgPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aWxlID0gdGhpcy5tYXAuZ2V0VGlsZSh4LCB5LCAxKTtcbiAgICAgICAgICBpZiAodGlsZSkge1xuICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2godGlsZS5hbHBoYSA9IDApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfcmVzdWx0czEucHVzaCh2b2lkIDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3Jlc3VsdHMxO1xuICAgICAgfSkuY2FsbCh0aGlzKSk7XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmNvbXB1dGVMaWdodCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucmVzZXRMaWdodCgpO1xuICAgIHRoaXMubGV2ZWwuYWN0b3JMaXN0LmZvckVhY2goZnVuY3Rpb24oYSkge1xuICAgICAgcmV0dXJuIGEuc3ByaXRlLmFscGhhID0gMDtcbiAgICB9KTtcbiAgICB0aGlzLmxldmVsLmFjdG9yTGlzdFswXS5zcHJpdGUuYWxwaGEgPSAxO1xuICAgIHRoaXMuZm92LmNvbXB1dGUodGhpcy5sZXZlbC5hY3Rvckxpc3RbMF0ueCwgdGhpcy5sZXZlbC5hY3Rvckxpc3RbMF0ueSwgMTAsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKHgsIHksIHIsIHZpc2liaWxpdHkpIHtcbiAgICAgICAgdmFyIHRpbGU7XG4gICAgICAgIHRpbGUgPSBfdGhpcy5tYXAuZ2V0VGlsZSh4LCB5LCAwKTtcbiAgICAgICAgaWYgKHRpbGUpIHtcbiAgICAgICAgICB0aWxlLmFscGhhID0gdmlzaWJpbGl0eTtcbiAgICAgICAgfVxuICAgICAgICB0aWxlID0gX3RoaXMubWFwLmdldFRpbGUoeCwgeSwgMSk7XG4gICAgICAgIGlmICh0aWxlKSB7XG4gICAgICAgICAgdGlsZS5hbHBoYSA9IHZpc2liaWxpdHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF90aGlzLmxldmVsLmFjdG9yTWFwLmhhc093blByb3BlcnR5KHggKyAnXycgKyB5KSkge1xuICAgICAgICAgIHJldHVybiBfdGhpcy5sZXZlbC5hY3Rvck1hcFt4ICsgJ18nICsgeV0uc3ByaXRlLmFscGhhID0gdmlzaWJpbGl0eTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gICAgdGhpcy5tYXAubGF5ZXJzWzBdLmRpcnR5ID0gdHJ1ZTtcbiAgICByZXR1cm4gdGhpcy5tYXAubGF5ZXJzWzFdLmRpcnR5ID0gdHJ1ZTtcbiAgfTtcblxuICBNYXAucHJvdG90eXBlLmdldFByb3BlcnRpZXMgPSBmdW5jdGlvbih0aWxlbWFwKSB7XG4gICAgdmFyIGtleSwgdmFsdWUsIF9yZWY7XG4gICAgdGhpcy53aWR0aCA9IHRpbGVtYXAud2lkdGg7XG4gICAgdGhpcy5oZWlnaHQgPSB0aWxlbWFwLmhlaWdodDtcbiAgICB0aGlzLnRpbGVzZXQgPSB0aWxlbWFwLnRpbGVzZXRzWzBdLm5hbWU7XG4gICAgdGhpcy5pbWFnZWhlaWdodCA9IHRpbGVtYXAudGlsZXNldHNbMF0uaW1hZ2VoZWlnaHQ7XG4gICAgdGhpcy5pbWFnZXdpZHRoID0gdGlsZW1hcC50aWxlc2V0c1swXS5pbWFnZXdpZHRoO1xuICAgIHRoaXMudGlsZWhlaWdodCA9IHRpbGVtYXAudGlsZWhlaWdodDtcbiAgICB0aGlzLnRpbGV3aWR0aCA9IHRpbGVtYXAudGlsZXdpZHRoO1xuICAgIHRoaXMuYmFja2dyb3VuZGNvbG9yID0gdGlsZW1hcC5iYWNrZ3JvdW5kY29sb3I7XG4gICAgaWYgKHRpbGVtYXAucHJvcGVydGllcy53YWxsICE9IG51bGwpIHtcbiAgICAgIHRoaXMud2FsbCA9IHBhcnNlSW50KHRpbGVtYXAucHJvcGVydGllcy53YWxsLCAxMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMud2FsbCA9IDA7XG4gICAgfVxuICAgIGlmICh0aWxlbWFwLnByb3BlcnRpZXMuc3BhY2UgIT0gbnVsbCkge1xuICAgICAgdGhpcy5zcGFjZSA9IHBhcnNlSW50KHRpbGVtYXAucHJvcGVydGllcy5zcGFjZSwgMTApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNwYWNlID0gKHRoaXMuaW1hZ2VoZWlnaHQgLyB0aGlzLnRpbGVoZWlnaHQpICogKHRoaXMuaW1hZ2V3aWR0aCAvIHRoaXMudGlsZXdpZHRoKTtcbiAgICB9XG4gICAgaWYgKHRpbGVtYXAucHJvcGVydGllcy5hcnRpZmFjdHMgIT0gbnVsbCkge1xuICAgICAgdGhpcy5hcnRpZmFjdHMgPSB0aWxlbWFwLnByb3BlcnRpZXMuYXJ0aWZhY3RzLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHYsIDEwKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmFydGlmYWN0cyA9IFtdO1xuICAgIH1cbiAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICBfcmVmID0gdGlsZW1hcC5wcm9wZXJ0aWVzO1xuICAgIGZvciAoa2V5IGluIF9yZWYpIHtcbiAgICAgIHZhbHVlID0gX3JlZltrZXldO1xuICAgICAgaWYgKC9ebVxcZFxcZFxcJC8udGVzdChrZXkpKSB7XG4gICAgICAgIHRoaXMuZGF0YVtrZXkuc3BsaXQoJyQnKVsxXV0gPSB2YWx1ZS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbih2KSB7XG4gICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHYsIDEwKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aWxlbWFwO1xuICB9O1xuXG4gIE1hcC5wcm90b3R5cGUuYWRkQXJ0aWZhY3RzID0gZnVuY3Rpb24odGlsZW1hcCwgYXJ0aWZhY3RzKSB7XG4gICAgdmFyIGRhdGEsIGRpcmVjdGlvbiwgZXhpc3QsIGksIGtleSwgcGF0dGVybkFycmF5LCB0aWxlcG9zLCB4LCB5LCBfZm4sIF9pLCBfaiwgX2ssIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjM7XG4gICAgZXhpc3QgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICAgIGlmICh0eXBlb2YgX3RoaXMucm90Lm1hcFt4XSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIF90aGlzLnJvdC5tYXBbeF1beV0gIT09ICd1bmRlZmluZWQnICYmIF90aGlzLnJvdC5tYXBbeF1beV0gPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gJzEnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAnMCc7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSkodGhpcyk7XG4gICAgcGF0dGVybkFycmF5ID0gW107XG4gICAgX3JlZiA9IHRoaXMuZGF0YTtcbiAgICBfZm4gPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbihrZXksIGRhdGEpIHtcbiAgICAgICAgcmV0dXJuIHBhdHRlcm5BcnJheS5wdXNoKHtcbiAgICAgICAgICBwYXR0ZXJuOiBuZXcgUmVnRXhwKGtleS5yZXBsYWNlKC9cXF8vZywgJ1swLTFdJykpLFxuICAgICAgICAgIHNldFRpbGU6IGZ1bmN0aW9uKHRpbGVwb3MsIHgsIHkpIHtcbiAgICAgICAgICAgIGlmIChkYXRhWzBdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgdGlsZW1hcC5sYXllcnNbMV0uZGF0YVt0aWxlcG9zXSA9IGRhdGFbMF07XG4gICAgICAgICAgICAgIGlmICgoZGF0YVsxXSAhPSBudWxsKSAmJiB5ID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aWxlbWFwLmxheWVyc1sxXS5kYXRhWyh5IC0gMSkgKiBfdGhpcy53aWR0aCArIHhdID0gZGF0YVsxXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRpbGVtYXAubGF5ZXJzWzFdLmRhdGFbdGlsZXBvc10gPSBnYW5nbGVyZS5SYW5kb20ucGljayhhcnRpZmFjdHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH0pKHRoaXMpO1xuICAgIGZvciAoa2V5IGluIF9yZWYpIHtcbiAgICAgIGRhdGEgPSBfcmVmW2tleV07XG4gICAgICBfZm4oa2V5LCBkYXRhKTtcbiAgICB9XG4gICAgZm9yICh5ID0gX2kgPSAwLCBfcmVmMSA9IHRoaXMuaGVpZ2h0OyAwIDw9IF9yZWYxID8gX2kgPCBfcmVmMSA6IF9pID4gX3JlZjE7IHkgPSAwIDw9IF9yZWYxID8gKytfaSA6IC0tX2kpIHtcbiAgICAgIGZvciAoeCA9IF9qID0gMCwgX3JlZjIgPSB0aGlzLndpZHRoOyAwIDw9IF9yZWYyID8gX2ogPCBfcmVmMiA6IF9qID4gX3JlZjI7IHggPSAwIDw9IF9yZWYyID8gKytfaiA6IC0tX2opIHtcbiAgICAgICAgaWYgKHRoaXMucm90Lm1hcFt4XVt5XSA9PT0gMCkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIHRpbGVwb3MgPSB5ICogdGhpcy53aWR0aCArIHg7XG4gICAgICAgIGRpcmVjdGlvbiA9IGV4aXN0KHggLSAxLCB5IC0gMSkgKyBleGlzdCh4LCB5IC0gMSkgKyBleGlzdCh4ICsgMSwgeSAtIDEpICsgZXhpc3QoeCAtIDEsIHkpICsgJzEnICsgZXhpc3QoeCArIDEsIHkpICsgZXhpc3QoeCAtIDEsIHkgKyAxKSArIGV4aXN0KHgsIHkgKyAxKSArIGV4aXN0KHggKyAxLCB5ICsgMSk7XG4gICAgICAgIGZvciAoaSA9IF9rID0gMCwgX3JlZjMgPSBwYXR0ZXJuQXJyYXkubGVuZ3RoOyAwIDw9IF9yZWYzID8gX2sgPCBfcmVmMyA6IF9rID4gX3JlZjM7IGkgPSAwIDw9IF9yZWYzID8gKytfayA6IC0tX2spIHtcbiAgICAgICAgICBpZiAocGF0dGVybkFycmF5W2ldLnBhdHRlcm4udGVzdChkaXJlY3Rpb24pKSB7XG4gICAgICAgICAgICBwYXR0ZXJuQXJyYXlbaV0uc2V0VGlsZSh0aWxlcG9zLCB4LCB5KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGlsZW1hcDtcbiAgfTtcblxuICByZXR1cm4gTWFwO1xuXG59KSgpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuXCJ1c2Ugc3RyaWN0XCI7XG52YXIgZ2FuZ2xlcmUsXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuZ2FuZ2xlcmUgPSByZXF1aXJlKCcuLi9nYW5nbGVyZScpO1xuXG5nYW5nbGVyZS5QbGF5ZXIgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhQbGF5ZXIsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gUGxheWVyKGdhbWUsIHgsIHkpIHtcbiAgICBQbGF5ZXIuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgZ2FtZSwgeCwgeSwgZ2FtZS5wbGF5ZXIuc3ByaXRlKTtcbiAgICB0aGlzLmhwID0gZ2FtZS5wbGF5ZXIuaHA7XG4gICAgdGhpcy5kYW1hZ2UgPSBnYW1lLnBsYXllci5kYW1hZ2U7XG4gICAgdGhpcy5pc1BsYXllciA9IHRydWU7XG4gIH1cblxuICByZXR1cm4gUGxheWVyO1xuXG59KShnYW5nbGVyZS5BY3Rvcik7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG5cInVzZSBzdHJpY3RcIjtcbnZhciBnYW5nbGVyZTtcblxuZ2FuZ2xlcmUgPSByZXF1aXJlKCcuLi9nYW5nbGVyZScpO1xuXG5nYW5nbGVyZS5SYW5kb20gPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIFJhbmRvbSgpIHt9XG5cbiAgUmFuZG9tLnBpY2sgPSBmdW5jdGlvbihhcnJheSkge1xuICAgIHJldHVybiBhcnJheVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcnJheS5sZW5ndGgpXTtcbiAgfTtcblxuICBSYW5kb20uZGljZVJvbGwgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgdmFyIGRhdGFTcGxpdCwgZGljZXMsIGksIG4sIHJldCwgc2lkZXM7XG4gICAgZGF0YSA9IFwiIFwiICsgZGF0YTtcbiAgICBkYXRhU3BsaXQgPSBkYXRhLnNwbGl0KC8tfFxcK3xkL2cpO1xuICAgIGRpY2VzID0gcGFyc2VJbnQoZGF0YVNwbGl0WzBdLCAxMCk7XG4gICAgaWYgKCFkaWNlcykge1xuICAgICAgZGljZXMgPSAxO1xuICAgIH1cbiAgICBzaWRlcyA9IHBhcnNlSW50KGRhdGFTcGxpdFsxXSwgMTApO1xuICAgIHJldCA9IHtcbiAgICAgIGRpY2VSb2xsOiBbXSxcbiAgICAgIG51bWJlcjogMCxcbiAgICAgIGJvbnVzOiAwXG4gICAgfTtcbiAgICByZXQubnVtYmVyID0gMDtcbiAgICBuID0gdm9pZCAwO1xuICAgIGkgPSAwO1xuICAgIHdoaWxlIChpIDwgZGljZXMpIHtcbiAgICAgIG4gPSAxICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc2lkZXMpO1xuICAgICAgcmV0LmRpY2VSb2xsLnB1c2gobik7XG4gICAgICByZXQubnVtYmVyICs9IG47XG4gICAgICBpKys7XG4gICAgfVxuICAgIGlmIChkYXRhU3BsaXRbMl0pIHtcbiAgICAgIHJldC5ib251cyA9IHBhcnNlSW50KGRhdGFTcGxpdFsyXSwgMTApO1xuICAgICAgaWYgKGRhdGEuaW5kZXhPZihcIi1cIikgPiAtMSkge1xuICAgICAgICByZXQuYm9udXMgPSByZXQuYm9udXMgKiAtMTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0LnRvdGFsID0gcmV0Lm51bWJlciArIHJldC5ib251cztcbiAgICByZXR1cm4gcmV0O1xuICB9O1xuXG4gIHJldHVybiBSYW5kb207XG5cbn0pKCk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG5cInVzZSBzdHJpY3RcIjtcbnZhciBnYW5nbGVyZSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5nYW5nbGVyZSA9IHJlcXVpcmUoJy4uL2dhbmdsZXJlJyk7XG5cbmdhbmdsZXJlLlNjb3JlcyA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKFNjb3JlcywgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBTY29yZXMoKSB7XG4gICAgcmV0dXJuIFNjb3Jlcy5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIFNjb3Jlcy5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge307XG5cbiAgU2NvcmVzLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmFkZC5zcHJpdGUoMCwgMCwgJ2JhY2tncm91bmQnKTtcbiAgICB0aGlzLmFkZC5zcHJpdGUoMCwgMCwgJ2ljb24nKTtcbiAgICB0aGlzLmFkZC5zcHJpdGUoMCwgMTAsICdxdW90ZScpO1xuICAgIHJldHVybiB0aGlzLmFkZC5idXR0b24odGhpcy5nYW1lLndpZHRoIC8gMiAtIDM4LCB0aGlzLmdhbWUuaGVpZ2h0IC0gODAsICdiYWNrQnV0dG9uJywgdGhpcy5nb0JhY2ssIHRoaXMsIDIsIDEsIDApO1xuICB9O1xuXG4gIFNjb3Jlcy5wcm90b3R5cGUuZ29CYWNrID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUuc3RhcnQoJ0ludHJvJywgdHJ1ZSwgZmFsc2UpO1xuICB9O1xuXG4gIHJldHVybiBTY29yZXM7XG5cbn0pKFBoYXNlci5TdGF0ZSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG5cInVzZSBzdHJpY3RcIjtcbnZhciBnYW5nbGVyZSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGdhbmdsZXJlID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoZ2FuZ2xlcmUsIF9zdXBlcik7XG5cbiAgZ2FuZ2xlcmUucHJvdG90eXBlLmlkID0gJyc7XG5cbiAgZ2FuZ2xlcmUucHJvdG90eXBlLndpZHRoID0gMzIwO1xuXG4gIGdhbmdsZXJlLnByb3RvdHlwZS5oZWlnaHQgPSA0ODA7XG5cbiAgZ2FuZ2xlcmUucHJvdG90eXBlLnJlbmRlcmVyID0gUGhhc2VyLkFVVE87XG5cbiAgZnVuY3Rpb24gZ2FuZ2xlcmUoaWQpIHtcbiAgICB0aGlzLmlkID0gaWQ7XG4gICAgZ2FuZ2xlcmUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIHRoaXMucmVuZGVyZXIsIHRoaXMuaWQpO1xuICAgIHRoaXMuc3RhdGUuYWRkKCdJbml0aWFsaXplJywgZ2FuZ2xlcmUuSW5pdGlhbGl6ZSwgZmFsc2UpO1xuICAgIHRoaXMuc3RhdGUuYWRkKCdBc3NldHMnLCBnYW5nbGVyZS5Bc3NldHMsIGZhbHNlKTtcbiAgICB0aGlzLnN0YXRlLmFkZCgnSW50cm8nLCBnYW5nbGVyZS5JbnRybywgZmFsc2UpO1xuICAgIHRoaXMuc3RhdGUuYWRkKCdDcmVkaXRzJywgZ2FuZ2xlcmUuQ3JlZGl0cywgZmFsc2UpO1xuICAgIHRoaXMuc3RhdGUuYWRkKCdTY29yZXMnLCBnYW5nbGVyZS5TY29yZXMsIGZhbHNlKTtcbiAgICB0aGlzLnN0YXRlLmFkZCgnTGV2ZWxzJywgZ2FuZ2xlcmUuTGV2ZWxzLCBmYWxzZSk7XG4gICAgdGhpcy5zdGF0ZS5hZGQoJ0dhbWVPdmVyJywgZ2FuZ2xlcmUuR2FtZU92ZXIsIGZhbHNlKTtcbiAgICB0aGlzLnN0YXRlLnN0YXJ0KCdJbml0aWFsaXplJyk7XG4gIH1cblxuICByZXR1cm4gZ2FuZ2xlcmU7XG5cbn0pKFBoYXNlci5HYW1lKTtcblxucmVxdWlyZSgnLi9Db25maWcnKTtcblxucmVxdWlyZSgnLi9SYW5kb20nKTtcblxucmVxdWlyZSgnLi9BSScpO1xuXG5yZXF1aXJlKCcuL0FjdG9yJyk7XG5cbnJlcXVpcmUoJy4vUGxheWVyJyk7XG5cbnJlcXVpcmUoJy4vRW5lbXknKTtcblxucmVxdWlyZSgnLi9NYXAnKTtcblxucmVxdWlyZSgnLi9Bc3NldHMnKTtcblxucmVxdWlyZSgnLi9Jbml0aWFsaXplJyk7XG5cbnJlcXVpcmUoJy4vSW50cm8nKTtcblxucmVxdWlyZSgnLi9DcmVkaXRzJyk7XG5cbnJlcXVpcmUoJy4vU2NvcmVzJyk7XG5cbnJlcXVpcmUoJy4vTGV2ZWxzJyk7XG5cbnJlcXVpcmUoJy4vR2FtZU92ZXInKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcblwidXNlIHN0cmljdFwiO1xudmFyIGdhbmdsZXJlO1xuXG53aW5kb3cuZ2FtZSA9IG51bGw7XG5cbmdhbmdsZXJlID0gcmVxdWlyZSgnLi9nYW5nbGVyZScpO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkge1xuICBpZiAodHlwZW9mIEZhc3RDbGljayAhPT0gXCJ1bmRlZmluZWRcIiAmJiBGYXN0Q2xpY2sgIT09IG51bGwpIHtcbiAgICBGYXN0Q2xpY2suYXR0YWNoKGRvY3VtZW50LmJvZHkpO1xuICB9XG4gIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9nb1wiKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGl0bGVcIikuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdibGFjayc7XG4gICAgcmV0dXJuIG5ldyBnYW5nbGVyZSgnZ2FtZScpO1xuICB9LCAxMDAwKTtcbn0sIGZhbHNlKTtcbiJdfQ==
